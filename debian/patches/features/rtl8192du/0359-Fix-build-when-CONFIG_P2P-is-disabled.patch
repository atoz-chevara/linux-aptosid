From 95a4591577932a971588e10b5570cc5c530bfe1a Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Sun, 16 Mar 2014 12:37:23 -0500
Subject: [PATCH 359/390] Fix build when CONFIG_P2P is disabled.

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 core/rtw_cmd.c      | 2 ++
 core/rtw_mlme_ext.c | 5 ++---
 include/autoconf.h  | 4 +---
 include/drv_types.h | 4 ----
 os_dep/os_intfs.c   | 3 ++-
 os_dep/usb_intf.c   | 2 ++
 6 files changed, 9 insertions(+), 11 deletions(-)

--- a/drivers/staging/rtl8192du/core/rtw_cmd.c
+++ b/drivers/staging/rtl8192du/core/rtw_cmd.c
@@ -1891,10 +1891,12 @@ u8 rtw_drvextra_cmd_hdl(struct rtw_adapt
 	case LPS_CTRL_WK_CID:
 		lps_ctrl_wk_hdl(padapter, (u8)pdrvextra_cmd->type_size);
 		break;
+#ifdef CONFIG_P2P
 	case P2P_PROTO_WK_CID:
 		/*	I used the type_size as the type command */
 		p2p_protocol_wk_hdl(padapter, pdrvextra_cmd->type_size);
 		break;
+#endif
 #ifdef CONFIG_92D_AP_MODE
 	case CHECK_HIQ_WK_CID:
 		rtw_chk_hi_queue_hdl(padapter);
--- a/drivers/staging/rtl8192du/core/rtw_mlme_ext.c
+++ b/drivers/staging/rtl8192du/core/rtw_mlme_ext.c
@@ -8075,13 +8075,12 @@ void site_survey(struct rtw_adapter *ada
 	struct mlme_ext_priv *pmlmeext = &adapt->mlmeextpriv;
 	struct mlme_ext_info *pmlmeinfo = &(pmlmeext->mlmext_info);
 	u32 initialgain = 0;
-
-#ifdef CONFIG_P2P
-
 #ifdef CONFIG_92D_AP_MODE
 	u8 stay_buddy_ch = 0;
 #endif
 
+#ifdef CONFIG_P2P
+
 #ifdef CONFIG_CONCURRENT_MODE
 	struct mlme_priv *pmlmepriv = &(adapt->mlmepriv);
 	struct rtw_adapter *pbuddy_adapter = adapt->pbuddy_adapter;
--- a/drivers/staging/rtl8192du/include/autoconf.h
+++ b/drivers/staging/rtl8192du/include/autoconf.h
@@ -21,15 +21,13 @@
 #define DRV_NAME "r8192du"
 #define DRIVERVERSION	"v4.2.1_7122.20130408"
 
-#define CONFIG_IOCTL_CFG80211 1
-
 //#define CONFIG_WAKE_ON_WLAN
 
 #define CONFIG_92D_AP_MODE 1
 
 #define CONFIG_P2P	1
 
-//#define CONFIG_IOCTL_CFG80211
+#define CONFIG_IOCTL_CFG80211
 
 #define RTW_NOTCH_FILTER 0 /* 0:Disable, 1:Enable,*/
 
--- a/drivers/staging/rtl8192du/include/drv_types.h
+++ b/drivers/staging/rtl8192du/include/drv_types.h
@@ -268,14 +268,10 @@ struct rtw_adapter {
 #endif
 
 #ifdef CONFIG_IOCTL_CFG80211
-#ifdef CONFIG_P2P
 	struct cfg80211_wifidirect_info	cfg80211_wdinfo;
-#endif /* CONFIG_P2P */
 #endif /* CONFIG_IOCTL_CFG80211 */
 	u32	setband;
-#ifdef CONFIG_P2P
 	struct wifidirect_info	wdinfo;
-#endif /* CONFIG_P2P */
 
 	void *HalData;
 	u32 hal_data_sz;
--- a/drivers/staging/rtl8192du/os_dep/os_intfs.c
+++ b/drivers/staging/rtl8192du/os_dep/os_intfs.c
@@ -952,8 +952,9 @@ struct rtw_adapter *rtw_drv_if2_init(str
 	}
 
 	memcpy(padapter->eeprompriv.mac_addr, mac, ETH_ALEN);
+#ifdef CONFIG_P2P
 	rtw_init_wifidirect_addrs(padapter, padapter->eeprompriv.mac_addr, padapter->eeprompriv.mac_addr);
-
+#endif
 	memcpy(pnetdev->dev_addr, mac, ETH_ALEN);
 
 	DBG_8192D("MAC Address (if2) = %pM\n", mac);
--- a/drivers/staging/rtl8192du/os_dep/usb_intf.c
+++ b/drivers/staging/rtl8192du/os_dep/usb_intf.c
@@ -729,7 +729,9 @@ static struct rtw_adapter *rtw_usb_if1_i
 	/*  alloc dev name after read efuse. */
 	rtw_init_netdev_name(pnetdev, padapter->registrypriv.ifname);
 	rtw_macaddr_cfg(padapter->eeprompriv.mac_addr);
+#ifdef CONFIG_P2P
 	rtw_init_wifidirect_addrs(padapter, padapter->eeprompriv.mac_addr, padapter->eeprompriv.mac_addr);
+#endif
 	memcpy(pnetdev->dev_addr, padapter->eeprompriv.mac_addr, ETH_ALEN);
 	DBG_8192D("MAC Address from pnetdev->dev_addr= %pM\n", pnetdev->dev_addr);
 
