From a66618265204d2d9bba2cb4c143aa60228646219 Mon Sep 17 00:00:00 2001
From: Stefan Lippers-Hollmann <s.l-h@gmx.de>
Date: Sat, 22 Mar 2014 03:03:28 +0100
Subject: [PATCH 430/456] rtl8192du: replace custom _rtw_mutex_free() with
 mutex_destroy()

Signed-off-by: Stefan Lippers-Hollmann <s.l-h@gmx.de>
---
 core/rtw_xmit.c         |  2 +-
 include/osdep_service.h |  1 -
 os_dep/osdep_service.c  |  5 -----
 os_dep/usb_intf.c       | 18 +++++++++---------
 4 files changed, 10 insertions(+), 16 deletions(-)

--- a/drivers/staging/rtl8192du/core/rtw_xmit.c
+++ b/drivers/staging/rtl8192du/core/rtw_xmit.c
@@ -251,7 +251,7 @@ void _rtw_free_xmit_priv(struct xmit_pri
 
 	rtw_free_hwxmits(padapter);
 
-	_rtw_mutex_free(&pxmitpriv->ack_tx_mutex);
+	mutex_destroy(&pxmitpriv->ack_tx_mutex);
 }
 
 static void update_attrib_vcs_info(struct rtw_adapter *padapter, struct xmit_frame *pxmitframe)
--- a/drivers/staging/rtl8192du/include/osdep_service.h
+++ b/drivers/staging/rtl8192du/include/osdep_service.h
@@ -179,7 +179,6 @@ enum {
 #define rtw_update_mem_stat(flag, sz) do {} while (0)
 
 u32	_rtw_down_sema(struct  semaphore *sema);
-void	_rtw_mutex_free(_mutex *pmutex);
 
 void	_rtw_init_queue(struct __queue *pqueue);
 u32	_rtw_queue_empty(struct __queue *pqueue);
--- a/drivers/staging/rtl8192du/os_dep/osdep_service.c
+++ b/drivers/staging/rtl8192du/os_dep/osdep_service.c
@@ -44,11 +44,6 @@ u32 _rtw_down_sema(struct  semaphore *se
 		return _SUCCESS;
 }
 
-void	_rtw_mutex_free(_mutex *pmutex)
-{
-	mutex_destroy(pmutex);
-}
-
 void	_rtw_init_queue(struct __queue *pqueue)
 {
 
--- a/drivers/staging/rtl8192du/os_dep/usb_intf.c
+++ b/drivers/staging/rtl8192du/os_dep/usb_intf.c
@@ -126,7 +126,7 @@ static u8 rtw_deinit_intf_priv(struct dv
 	u8 rst = _SUCCESS;
 
 	kfree(dvobj->usb_alloc_vendor_req_buf);
-	_rtw_mutex_free(&dvobj->usb_vendor_req_mutex);
+	mutex_destroy(&dvobj->usb_vendor_req_mutex);
 	return rst;
 }
 
@@ -223,10 +223,10 @@ static struct dvobj_priv *usb_dvobj_init
 free_dvobj:
 	if (status != _SUCCESS && pdvobjpriv) {
 		usb_set_intfdata(usb_intf, NULL);
-		_rtw_mutex_free(&pdvobjpriv->hw_init_mutex);
-		_rtw_mutex_free(&pdvobjpriv->h2c_fwcmd_mutex);
-		_rtw_mutex_free(&pdvobjpriv->setch_mutex);
-		_rtw_mutex_free(&pdvobjpriv->setbw_mutex);
+		mutex_destroy(&pdvobjpriv->hw_init_mutex);
+		mutex_destroy(&pdvobjpriv->h2c_fwcmd_mutex);
+		mutex_destroy(&pdvobjpriv->setch_mutex);
+		mutex_destroy(&pdvobjpriv->setbw_mutex);
 		kfree(pdvobjpriv);
 		pdvobjpriv = NULL;
 	}
@@ -243,10 +243,10 @@ static void usb_dvobj_deinit(struct usb_
 	if (dvobj) {
 		/* Modify condition for 92DU DMDP 2010.11.18, by Thomas */
 		rtw_deinit_intf_priv(dvobj);
-		_rtw_mutex_free(&dvobj->hw_init_mutex);
-		_rtw_mutex_free(&dvobj->h2c_fwcmd_mutex);
-		_rtw_mutex_free(&dvobj->setch_mutex);
-		_rtw_mutex_free(&dvobj->setbw_mutex);
+		mutex_destroy(&dvobj->hw_init_mutex);
+		mutex_destroy(&dvobj->h2c_fwcmd_mutex);
+		mutex_destroy(&dvobj->setch_mutex);
+		mutex_destroy(&dvobj->setbw_mutex);
 		kfree(dvobj);
 	}
 
