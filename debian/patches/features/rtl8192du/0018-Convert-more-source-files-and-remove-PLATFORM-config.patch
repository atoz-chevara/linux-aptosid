From e6918e3a427c4e44187c7cbf507d4ae60924e370 Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Wed, 17 Apr 2013 15:48:25 -0500
Subject: [PATCH 018/390] Convert more source files and remove PLATFORM
 configuration dead code

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 core/rtw_mlme.c      | 231 +-----------------------------
 core/rtw_recv.c      | 397 +--------------------------------------------------
 hal/rtl8192d_dm.c    |  39 +----
 hal/rtl8192du_led.c  |   6 -
 hal/rtl8192du_recv.c |  74 ----------
 hal/rtl8192du_xmit.c |  46 ------
 6 files changed, 3 insertions(+), 790 deletions(-)

--- a/drivers/staging/rtl8192du/core/rtw_mlme.c
+++ b/drivers/staging/rtl8192du/core/rtw_mlme.c
@@ -275,38 +275,12 @@ _func_enter_;
 
 	if(!isfreeall)
 	{
-#ifdef PLATFORM_WINDOWS
-
-		delta_time = (curr_time -pnetwork->last_scanned)/10;
-
-		if(delta_time  < lifetime*1000000)// unit:usec
-		{
-			goto exit;
-		}
-
-#endif
-
-#ifdef PLATFORM_LINUX
-
 		delta_time = (curr_time -pnetwork->last_scanned)/HZ;
 
 		if(delta_time < lifetime)// unit:sec
 		{
 			goto exit;
 		}
-
-#endif
-
-#ifdef PLATFORM_FREEBSD
-        //i think needs to check again
-		delta_time = (curr_time -pnetwork->last_scanned)/hz;
-
-		if(delta_time < lifetime)// unit:sec
-		{
-			goto exit;
-		}
-
-#endif
 	}
 
 	_enter_critical_bh(&free_queue->lock, &irqL);
@@ -317,9 +291,6 @@ _func_enter_;
 
 	pmlmepriv->num_of_scanned --;
 
-
-	//DBG_871X("_rtw_free_network:SSID=%s\n", pnetwork->network.Ssid.Ssid);
-
 	_exit_critical_bh(&free_queue->lock, &irqL);
 
 exit:
@@ -532,7 +503,6 @@ _func_exit_;
 }
 
 
-#ifndef PLATFORM_FREEBSD //Baron
 static struct	wlan_network *rtw_dequeue_network(_queue *queue)
 {
 	struct wlan_network *pnetwork;
@@ -541,9 +511,7 @@ _func_enter_;
 _func_exit_;
 	return pnetwork;
 }
-#endif //PLATFORM_FREEBSD
 
-struct	wlan_network *rtw_alloc_network(struct	mlme_priv *pmlmepriv );
 struct	wlan_network *rtw_alloc_network(struct	mlme_priv *pmlmepriv )//(_queue	*free_queue)
 {
 	struct	wlan_network	*pnetwork;
@@ -630,21 +598,6 @@ int is_same_network(WLAN_BSSID_EX *src,
 
 _func_enter_;
 
-#ifdef PLATFORM_OS_XP
-	 if ( ((uint)dst) <= 0x7fffffff ||
-		((uint)src) <= 0x7fffffff ||
-		((uint)&s_cap) <= 0x7fffffff ||
-		((uint)&d_cap) <= 0x7fffffff)
-	{
-		RT_TRACE(_module_rtl871x_mlme_c_,_drv_err_,("\n@@@@ error address of dst\n"));
-
-		KeBugCheckEx(0x87110000, (ULONG_PTR)dst, (ULONG_PTR)src,(ULONG_PTR)&s_cap, (ULONG_PTR)&d_cap);
-
-		return _FALSE;
-	}
-#endif
-
-
 	_rtw_memcpy((u8 *)&s_cap, rtw_get_capability_from_ie(src->IEs), 2);
 	_rtw_memcpy((u8 *)&d_cap, rtw_get_capability_from_ie(dst->IEs), 2);
 
@@ -826,9 +779,6 @@ _func_enter_;
 
 		if ((unsigned long)(pnetwork) < 0x7ffffff)
 		{
-#ifdef PLATFORM_OS_XP
-			KeBugCheckEx(0x87111c1c, (ULONG_PTR)pnetwork, 0, 0,0);
-#endif
 		}
 
 		if (is_same_network(&(pnetwork->network), target))
@@ -1519,11 +1469,6 @@ void rtw_scan_abort(_adapter *adapter)
 	if (check_fwstate(pmlmepriv, _FW_UNDER_SURVEY)) {
 		if (!adapter->bDriverStopped && !adapter->bSurpriseRemoved)
 			DBG_871X(FUNC_NDEV_FMT"waiting for scan_abort time out!\n", FUNC_NDEV_ARG(adapter->pnetdev));
-		#ifdef CONFIG_PLATFORM_MSTAR_TITANIA12
-		//_clr_fwstate_(pmlmepriv, _FW_UNDER_SURVEY);
-		set_survey_timer(pmlmeext, 0);
-		_set_timer(&pmlmepriv->scan_to_timer, 50);
-		#endif
 		rtw_indicate_scan_done(adapter, _TRUE);
 	}
 	pmlmeext->scan_abort = _FALSE;
@@ -2222,25 +2167,6 @@ void _rtw_join_timeout_handler (_adapter
 #endif //CONFIG_LAYER2_ROAMING
 
 _func_enter_;
-#ifdef PLATFORM_FREEBSD
-		rtw_mtx_lock(NULL);
-		 if (callout_pending(&adapter->mlmepriv.assoc_timer.callout)) {
-			 /* callout was reset */
-			 //mtx_unlock(&sc->sc_mtx);
-			 rtw_mtx_unlock(NULL);
-			 return;
-		 }
-		 if (!callout_active(&adapter->mlmepriv.assoc_timer.callout)) {
-			 /* callout was stopped */
-			 //mtx_unlock(&sc->sc_mtx);
-			 rtw_mtx_unlock(NULL);
-			 return;
-		 }
-		 callout_deactivate(&adapter->mlmepriv.assoc_timer.callout);
-
-
-#endif
-
 	DBG_871X("%s, fw_state=%x\n", __FUNCTION__, get_fwstate(pmlmepriv));
 
 	if(adapter->bDriverStopped ||adapter->bSurpriseRemoved)
@@ -2288,9 +2214,6 @@ _func_enter_;
 #ifdef CONFIG_DRVEXT_MODULE_WSC
 	drvext_assoc_fail_indicate(&adapter->drvextpriv);
 #endif
-#ifdef PLATFORM_FREEBSD
-		rtw_mtx_unlock(NULL);
-#endif
 
 _func_exit_;
 
@@ -2431,7 +2354,7 @@ void rtw_dynamic_check_timer_handlder(_a
 #endif	// (LINUX_VERSION_CODE > KERNEL_VERSION(2, 6, 35))
 
 #if (LINUX_VERSION_CODE <= KERNEL_VERSION(2, 6, 35))
-	if( adapter->pnetdev->br_port
+	if( adapter->pnetdev->br_port)
 #else	// (LINUX_VERSION_CODE <= KERNEL_VERSION(2, 6, 35))
 	if( rcu_dereference(adapter->pnetdev->rx_handler_data)
 #endif	// (LINUX_VERSION_CODE <= KERNEL_VERSION(2, 6, 35))
@@ -2512,7 +2435,6 @@ void rtw_set_scan_deny(_adapter *adapter
 #define RTW_SCAN_RESULT_EXPIRE 2000
 #endif
 
-#ifndef PLATFORM_FREEBSD
 /*
 * Select a new join candidate from the original @param candidate and @param competitor
 * @return _TRUE: candidate is updated
@@ -2665,157 +2587,6 @@ _func_exit_;
 
 	return ret;
 }
-#else
-int rtw_select_and_join_from_scanned_queue(struct mlme_priv *pmlmepriv )
-{
-	_irqL	irqL;
-	_list	*phead;
-#ifdef CONFIG_ANTENNA_DIVERSITY
-	u8 CurrentAntenna;
-#endif
-	unsigned char *dst_ssid, *src_ssid;
-	_adapter *adapter;
-	_queue	*queue	= &(pmlmepriv->scanned_queue);
-	struct	wlan_network	*pnetwork = NULL;
-	struct	wlan_network	*pnetwork_max_rssi = NULL;
-	#ifdef CONFIG_LAYER2_ROAMING
-	struct wlan_network * roaming_candidate=NULL;
-	u32 cur_time=rtw_get_current_time();
-	#endif
-
-_func_enter_;
-	_enter_critical_bh(&(pmlmepriv->scanned_queue.lock), &irqL);
-	phead = get_list_head(queue);
-	adapter = (_adapter *)pmlmepriv->nic_hdl;
-
-	pmlmepriv->pscanned = get_next( phead );
-
-	while (!rtw_end_of_queue_search(phead, pmlmepriv->pscanned)) {
-
-		pnetwork = LIST_CONTAINOR(pmlmepriv->pscanned, struct wlan_network, list);
-		if(pnetwork==NULL){
-			RT_TRACE(_module_rtl871x_mlme_c_,_drv_err_,("(2)rtw_select_and_join_from_scanned_queue return _FAIL:(pnetwork==NULL)\n"));
-			_exit_critical_bh(&(pmlmepriv->scanned_queue.lock), &irqL);
-			return _FAIL;
-		}
-
-		dst_ssid = pnetwork->network.Ssid.Ssid;
-		src_ssid = pmlmepriv->assoc_ssid.Ssid;
-
-		pmlmepriv->pscanned = get_next(pmlmepriv->pscanned);
-
-		if(pmlmepriv->assoc_by_bssid==_TRUE) {
-			if(_rtw_memcmp(pnetwork->network.MacAddress, pmlmepriv->assoc_bssid, ETH_ALEN)==_TRUE) {
-				if (check_fwstate(pmlmepriv, _FW_LINKED) == _TRUE) {
-					if(is_same_network(&pmlmepriv->cur_network.network, &pnetwork->network)) {
-						rtw_indicate_connect(adapter);//rtw_indicate_connect again
-						_exit_critical_bh(&(pmlmepriv->scanned_queue.lock), &irqL);
-						return 2;
-					} else {
-						rtw_disassoc_cmd(adapter, 0, _TRUE);
-						rtw_indicate_disconnect(adapter);
-						rtw_free_assoc_resources(adapter, 0);
-						_exit_critical_bh(&(pmlmepriv->scanned_queue.lock), &irqL);
-						goto ask_for_joinbss;
-
-					}
-				} else {
-					_exit_critical_bh(&(pmlmepriv->scanned_queue.lock), &irqL);
-					goto ask_for_joinbss;
-				}
-
-			}
-
-		} else if (pmlmepriv->assoc_ssid.SsidLength == 0) {
-			_exit_critical_bh(&(pmlmepriv->scanned_queue.lock), &irqL);
-			goto ask_for_joinbss;//anyway, join first selected(dequeued) pnetwork if ssid_len=0
-
-		#ifdef CONFIG_LAYER2_ROAMING
-		} else if (rtw_to_roaming(adapter) > 0) {
-
-			if(	(roaming_candidate == NULL ||roaming_candidate->network.Rssi<pnetwork->network.Rssi )
-				&& is_same_ess(&pnetwork->network, &pmlmepriv->cur_network.network)
-				//&&(!is_same_network(&pnetwork->network, &pmlmepriv->cur_network.network))
-				&&  rtw_get_time_interval_ms((u32)pnetwork->last_scanned,cur_time) < 5000
-				) {
-				roaming_candidate = pnetwork;
-				//RT_TRACE(_module_rtl871x_mlme_c_,_drv_err_,
-				DBG_871X
-					("roaming_candidate???: %s("MAC_FMT")\n",
-					roaming_candidate->network.Ssid.Ssid, MAC_ARG(roaming_candidate->network.MacAddress) )
-					//)
-					;
-			}
-			continue;
-		#endif
-
-		} else if ( (pnetwork->network.Ssid.SsidLength==pmlmepriv->assoc_ssid.SsidLength)
-			&&((_rtw_memcmp(dst_ssid, src_ssid, pmlmepriv->assoc_ssid.SsidLength)) == _TRUE)
-			)
-		{
-			RT_TRACE(_module_rtl871x_mlme_c_,_drv_err_,("dst_ssid=%s, src_ssid=%s \n", dst_ssid, src_ssid));
-#ifdef CONFIG_ANTENNA_DIVERSITY
-			rtw_hal_get_def_var(adapter, HAL_DEF_CURRENT_ANTENNA, &(CurrentAntenna));
-			DBG_871X("#### dst_ssid=(%s) Opt_Ant_(%s) , cur_Ant(%s)\n", dst_ssid,
-				(2==pnetwork->network.PhyInfo.Optimum_antenna)?"A":"B",
-				(2==CurrentAntenna)?"A":"B");
-#endif
-
-			if(pmlmepriv->assoc_by_rssi==_TRUE)//if the ssid is the same, select the bss which has the max rssi
-			{
-				if( NULL==pnetwork_max_rssi|| pnetwork->network.Rssi > pnetwork_max_rssi->network.Rssi)
-						pnetwork_max_rssi = pnetwork;
-			} else if(rtw_is_desired_network(adapter, pnetwork) == _TRUE) {
-				if (check_fwstate(pmlmepriv, _FW_LINKED) == _TRUE)
-				{
-					rtw_disassoc_cmd(adapter, 0, _TRUE);
-					rtw_free_assoc_resources(adapter, 0);
-					_exit_critical_bh(&(pmlmepriv->scanned_queue.lock), &irqL);
-					goto ask_for_joinbss;
-				} else {
-					_exit_critical_bh(&(pmlmepriv->scanned_queue.lock), &irqL);
-					goto ask_for_joinbss;
-				}
-
-			}
-
-
-		}
-
-	}
-	_exit_critical_bh(&(pmlmepriv->scanned_queue.lock), &irqL);
-	#ifdef CONFIG_LAYER2_ROAMING
-	if(rtw_to_roaming(adapter) > 0 && roaming_candidate ){
-		pnetwork=roaming_candidate;
-		DBG_871X("select_and_join_from_scanned_queue: roaming_candidate: %s("MAC_FMT")\n",
-			pnetwork->network.Ssid.Ssid, MAC_ARG(pnetwork->network.MacAddress));
-		goto ask_for_joinbss;
-	}
-	#endif
-
-	if((pmlmepriv->assoc_by_rssi==_TRUE)  && (pnetwork_max_rssi!=NULL))
-	{
-		pnetwork = pnetwork_max_rssi;
-		DBG_871X("select_and_join_from_scanned_queue: pnetwork_max_rssi: %s("MAC_FMT")\n",
-			pnetwork->network.Ssid.Ssid, MAC_ARG(pnetwork->network.MacAddress));
-		goto ask_for_joinbss;
-	}
-
-	DBG_871X("(1)rtw_select_and_join_from_scanned_queue return _FAIL\n");
-
-_func_exit_;
-
-     return _FAIL;
-
-ask_for_joinbss:
-
-_func_exit_;
-
-	return rtw_joinbss_cmd(adapter, pnetwork);
-
-}
-#endif //PLATFORM_FREEBSD
-
 
 sint rtw_set_auth(_adapter * adapter,struct security_priv *psecuritypriv)
 {
--- a/drivers/staging/rtl8192du/core/rtw_recv.c
+++ b/drivers/staging/rtl8192du/core/rtw_recv.c
@@ -26,17 +26,7 @@
 #include <ip.h>
 #include <if_ether.h>
 #include <ethernet.h>
-
-#ifdef CONFIG_USB_HCI
 #include <usb_ops.h>
-#endif
-
-#if defined (PLATFORM_LINUX) && defined (PLATFORM_WINDOWS)
-
-#error "Shall be Linux or Windows, but not both!\n"
-
-#endif
-
 #include <wifi.h>
 #include <circ_buf.h>
 
@@ -133,14 +123,9 @@ _func_enter_;
 	precvpriv->read_port_complete_other_urb_err_cnt = 0;
 
 #ifdef CONFIG_NEW_SIGNAL_STAT_PROCESS
-	#ifdef PLATFORM_LINUX
 	_init_timer(&precvpriv->signal_stat_timer, padapter->pnetdev, RTW_TIMER_HDL_NAME(signal_stat), padapter);
-	#elif defined(PLATFORM_OS_CE) || defined(PLATFORM_WINDOWS)
-	_init_timer(&precvpriv->signal_stat_timer, padapter->hndis_adapter, RTW_TIMER_HDL_NAME(signal_stat), padapter);
-	#endif
 
 	precvpriv->signal_stat_sampling_interval = 1000; //ms
-	//precvpriv->signal_stat_converging_constant = 5000; //ms
 
 	rtw_set_signal_stat_timer(precvpriv);
 #endif //CONFIG_NEW_SIGNAL_STAT_PROCESS
@@ -269,16 +254,7 @@ _func_enter_;
 		precvframe->u.hdr.adapter = padapter;
 	}
 #endif
-
-
-#ifdef PLATFORM_WINDOWS
-	rtw_os_read_port(padapter, precvframe->u.hdr.precvbuf);
-#endif
-
-#if defined(PLATFORM_LINUX) || defined(PLATFORM_FREEBSD)
-
-	if(precvframe->u.hdr.pkt)
-	{
+	if(precvframe->u.hdr.pkt) {
 #ifdef CONFIG_BSD_RX_USE_MBUF
 		m_freem(precvframe->u.hdr.pkt);
 #else	// CONFIG_BSD_RX_USE_MBUF
@@ -287,8 +263,6 @@ _func_enter_;
 		precvframe->u.hdr.pkt = NULL;
 	}
 
-#endif //defined(PLATFORM_LINUX) || defined(PLATFORM_FREEBSD)
-
 	_enter_critical_bh(&pfree_recv_queue->lock, &irqL);
 
 	rtw_list_delete(&(precvframe->u.hdr.list));
@@ -1959,21 +1933,6 @@ _func_enter_;
 	}
 #endif //CONFIG_TDLS
 
-#ifdef RTK_DMP_PLATFORM
-	if ( 0 )
-	{
-		DBG_871X("++\n");
-		{
-			int i;
-			for(i=0; i<64;i=i+8)
-				DBG_871X("%02X:%02X:%02X:%02X:%02X:%02X:%02X:%02X:", *(ptr+i),
-				*(ptr+i+1), *(ptr+i+2) ,*(ptr+i+3) ,*(ptr+i+4),*(ptr+i+5), *(ptr+i+6), *(ptr+i+7));
-
-		}
-		DBG_871X("--\n");
-	}
-#endif //RTK_DMP_PLATFORM
-
 	//add version chk
 	if(ver!=0){
 		RT_TRACE(_module_rtl871x_recv_c_,_drv_err_,("validate_recv_data_frame fail! (ver!=0)\n"));
@@ -2204,24 +2163,6 @@ _func_enter_;
 		//ptr -= 16;
 		//_rtw_memcpy(ptr, get_rxmem(precvframe), 16);
 	}
-	else
-	{
-#ifdef PLATFORM_OS_XP
-		NDIS_PACKET_8021Q_INFO VlanPriInfo;
-		UINT32 UserPriority = precvframe->u.hdr.attrib.priority;
-		UINT32 VlanID = (pvlan!=NULL ? get_vlan_id(pvlan) : 0 );
-
-		VlanPriInfo.Value =          // Get current value.
-				NDIS_PER_PACKET_INFO_FROM_PACKET(precvframe->u.hdr.pkt, Ieee8021QInfo);
-
-		VlanPriInfo.TagHeader.UserPriority = UserPriority;
-		VlanPriInfo.TagHeader.VlanId =  VlanID ;
-
-		VlanPriInfo.TagHeader.CanonicalFormatId = 0; // Should be zero.
-		VlanPriInfo.TagHeader.Reserved = 0; // Should be zero.
-		NDIS_PER_PACKET_INFO_FROM_PACKET(precvframe->u.hdr.pkt, Ieee8021QInfo) = VlanPriInfo.Value;
-#endif
-	}
 
 	if(eth_type==0x8712)// append rx status for mp test packets
 	{
@@ -2246,66 +2187,6 @@ _func_exit_;
 }
 #endif
 
-
-#ifdef CONFIG_SDIO_HCI
-#ifdef PLATFORM_LINUX
-static void recvframe_expand_pkt(
-	PADAPTER padapter,
-	union recv_frame *prframe)
-{
-	struct recv_frame_hdr *pfhdr;
-	_pkt *ppkt;
-	u8 shift_sz;
-	u32 alloc_sz;
-
-
-	pfhdr = &prframe->u.hdr;
-
-	//	6 is for IP header 8 bytes alignment in QoS packet case.
-	if (pfhdr->attrib.qos)
-		shift_sz = 6;
-	else
-		shift_sz = 0;
-
-	// for first fragment packet, need to allocate
-	// (1536 + RXDESC_SIZE + drvinfo_sz) to reassemble packet
-	//	8 is for skb->data 8 bytes alignment.
-//	alloc_sz = _RND(1536 + RXDESC_SIZE + pfhdr->attrib.drvinfosize + shift_sz + 8, 128);
-	alloc_sz = 1664; // round (1536 + 24 + 32 + shift_sz + 8) to 128 bytes alignment
-
-	//3 1. alloc new skb
-	// prepare extra space for 4 bytes alignment
-#if (LINUX_VERSION_CODE < KERNEL_VERSION(2,6,18)) // http://www.mail-archive.com/netdev@vger.kernel.org/msg17214.html
-	ppkt = dev_alloc_skb(alloc_sz);
-	if (ppkt) ppkt->dev = padapter->pnetdev;
-#else
-	ppkt = netdev_alloc_skb(padapter->pnetdev, alloc_sz);
-#endif
-	if (!ppkt) return; // no way to expand
-
-	//3 2. Prepare new skb to replace & release old skb
-	// force ppkt->data at 8-byte alignment address
-	skb_reserve(ppkt, 8 - ((SIZE_PTR)ppkt->data & 7));
-	// force ip_hdr at 8-byte alignment address according to shift_sz
-	skb_reserve(ppkt, shift_sz);
-
-	// copy data to new pkt
-	_rtw_memcpy(skb_put(ppkt, pfhdr->len), pfhdr->rx_data, pfhdr->len);
-
-	dev_kfree_skb_any(pfhdr->pkt);
-
-	// attach new pkt to recvframe
-	pfhdr->pkt = ppkt;
-	pfhdr->rx_head = ppkt->head;
-	pfhdr->rx_data = ppkt->data;
-	pfhdr->rx_tail = skb_tail_pointer(ppkt);
-	pfhdr->rx_end = skb_end_pointer(ppkt);
-}
-#else
-#warning "recvframe_expand_pkt not implement, defrag may crash system"
-#endif
-#endif
-
 //perform defrag
 union recv_frame * recvframe_defrag(_adapter *adapter,_queue *defrag_q);
 union recv_frame * recvframe_defrag(_adapter *adapter,_queue *defrag_q)
@@ -2529,26 +2410,18 @@ _func_exit_;
 
 #define ENDIAN_FREE 1
 
-int amsdu_to_msdu(_adapter *padapter, union recv_frame *prframe);
 int amsdu_to_msdu(_adapter *padapter, union recv_frame *prframe)
 {
-#if defined (PLATFORM_LINUX) || defined (PLATFORM_FREEBSD)  //for amsdu TP improvement,Creator: Thomas
 	int	a_len, padding_len;
 	u16	eth_type, nSubframe_Length;
 	u8	nr_subframes, i;
 	unsigned char *pdata;
 	struct rx_pkt_attrib *pattrib;
-#ifndef PLATFORM_FREEBSD
 	unsigned char *data_ptr;
 	_pkt *sub_skb,*subframes[MAX_SUBFRAME_COUNT];
-#endif //PLATFORM_FREEBSD
 	struct recv_priv *precvpriv = &padapter->recvpriv;
 	_queue *pfree_recv_queue = &(precvpriv->free_recv_queue);
 	int	ret = _SUCCESS;
-#ifdef PLATFORM_FREEBSD
-	struct mbuf *sub_m=NULL, *subframes[MAX_SUBFRAME_COUNT];
-	u8 *ptr,offset;
-#endif //PLATFORM_FREEBSD
 	nr_subframes = 0;
 
 	pattrib = &prframe->u.hdr.attrib;
@@ -2556,9 +2429,7 @@ int amsdu_to_msdu(_adapter *padapter, un
 	recvframe_pull(prframe, prframe->u.hdr.attrib.hdrlen);
 
 	if(prframe->u.hdr.attrib.iv_len >0)
-	{
 		recvframe_pull(prframe, prframe->u.hdr.attrib.iv_len);
-	}
 
 	a_len = prframe->u.hdr.len;
 
@@ -2582,7 +2453,6 @@ int amsdu_to_msdu(_adapter *padapter, un
 			goto exit;
 		}
 
-#ifndef PLATFORM_FREEBSD
 		/* move the data point to data content */
 		pdata += ETH_HLEN;
 		a_len -= ETH_HLEN;
@@ -2613,25 +2483,8 @@ int amsdu_to_msdu(_adapter *padapter, un
 			}
 		}
 
-#else   // PLATFORM_FREEBSD
-
-		//PLATFORM_FREEBSD
-		//Allocate a mbuff,
-		//sub_m =m_devget(pdata, nSubframe_Length+12, 12, padapter->pifp,NULL);
-		sub_m =m_devget(pdata, nSubframe_Length+ETH_HLEN, ETHER_ALIGN, padapter->pifp,NULL);
-
-		pdata += ETH_HLEN;
-		a_len -= ETH_HLEN;
-#endif	// PLATFORM_FREEBSD
 
-#ifndef PLATFORM_FREEBSD
-		//sub_skb->dev = padapter->pnetdev;
 		subframes[nr_subframes++] = sub_skb;
-#else  //PLATFORM_FREEBSD
-		//PLATFORM_FREEBSD
-		subframes[nr_subframes++] = sub_m;
-#endif  //PLATFORM_FREEBSD
-
 		if(nr_subframes >= MAX_SUBFRAME_COUNT) {
 			DBG_871X("ParseSubframe(): Too many Subframes! Packets dropped!\n");
 			break;
@@ -2654,7 +2507,6 @@ int amsdu_to_msdu(_adapter *padapter, un
 	}
 
 	for(i=0; i<nr_subframes; i++){
-#ifndef PLATFORM_FREEBSD
 		sub_skb = subframes[i];
 		/* convert hdr + possible LLC headers into Ethernet header */
 #ifdef ENDIAN_FREE
@@ -2731,57 +2583,6 @@ int amsdu_to_msdu(_adapter *padapter, un
 
 			netif_rx(sub_skb);
 		}
-#else //PLATFORM_FREEBSD
-
-		//PLATFORM_FREEBSD
-		sub_m = subframes[i];
-		ptr=mtod(sub_m, u8 *);
-		offset=ETH_HLEN;
-		/* convert hdr + possible LLC headers into Ethernet header */
-#ifdef ENDIAN_FREE
-		eth_type = ntohs(*(u16*)&ptr[offset+6]);
-#else // ENDIAN_FREE
-		eth_type = (  ptr[offset+6] << 8) | ptr[offset+7];
-#endif // ENDIAN_FREE
-		if (sub_m->m_pkthdr.len >= ETH_HLEN+8 &&
-			((_rtw_memcmp(ptr+ETH_HLEN, rtw_rfc1042_header, SNAP_SIZE) &&
-			  eth_type != ETH_P_AARP && eth_type != ETH_P_IPX) ||
-			 _rtw_memcmp(ptr+ETH_HLEN, rtw_bridge_tunnel_header, SNAP_SIZE) )) {
-			/* remove RFC1042 or Bridge-Tunnel encapsulation and replace EtherType */
-			offset+=SNAP_SIZE;
-			_rtw_memcpy(&ptr[offset-ETH_ALEN], pattrib->src, ETH_ALEN);
-			offset-=ETH_ALEN;
-			_rtw_memcpy(&ptr[offset-ETH_ALEN], pattrib->dst, ETH_ALEN);
-			offset-=ETH_ALEN;
-		} else {
-			u16 len;
-			/* Leave Ethernet header part of hdr and full payload */
-			len = htons(sub_m->m_pkthdr.len-offset);
-			_rtw_memcpy(&ptr[offset- 2], &len, 2);
-			offset-=2;
-			_rtw_memcpy(&ptr[offset-ETH_ALEN], pattrib->src, ETH_ALEN);
-			offset-=ETH_ALEN;
-			_rtw_memcpy(&ptr[offset-ETH_ALEN], pattrib->dst, ETH_ALEN);
-			offset-=ETH_ALEN;
-		}
-
-		m_adj(sub_m,offset);
-
-		/* Indicat the packets to upper layer */
-		if (sub_m) {
-			if ( ((u32)(mtod(sub_m, caddr_t) + 14) % 4) != 0)
-				printf("%s()-%d: mtod(sub_m) = %p\n", __FUNCTION__, __LINE__, mtod(sub_m, caddr_t));
-#ifdef CONFIG_RX_INDICATE_QUEUE
-			IF_ENQUEUE(&precvpriv->rx_indicate_queue, sub_m);
-			if (_IF_QLEN(&precvpriv->rx_indicate_queue) <= 1) {
-				taskqueue_enqueue(taskqueue_thread, &precvpriv->rx_indicate_tasklet);
-			}
-#else	// CONFIG_RX_INDICATE_QUEUE
-			(*padapter->pifp->if_input)(padapter->pifp, sub_m);
-#endif	// CONFIG_RX_INDICATE_QUEUE
-		}
-
-#endif //PLATFORM_FREEBSD
 	}
 
 exit:
@@ -2790,202 +2591,6 @@ exit:
 	rtw_free_recvframe(prframe, pfree_recv_queue);//free this recv_frame
 
 	return ret;
-#else  // || defined (PLATFORM_LINUX) || defined (PLATFORM_FREEBSD)
-#ifdef PLATFORM_WINDOWS
-	_irqL irql;
-#endif //PLATFORM_WINDOWS
-	unsigned char *ptr, *pdata, *pbuf, *psnap_type;
-	union recv_frame *pnrframe, *pnrframe_new;
-	int a_len, mv_len, padding_len;
-	u16 eth_type, type_len;
-	u8 bsnaphdr;
-	struct ieee80211_snap_hdr	*psnap;
-	struct _vlan *pvlan;
-	struct recv_priv *precvpriv = &padapter->recvpriv;
-	_queue *pfree_recv_queue = &(precvpriv->free_recv_queue);
-	int ret = _SUCCESS;
-#ifdef PLATFORM_WINDOWS
-	struct recv_buf *precvbuf = prframe->u.hdr.precvbuf;
-#endif //PLATFORM_WINDOWS
-	a_len = prframe->u.hdr.len - prframe->u.hdr.attrib.hdrlen;
-
-	recvframe_pull(prframe, prframe->u.hdr.attrib.hdrlen);
-
-	if(prframe->u.hdr.attrib.iv_len >0)
-	{
-		recvframe_pull(prframe, prframe->u.hdr.attrib.iv_len);
-	}
-
-	pdata = prframe->u.hdr.rx_data;
-
-	prframe->u.hdr.len=0;
-
-	pnrframe = prframe;
-
-
-	do{
-
-		mv_len=0;
-		pnrframe->u.hdr.rx_data = pnrframe->u.hdr.rx_tail = pdata;
-		ptr = pdata;
-
-
-		_rtw_memcpy(pnrframe->u.hdr.attrib.dst, ptr, ETH_ALEN);
-		ptr+=ETH_ALEN;
-		_rtw_memcpy(pnrframe->u.hdr.attrib.src, ptr, ETH_ALEN);
-		ptr+=ETH_ALEN;
-
-		_rtw_memcpy(&type_len, ptr, 2);
-		type_len= ntohs((unsigned short )type_len);
-		ptr +=2;
-		mv_len += ETH_HLEN;
-
-		recvframe_put(pnrframe, type_len+ETH_HLEN);//update tail;
-
-		if(pnrframe->u.hdr.rx_data >= pnrframe->u.hdr.rx_tail || type_len<8)
-		{
-			//panic("pnrframe->u.hdr.rx_data >= pnrframe->u.hdr.rx_tail || type_len<8\n");
-
-			rtw_free_recvframe(pnrframe, pfree_recv_queue);
-
-			goto exit;
-		}
-
-		psnap=(struct ieee80211_snap_hdr *)(ptr);
-		psnap_type=ptr+SNAP_SIZE;
-		if (psnap->dsap==0xaa && psnap->ssap==0xaa && psnap->ctrl==0x03)
-		{
-			if ( _rtw_memcmp(psnap->oui, oui_rfc1042, WLAN_IEEE_OUI_LEN))
-			{
-				bsnaphdr=_TRUE;//wlan_pkt_format = WLAN_PKT_FORMAT_SNAP_RFC1042;
-			}
-			else if (_rtw_memcmp(psnap->oui, SNAP_HDR_APPLETALK_DDP, WLAN_IEEE_OUI_LEN) &&
-					_rtw_memcmp(psnap_type, SNAP_ETH_TYPE_APPLETALK_DDP, 2) )
-			{
-				bsnaphdr=_TRUE;	//wlan_pkt_format = WLAN_PKT_FORMAT_APPLETALK;
-			}
-			else if (_rtw_memcmp( psnap->oui, oui_8021h, WLAN_IEEE_OUI_LEN))
-			{
-				bsnaphdr=_TRUE;	//wlan_pkt_format = WLAN_PKT_FORMAT_SNAP_TUNNEL;
-			}
-			else
-			{
-				RT_TRACE(_module_rtl871x_recv_c_,_drv_err_,("drop pkt due to invalid frame format!\n"));
-
-				//KeBugCheckEx(0x87123333, 0xe0, 0x4c, 0x87, 0xdd);
-
-				//panic("0x87123333, 0xe0, 0x4c, 0x87, 0xdd\n");
-
-				rtw_free_recvframe(pnrframe, pfree_recv_queue);
-
-				goto exit;
-			}
-
-		}
-		else
-		{
-			bsnaphdr=_FALSE;//wlan_pkt_format = WLAN_PKT_FORMAT_OTHERS;
-		}
-
-		ptr += (bsnaphdr?SNAP_SIZE:0);
-		_rtw_memcpy(&eth_type, ptr, 2);
-		eth_type= ntohs((unsigned short )eth_type); //pattrib->ether_type
-
-		mv_len+= 2+(bsnaphdr?SNAP_SIZE:0);
-		ptr += 2;//now move to iphdr;
-
-		pvlan = NULL;
-		if(eth_type == 0x8100) //vlan
-		{
-			pvlan = (struct _vlan *)ptr;
-			ptr+=4;
-			mv_len+=4;
-		}
-
-		if(eth_type==0x0800)//ip
-		{
-			struct iphdr*  piphdr = (struct iphdr*)ptr;
-
-
-			if (piphdr->protocol == 0x06)
-			{
-				RT_TRACE(_module_rtl871x_recv_c_,_drv_info_,("@@@===recv tcp len:%d @@@===\n", pnrframe->u.hdr.len));
-			}
-		}
-#ifdef PLATFORM_OS_XP
-		else
-		{
-			NDIS_PACKET_8021Q_INFO VlanPriInfo;
-			UINT32 UserPriority = pnrframe->u.hdr.attrib.priority;
-			UINT32 VlanID = (pvlan!=NULL ? get_vlan_id(pvlan) : 0 );
-
-			VlanPriInfo.Value =          // Get current value.
-					NDIS_PER_PACKET_INFO_FROM_PACKET(pnrframe->u.hdr.pkt, Ieee8021QInfo);
-
-			VlanPriInfo.TagHeader.UserPriority = UserPriority;
-			VlanPriInfo.TagHeader.VlanId =  VlanID;
-
-			VlanPriInfo.TagHeader.CanonicalFormatId = 0; // Should be zero.
-			VlanPriInfo.TagHeader.Reserved = 0; // Should be zero.
-			NDIS_PER_PACKET_INFO_FROM_PACKET(pnrframe->u.hdr.pkt, Ieee8021QInfo) = VlanPriInfo.Value;
-
-		}
-#endif //PLATFORM_OS_XP
-
-		pbuf = recvframe_pull(pnrframe, (mv_len-sizeof(struct ethhdr)));
-
-		_rtw_memcpy(pbuf, pnrframe->u.hdr.attrib.dst, ETH_ALEN);
-		_rtw_memcpy(pbuf+ETH_ALEN, pnrframe->u.hdr.attrib.src, ETH_ALEN);
-
-		eth_type = htons((unsigned short)eth_type) ;
-		_rtw_memcpy(pbuf+12, &eth_type, 2);
-
-		padding_len = (4) - ((type_len + ETH_HLEN)&(4-1));
-
-		a_len -= (type_len + ETH_HLEN + padding_len) ;
-
-		pnrframe_new = NULL;
-
-		if(a_len > ETH_HLEN) {
-			pnrframe_new = rtw_alloc_recvframe(pfree_recv_queue);
-
-			if(pnrframe_new) {
-				_pkt *pskb = pnrframe->u.hdr.pkt;
-				_rtw_init_listhead(&pnrframe_new->u.hdr.list);
-
-				pnrframe_new->u.hdr.len=0;
-
-				if(pskb)
-					pnrframe_new->u.hdr.pkt = skb_clone(pskb, GFP_ATOMIC);
-				pdata += (type_len + ETH_HLEN + padding_len);
-				pnrframe_new->u.hdr.rx_head = pnrframe_new->u.hdr.rx_data = pnrframe_new->u.hdr.rx_tail = pdata;
-				pnrframe_new->u.hdr.rx_end = pdata + a_len + padding_len;//
-			}
-		}
-
-
-		if ((padapter->bDriverStopped ==_FALSE)&&( padapter->bSurpriseRemoved==_FALSE) )
-		{
-			rtw_recv_indicatepkt(padapter, pnrframe);//indicate this recv_frame
-		}
-		else
-		{
-			rtw_free_recvframe(pnrframe, pfree_recv_queue);//free this recv_frame
-		}
-
-
-		pnrframe = NULL;
-		if(pnrframe_new)
-		{
-			pnrframe = pnrframe_new;
-		}
-
-	}while(pnrframe);
-
-exit:
-
-	return ret;
-#endif
 }
 
 int check_indicate_seq(struct recv_reorder_ctrl *preorder_ctrl, u16 seq_num);
--- a/drivers/staging/rtl8192du/hal/rtl8192d_dm.c
+++ b/drivers/staging/rtl8192du/hal/rtl8192d_dm.c
@@ -656,12 +656,8 @@ static void odm_DIG(
 	if(check_fwstate(pmlmepriv, _FW_LINKED) == _TRUE)
 #endif //CONFIG_CONCURRENT_MODE
 	{
-#ifdef CONFIG_PLATFORM_RTK_DMP
-		pDM_DigTable->rx_gain_range_max = DM_DIG_MAX;
-#else
 		//2 Get minimum RSSI value among associated devices
 		pDM_DigTable->Rssi_val_min = odm_initial_gain_MinPWDB(pAdapter);
-		//DBG_871X("pDM_DigTable->Rssi_val_min = 0x%x\n", pDM_DigTable->Rssi_val_min);
 
 		//2 Modify DIG upper bound
 		if((pDM_DigTable->Rssi_val_min + 20) > DM_DIG_MAX )
@@ -675,24 +671,10 @@ static void odm_DIG(
 			DIG_Dynamic_MIN--;
 		if((pDM_DigTable->Rssi_val_min < 8) && (DIG_Dynamic_MIN > DM_DIG_MIN))
 			DIG_Dynamic_MIN--;
-#endif //CONFIG_PLATFORM_RTK_DMP
-	}
-	else
-	{
+	} else {
 		pDM_DigTable->rx_gain_range_max = DM_DIG_MAX;
 		DIG_Dynamic_MIN = DM_DIG_MIN;
 	}
-#ifdef CONFIG_PLATFORM_RTK_DMP
-	{
-		u8 RSSI_tmp = odm_initial_gain_MinPWDB(pAdapter);
-		if(RSSI_tmp <= DM_DIG_MIN)
-			pDM_DigTable->rx_gain_range_min = DM_DIG_MIN;
-		else if(RSSI_tmp >= DM_DIG_MAX)
-			pDM_DigTable->rx_gain_range_min = DM_DIG_MAX;
-		else
-			pDM_DigTable->rx_gain_range_min = RSSI_tmp;
-	}
-#else //CONFIG_PLATFORM_RTK_DMP
 
 	//1 Modify DIG lower bound, deal with abnorally large false alarm
 	if(FalseAlmCnt->Cnt_all > 10000)
@@ -743,11 +725,6 @@ static void odm_DIG(
 		}
 
 	}
-#endif //CONFIG_PLATFORM_RTK_DMP
-	//DBG_871X("DM_DigTable.ForbiddenIGI = 0x%x, DM_DigTable.LargeFAHit = 0x%x\n",
-		//pDM_DigTable->ForbiddenIGI, pDM_DigTable->LargeFAHit);
-	//DBG_871X("DM_DigTable.rx_gain_range_max = 0x%x, DM_DigTable.rx_gain_range_min = 0x%x\n",
-		//pDM_DigTable->rx_gain_range_max, pDM_DigTable->rx_gain_range_min);
 
 	//1 Adjust initial gain by false alarm
 #ifdef CONFIG_CONCURRENT_MODE
@@ -2363,7 +2340,6 @@ rtl8192d_dm_CheckTXPowerTracking(
  *	01/10/2008	MHC		Create Version 0.
  *
  *---------------------------------------------------------------------------*/
-#ifndef PLATFORM_FREEBSD
 static VOID
 dm_CheckRfCtrlGPIO(
 	IN	PADAPTER	Adapter
@@ -2371,7 +2347,6 @@ dm_CheckRfCtrlGPIO(
 {
 
 }	/* dm_CheckRfCtrlGPIO */
-#endif //PLATFORM_FREEBSD
 
 /*-----------------------------------------------------------------------------
  * Function:	dm_CheckPbcGPIO()
@@ -2454,23 +2429,13 @@ static void	dm_CheckPbcGPIO(IN PADAPTER
 		// After trigger PBC, the variable will be set to false
 		DBG_8192C("CheckPbcGPIO - PBC is pressed, try_cnt=%d\n", i-1);
 
-#ifdef RTK_DMP_PLATFORM
-#if (LINUX_VERSION_CODE > KERNEL_VERSION(2,6,12))
-		kobject_uevent(&padapter->pnetdev->dev.kobj, KOBJ_NET_PBC);
-#else
-		kobject_hotplug(&padapter->pnetdev->class_dev.kobj, KOBJ_NET_PBC);
-#endif
-#else
 
 		if ( padapter->pid[0] == 0 )
 		{	//	0 is the default value and it means the application monitors the HW PBC doesn't privde its pid to driver.
 			return;
 		}
 
-#ifdef PLATFORM_LINUX
 		rtw_signal_process(padapter->pid[0], SIGUSR1);
-#endif
-#endif
 	}
 }
 
@@ -2513,14 +2478,12 @@ static VOID
 dm_RefreshRateAdaptiveMask(	IN	PADAPTER	pAdapter)
 {
 }
-#ifndef PLATFORM_FREEBSD
 static VOID
 dm_CheckProtection(
 	IN	PADAPTER	Adapter
 	)
 {
 }
-#endif //PLATFORM_FREEBSD
 
 static VOID
 dm_CheckStatistics(
--- a/drivers/staging/rtl8192du/hal/rtl8192du_led.c
+++ b/drivers/staging/rtl8192du/hal/rtl8192du_led.c
@@ -47,7 +47,6 @@
 //	Prototype of protected function.
 //================================================================================
 
-#ifndef PLATFORM_FREEBSD //amy temp remove
 static void
 BlinkTimerCallback(
 	unsigned long data
@@ -57,7 +56,6 @@ static void
 BlinkWorkItemCallback(
 	struct work_struct *work
 	);
-#endif //PLATFORM_FREEBSD,amy temp remove
 
 static void
 ResetLedStatus(PLED_871x	pLed) {
@@ -106,12 +104,10 @@ InitLed871x(
 	pLed->bLedBlinkInProgress = _FALSE;
 	pLed->BlinkTimes = 0;
 	pLed->BlinkingLedState = LED_UNKNOWN;
-#ifndef PLATFORM_FREEBSD   //amy, temp remove
 
 	_init_timer(&(pLed->BlinkTimer), padapter->pnetdev, BlinkTimerCallback, pLed);
 
 	_init_workitem(&(pLed->BlinkWorkItem), BlinkWorkItemCallback, pLed);
-#endif //PLATFORM_FREEBSD    //amy, temp remove
 }
 
 
@@ -1222,7 +1218,6 @@ SwLedBlink5(
 
 }
 
-#ifndef PLATFORM_FREEBSD //amy temp remove
 //
 //	Description:
 //		Callback function of LED BlinkTimer,
@@ -1292,7 +1287,6 @@ void BlinkWorkItemCallback(struct work_s
 			break;
 	}
 }
-#endif //PLATFORM_FREEBSD,amy temp remove
 
 
 //================================================================================
--- a/drivers/staging/rtl8192du/hal/rtl8192du_recv.c
+++ b/drivers/staging/rtl8192du/hal/rtl8192du_recv.c
@@ -26,20 +26,9 @@
 #include <ip.h>
 #include <if_ether.h>
 #include <ethernet.h>
-
-#ifdef CONFIG_USB_HCI
 #include <usb_ops.h>
-#endif
-
-#if defined (PLATFORM_LINUX) && defined (PLATFORM_WINDOWS)
-
-#error "Shall be Linux or Windows, but not both!\n"
-
-#endif
-
 #include <wifi.h>
 #include <circ_buf.h>
-
 #include <rtl8192d_hal.h>
 
 void rtl8192du_init_recvbuf(_adapter *padapter, struct recv_buf *precvbuf)
@@ -70,7 +59,6 @@ int	rtl8192du_init_recv_priv(_adapter *p
 	_rtw_init_sema(&precvpriv->terminate_recvthread_sema, 0);//will be removed
 #endif //CONFIG_RECV_THREAD_MODE
 
-#ifdef PLATFORM_LINUX
 	tasklet_init(&precvpriv->recv_tasklet,
 	     (void(*)(unsigned long))rtl8192du_recv_tasklet,
 	     (unsigned long)padapter);
@@ -78,23 +66,13 @@ int	rtl8192du_init_recv_priv(_adapter *p
 #ifdef CONFIG_USE_USB_BUFFER_ALLOC_RX
 	_rtw_init_queue(&precvpriv->recv_buf_pending_queue);
 #endif	// CONFIG_USE_USB_BUFFER_ALLOC_RX
-#endif	// PLATFORM_LINUX
-
-#ifdef PLATFORM_FREEBSD
-	TASK_INIT(&precvpriv->recv_tasklet, 0, rtl8192du_recv_tasklet, padapter);
-#ifdef CONFIG_RX_INDICATE_QUEUE
-	TASK_INIT(&precvpriv->rx_indicate_tasklet, 0, rtw_rx_indicate_tasklet, padapter);
-#endif	// CONFIG_RX_INDICATE_QUEUE
-#endif	// PLATFORM_FREEBSD
 
 #ifdef CONFIG_USB_INTERRUPT_IN_PIPE
 
-#ifdef PLATFORM_LINUX
 	precvpriv->int_in_urb = usb_alloc_urb(0, GFP_KERNEL);
 	if(precvpriv->int_in_urb == NULL){
 		DBG_8192C("alloc_urb for interrupt in endpoint fail !!!!\n");
 	}
-#endif //PLATFORM_LINUX
 	precvpriv->int_in_buf = rtw_malloc(sizeof(INTERRUPT_MSG_FORMAT_EX));
 	if(precvpriv->int_in_buf == NULL){
 		DBG_8192C("alloc_mem for interrupt in endpoint fail !!!!\n");
@@ -138,9 +116,6 @@ int	rtl8192du_init_recv_priv(_adapter *p
 	}
 
 	precvpriv->free_recv_buf_queue_cnt = NR_RECVBUFF;
-
-#if defined(PLATFORM_LINUX) || defined(PLATFORM_FREEBSD)
-
 	skb_queue_head_init(&precvpriv->rx_skb_queue);
 
 #ifdef CONFIG_RX_INDICATE_QUEUE
@@ -159,23 +134,15 @@ int	rtl8192du_init_recv_priv(_adapter *p
 
 		for(i=0; i<NR_PREALLOC_RECV_SKB; i++)
 		{
-	#ifdef PLATFORM_FREEBSD
-			pskb = dev_alloc_skb(MAX_RECVBUF_SZ + RECVBUFF_ALIGN_SZ);
-	#else
 	#if (LINUX_VERSION_CODE < KERNEL_VERSION(2,6,18)) // http://www.mail-archive.com/netdev@vger.kernel.org/msg17214.html
 			pskb = dev_alloc_skb(MAX_RECVBUF_SZ + RECVBUFF_ALIGN_SZ);
 	#else
 			pskb = netdev_alloc_skb(padapter->pnetdev, MAX_RECVBUF_SZ + RECVBUFF_ALIGN_SZ);
 	#endif //(LINUX_VERSION_CODE < KERNEL_VERSION(2,6,18))
-	#endif //PLATFORM_FREEBSD
 
 			if(pskb)
 			{
-				#ifdef PLATFORM_FREEBSD
-				pskb->dev = padapter->pifp;
-				#else
 				pskb->dev = padapter->pnetdev;
-				#endif //PLATFORM_FREEBSD
 
 				tmpaddr = (SIZE_PTR)pskb->data;
 				alignment = tmpaddr & (RECVBUFF_ALIGN_SZ-1);
@@ -190,8 +157,6 @@ int	rtl8192du_init_recv_priv(_adapter *p
 	}
 #endif
 
-#endif
-
 exit:
 
 	return res;
@@ -216,18 +181,14 @@ void rtl8192du_free_recv_priv (_adapter
 		rtw_mfree(precvpriv->pallocated_recv_buf, NR_RECVBUFF *sizeof(struct recv_buf) + 4);
 
 #ifdef CONFIG_USB_INTERRUPT_IN_PIPE
-#ifdef PLATFORM_LINUX
 	if(precvpriv->int_in_urb)
 	{
 		usb_free_urb(precvpriv->int_in_urb);
 	}
-#endif
 	if(precvpriv->int_in_buf)
 		rtw_mfree(precvpriv->int_in_buf, sizeof(INTERRUPT_MSG_FORMAT_EX));
 #endif
 
-#ifdef PLATFORM_LINUX
-
 	if (skb_queue_len(&precvpriv->rx_skb_queue)) {
 		DBG_8192C(KERN_WARNING "rx_skb_queue not empty\n");
 	}
@@ -241,40 +202,5 @@ void rtl8192du_free_recv_priv (_adapter
 	}
 
 	skb_queue_purge(&precvpriv->free_recv_skb_queue);
-
 #endif
-
-#endif // PLATFORM_LINUX
-
-#ifdef PLATFORM_FREEBSD
-	struct sk_buff  *pskb;
-	while (NULL != (pskb = skb_dequeue(&precvpriv->rx_skb_queue)))
-	{
-		dev_kfree_skb_any(pskb);
-
-	}
-
-#ifdef CONFIG_PREALLOC_RECV_SKB
-	while (NULL != (pskb = skb_dequeue(&precvpriv->free_recv_skb_queue)))
-	{
-		dev_kfree_skb_any(pskb);
-
-	}
-#endif
-
-#ifdef CONFIG_RX_INDICATE_QUEUE
-	struct mbuf *m;
-	for (;;) {
-		IF_DEQUEUE(&precvpriv->rx_indicate_queue, m);
-		if (m == NULL)
-			break;
-		m_freem(m);
-	}
-	mtx_destroy(&precvpriv->rx_indicate_queue.ifq_mtx);
-#endif	// CONFIG_RX_INDICATE_QUEUE
-
-#endif // PLATFORM_FREEBSD
-
-
-
 }
--- a/drivers/staging/rtl8192du/hal/rtl8192du_xmit.c
+++ b/drivers/staging/rtl8192du/hal/rtl8192du_xmit.c
@@ -28,24 +28,13 @@
 #include <usb_ops.h>
 #include <rtl8192d_hal.h>
 
-#if defined (PLATFORM_LINUX) && defined (PLATFORM_WINDOWS)
-#error "Shall be Linux or Windows, but not both!\n"
-#endif
-
-
 s32	rtl8192du_init_xmit_priv(_adapter *padapter)
 {
 	struct xmit_priv	*pxmitpriv = &padapter->xmitpriv;
 
-#ifdef PLATFORM_LINUX
 	tasklet_init(&pxmitpriv->xmit_tasklet,
 	     (void(*)(unsigned long))rtl8192du_xmit_tasklet,
 	     (unsigned long)padapter);
-#endif
-#ifdef PLATFORM_FREEBSD
-		TASK_INIT(&pxmitpriv->xmit_tasklet, 1, (task_fn_t *)rtl8192du_xmit_tasklet, (void *)padapter);
-#endif
-
 	return _SUCCESS;
 }
 
@@ -988,11 +977,6 @@ static s32 pre_xmitframe(_adapter *padap
 
 	_enter_critical_bh(&pxmitpriv->lock, &irqL);
 
-#ifdef PLATFORM_FREEBSD
-	//force tx to enqueue, and schedule tx task later.
-	goto enqueue;
-#endif	// PLATFORM_FREEBSD
-
 	if (rtw_txframes_sta_ac_pending(padapter, pattrib) > 0
 #ifdef CONFIG_DUALMAC_CONCURRENT
 		|| (dc_check_xmit(padapter)== _FALSE)
@@ -1041,10 +1025,6 @@ enqueue:
 		return _TRUE;
 	}
 
-#ifdef PLATFORM_FREEBSD
-	rtw_os_xmit_schedule(padapter);
-#endif	// PLATFORM_FREEBSD
-
 	return _FALSE;
 }
 
@@ -1067,18 +1047,13 @@ s32 rtl8192du_hal_xmit(_adapter *padapte
 
 static void rtl8192du_hostap_mgnt_xmit_cb(struct urb *urb)
 {
-#ifdef PLATFORM_LINUX
 	struct sk_buff *skb = (struct sk_buff *)urb->context;
 
-	//DBG_8192C("%s\n", __FUNCTION__);
-
 	dev_kfree_skb_any(skb);
-#endif
 }
 
 s32 rtl8192du_hostap_mgnt_xmit_entry(_adapter *padapter, _pkt *pkt)
 {
-#ifdef PLATFORM_LINUX
 	u16 fc;
 	int rc, len, pipe;
 	unsigned int bmcst, tid, qsel;
@@ -1115,11 +1090,7 @@ s32 rtl8192du_hostap_mgnt_xmit_entry(_ad
 		goto _exit;
 
 	pxmitbuf = pxmit_skb->data;
-#ifdef PLATFORM_FREEBSD
-	urb = rtw_usb_alloc_urb(0, GFP_ATOMIC);
-#else //PLATFORM_FREEBSD
 	urb = usb_alloc_urb(0, GFP_ATOMIC);
-#endif //PLATFORM_FREEBSD
 	if (!urb) {
 		goto _exit;
 	}
@@ -1177,38 +1148,21 @@ s32 rtl8192du_hostap_mgnt_xmit_entry(_ad
 	//translate DMA FIFO addr to pipehandle
 	//pipe = ffaddr2pipehdl(pdvobj, MGT_QUEUE_INX);
 	pipe = usb_sndbulkpipe(pdvobj->pusbdev, pHalData->Queue2EPNum[(u8)MGT_QUEUE_INX]&0x0f);
-#ifdef PLATFORM_FREEBSD
-	rtw_usb_fill_bulk_urb(urb, pdvobj->pusbdev, pipe,
-		pxmit_skb->data, pxmit_skb->len, rtl8192cu_hostap_mgnt_xmit_cb, pxmit_skb);
-#else //PLATFORM_FREEBSD
 	usb_fill_bulk_urb(urb, pdvobj->pusbdev, pipe,
 		pxmit_skb->data, pxmit_skb->len, rtl8192cu_hostap_mgnt_xmit_cb, pxmit_skb);
-#endif //PLATFORM_FREEBSD
 
 	urb->transfer_flags |= URB_ZERO_PACKET;
 	usb_anchor_urb(urb, &phostapdpriv->anchored);
-#ifdef PLATFORM_FREEBSD
-	rc = rtw_usb_submit_urb(urb, GFP_ATOMIC);
-#else //PLATFORM_FREEBSD
 	rc = usb_submit_urb(urb, GFP_ATOMIC);
-#endif //PLATFORM_FREEBSD
 	if (rc < 0) {
 		usb_unanchor_urb(urb);
 		kfree_skb(skb);
 	}
-#ifdef PLATFORM_FREEBSD
-	rtw_usb_free_urb(urb);
-#else //PLATFORM_FREEBSD
 	usb_free_urb(urb);
-#endif //PLATFORM_FREEBSD
-
 
 _exit:
 
 	dev_kfree_skb_any(skb);
-
-#endif
-
 	return 0;
 
 }
