From 6cb385809e187e8560e965fd3b13a88e9000b814 Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Wed, 17 Apr 2013 16:22:09 -0500
Subject: [PATCH 021/210] Remove PLATFORM configuration dead code from rest od
 C files

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 core/rtw_cmd.c        | 43 -------------------------------------------
 core/rtw_efuse.c      |  7 -------
 core/rtw_ieee80211.c  |  2 --
 core/rtw_io.c         | 16 ----------------
 core/rtw_pwrctrl.c    |  9 ---------
 core/rtw_sta_mgt.c    |  8 --------
 hal/rtl8192d_cmd.c    |  4 ----
 hal/rtl8192d_rf6052.c |  2 --
 hal/usb_ops_linux.c   |  6 ------
 9 files changed, 97 deletions(-)

--- a/drivers/staging/rtl8192du/core/rtw_cmd.c
+++ b/drivers/staging/rtl8192du/core/rtw_cmd.c
@@ -41,14 +41,11 @@ sint	_rtw_init_cmd_priv (struct	cmd_priv
 _func_enter_;
 
 	_rtw_init_sema(&(pcmdpriv->cmd_queue_sema), 0);
-	//_rtw_init_sema(&(pcmdpriv->cmd_done_sema), 0);
 	_rtw_init_sema(&(pcmdpriv->terminate_cmdthread_sema), 0);
 
 
 	_rtw_init_queue(&(pcmdpriv->cmd_queue));
 
-	//allocate DMA-able/Non-Page memory for cmd_buf and rsp_buf
-
 	pcmdpriv->cmd_seq = 1;
 
 	pcmdpriv->cmd_allocated_buf = rtw_zmalloc(MAX_CMDSZ + CMDBUFF_ALIGN_SZ);
@@ -74,9 +71,7 @@ _func_enter_;
 exit:
 
 _func_exit_;
-
 	return res;
-
 }
 
 #ifdef CONFIG_C2H_WK
@@ -111,28 +106,6 @@ _func_enter_;
 		}
 	pevtpriv->evt_buf = pevtpriv->evt_allocated_buf  +  4 - ((unsigned int)(pevtpriv->evt_allocated_buf) & 3);
 
-
-#ifdef CONFIG_SDIO_HCI
-	pevtpriv->allocated_c2h_mem = rtw_zmalloc(C2H_MEM_SZ +4);
-
-	if (pevtpriv->allocated_c2h_mem == NULL){
-		res= _FAIL;
-		goto exit;
-	}
-
-	pevtpriv->c2h_mem = pevtpriv->allocated_c2h_mem +  4\
-	- ( (u32)(pevtpriv->allocated_c2h_mem) & 3);
-#ifdef PLATFORM_OS_XP
-	pevtpriv->pc2h_mdl= IoAllocateMdl((u8 *)pevtpriv->c2h_mem, C2H_MEM_SZ , FALSE, FALSE, NULL);
-
-	if(pevtpriv->pc2h_mdl == NULL){
-		res= _FAIL;
-		goto exit;
-	}
-	MmBuildMdlForNonPagedPool(pevtpriv->pc2h_mdl);
-#endif
-#endif //end of CONFIG_SDIO_HCI
-
 	_rtw_init_queue(&(pevtpriv->evt_queue));
 
 exit:
@@ -192,7 +165,6 @@ _func_enter_;
 	if(pcmdpriv){
 		_rtw_spinlock_free(&(pcmdpriv->cmd_queue.lock));
 		_rtw_free_sema(&(pcmdpriv->cmd_queue_sema));
-		//_rtw_free_sema(&(pcmdpriv->cmd_done_sema));
 		_rtw_free_sema(&(pcmdpriv->terminate_cmdthread_sema));
 
 		if (pcmdpriv->cmd_allocated_buf)
@@ -223,12 +195,10 @@ _func_enter_;
 	if (obj == NULL)
 		goto exit;
 
-	//_enter_critical_bh(&queue->lock, &irqL);
 	_enter_critical(&queue->lock, &irqL);
 
 	rtw_list_insert_tail(&obj->list, &queue->queue);
 
-	//_exit_critical_bh(&queue->lock, &irqL);
 	_exit_critical(&queue->lock, &irqL);
 
 exit:
@@ -245,7 +215,6 @@ struct	cmd_obj	*_rtw_dequeue_cmd(_queue
 
 _func_enter_;
 
-	//_enter_critical_bh(&(queue->lock), &irqL);
 	_enter_critical(&queue->lock, &irqL);
 	if (rtw_is_list_empty(&(queue->queue)))
 		obj = NULL;
@@ -255,7 +224,6 @@ _func_enter_;
 		rtw_list_delete(&obj->list);
 	}
 
-	//_exit_critical_bh(&(queue->lock), &irqL);
 	_exit_critical(&queue->lock, &irqL);
 
 _func_exit_;
@@ -312,10 +280,7 @@ int rtw_cmd_filter(struct cmd_priv *pcmd
 		{
 			struct drvextra_cmd_parm	*pdrvextra_cmd_parm = (struct drvextra_cmd_parm	*)cmd_obj->parmbuf;
 			if(pdrvextra_cmd_parm->ec_id == POWER_SAVING_CTRL_WK_CID)
-			{
-				//DBG_871X("==>enqueue POWER_SAVING_CTRL_WK_CID\n");
 				bAllow = _TRUE;
-			}
 		}
 	}
 	#endif
@@ -327,19 +292,11 @@ int rtw_cmd_filter(struct cmd_priv *pcmd
 		|| pcmdpriv->cmdthd_running== _FALSE	//com_thread not running
 	)
 	{
-		//DBG_871X("%s:%s: drop cmdcode:%u, hw_init_completed:%u, cmdthd_running:%u\n", caller_func, __FUNCTION__,
-		//	cmd_obj->cmdcode,
-		//	pcmdpriv->padapter->hw_init_completed,
-		//	pcmdpriv->cmdthd_running
-		//);
-
 		return _FAIL;
 	}
 	return _SUCCESS;
 }
 
-
-
 u32 rtw_enqueue_cmd(struct cmd_priv *pcmdpriv, struct cmd_obj *cmd_obj)
 {
 	int res = _FAIL;
--- a/drivers/staging/rtl8192du/core/rtw_efuse.c
+++ b/drivers/staging/rtl8192du/core/rtw_efuse.c
@@ -884,13 +884,6 @@ efuse_ShadowRead4Byte(
  * 11/12/2008	MHC		Create Version 0.
  *
  *---------------------------------------------------------------------------*/
-#ifdef PLATFORM
-static VOID
-efuse_ShadowWrite1Byte(
-	IN	PADAPTER	pAdapter,
-	IN	u16		Offset,
-	IN	u8		Value);
-#endif //PLATFORM
 static VOID
 efuse_ShadowWrite1Byte(
 	IN	PADAPTER	pAdapter,
--- a/drivers/staging/rtl8192du/core/rtw_ieee80211.c
+++ b/drivers/staging/rtl8192du/core/rtw_ieee80211.c
@@ -1341,9 +1341,7 @@ u8 *rtw_get_p2p_ie(u8 *in_ie, int in_len
 	{
 		eid = in_ie[cnt];
 		if ((in_len < 0) || (cnt > MAX_IE_SZ)) {
-#ifdef PLATFORM_LINUX
 			dump_stack();
-#endif
 			return NULL;
 		}
 		if( ( eid == _VENDOR_SPECIFIC_IE_ ) && ( _rtw_memcmp( &in_ie[cnt+2], p2p_oui, 4) == _TRUE ) )
--- a/drivers/staging/rtl8192du/core/rtw_io.c
+++ b/drivers/staging/rtl8192du/core/rtw_io.c
@@ -53,23 +53,7 @@ jackson@realtek.com.tw
 #include <drv_types.h>
 #include <rtw_io.h>
 #include <osdep_intf.h>
-
-#if defined (PLATFORM_LINUX) && defined (PLATFORM_WINDOWS)
-#error "Shall be Linux or Windows, but not both!\n"
-#endif
-
-#ifdef CONFIG_SDIO_HCI
-#include <sdio_ops.h>
-#endif
-
-#ifdef CONFIG_USB_HCI
 #include <usb_ops.h>
-#endif
-
-#ifdef CONFIG_PCI_HCI
-#include <pci_ops.h>
-#endif
-
 
 u8 _rtw_read8(_adapter *adapter, u32 addr)
 {
--- a/drivers/staging/rtl8192du/core/rtw_pwrctrl.c
+++ b/drivers/staging/rtl8192du/core/rtw_pwrctrl.c
@@ -176,7 +176,6 @@ exit:
 	return ret;
 }
 
-#if defined (PLATFORM_LINUX)||defined (PLATFORM_FREEBSD)
 void rtw_ps_processor(_adapter*padapter)
 {
 #ifdef CONFIG_P2P
@@ -298,8 +297,6 @@ void pwr_state_check_handler(void *Funct
 	_adapter *padapter = (_adapter *)FunctionContext;
 	rtw_ps_cmd(padapter);
 }
-#endif
-
 
 #ifdef CONFIG_LPS
 /*
@@ -1054,10 +1051,6 @@ void rtw_init_pwrctrl_priv(PADAPTER pada
 
 _func_enter_;
 
-#ifdef PLATFORM_WINDOWS
-	pwrctrlpriv->pnp_current_pwr_state=NdisDeviceStateD0;
-#endif
-
 	_init_pwrlock(&pwrctrlpriv->lock);
 	pwrctrlpriv->rf_pwrstate = rf_on;
 	pwrctrlpriv->ips_enter_cnts=0;
@@ -1094,9 +1087,7 @@ _func_enter_;
 
 	pwrctrlpriv->tog = 0x80;
 
-#ifdef PLATFORM_LINUX
 	_init_timer(&(pwrctrlpriv->pwr_state_check_timer), padapter->pnetdev, pwr_state_check_handler, (u8 *)padapter);
-#endif
 
 	#ifdef CONFIG_RESUME_IN_WORKQUEUE
 	_init_workitem(&pwrctrlpriv->resume_work, resume_workitem_callback, NULL);
--- a/drivers/staging/rtl8192du/core/rtw_sta_mgt.c
+++ b/drivers/staging/rtl8192du/core/rtw_sta_mgt.c
@@ -25,14 +25,6 @@
 #include <recv_osdep.h>
 #include <xmit_osdep.h>
 #include <mlme_osdep.h>
-
-
-#if defined (PLATFORM_LINUX) && defined (PLATFORM_WINDOWS)
-
-#error "Shall be Linux or Windows, but not both!\n"
-
-#endif
-
 #include <sta_info.h>
 
 void _rtw_init_stainfo(struct sta_info *psta);
--- a/drivers/staging/rtl8192du/hal/rtl8192d_cmd.c
+++ b/drivers/staging/rtl8192du/hal/rtl8192d_cmd.c
@@ -31,7 +31,6 @@
 
 #include <rtl8192d_hal.h>
 
-#ifndef PLATFORM_FREEBSD
 static BOOLEAN
 CheckWriteH2C(
 	IN	PADAPTER		Adapter,
@@ -43,15 +42,12 @@ CheckWriteH2C(
 
 	valHMETFR = rtw_read8(Adapter, REG_HMETFR);
 
-	//DbgPrint("CheckWriteH2C(): Reg[0x%2x] = %x\n",REG_HMETFR, valHMETFR);
-
 	if(((valHMETFR>>BoxNum)&BIT0) == 1)
 		Result = _TRUE;
 
 	return Result;
 
 }
-#endif //PLATFORM_FREEBSD
 
 static BOOLEAN
 CheckFwReadLastH2C(
--- a/drivers/staging/rtl8192du/hal/rtl8192d_rf6052.c
+++ b/drivers/staging/rtl8192du/hal/rtl8192d_rf6052.c
@@ -941,7 +941,6 @@ PHY_RF6052_Config8192D(
  * 11/20/2008	MHC		Create Version 0.
  *
  *---------------------------------------------------------------------------*/
-#ifndef PLATFORM_FREEBSD //amy, temp remove
 
 u32
 PHY_RFShadowRead(
@@ -965,7 +964,6 @@ PHY_RFShadowWrite(
 	RF_Shadow[eRFPath][Offset].Driver_Write = _TRUE;
 
 }	/* PHY_RFShadowWrite */
-#endif  //amy, temp remove
 
 BOOLEAN
 PHY_RFShadowCompare(
--- a/drivers/staging/rtl8192du/hal/usb_ops_linux.c
+++ b/drivers/staging/rtl8192du/hal/usb_ops_linux.c
@@ -28,12 +28,6 @@
 #include <recv_osdep.h>
 #include <rtl8192d_hal.h>
 
-#if defined (PLATFORM_LINUX) && defined (PLATFORM_WINDOWS)
-
-#error "Shall be Linux or Windows, but not both!\n"
-
-#endif
-
 static int usbctrl_vendorreq(struct intf_hdl *pintfhdl, u8 request, u16 value, u16 index, void *pdata, u16 len, u8 requesttype)
 {
 	_adapter *padapter = pintfhdl->padapter ;
