From 920387c0e269462486e4d91c55ff06482fae0eeb Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Wed, 17 Apr 2013 18:45:12 -0500
Subject: [PATCH 030/390] Remove CONFIG_TX_MCAST2UNI variable

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 core/rtw_ap.c       | 5 -----
 core/rtw_sta_mgt.c  | 6 ------
 hal/usb_halinit.c   | 9 ++-------
 include/autoconf.h  | 2 --
 include/sta_info.h  | 2 --
 include/wifi.h      | 7 +------
 os_dep/os_intfs.c   | 4 ----
 os_dep/xmit_linux.c | 7 -------
 8 files changed, 3 insertions(+), 39 deletions(-)

--- a/drivers/staging/rtl8192du/core/rtw_ap.c
+++ b/drivers/staging/rtl8192du/core/rtw_ap.c
@@ -426,19 +426,15 @@ void	expire_timeout_chk(_adapter *padapt
 		if (chk_sta_is_alive(psta) || !psta->expire_to) {
 			psta->expire_to = pstapriv->expire_to;
 			psta->keep_alive_trycnt = 0;
-			#ifdef CONFIG_TX_MCAST2UNI
 			psta->under_exist_checking = 0;
-			#endif	// CONFIG_TX_MCAST2UNI
 		} else {
 			psta->expire_to--;
 		}
 
 #ifndef CONFIG_ACTIVE_KEEP_ALIVE_CHECK
-#ifdef CONFIG_TX_MCAST2UNI
 		if ( (psta->flags & WLAN_STA_HT) && (psta->htpriv.agg_enable_bitmap || psta->under_exist_checking) ) {
 			// check sta by delba(addba) for 11n STA
 			// ToDo: use CCX report to check for all STAs
-			//DBG_871X("asoc check by DELBA/ADDBA! (pstapriv->expire_to=%d s)(psta->expire_to=%d s), [%02x, %d]\n", pstapriv->expire_to*2, psta->expire_to*2, psta->htpriv.agg_enable_bitmap, psta->under_exist_checking);
 
 			if ( psta->expire_to <= (pstapriv->expire_to - 50 ) ) {
 				DBG_871X("asoc expire by DELBA/ADDBA! (%d s)\n", (pstapriv->expire_to-psta->expire_to)*2);
@@ -453,7 +449,6 @@ void	expire_timeout_chk(_adapter *padapt
 				psta->htpriv.candidate_tid_bitmap = 0x0;//reset
 			}
 		}
-#endif // CONFIG_TX_MCAST2UNI
 #endif //CONFIG_ACTIVE_KEEP_ALIVE_CHECK
 
 		if (psta->expire_to <= 0)
--- a/drivers/staging/rtl8192du/core/rtw_sta_mgt.c
+++ b/drivers/staging/rtl8192du/core/rtw_sta_mgt.c
@@ -72,12 +72,8 @@ _func_enter_;
 	psta->ht_20mhz_set = 0;
 #endif
 
-#ifdef CONFIG_TX_MCAST2UNI
 	psta->under_exist_checking = 0;
-#endif	// CONFIG_TX_MCAST2UNI
-
 	psta->keep_alive_trycnt = 0;
-
 #endif	// CONFIG_AP_MODE
 
 _func_exit_;
@@ -602,9 +598,7 @@ _func_enter_;
 
 #endif	// CONFIG_NATIVEAP_MLME
 
-#ifdef CONFIG_TX_MCAST2UNI
 	psta->under_exist_checking = 0;
-#endif	// CONFIG_TX_MCAST2UNI
 
 #endif	// CONFIG_AP_MODE
 
--- a/drivers/staging/rtl8192du/hal/usb_halinit.c
+++ b/drivers/staging/rtl8192du/hal/usb_halinit.c
@@ -2024,21 +2024,16 @@ HAL_INIT_PROFILE_TAG(HAL_INIT_STAGES_MIS
 	_InitAMPDUAggregation(padapter);
 	_InitBeaconMaxError(padapter, _TRUE);
 
-#if defined(CONFIG_CONCURRENT_MODE) || defined(CONFIG_TX_MCAST2UNI)
+#if defined(CONFIG_CONCURRENT_MODE)
 
 #ifdef CONFIG_CHECK_AC_LIFETIME
 	// Enable lifetime check for the four ACs
 	rtw_write8(padapter, REG_LIFETIME_EN, 0x0F);
 #endif	// CONFIG_CHECK_AC_LIFETIME
 
-#ifdef CONFIG_TX_MCAST2UNI
 	rtw_write16(padapter, REG_PKT_VO_VI_LIFE_TIME, 0x0400);	// unit: 256us. 256ms
 	rtw_write16(padapter, REG_PKT_BE_BK_LIFE_TIME, 0x0400);	// unit: 256us. 256ms
-#else	// CONFIG_TX_MCAST2UNI
-	rtw_write16(padapter, REG_PKT_VO_VI_LIFE_TIME, 0x3000);	// unit: 256us. 3s
-	rtw_write16(padapter, REG_PKT_BE_BK_LIFE_TIME, 0x3000);	// unit: 256us. 3s
-#endif	// CONFIG_TX_MCAST2UNI
-#endif	// CONFIG_CONCURRENT_MODE || CONFIG_TX_MCAST2UNI
+#endif	// CONFIG_CONCURRENT_MODE
 
 	#ifdef CONFIG_LED
 	_InitHWLed(padapter);
--- a/drivers/staging/rtl8192du/include/autoconf.h
+++ b/drivers/staging/rtl8192du/include/autoconf.h
@@ -133,8 +133,6 @@
 #define CONFIG_BR_EXT_BRNAME	"br0"
 #endif	// CONFIG_BR_EXT
 
-#define CONFIG_TX_MCAST2UNI	1	// Support IP multicast->unicast
-
 //#define CONFIG_CHECK_AC_LIFETIME	1	// Check packet lifetime of 4 ACs.
 //#define CONFIG_DISABLE_MCS13TO15	1	// Disable MSC13-15 rates for more stable TX throughput with some 5G APs
 
--- a/drivers/staging/rtl8192du/include/sta_info.h
+++ b/drivers/staging/rtl8192du/include/sta_info.h
@@ -247,9 +247,7 @@ struct sta_info {
 	u8 dev_name[32];
 #endif //CONFIG_P2P
 
-#ifdef CONFIG_TX_MCAST2UNI
 	u8 under_exist_checking;
-#endif	// CONFIG_TX_MCAST2UNI
 
 	u8 keep_alive_trycnt;
 
--- a/drivers/staging/rtl8192du/include/wifi.h
+++ b/drivers/staging/rtl8192du/include/wifi.h
@@ -1137,12 +1137,7 @@ enum P2P_PS_MODE
 #define	WFD_DEVINFO_PC_TDLS					0x0080
 #define	WFD_DEVINFO_HDCP_SUPPORT			0x0100
 
-
-#ifdef  CONFIG_TX_MCAST2UNI
-#define IP_MCAST_MAC(mac)		((mac[0]==0x01)&&(mac[1]==0x00)&&(mac[2]==0x5e))
+#define IP_MCAST_MAC(mac)	((mac[0]==0x01)&&(mac[1]==0x00)&&(mac[2]==0x5e))
 #define ICMPV6_MCAST_MAC(mac)	((mac[0]==0x33)&&(mac[1]==0x33)&&(mac[2]!=0xff))
-#endif	// CONFIG_TX_MCAST2UNI
-
-
 
 #endif // _WIFI_H_
--- a/drivers/staging/rtl8192du/os_dep/os_intfs.c
+++ b/drivers/staging/rtl8192du/os_dep/os_intfs.c
@@ -145,9 +145,7 @@ int rtw_hwpwrp_detect = 0; //HW power  p
 
 int rtw_hw_wps_pbc = 1;
 
-#ifdef CONFIG_TX_MCAST2UNI
 int rtw_mc2u_disable = 0;
-#endif	// CONFIG_TX_MCAST2UNI
 
 int rtw_mac_phy_mode = 0; //0:by efuse, 1:smsp, 2:dmdp, 3:dmsp.
 
@@ -232,9 +230,7 @@ module_param(rtw_fw_file_path, charp, 06
 MODULE_PARM_DESC(rtw_fw_file_path, "The path of fw image");
 #endif //CONFIG_FILE_FWIMG
 
-#ifdef CONFIG_TX_MCAST2UNI
 module_param(rtw_mc2u_disable, int, 0644);
-#endif	// CONFIG_TX_MCAST2UNI
 
 module_param(rtw_mac_phy_mode, int, 0644);
 
--- a/drivers/staging/rtl8192du/os_dep/xmit_linux.c
+++ b/drivers/staging/rtl8192du/os_dep/xmit_linux.c
@@ -243,7 +243,6 @@ void rtw_os_xmit_schedule(_adapter *pada
 
 
 
-#ifdef CONFIG_TX_MCAST2UNI
 int rtw_mlcst2unicst(_adapter *padapter, struct sk_buff *skb)
 {
 	struct	sta_priv *pstapriv = &padapter->stapriv;
@@ -294,17 +293,13 @@ int rtw_mlcst2unicst(_adapter *padapter,
 	dev_kfree_skb_any(skb);
 	return _TRUE;
 }
-#endif	// CONFIG_TX_MCAST2UNI
-
 
 int rtw_xmit_entry(_pkt *pkt, _nic_hdl pnetdev)
 {
 	_adapter *padapter = (_adapter *)rtw_netdev_priv(pnetdev);
 	struct xmit_priv *pxmitpriv = &padapter->xmitpriv;
-#ifdef CONFIG_TX_MCAST2UNI
 	struct mlme_priv	*pmlmepriv = &padapter->mlmepriv;
 	extern int rtw_mc2u_disable;
-#endif	// CONFIG_TX_MCAST2UNI
 	s32 res = 0;
 #if (LINUX_VERSION_CODE>=KERNEL_VERSION(2,6,35))
 	u16 queue;
@@ -332,7 +327,6 @@ _func_enter_;
 	}
 #endif
 
-#ifdef CONFIG_TX_MCAST2UNI
 	if ( !rtw_mc2u_disable
 		&& check_fwstate(pmlmepriv, WIFI_AP_STATE) == _TRUE
 		&& ( IP_MCAST_MAC(pkt->data)
@@ -350,7 +344,6 @@ _func_enter_;
 			//DBG_871X("!m2u );
 		}
 	}
-#endif	// CONFIG_TX_MCAST2UNI
 
 	res = rtw_xmit(padapter, &pkt);
 	if (res < 0) {
