From 79e87ef7dd52a8a06cd0e44f3032059b4a965377 Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Sat, 15 Mar 2014 17:21:46 -0500
Subject: [PATCH 298/390] Remove CONFIG_TSF_RESET_OFFLOAD

This is set when CONFIG_CONCURRENT_MODE is defined.

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 hal/rtl8192d_cmd.c     |  4 ++--
 hal/usb_halinit.c      | 16 ++++++++--------
 include/autoconf.h     |  3 ---
 include/rtl8192d_cmd.h |  4 ++--
 4 files changed, 12 insertions(+), 15 deletions(-)

--- a/drivers/staging/rtl8192du/hal/rtl8192d_cmd.c
+++ b/drivers/staging/rtl8192du/hal/rtl8192d_cmd.c
@@ -818,7 +818,7 @@ void rtl8192d_set_FwJoinBssReport_cmd(st
 
 }
 
-#ifdef CONFIG_TSF_RESET_OFFLOAD
+#ifdef CONFIG_CONCURRENT_MODE
 /*
 	ask FW to Reset sync register at Beacon early interrupt
 */
@@ -857,7 +857,7 @@ int reset_tsf(struct rtw_adapter * adapt
 	return(loop_cnt >= 10) ? _FAIL : true;
 }
 
-#endif	/*  CONFIG_TSF_RESET_OFFLOAD */
+#endif	/*  CONFIG_CONCURRENT_MODE */
 
 #ifdef CONFIG_WOWLAN
 
--- a/drivers/staging/rtl8192du/hal/usb_halinit.c
+++ b/drivers/staging/rtl8192du/hal/usb_halinit.c
@@ -3184,14 +3184,14 @@ static void hw_var_set_opmode(struct rtw
 
 			/* dis BCN0 ATIM  WND if if1 is station */
 			rtw_write8(adapter, REG_BCN_CTRL, rtw_read8(adapter, REG_BCN_CTRL)|BIT(0));
-#ifdef CONFIG_TSF_RESET_OFFLOAD
+#ifdef CONFIG_CONCURRENT_MODE
 			/*  Reset TSF for STA+AP concurrent mode */
 			if (check_buddy_fwstate(adapter, (WIFI_STATION_STATE|WIFI_ASOC_STATE))) {
 				if (reset_tsf(adapter, IFACE_PORT1) == false)
 					DBG_8192D("ERROR! %s()-%d: Reset port1 TSF fail\n",
 						__func__, __LINE__);
 			}
-#endif	/*  CONFIG_TSF_RESET_OFFLOAD */
+#endif	/*  CONFIG_CONCURRENT_MODE */
 		}
 
 	}
@@ -3261,14 +3261,14 @@ static void hw_var_set_opmode(struct rtw
 
 			/* dis BCN1 ATIM  WND if if2 is station */
 			rtw_write8(adapter, REG_BCN_CTRL_1, rtw_read8(adapter, REG_BCN_CTRL_1)|BIT(0));
-#ifdef CONFIG_TSF_RESET_OFFLOAD
+#ifdef CONFIG_CONCURRENT_MODE
 			/*  Reset TSF for STA+AP concurrent mode */
 			if (check_buddy_fwstate(adapter, (WIFI_STATION_STATE|WIFI_ASOC_STATE))) {
 				if (reset_tsf(adapter, IFACE_PORT0) == false)
 					DBG_8192D("ERROR! %s()-%d: Reset port0 TSF fail\n",
 						__func__, __LINE__);
 			}
-#endif /*  CONFIG_TSF_RESET_OFFLOAD */
+#endif /*  CONFIG_CONCURRENT_MODE */
 #endif /*  CONFIG_CONCURRENT_MODE */
 		}
 
@@ -3375,7 +3375,7 @@ static void hw_var_set_correct_tsf(struc
 		/* enable related TSF function */
 		rtw_write8(adapter, REG_BCN_CTRL_1, rtw_read8(adapter, REG_BCN_CTRL_1)|BIT(3));
 
-#ifdef CONFIG_TSF_RESET_OFFLOAD
+#ifdef CONFIG_CONCURRENT_MODE
 		/*  Update buddy port's TSF(TBTT) if it is SoftAP for beacon TX issue! */
 		if ((pmlmeinfo->state&0x03) == WIFI_FW_STATION_STATE
 			&& check_buddy_fwstate(adapter, WIFI_AP_STATE)) {
@@ -3383,7 +3383,7 @@ static void hw_var_set_correct_tsf(struc
 				DBG_8192D("ERROR! %s()-%d: Reset port0 TSF fail\n",
 					__func__, __LINE__);
 		}
-#endif	/*  CONFIG_TSF_RESET_OFFLOAD */
+#endif	/*  CONFIG_CONCURRENT_MODE */
 
 	}
 	else	/*  adapter->iface_type == IFACE_PORT1 */
@@ -3412,7 +3412,7 @@ static void hw_var_set_correct_tsf(struc
 			/* enable related TSF function */
 			rtw_write8(adapter, REG_BCN_CTRL_1, rtw_read8(adapter, REG_BCN_CTRL_1)|BIT(3));
 		}
-#ifdef CONFIG_TSF_RESET_OFFLOAD
+#ifdef CONFIG_CONCURRENT_MODE
 		/*  Update buddy port's TSF if it is SoftAP for beacon TX issue! */
 		if ((pmlmeinfo->state&0x03) == WIFI_FW_STATION_STATE
 			&& check_buddy_fwstate(adapter, WIFI_AP_STATE)) {
@@ -3420,7 +3420,7 @@ static void hw_var_set_correct_tsf(struc
 				DBG_8192D("ERROR! %s()-%d: Reset port1 TSF fail\n",
 					__func__, __LINE__);
 		}
-#endif	/*  CONFIG_TSF_RESET_OFFLOAD */
+#endif	/*  CONFIG_CONCURRENT_MODE */
 	}
 
 	if (((pmlmeinfo->state&0x03) == WIFI_FW_ADHOC_STATE) || ((pmlmeinfo->state&0x03) == WIFI_FW_AP_STATE))
--- a/drivers/staging/rtl8192du/include/autoconf.h
+++ b/drivers/staging/rtl8192du/include/autoconf.h
@@ -50,9 +50,6 @@
 #define RTW_NOTCH_FILTER 0 /* 0:Disable, 1:Enable,*/
 
 //#define CONFIG_CONCURRENT_MODE 1
-#ifdef CONFIG_CONCURRENT_MODE
-	#define CONFIG_TSF_RESET_OFFLOAD 1			/*  For 2 PORT TSF SYNC. */
-#endif	/*  CONFIG_CONCURRENT_MODE */
 
 /*
  * USB VENDOR REQ BUFFER ALLOCATION METHOD
--- a/drivers/staging/rtl8192du/include/rtl8192d_cmd.h
+++ b/drivers/staging/rtl8192du/include/rtl8192d_cmd.h
@@ -103,9 +103,9 @@ void	rtl8192d_Add_RateATid(struct rtw_ad
 void	rtl8192d_set_p2p_ps_offload_cmd(struct rtw_adapter* padapter, u8 p2p_ps_state);
 #endif /* CONFIG_P2P */
 
-#ifdef CONFIG_TSF_RESET_OFFLOAD
+#ifdef CONFIG_CONCURRENT_MODE
 int reset_tsf(struct rtw_adapter * adapter, u8 reset_port);
-#endif	/*  CONFIG_TSF_RESET_OFFLOAD */
+#endif	/*  CONFIG_CONCURRENT_MODE */
 
 #ifdef CONFIG_WOWLAN
 struct set_wowlan_parm {
