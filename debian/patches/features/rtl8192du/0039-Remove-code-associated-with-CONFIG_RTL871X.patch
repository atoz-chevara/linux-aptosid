From 2bdd83f1ef364ee38c0e2af25df3465bc43c9ef4 Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Fri, 19 Apr 2013 15:47:25 -0500
Subject: [PATCH 039/390] Remove code associated with CONFIG_RTL871X

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 core/rtw_cmd.c      |  29 -------------
 core/rtw_eeprom.c   |  50 ----------------------
 core/rtw_mlme.c     |  54 +----------------------
 core/rtw_xmit.c     | 121 +++++++++++-----------------------------------------
 include/drv_types.h |  11 +----
 include/ieee80211.h |  19 +++------
 include/rtw_cmd.h   |   6 ---
 include/rtw_event.h |   4 --
 8 files changed, 33 insertions(+), 261 deletions(-)

--- a/drivers/staging/rtl8192du/core/rtw_cmd.c
+++ b/drivers/staging/rtl8192du/core/rtw_cmd.c
@@ -1042,19 +1042,9 @@ _func_enter_;
 
 	pdev_network->Length = pcmd->cmdsz;
 
-#ifdef CONFIG_RTL8712
-	//notes: translate IELength & Length after assign the Length to cmdsz;
-	pdev_network->Length = cpu_to_le32(pcmd->cmdsz);
-	pdev_network->IELength = cpu_to_le32(pdev_network->IELength);
-	pdev_network->Ssid.SsidLength = cpu_to_le32(pdev_network->Ssid.SsidLength);
-#endif
-
 	res = rtw_enqueue_cmd(pcmdpriv, pcmd);
-
 exit:
-
 _func_exit_;
-
 	return res;
 }
 
@@ -1248,25 +1238,6 @@ _func_enter_;
 
 	pcmd->cmdsz = get_WLAN_BSSID_EX_sz(psecnetwork);//get cmdsz before endian conversion
 
-#ifdef CONFIG_RTL8712
-	//wlan_network endian conversion
-	psecnetwork->Length = cpu_to_le32(psecnetwork->Length);
-	psecnetwork->Ssid.SsidLength= cpu_to_le32(psecnetwork->Ssid.SsidLength);
-	psecnetwork->Privacy = cpu_to_le32(psecnetwork->Privacy);
-	psecnetwork->Rssi = cpu_to_le32(psecnetwork->Rssi);
-	psecnetwork->NetworkTypeInUse = cpu_to_le32(psecnetwork->NetworkTypeInUse);
-	psecnetwork->Configuration.ATIMWindow = cpu_to_le32(psecnetwork->Configuration.ATIMWindow);
-	psecnetwork->Configuration.BeaconPeriod = cpu_to_le32(psecnetwork->Configuration.BeaconPeriod);
-	psecnetwork->Configuration.DSConfig = cpu_to_le32(psecnetwork->Configuration.DSConfig);
-	psecnetwork->Configuration.FHConfig.DwellTime=cpu_to_le32(psecnetwork->Configuration.FHConfig.DwellTime);
-	psecnetwork->Configuration.FHConfig.HopPattern=cpu_to_le32(psecnetwork->Configuration.FHConfig.HopPattern);
-	psecnetwork->Configuration.FHConfig.HopSet=cpu_to_le32(psecnetwork->Configuration.FHConfig.HopSet);
-	psecnetwork->Configuration.FHConfig.Length=cpu_to_le32(psecnetwork->Configuration.FHConfig.Length);
-	psecnetwork->Configuration.Length = cpu_to_le32(psecnetwork->Configuration.Length);
-	psecnetwork->InfrastructureMode = cpu_to_le32(psecnetwork->InfrastructureMode);
-	psecnetwork->IELength = cpu_to_le32(psecnetwork->IELength);
-#endif
-
 	_rtw_init_listhead(&pcmd->list);
 	pcmd->cmdcode = _JoinBss_CMD_;//GEN_CMD_CODE(_JoinBss)
 	pcmd->parmbuf = (unsigned char *)psecnetwork;
--- a/drivers/staging/rtl8192du/core/rtw_eeprom.c
+++ b/drivers/staging/rtl8192du/core/rtw_eeprom.c
@@ -185,21 +185,6 @@ _func_exit_;
 void eeprom_write16(_adapter * padapter, u16 reg, u16 data)
 {
 	u8 x;
-#ifdef CONFIG_RTL8712
-	u8	tmp8_ori,tmp8_new,tmp8_clk_ori,tmp8_clk_new;
-	tmp8_ori=rtw_read8(padapter, 0x102502f1);
-	tmp8_new=tmp8_ori & 0xf7;
-	if(tmp8_ori != tmp8_new){
-		rtw_write8(padapter, 0x102502f1, tmp8_new);
-		RT_TRACE(_module_rtl871x_mp_ioctl_c_,_drv_err_,("====write 0x102502f1=====\n"));
-	}
-	tmp8_clk_ori=rtw_read8(padapter,0x10250003);
-	tmp8_clk_new=tmp8_clk_ori|0x20;
-	if(tmp8_clk_new!=tmp8_clk_ori){
-		RT_TRACE(_module_rtl871x_mp_ioctl_c_,_drv_err_,("====write 0x10250003=====\n"));
-		rtw_write8(padapter, 0x10250003, tmp8_clk_new);
-	}
-#endif
 _func_enter_;
 
 	x = rtw_read8(padapter, EE_9346CR);
@@ -251,13 +236,6 @@ _func_enter_;
 
 	eeprom_clean(padapter );
 exit:
-#ifdef CONFIG_RTL8712
-	if(tmp8_clk_new!=tmp8_clk_ori)
-		rtw_write8(padapter, 0x10250003, tmp8_clk_ori);
-	if(tmp8_new!=tmp8_ori)
-		rtw_write8(padapter, 0x102502f1, tmp8_ori);
-
-#endif
 _func_exit_;
 	return;
 }
@@ -267,21 +245,6 @@ u16 eeprom_read16(_adapter * padapter, u
 
 	u16 x;
 	u16 data=0;
-#ifdef CONFIG_RTL8712
-	u8	tmp8_ori,tmp8_new,tmp8_clk_ori,tmp8_clk_new;
-	tmp8_ori= rtw_read8(padapter, 0x102502f1);
-	tmp8_new = tmp8_ori & 0xf7;
-	if(tmp8_ori != tmp8_new){
-		rtw_write8(padapter, 0x102502f1, tmp8_new);
-		RT_TRACE(_module_rtl871x_mp_ioctl_c_,_drv_err_,("====write 0x102502f1=====\n"));
-	}
-	tmp8_clk_ori=rtw_read8(padapter,0x10250003);
-	tmp8_clk_new=tmp8_clk_ori|0x20;
-	if(tmp8_clk_new!=tmp8_clk_ori){
-		RT_TRACE(_module_rtl871x_mp_ioctl_c_,_drv_err_,("====write 0x10250003=====\n"));
-		rtw_write8(padapter, 0x10250003, tmp8_clk_new);
-	}
-#endif
 _func_enter_;
 
 	if(padapter->bSurpriseRemoved==true){
@@ -310,26 +273,13 @@ _func_enter_;
 
 	eeprom_clean(padapter);
 out:
-#ifdef CONFIG_RTL8712
-	if(tmp8_clk_new!=tmp8_clk_ori)
-		rtw_write8(padapter, 0x10250003, tmp8_clk_ori);
-	if(tmp8_new!=tmp8_ori)
-		rtw_write8(padapter, 0x102502f1, tmp8_ori);
-
-#endif
 _func_exit_;
 	return data;
-
-
 }
 
-
-
-
 //From even offset
 void eeprom_read_sz(_adapter * padapter, u16 reg, u8* data, u32 sz)
 {
-
 	u16 x, data16;
 	u32 i;
 _func_enter_;
--- a/drivers/staging/rtl8192du/core/rtw_mlme.c
+++ b/drivers/staging/rtl8192du/core/rtw_mlme.c
@@ -973,25 +973,6 @@ _func_enter_;
 
 	RT_TRACE(_module_rtl871x_mlme_c_,_drv_info_,("rtw_survey_event_callback, ssid=%s\n",  pnetwork->Ssid.Ssid));
 
-#ifdef CONFIG_RTL8712
-        //endian_convert
-	pnetwork->Length = le32_to_cpu(pnetwork->Length);
-	pnetwork->Ssid.SsidLength = le32_to_cpu(pnetwork->Ssid.SsidLength);
-	pnetwork->Privacy =le32_to_cpu( pnetwork->Privacy);
-	pnetwork->Rssi = le32_to_cpu(pnetwork->Rssi);
-	pnetwork->NetworkTypeInUse =le32_to_cpu(pnetwork->NetworkTypeInUse);
-	pnetwork->Configuration.ATIMWindow = le32_to_cpu(pnetwork->Configuration.ATIMWindow);
-	pnetwork->Configuration.BeaconPeriod = le32_to_cpu(pnetwork->Configuration.BeaconPeriod);
-	pnetwork->Configuration.DSConfig =le32_to_cpu(pnetwork->Configuration.DSConfig);
-	pnetwork->Configuration.FHConfig.DwellTime=le32_to_cpu(pnetwork->Configuration.FHConfig.DwellTime);
-	pnetwork->Configuration.FHConfig.HopPattern=le32_to_cpu(pnetwork->Configuration.FHConfig.HopPattern);
-	pnetwork->Configuration.FHConfig.HopSet=le32_to_cpu(pnetwork->Configuration.FHConfig.HopSet);
-	pnetwork->Configuration.FHConfig.Length=le32_to_cpu(pnetwork->Configuration.FHConfig.Length);
-	pnetwork->Configuration.Length = le32_to_cpu(pnetwork->Configuration.Length);
-	pnetwork->InfrastructureMode = le32_to_cpu(pnetwork->InfrastructureMode);
-	pnetwork->IELength = le32_to_cpu(pnetwork->IELength);
-#endif
-
 	len = get_WLAN_BSSID_EX_sz(pnetwork);
 	if(len > (sizeof(WLAN_BSSID_EX)))
 	{
@@ -1003,11 +984,8 @@ _func_enter_;
 	_enter_critical_bh(&pmlmepriv->lock, &irqL);
 
 	// update IBSS_network 's timestamp
-	if ((check_fwstate(pmlmepriv, WIFI_ADHOC_MASTER_STATE)) == true)
-	{
-		//RT_TRACE(_module_rtl871x_mlme_c_,_drv_err_,"rtw_survey_event_callback : WIFI_ADHOC_MASTER_STATE \n\n");
-		if(_rtw_memcmp(&(pmlmepriv->cur_network.network.MacAddress), pnetwork->MacAddress, ETH_ALEN))
-		{
+	if ((check_fwstate(pmlmepriv, WIFI_ADHOC_MASTER_STATE)) == true) {
+		if(_rtw_memcmp(&(pmlmepriv->cur_network.network.MacAddress), pnetwork->MacAddress, ETH_ALEN)) {
 			struct wlan_network* ibss_wlan = NULL;
 			_irqL	irqL;
 
@@ -1671,27 +1649,6 @@ void rtw_joinbss_event_prehandle(_adapte
 
 _func_enter_;
 
-#ifdef CONFIG_RTL8712
-       //endian_convert
-	pnetwork->join_res = le32_to_cpu(pnetwork->join_res);
-	pnetwork->network_type = le32_to_cpu(pnetwork->network_type);
-	pnetwork->network.Length = le32_to_cpu(pnetwork->network.Length);
-	pnetwork->network.Ssid.SsidLength = le32_to_cpu(pnetwork->network.Ssid.SsidLength);
-	pnetwork->network.Privacy =le32_to_cpu( pnetwork->network.Privacy);
-	pnetwork->network.Rssi = le32_to_cpu(pnetwork->network.Rssi);
-	pnetwork->network.NetworkTypeInUse =le32_to_cpu(pnetwork->network.NetworkTypeInUse) ;
-	pnetwork->network.Configuration.ATIMWindow = le32_to_cpu(pnetwork->network.Configuration.ATIMWindow);
-	pnetwork->network.Configuration.BeaconPeriod = le32_to_cpu(pnetwork->network.Configuration.BeaconPeriod);
-	pnetwork->network.Configuration.DSConfig = le32_to_cpu(pnetwork->network.Configuration.DSConfig);
-	pnetwork->network.Configuration.FHConfig.DwellTime=le32_to_cpu(pnetwork->network.Configuration.FHConfig.DwellTime);
-	pnetwork->network.Configuration.FHConfig.HopPattern=le32_to_cpu(pnetwork->network.Configuration.FHConfig.HopPattern);
-	pnetwork->network.Configuration.FHConfig.HopSet=le32_to_cpu(pnetwork->network.Configuration.FHConfig.HopSet);
-	pnetwork->network.Configuration.FHConfig.Length=le32_to_cpu(pnetwork->network.Configuration.FHConfig.Length);
-	pnetwork->network.Configuration.Length = le32_to_cpu(pnetwork->network.Configuration.Length);
-	pnetwork->network.InfrastructureMode = le32_to_cpu(pnetwork->network.InfrastructureMode);
-	pnetwork->network.IELength = le32_to_cpu(pnetwork->network.IELength );
-#endif
-
 	RT_TRACE(_module_rtl871x_mlme_c_,_drv_info_,("joinbss event call back received with res=%d\n", pnetwork->join_res));
 
 	rtw_get_encrypt_decrypt_from_registrypriv(adapter);
@@ -1997,15 +1954,8 @@ _func_enter_;
 
 	mlmeext_sta_add_event_callback(adapter, psta);
 
-#ifdef CONFIG_RTL8711
-	//submit SetStaKey_cmd to tell fw, fw will allocate an CAM entry for this sta
-	rtw_setstakey_cmd(adapter, (unsigned char*)psta, false);
-#endif
-
 exit:
-
 _func_exit_;
-
 }
 
 void rtw_stadel_event_callback(_adapter *adapter, u8 *pbuf)
--- a/drivers/staging/rtl8192du/core/rtw_xmit.c
+++ b/drivers/staging/rtl8192du/core/rtw_xmit.c
@@ -2307,113 +2307,42 @@ _func_exit_;
 	return pxmitframe;
 }
 
-#if 1
 struct tx_servq *rtw_get_sta_pending(_adapter *padapter, struct sta_info *psta, sint up, u8 *ac)
 {
 	struct tx_servq *ptxservq;
 
 _func_enter_;
 
-	switch (up)
-	{
-		case 1:
-		case 2:
-			ptxservq = &(psta->sta_xmitpriv.bk_q);
-			*(ac) = 3;
-			RT_TRACE(_module_rtl871x_xmit_c_,_drv_info_,("rtw_get_sta_pending : BK \n"));
-			break;
-
-		case 4:
-		case 5:
-			ptxservq = &(psta->sta_xmitpriv.vi_q);
-			*(ac) = 1;
-			RT_TRACE(_module_rtl871x_xmit_c_,_drv_info_,("rtw_get_sta_pending : VI\n"));
-			break;
-
-		case 6:
-		case 7:
-			ptxservq = &(psta->sta_xmitpriv.vo_q);
-			*(ac) = 0;
-			RT_TRACE(_module_rtl871x_xmit_c_,_drv_info_,("rtw_get_sta_pending : VO \n"));
-			break;
-
-		case 0:
-		case 3:
-		default:
-			ptxservq = &(psta->sta_xmitpriv.be_q);
-			*(ac) = 2;
-			RT_TRACE(_module_rtl871x_xmit_c_,_drv_info_,("rtw_get_sta_pending : BE \n"));
+	switch (up) {
+	case 1:
+	case 2:
+		ptxservq = &(psta->sta_xmitpriv.bk_q);
+		*(ac) = 3;
+		RT_TRACE(_module_rtl871x_xmit_c_,_drv_info_,("rtw_get_sta_pending : BK \n"));
 		break;
-
-	}
-
-_func_exit_;
-
-	return ptxservq;
-}
-#else
-__inline static struct tx_servq *rtw_get_sta_pending
-	(_adapter *padapter, _queue **ppstapending, struct sta_info *psta, sint up)
-{
-	struct tx_servq *ptxservq;
-	struct hw_xmit *phwxmits =  padapter->xmitpriv.hwxmits;
-
-_func_enter_;
-
-#ifdef CONFIG_RTL8711
-
-	if(IS_MCAST(psta->hwaddr))
-	{
-		ptxservq = &(psta->sta_xmitpriv.be_q); // we will use be_q to queue bc/mc frames in BCMC_stainfo
-		*ppstapending = &padapter->xmitpriv.bm_pending;
-	}
-	else
-#endif
-	{
-		switch (up)
-		{
-			case 1:
-			case 2:
-				ptxservq = &(psta->sta_xmitpriv.bk_q);
-				*ppstapending = &padapter->xmitpriv.bk_pending;
-				(phwxmits+3)->accnt++;
-				RT_TRACE(_module_rtl871x_xmit_c_,_drv_info_,("rtw_get_sta_pending : BK \n"));
-				break;
-
-			case 4:
-			case 5:
-				ptxservq = &(psta->sta_xmitpriv.vi_q);
-				*ppstapending = &padapter->xmitpriv.vi_pending;
-				(phwxmits+1)->accnt++;
-				RT_TRACE(_module_rtl871x_xmit_c_,_drv_info_,("rtw_get_sta_pending : VI\n"));
-				break;
-
-			case 6:
-			case 7:
-				ptxservq = &(psta->sta_xmitpriv.vo_q);
-				*ppstapending = &padapter->xmitpriv.vo_pending;
-				(phwxmits+0)->accnt++;
-				RT_TRACE(_module_rtl871x_xmit_c_,_drv_info_,("rtw_get_sta_pending : VO \n"));
-				break;
-
-			case 0:
-			case 3:
-			default:
-				ptxservq = &(psta->sta_xmitpriv.be_q);
-				*ppstapending = &padapter->xmitpriv.be_pending;
-				(phwxmits+2)->accnt++;
-				RT_TRACE(_module_rtl871x_xmit_c_,_drv_info_,("rtw_get_sta_pending : BE \n"));
-			break;
-
-		}
-
+	case 4:
+	case 5:
+		ptxservq = &(psta->sta_xmitpriv.vi_q);
+		*(ac) = 1;
+		RT_TRACE(_module_rtl871x_xmit_c_,_drv_info_,("rtw_get_sta_pending : VI\n"));
+		break;
+	case 6:
+	case 7:
+		ptxservq = &(psta->sta_xmitpriv.vo_q);
+		*(ac) = 0;
+		RT_TRACE(_module_rtl871x_xmit_c_,_drv_info_,("rtw_get_sta_pending : VO \n"));
+		break;
+	case 0:
+	case 3:
+	default:
+		ptxservq = &(psta->sta_xmitpriv.be_q);
+		*(ac) = 2;
+		RT_TRACE(_module_rtl871x_xmit_c_,_drv_info_,("rtw_get_sta_pending : BE \n"));
+	break;
 	}
-
 _func_exit_;
-
 	return ptxservq;
 }
-#endif
 
 /*
  * Will enqueue pxmitframe to the proper queue,
--- a/drivers/staging/rtl8192du/include/drv_types.h
+++ b/drivers/staging/rtl8192du/include/drv_types.h
@@ -32,16 +32,7 @@
 #include <wlan_bssdef.h>
 #include <drv_types_linux.h>
 
-enum _NIC_VERSION {
-
-	RTL8711_NIC,
-	RTL8712_NIC,
-	RTL8713_NIC,
-	RTL8716_NIC
-
-};
-
-enum{
+enum {
 	UP_LINK,
 	DOWN_LINK,
 };
--- a/drivers/staging/rtl8192du/include/ieee80211.h
+++ b/drivers/staging/rtl8192du/include/ieee80211.h
@@ -20,21 +20,12 @@
 #ifndef __IEEE80211_H
 #define __IEEE80211_H
 
+#include <drv_conf.h>
+#include <osdep_service.h>
+#include <drv_types.h>
+#include "wifi.h"
 
-#ifndef CONFIG_RTL8711FW
-
-	#include <drv_conf.h>
-	#include <osdep_service.h>
-	#include <drv_types.h>
-	#include "wifi.h"
-
-	#include <linux/wireless.h>
-#else
-
-	#include <list.h>
-
-#endif
-
+#include <linux/wireless.h>
 #define MGMT_QUEUE_NUM 5
 
 #define ETH_ALEN	6
--- a/drivers/staging/rtl8192du/include/rtw_cmd.h
+++ b/drivers/staging/rtl8192du/include/rtw_cmd.h
@@ -27,8 +27,6 @@
 
 #define C2H_MEM_SZ (16*1024)
 
-#ifndef CONFIG_RTL8711FW
-
 	#include <osdep_service.h>
 	#include <ieee80211.h> // <ieee80211/ieee80211.h>
 
@@ -149,10 +147,6 @@ extern void rtw_evt_notify_isr(struct ev
 u8 p2p_protocol_wk_cmd(_adapter*padapter, int intCmdType );
 #endif //CONFIG_P2P
 
-#else
-	#include <ieee80211.h>
-#endif	/* CONFIG_RTL8711FW */
-
 enum rtw_drvextra_cmd_id
 {
 	NONE_WK_CID,
--- a/drivers/staging/rtl8192du/include/rtw_event.h
+++ b/drivers/staging/rtl8192du/include/rtw_event.h
@@ -22,7 +22,6 @@
 #include <drv_conf.h>
 #include <osdep_service.h>
 
-#ifndef CONFIG_RTL8711FW
 #include <wlan_bssdef.h>
 #if (LINUX_VERSION_CODE < KERNEL_VERSION(2,6,26))
 #include <asm/semaphore.h>
@@ -30,9 +29,6 @@
 #include <linux/semaphore.h>
 #endif
 #include <linux/sem.h>
-#else
-#include <wlan_bssdef.h>
-#endif//CONFIG_RTL8711FW
 
 #ifdef CONFIG_H2CLBK
 #include <h2clbk.h>
