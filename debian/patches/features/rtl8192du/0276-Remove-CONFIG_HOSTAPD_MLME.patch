From c10e4850d5097d376dc1ec89e3886e5437b33958 Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Sat, 15 Mar 2014 14:22:14 -0500
Subject: [PATCH 276/390] Remove CONFIG_HOSTAPD_MLME

This configuration variable is not selected.

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 core/rtw_mlme_ext.c     |  12 +-----
 hal/hal_intf.c          |   9 ----
 hal/rtl8192du_xmit.c    | 110 ------------------------------------------------
 hal/usb_halinit.c       |   5 ---
 include/hal_intf.h      |  27 ------------
 include/rtl8192d_xmit.h |   9 ----
 include/rtw_mlme.h      |   9 +---
 os_dep/mlme_linux.c     | 110 ------------------------------------------------
 os_dep/recv_linux.c     |  29 -------------
 os_dep/usb_intf.c       |  19 +++------
 10 files changed, 9 insertions(+), 330 deletions(-)

--- a/drivers/staging/rtl8192du/core/rtw_mlme_ext.c
+++ b/drivers/staging/rtl8192du/core/rtw_mlme_ext.c
@@ -615,19 +615,11 @@ void mgt_dispatcher(struct rtw_adapter *
 	case WIFI_ASSOCREQ:
 	case WIFI_REASSOCREQ:
 		_mgt_dispatcher(adapt, ptable, precv_frame);
-#ifdef CONFIG_HOSTAPD_MLME
-		if (check_fwstate(pmlmepriv, WIFI_AP_STATE) == true)
-			rtw_hostapd_mlme_rx(adapt, precv_frame);
-#endif
 		break;
 	case WIFI_PROBEREQ:
-		if (check_fwstate(pmlmepriv, WIFI_AP_STATE) == true) {
-#ifdef CONFIG_HOSTAPD_MLME
-			rtw_hostapd_mlme_rx(adapt, precv_frame);
-#else
+		if (check_fwstate(pmlmepriv, WIFI_AP_STATE) == true)
 			_mgt_dispatcher(adapt, ptable, precv_frame);
-#endif
-		} else
+		else
 			_mgt_dispatcher(adapt, ptable, precv_frame);
 		break;
 	case WIFI_BEACON:
--- a/drivers/staging/rtl8192du/hal/hal_intf.c
+++ b/drivers/staging/rtl8192du/hal/hal_intf.c
@@ -321,15 +321,6 @@ void rtw_hal_bcn_related_reg_setting(str
 		padapter->HalFunc.SetBeaconRelatedRegistersHandler(padapter);
 }
 
-#ifdef CONFIG_HOSTAPD_MLME
-s32	rtw_hal_hostap_mgnt_xmit_entry(struct rtw_adapter *padapter, struct sk_buff *pkt)
-{
-	if (padapter->HalFunc.hostap_mgnt_xmit_entry)
-		return padapter->HalFunc.hostap_mgnt_xmit_entry(padapter, pkt);
-	return _FAIL;
-}
-#endif /* CONFIG_HOSTAPD_MLME */
-
 void rtw_hal_notch_filter(struct rtw_adapter *adapter, bool enable)
 {
 	if (adapter->HalFunc.hal_notch_filter)
--- a/drivers/staging/rtl8192du/hal/rtl8192du_xmit.c
+++ b/drivers/staging/rtl8192du/hal/rtl8192du_xmit.c
@@ -845,113 +845,3 @@ s32 rtl8192du_hal_xmit(struct rtw_adapte
 {
 	return pre_xmitframe(padapter, pxmitframe);
 }
-
-#ifdef  CONFIG_HOSTAPD_MLME
-
-static void rtl8192du_hostap_mgnt_xmit_cb(struct urb *urb)
-{
-	struct sk_buff *skb = (struct sk_buff *)urb->context;
-
-	dev_kfree_skb_any(skb);
-}
-
-s32 rtl8192du_hostap_mgnt_xmit_entry(struct rtw_adapter *padapter, struct sk_buff *pkt)
-{
-	u16 fc;
-	int rc, len, pipe;
-	unsigned int bmcst, tid, qsel;
-	struct sk_buff *skb, *pxmit_skb;
-	struct urb *urb;
-	unsigned char *pxmitbuf;
-	struct tx_desc *ptxdesc;
-	struct ieee80211_hdr *tx_hdr;
-	struct hostapd_priv *phostapdpriv = padapter->phostapdpriv;
-	struct net_device *pnetdev = padapter->pnetdev;
-	struct hal_data_8192du  *pHalData = GET_HAL_DATA(padapter);
-	struct dvobj_priv *pdvobj = adapter_to_dvobj(padapter);
-
-	skb = pkt;
-	len = skb->len;
-	tx_hdr = (struct ieee80211_3ddr_hdr *)(skb->data);
-	fc = le16_to_cpu(tx_hdr->frame_control);
-	bmcst = IS_MCAST(tx_hdr->addr1);
-
-	if ((fc & RTW_IEEE80211_FCTL_FTYPE) != RTW_IEEE80211_FTYPE_MGMT)
-		goto _exit;
-
-	pxmit_skb = netdev_alloc_skb(pnetdev, len + TXDESC_SIZE);
-
-	if (!pxmit_skb)
-		goto _exit;
-
-	pxmitbuf = pxmit_skb->data;
-	urb = usb_alloc_urb(0, GFP_ATOMIC);
-	if (!urb) {
-		goto _exit;
-	}
-
-	/*  ----- fill tx desc ----- */
-	ptxdesc = (struct tx_desc *)pxmitbuf;
-	memset(ptxdesc, 0, sizeof(*ptxdesc));
-
-	/* offset 0 */
-	ptxdesc->txdw0 |= cpu_to_le32(len&0x0000ffff);
-	ptxdesc->txdw0 |= cpu_to_le32(((TXDESC_SIZE+OFFSET_SZ)<<OFFSET_SHT)&0x00ff0000);/* default = 32 bytes for TX Desc */
-	ptxdesc->txdw0 |= cpu_to_le32(OWN | FSG | LSG);
-
-	if (bmcst)
-	{
-		ptxdesc->txdw0 |= cpu_to_le32(BIT(24));
-	}
-
-	/* offset 4 */
-	ptxdesc->txdw1 |= cpu_to_le32(0x00);/* MAC_ID */
-
-	ptxdesc->txdw1 |= cpu_to_le32((0x12<<QSEL_SHT)&0x00001f00);
-
-	ptxdesc->txdw1 |= cpu_to_le32((0x06<< 16) & 0x000f0000);/* b mode */
-
-	/* offset 8 */
-
-	/* offset 12 */
-	ptxdesc->txdw3 |= cpu_to_le32((le16_to_cpu(tx_hdr->seq_ctl)<<16)&0xffff0000);
-
-	/* offset 16 */
-	ptxdesc->txdw4 |= cpu_to_le32(BIT(8));/* driver uses rate */
-
-	/* offset 20 */
-
-	/* HW append seq */
-	ptxdesc->txdw4 |= cpu_to_le32(BIT(7)); /*  Hw set sequence number */
-	ptxdesc->txdw3 |= cpu_to_le32((8 <<28)); /* set bit3 to 1. Suugested by TimChen. 2009.12.29. */
-
-	rtl8192cu_cal_txdesc_chksum(ptxdesc);
-	/*  ----- end of fill tx desc ----- */
-
-	/*  */
-	skb_put(pxmit_skb, len + TXDESC_SIZE);
-	pxmitbuf = pxmitbuf + TXDESC_SIZE;
-	memcpy(pxmitbuf, skb->data, len);
-
-	/*  ----- prepare urb for submit ----- */
-
-	/* translate DMA FIFO addr to pipehandle */
-	pipe = usb_sndbulkpipe(pdvobj->pusbdev, pHalData->Queue2EPNum[(u8)MGT_QUEUE_INX]&0x0f);
-	usb_fill_bulk_urb(urb, pdvobj->pusbdev, pipe,
-		pxmit_skb->data, pxmit_skb->len, rtl8192cu_hostap_mgnt_xmit_cb, pxmit_skb);
-
-	urb->transfer_flags |= URB_ZERO_PACKET;
-	usb_anchor_urb(urb, &phostapdpriv->anchored);
-	rc = usb_submit_urb(urb, GFP_ATOMIC);
-	if (rc < 0) {
-		usb_unanchor_urb(urb);
-		kfree_skb(skb);
-	}
-	usb_free_urb(urb);
-
-_exit:
-
-	dev_kfree_skb_any(skb);
-	return 0;
-}
-#endif
--- a/drivers/staging/rtl8192du/hal/usb_halinit.c
+++ b/drivers/staging/rtl8192du/hal/usb_halinit.c
@@ -4998,10 +4998,5 @@ void rtl8192du_set_hal_ops(struct rtw_ad
 	pHalFunc->hal_xmit = &rtl8192du_hal_xmit;
 	pHalFunc->mgnt_xmit = &rtl8192du_mgnt_xmit;
 
-#ifdef CONFIG_HOSTAPD_MLME
-	pHalFunc->hostap_mgnt_xmit_entry = &rtl8192du_hostap_mgnt_xmit_entry;
-#endif
-
 	rtl8192d_set_hal_ops(pHalFunc);
-
 }
--- a/drivers/staging/rtl8192du/include/hal_intf.h
+++ b/drivers/staging/rtl8192du/include/hal_intf.h
@@ -188,10 +188,6 @@ struct hal_ops {
 	void	(*write_bbreg)(struct rtw_adapter * adapter, u32 RegAddr, u32 BitMask, u32 Data);
 	u32	(*read_rfreg)(struct rtw_adapter * adapter, enum RF_RADIO_PATH_E eRFPath, u32 RegAddr, u32 BitMask);
 	void	(*write_rfreg)(struct rtw_adapter * adapter, enum RF_RADIO_PATH_E eRFPath, u32 RegAddr, u32 BitMask, u32 Data);
-
-#ifdef CONFIG_HOSTAPD_MLME
-	s32	(*hostap_mgnt_xmit_entry)(struct rtw_adapter * adapter, struct sk_buff *pkt);
-#endif
 	void (*EfusePowerSwitch)(struct rtw_adapter * adapter, u8 bWrite, u8 PwrState);
 	void (*ReadEFuse)(struct rtw_adapter * adapter, u8 efuseType, u16 _offset, u16 _size_byte, u8 *pbuf, bool bPseudoTest);
 	void (*EFUSEGetEfuseDefinition)(struct rtw_adapter * adapter, u8 efuseType, u8 type, void * *pOut, bool bPseudoTest);
@@ -293,69 +289,46 @@ struct wowlan_ioctl_param{
 
 void rtw_hal_def_value_init(struct rtw_adapter *padapter);
 void rtw_hal_free_data(struct rtw_adapter *padapter);
-
 void rtw_hal_dm_init(struct rtw_adapter *padapter);
 void rtw_hal_dm_deinit(struct rtw_adapter *padapter);
 void rtw_hal_sw_led_init(struct rtw_adapter *padapter);
 void rtw_hal_sw_led_deinit(struct rtw_adapter *padapter);
-
 uint rtw_hal_init(struct rtw_adapter *padapter);
 uint rtw_hal_deinit(struct rtw_adapter *padapter);
 void rtw_hal_stop(struct rtw_adapter *padapter);
-
 void rtw_hal_set_hwreg(struct rtw_adapter * padapter, u8 variable, u8 *val);
 void rtw_hal_get_hwreg(struct rtw_adapter * padapter, u8 variable, u8 *val);
-
 void rtw_hal_chip_configure(struct rtw_adapter *padapter);
 void rtw_hal_read_chip_info(struct rtw_adapter *padapter);
 void rtw_hal_read_chip_version(struct rtw_adapter *padapter);
-
 u8 rtw_hal_set_def_var(struct rtw_adapter *padapter, enum HAL_DEF_VARIABLE eVariable,
 		       void *pValue);
 u8 rtw_hal_get_def_var(struct rtw_adapter *padapter, enum HAL_DEF_VARIABLE eVariable,
 		       void *pValue);
-
 void rtw_hal_enable_interrupt(struct rtw_adapter *padapter);
 void rtw_hal_disable_interrupt(struct rtw_adapter *padapter);
-
 u32 rtw_hal_inirp_init(struct rtw_adapter *padapter);
 u32 rtw_hal_inirp_deinit(struct rtw_adapter *padapter);
-
 u8 rtw_hal_intf_ps_func(struct rtw_adapter *padapter, enum HAL_INTF_PS_FUNC efunc_id, u8* val);
-
 s32 rtw_hal_xmit(struct rtw_adapter *padapter, struct xmit_frame *pxmitframe);
 s32 rtw_hal_mgnt_xmit(struct rtw_adapter *padapter, struct xmit_frame *pmgntframe);
-
 s32 rtw_hal_init_xmit_priv(struct rtw_adapter *padapter);
 void rtw_hal_free_xmit_priv(struct rtw_adapter *padapter);
-
 s32 rtw_hal_init_recv_priv(struct rtw_adapter *padapter);
 void rtw_hal_free_recv_priv(struct rtw_adapter *padapter);
-
 void rtw_hal_update_ra_mask(struct rtw_adapter *padapter, u32 mac_id);
 void rtw_hal_add_ra_tid(struct rtw_adapter *padapter, u32 bitmap, u8 arg);
-
 void rtw_hal_bcn_related_reg_setting(struct rtw_adapter *padapter);
-
 u32 rtw_hal_read_bbreg(struct rtw_adapter *padapter, u32 RegAddr, u32 BitMask);
 void rtw_hal_write_bbreg(struct rtw_adapter *padapter, u32 RegAddr, u32 BitMask, u32 Data);
 u32 rtw_hal_read_rfreg(struct rtw_adapter *padapter, u32 eRFPath, u32 RegAddr, u32 BitMask);
 void rtw_hal_write_rfreg(struct rtw_adapter *padapter, u32 eRFPath, u32 RegAddr, u32 BitMask, u32 Data);
-
 s32 rtw_hal_interrupt_handler(struct rtw_adapter *padapter);
-
 void rtw_hal_set_bwmode(struct rtw_adapter *padapter, enum HT_CHANNEL_WIDTH Bandwidth, u8 Offset);
 void rtw_hal_set_chan(struct rtw_adapter *padapter, u8 channel);
-
 void rtw_hal_dm_watchdog(struct rtw_adapter *padapter);
-
-#ifdef CONFIG_HOSTAPD_MLME
-s32 rtw_hal_hostap_mgnt_xmit_entry(struct rtw_adapter *padapter, struct sk_buff *pkt);
-#endif
-
 void rtw_hal_notch_filter(struct rtw_adapter *adapter, bool enable);
 void rtw_hal_reset_security_engine(struct rtw_adapter *adapter);
-
 s32 rtw_hal_c2h_handler(struct rtw_adapter *adapter, struct c2h_evt_hdr *c2h_evt);
 c2h_id_filter rtw_hal_c2h_id_filter_ccx(struct rtw_adapter *adapter);
 
--- a/drivers/staging/rtl8192du/include/rtl8192d_xmit.h
+++ b/drivers/staging/rtl8192du/include/rtl8192d_xmit.h
@@ -86,23 +86,14 @@ void handle_txrpt_ccx_8192d(struct rtw_a
 #define MAX_TX_AGG_PACKET_NUMBER 0xFF
 
 s32	rtl8192du_init_xmit_priv(struct rtw_adapter * padapter);
-
 void	rtl8192du_free_xmit_priv(struct rtw_adapter * padapter);
-
 void rtl8192du_cal_txdesc_chksum(struct tx_desc	*ptxdesc);
-
 s32 rtl8192du_xmitframe_complete(struct rtw_adapter *padapter,
 				 struct xmit_priv *pxmitpriv,
 				 struct xmit_buf *pxmitbuf);
-
 s32 rtl8192du_mgnt_xmit(struct rtw_adapter *padapter,
 			struct xmit_frame *pmgntframe);
-
 s32 rtl8192du_hal_xmit(struct rtw_adapter *padapter,
 		       struct xmit_frame *pxmitframe);
 
-#ifdef CONFIG_HOSTAPD_MLME
-s32	rtl8192du_hostap_mgnt_xmit_entry(struct rtw_adapter *padapter, struct sk_buff *pkt);
-#endif
-
 #endif
--- a/drivers/staging/rtl8192du/include/rtw_mlme.h
+++ b/drivers/staging/rtl8192du/include/rtw_mlme.h
@@ -431,15 +431,8 @@ struct mlme_priv {
 
 #ifdef CONFIG_92D_AP_MODE
 
-struct hostapd_priv
-{
+struct hostapd_priv {
 	struct rtw_adapter *padapter;
-
-#ifdef CONFIG_HOSTAPD_MLME
-	struct net_device *pmgnt_netdev;
-	struct usb_anchor anchored;
-#endif
-
 };
 
 int hostapd_mode_init(struct rtw_adapter *padapter);
--- a/drivers/staging/rtl8192du/os_dep/mlme_linux.c
+++ b/drivers/staging/rtl8192du/os_dep/mlme_linux.c
@@ -292,114 +292,4 @@ void rtw_indicate_sta_disassoc_event(str
 	wireless_send_event(padapter->pnetdev, IWEVEXPIRED, &wrqu, NULL);
 }
 
-#ifdef CONFIG_HOSTAPD_MLME
-
-static int mgnt_xmit_entry(struct sk_buff *skb, struct net_device *pnetdev)
-{
-	struct hostapd_priv *phostapdpriv = rtw_netdev_priv(pnetdev);
-	struct rtw_adapter *padapter = (struct rtw_adapter *)phostapdpriv->padapter;
-
-	return rtw_hal_hostap_mgnt_xmit_entry(padapter, skb);
-}
-
-static int mgnt_netdev_open(struct net_device *pnetdev)
-{
-	struct hostapd_priv *phostapdpriv = rtw_netdev_priv(pnetdev);
-
-	DBG_8192D("mgnt_netdev_open: MAC Address:%pM\n", pnetdev->dev_addr);
-
-	init_usb_anchor(&phostapdpriv->anchored);
-
-	if (!netif_queue_stopped(pnetdev))
-		netif_start_queue(pnetdev);
-	else
-		netif_wake_queue(pnetdev);
-
-	netif_carrier_on(pnetdev);
-
-	return 0;
-}
-static int mgnt_netdev_close(struct net_device *pnetdev)
-{
-	struct hostapd_priv *phostapdpriv = rtw_netdev_priv(pnetdev);
-
-	DBG_8192D("%s\n", __func__);
-
-	usb_kill_anchored_urbs(&phostapdpriv->anchored);
-
-	netif_carrier_off(pnetdev);
-
-	if (!rtw_netif_queue_stopped(pnetdev))
-		rtw_netif_stop_queue(pnetdev);
-
-	return 0;
-}
-
-static const struct net_device_ops rtl871x_mgnt_netdev_ops = {
-	.ndo_open = mgnt_netdev_open,
-       .ndo_stop = mgnt_netdev_close,
-       .ndo_start_xmit = mgnt_xmit_entry,
-};
-
-int hostapd_mode_init(struct rtw_adapter *padapter)
-{
-	unsigned char mac[ETH_ALEN];
-	struct hostapd_priv *phostapdpriv;
-	struct net_device *pnetdev;
-
-	pnetdev = rtw_alloc_etherdev(sizeof(struct hostapd_priv));
-	if (!pnetdev)
-	   return -ENOMEM;
-
-       ether_setup(pnetdev);
-
-	phostapdpriv = rtw_netdev_priv(pnetdev);
-	phostapdpriv->pmgnt_netdev = pnetdev;
-	phostapdpriv->padapter= padapter;
-	padapter->phostapdpriv = phostapdpriv;
-
-	DBG_8192D("register rtl871x_mgnt_netdev_ops to netdev_ops\n");
-
-	pnetdev->netdev_ops = &rtl871x_mgnt_netdev_ops;
-
-	pnetdev->watchdog_timeo = HZ; /* 1 second timeout */
-
-	if (dev_alloc_name(pnetdev,"mgnt.wlan%d") < 0)
-		DBG_8192D("hostapd_mode_init(): dev_alloc_name, fail!\n");
-
-	mac[0]=0x00;
-	mac[1]=0xe0;
-	mac[2]=0x4c;
-	mac[3]=0x87;
-	mac[4]=0x11;
-	mac[5]=0x12;
-
-	memcpy(pnetdev->dev_addr, mac, ETH_ALEN);
-
-	netif_carrier_off(pnetdev);
-
-	/* Tell the network stack we exist */
-	if (register_netdev(pnetdev) != 0)
-	{
-		DBG_8192D("hostapd_mode_init(): register_netdev fail!\n");
-
-		if (pnetdev)
-		{
-			rtw_free_netdev(pnetdev);
-		}
-	}
-
-	return 0;
-}
-
-void hostapd_mode_unload(struct rtw_adapter *padapter)
-{
-	struct hostapd_priv *phostapdpriv = padapter->phostapdpriv;
-	struct net_device *pnetdev = phostapdpriv->pmgnt_netdev;
-
-	unregister_netdev(pnetdev);
-	rtw_free_netdev(pnetdev);
-}
-
-#endif
 #endif
--- a/drivers/staging/rtl8192du/os_dep/recv_linux.c
+++ b/drivers/staging/rtl8192du/os_dep/recv_linux.c
@@ -159,35 +159,6 @@ void rtw_handle_tkip_mic_err(struct rtw_
 
 void rtw_hostapd_mlme_rx(struct rtw_adapter *padapter, struct recv_frame_hdr *precv_frame)
 {
-#ifdef CONFIG_HOSTAPD_MLME
-	struct sk_buff *skb;
-	struct hostapd_priv *phostapdpriv  = padapter->phostapdpriv;
-	struct net_device *pmgnt_netdev = phostapdpriv->pmgnt_netdev;
-
-	RT_TRACE(_module_recv_osdep_c_, _drv_info_, ("+rtw_hostapd_mlme_rx\n"));
-
-	skb = precv_frame->pkt;
-
-	if (skb == NULL)
-		return;
-
-	skb->data = precv_frame->rx_data;
-	skb->tail = precv_frame->rx_tail;
-	skb->len = precv_frame->len;
-
-	skb->dev = pmgnt_netdev;
-	skb->ip_summed = CHECKSUM_NONE;
-	skb->pkt_type = PACKET_OTHERHOST;
-	skb->protocol = __constant_htons(0x0003); /*ETH_P_80211_RAW*/
-
-	skb_reset_mac_header(skb);
-
-       memset(skb->cb, 0, sizeof(skb->cb));
-
-	netif_rx(skb);
-
-	precv_frame->pkt = NULL; /*  set pointer to NULL before rtw_free_recvframe() if call netif_rx() */
-#endif
 }
 
 int rtw_recv_indicatepkt(struct rtw_adapter *padapter, struct recv_frame_hdr *precv_frame)
--- a/drivers/staging/rtl8192du/os_dep/usb_intf.c
+++ b/drivers/staging/rtl8192du/os_dep/usb_intf.c
@@ -740,22 +740,18 @@ static struct rtw_adapter *rtw_usb_if1_i
 	memcpy(pnetdev->dev_addr, padapter->eeprompriv.mac_addr, ETH_ALEN);
 	DBG_8192D("MAC Address from pnetdev->dev_addr= %pM\n", pnetdev->dev_addr);
 
-#ifdef CONFIG_HOSTAPD_MLME
-	hostapd_mode_init(padapter);
-#endif
-
 	/* step 6. Tell the network stack we exist */
 	if (register_netdev(pnetdev) != 0) {
 		RT_TRACE(_module_hci_intfs_c_,_drv_err_,("register_netdev() failed\n"));
 		goto free_hal_data;
 	}
 
-	RT_TRACE(_module_hci_intfs_c_,_drv_err_,("-drv_init - adapter->bDriverStopped=%d, adapter->bSurpriseRemoved=%d\n",padapter->bDriverStopped, padapter->bSurpriseRemoved));
-	DBG_8192D("bDriverStopped:%d, bSurpriseRemoved:%d, bup:%d, hw_init_completed:%d\n"
-		,padapter->bDriverStopped
-		,padapter->bSurpriseRemoved
-		,padapter->bup
-		,padapter->hw_init_completed
+	RT_TRACE(_module_hci_intfs_c_, _drv_err_,
+		 ("-drv_init - adapter->bDriverStopped=%d, adapter->bSurpriseRemoved=%d\n",
+		 padapter->bDriverStopped, padapter->bSurpriseRemoved));
+	DBG_8192D("bDriverStopped:%d, bSurpriseRemoved:%d, bup:%d, hw_init_completed:%d\n",
+		  padapter->bDriverStopped, padapter->bSurpriseRemoved,
+		  padapter->bup, padapter->hw_init_completed
 	);
 
 	status = _SUCCESS;
@@ -795,9 +791,6 @@ static void rtw_usb_if1_deinit(struct rt
 
 #ifdef CONFIG_92D_AP_MODE
 	free_mlme_ap_info(if1);
-	#ifdef CONFIG_HOSTAPD_MLME
-	hostapd_mode_unload(if1);
-	#endif
 #endif
 
 	if (if1->DriverState != DRIVER_DISAPPEAR) {
