From 23160a8ed834b394a7f722bb92198c9d968dea68 Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Wed, 19 Feb 2014 13:04:53 -0600
Subject: [PATCH 206/390] rtl8192du: Cleanup some configuration parameters

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 core/rtw_ap.c            |   4 +-
 core/rtw_cmd.c           |   8 ++--
 core/rtw_debug.c         |   2 +-
 core/rtw_mlme.c          |  10 ++--
 core/rtw_mlme_ext.c      |  51 +++++++++-----------
 core/rtw_recv.c          |  11 ++---
 core/rtw_security.c      |  18 ++-----
 core/rtw_sta_mgt.c       |  16 +++----
 core/rtw_xmit.c          |  70 ++++++---------------------
 hal/rtl8192d_hal_init.c  |   5 +-
 hal/rtl8192d_xmit.c      |   2 -
 hal/rtl8192du_xmit.c     |  96 ++++---------------------------------
 hal/usb_halinit.c        | 121 +++++++++++++++--------------------------------
 hal/usb_ops_linux.c      |  40 ++++++----------
 include/autoconf.h       |  32 +++----------
 include/drv_types.h      |   2 +-
 include/ieee80211.h      |   6 +--
 include/ioctl_cfg80211.h |   4 +-
 include/rtl8192d_hal.h   |  67 ++++++++++++--------------
 include/rtl8192d_xmit.h  |  17 +++----
 include/rtw_ap.h         |   4 +-
 include/rtw_cmd.h        |   2 +-
 include/rtw_debug.h      |   2 +-
 include/rtw_led.h        |  13 ++---
 include/rtw_mlme.h       |   6 +--
 include/rtw_mlme_ext.h   |   2 +-
 include/rtw_security.h   |   2 +-
 include/rtw_xmit.h       |  64 +++++++++----------------
 include/sta_info.h       |   6 +--
 include/usb_osintf.h     |  12 ++---
 os_dep/ioctl_cfg80211.c  |  20 ++++----
 os_dep/ioctl_linux.c     |   8 ++--
 os_dep/mlme_linux.c      |   2 +-
 os_dep/os_intfs.c        |  18 ++-----
 os_dep/usb_intf.c        |   9 +---
 os_dep/usb_ops_linux.c   |   2 +-
 36 files changed, 248 insertions(+), 506 deletions(-)

--- a/drivers/staging/rtl8192du/core/rtw_ap.c
+++ b/drivers/staging/rtl8192du/core/rtw_ap.c
@@ -20,7 +20,7 @@
 #include <drv_types.h>
 #include <wifi.h>
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 
 void init_mlme_ap_info(struct rtw_adapter *padapter)
 {
@@ -2159,4 +2159,4 @@ void stop_ap_mode(struct rtw_adapter *pa
 }
 
 #endif /* CONFIG_NATIVEAP_MLME */
-#endif /* CONFIG_AP_MODE */
+#endif /* CONFIG_92D_AP_MODE */
--- a/drivers/staging/rtl8192du/core/rtw_cmd.c
+++ b/drivers/staging/rtl8192du/core/rtw_cmd.c
@@ -1744,7 +1744,7 @@ static void dynamic_chk_wk_hdl(struct rt
 	pmlmepriv = &(padapter->mlmepriv);
 
 #ifdef CONFIG_ACTIVE_KEEP_ALIVE_CHECK
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	if (check_fwstate(pmlmepriv, WIFI_AP_STATE) == true)
 		expire_timeout_chk(padapter);
 #endif
@@ -1972,7 +1972,7 @@ exit:
 	return res;
 }
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 
 static void rtw_chk_hi_queue_hdl(struct rtw_adapter *padapter)
 {
@@ -2168,11 +2168,11 @@ u8 rtw_drvextra_cmd_hdl(struct rtw_adapt
 		/*	I used the type_size as the type command */
 		p2p_protocol_wk_hdl(padapter, pdrvextra_cmd->type_size);
 		break;
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	case CHECK_HIQ_WK_CID:
 		rtw_chk_hi_queue_hdl(padapter);
 		break;
-#endif /* CONFIG_AP_MODE */
+#endif /* CONFIG_92D_AP_MODE */
 #ifdef CONFIG_INTEL_WIDI
 	case INTEl_WIDI_WK_CID:
 		intel_widi_wk_hdl(padapter, pdrvextra_cmd->type_size, pdrvextra_cmd->pbuf);
--- a/drivers/staging/rtl8192du/core/rtw_debug.c
+++ b/drivers/staging/rtl8192du/core/rtw_debug.c
@@ -959,7 +959,7 @@ int proc_set_rssi_disp(struct file *file
 	return count;
 }
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 
 int proc_get_all_sta_info(char *page, char **start,
 			  off_t offset, int count,
--- a/drivers/staging/rtl8192du/core/rtw_mlme.c
+++ b/drivers/staging/rtl8192du/core/rtw_mlme.c
@@ -113,7 +113,7 @@ static void rtw_free_mlme_ie_data(u8 **p
 
 void rtw_free_mlme_priv_ie_data(struct mlme_priv *pmlmepriv)
 {
-#if defined (CONFIG_AP_MODE) && defined (CONFIG_NATIVEAP_MLME)
+#if defined (CONFIG_92D_AP_MODE) && defined (CONFIG_NATIVEAP_MLME)
 	rtw_buf_free(&pmlmepriv->assoc_req, &pmlmepriv->assoc_req_len);
 	rtw_buf_free(&pmlmepriv->assoc_rsp, &pmlmepriv->assoc_rsp_len);
 	rtw_free_mlme_ie_data(&pmlmepriv->wps_beacon_ie,
@@ -1775,7 +1775,7 @@ void rtw_stassoc_event_callback(struct r
 	if (rtw_access_ctrl(adapter, pstassoc->macaddr) == false)
 		return;
 
-#if defined (CONFIG_AP_MODE) && defined (CONFIG_NATIVEAP_MLME)
+#if defined (CONFIG_92D_AP_MODE) && defined (CONFIG_NATIVEAP_MLME)
 	if (check_fwstate(pmlmepriv, WIFI_AP_STATE)) {
 		psta = rtw_get_stainfo(&adapter->stapriv, pstassoc->macaddr);
 		if (psta) {
@@ -2124,9 +2124,9 @@ static void rtw_auto_scan_handler(struct
 
 void rtw_dynamic_check_timer_handlder(struct rtw_adapter *adapter)
 {
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	struct mlme_priv *pmlmepriv = &adapter->mlmepriv;
-#endif /* CONFIG_AP_MODE */
+#endif /* CONFIG_92D_AP_MODE */
 	struct registry_priv *pregistrypriv = &adapter->registrypriv;
 #ifdef CONFIG_CONCURRENT_MODE
 	struct rtw_adapter *pbuddy_adapter = adapter->pbuddy_adapter;
@@ -2167,7 +2167,7 @@ void rtw_dynamic_check_timer_handlder(st
 		}
 	}
 #ifndef CONFIG_ACTIVE_KEEP_ALIVE_CHECK
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	if (check_fwstate(pmlmepriv, WIFI_AP_STATE) == true) {
 		expire_timeout_chk(adapter);
 	}
--- a/drivers/staging/rtl8192du/core/rtw_mlme_ext.c
+++ b/drivers/staging/rtl8192du/core/rtw_mlme_ext.c
@@ -519,7 +519,7 @@ int init_mlme_ext_priv(struct rtw_adapte
 
 	init_mlme_ext_timer(adapt);
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	init_mlme_ap_info(adapt);
 #endif
 
@@ -592,9 +592,9 @@ void mgt_dispatcher(struct rtw_adapter *
 {
 	int index;
 	struct mlme_handler *ptable;
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	struct mlme_priv *pmlmepriv = &adapt->mlmepriv;
-#endif /* CONFIG_AP_MODE */
+#endif /* CONFIG_92D_AP_MODE */
 	u8 bc_addr[ETH_ALEN] = { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff };
 	u8 *pframe = precv_frame->rx_data;
 	struct sta_info *psta =
@@ -653,7 +653,7 @@ void mgt_dispatcher(struct rtw_adapter *
 		}
 		psta->RxMgmtFrameSeqNum = precv_frame->attrib.seq_num;
 	}
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	switch (GetFrameSubType(pframe)) {
 	case WIFI_AUTH:
 		if (check_fwstate(pmlmepriv, WIFI_AP_STATE) == true)
@@ -1065,7 +1065,7 @@ _END_ONBEACON_:
 
 unsigned int OnAuth(struct rtw_adapter *adapt, struct recv_frame_hdr *precv_frame)
 {
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	unsigned int auth_mode, seq, ie_len;
 	unsigned char *sa, *p;
 	u16 algorithm;
@@ -1346,7 +1346,7 @@ authclnt_fail:
 unsigned int OnAssocReq(struct rtw_adapter *adapt,
 			struct recv_frame_hdr *precv_frame)
 {
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	u16 capab_info;
 	struct rtw_ieee802_11_elems elems;
 	struct sta_info *pstat;
@@ -1908,7 +1908,7 @@ OnAssocReqFail:
 		issue_asocrsp(adapt, status, pstat, WIFI_REASSOCRSP);
 #endif
 
-#endif /* CONFIG_AP_MODE */
+#endif /* CONFIG_92D_AP_MODE */
 
 	return _FAIL;
 }
@@ -2050,7 +2050,7 @@ unsigned int OnDeAuth(struct rtw_adapter
 
 	DBG_8192D("%s Reason code(%d)\n", __func__, reason);
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	if (check_fwstate(pmlmepriv, WIFI_AP_STATE) == true) {
 		struct sta_info *psta;
 		struct sta_priv *pstapriv = &adapt->stapriv;
@@ -2115,7 +2115,7 @@ unsigned int OnDisassoc(struct rtw_adapt
 
 	DBG_8192D("%s Reason code(%d)\n", __func__, reason);
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	if (check_fwstate(pmlmepriv, WIFI_AP_STATE) == true) {
 		struct sta_info *psta;
 		struct sta_priv *pstapriv = &adapt->stapriv;
@@ -6028,10 +6028,10 @@ s32 dump_mgntframe_and_wait(struct rtw_a
 s32 dump_mgntframe_and_wait_ack(struct rtw_adapter *adapt,
 				struct xmit_frame *pmgntframe)
 {
-#ifdef CONFIG_XMIT_ACK
+	struct xmit_priv *pxmitpriv = &adapt->xmitpriv;
 	s32 ret = _FAIL;
 	u32 timeout_ms = 500;	/*   500ms */
-	struct xmit_priv *pxmitpriv = &adapt->xmitpriv;
+
 #ifdef CONFIG_CONCURRENT_MODE
 	if (adapt->pbuddy_adapter && !adapt->isprimary)
 		pxmitpriv = &(adapt->pbuddy_adapter->xmitpriv);
@@ -6053,11 +6053,6 @@ s32 dump_mgntframe_and_wait_ack(struct r
 	_exit_critical_mutex(&pxmitpriv->ack_tx_mutex);
 
 	return ret;
-#else /* CONFIG_XMIT_ACK */
-	dump_mgntframe(adapt, pmgntframe);
-	rtw_msleep_os(50);
-	return _SUCCESS;
-#endif /* CONFIG_XMIT_ACK */
 }
 
 static int update_hidden_ssid(u8 *ies, u32 ies_len, u8 hidden_ssid_mode)
@@ -6105,9 +6100,9 @@ void issue_beacon(struct rtw_adapter *ad
 	unsigned short *fctrl;
 	unsigned int rate_len;
 	struct xmit_priv *pxmitpriv = &(adapt->xmitpriv);
-#if defined (CONFIG_AP_MODE) && defined (CONFIG_NATIVEAP_MLME)
+#if defined (CONFIG_92D_AP_MODE) && defined (CONFIG_NATIVEAP_MLME)
 	struct mlme_priv *pmlmepriv = &(adapt->mlmepriv);
-#endif /* if defined (CONFIG_AP_MODE) && defined (CONFIG_NATIVEAP_MLME) */
+#endif /* if defined (CONFIG_92D_AP_MODE) && defined (CONFIG_NATIVEAP_MLME) */
 	struct mlme_ext_priv *pmlmeext = &(adapt->mlmeextpriv);
 	struct mlme_ext_info *pmlmeinfo = &(pmlmeext->mlmext_info);
 	struct wlan_bssid_ex *cur_network = &(pmlmeinfo->network);
@@ -6121,9 +6116,9 @@ void issue_beacon(struct rtw_adapter *ad
 		DBG_8192D("%s, alloc mgnt frame fail\n", __func__);
 		return;
 	}
-#if defined (CONFIG_AP_MODE) && defined (CONFIG_NATIVEAP_MLME)
+#if defined (CONFIG_92D_AP_MODE) && defined (CONFIG_NATIVEAP_MLME)
 	spin_lock_bh(&pmlmepriv->bcn_update_lock);
-#endif /* if defined (CONFIG_AP_MODE) && defined (CONFIG_NATIVEAP_MLME) */
+#endif /* if defined (CONFIG_92D_AP_MODE) && defined (CONFIG_NATIVEAP_MLME) */
 
 	/* update attribute */
 	pattrib = &pmgntframe->attrib;
@@ -6419,11 +6414,11 @@ void issue_beacon(struct rtw_adapter *ad
 
 _issue_bcn:
 
-#if defined (CONFIG_AP_MODE) && defined (CONFIG_NATIVEAP_MLME)
+#if defined (CONFIG_92D_AP_MODE) && defined (CONFIG_NATIVEAP_MLME)
 	pmlmepriv->update_bcn = false;
 
 	spin_unlock_bh(&pmlmepriv->bcn_update_lock);
-#endif /* if defined (CONFIG_AP_MODE) && defined (CONFIG_NATIVEAP_MLME) */
+#endif /* if defined (CONFIG_92D_AP_MODE) && defined (CONFIG_NATIVEAP_MLME) */
 
 	if ((pattrib->pktlen + TXDESC_SIZE) > 512) {
 		DBG_8192D("beacon frame too large\n");
@@ -6447,11 +6442,11 @@ void issue_probersp(struct rtw_adapter *
 	unsigned short *fctrl;
 	unsigned char *mac, *bssid;
 	struct xmit_priv *pxmitpriv = &(adapt->xmitpriv);
-#if defined (CONFIG_AP_MODE) && defined (CONFIG_NATIVEAP_MLME)
+#if defined (CONFIG_92D_AP_MODE) && defined (CONFIG_NATIVEAP_MLME)
 	u8 *pwps_ie;
 	uint wps_ielen;
 	struct mlme_priv *pmlmepriv = &adapt->mlmepriv;
-#endif /* if defined (CONFIG_AP_MODE) && defined (CONFIG_NATIVEAP_MLME) */
+#endif /* if defined (CONFIG_92D_AP_MODE) && defined (CONFIG_NATIVEAP_MLME) */
 	struct mlme_ext_priv *pmlmeext = &(adapt->mlmeextpriv);
 	struct mlme_ext_info *pmlmeinfo = &(pmlmeext->mlmext_info);
 	struct wlan_bssid_ex *cur_network = &(pmlmeinfo->network);
@@ -6500,7 +6495,7 @@ void issue_probersp(struct rtw_adapter *
 	if (cur_network->IELength > MAX_IE_SZ)
 		return;
 
-#if defined (CONFIG_AP_MODE) && defined (CONFIG_NATIVEAP_MLME)
+#if defined (CONFIG_92D_AP_MODE) && defined (CONFIG_NATIVEAP_MLME)
 	if ((pmlmeinfo->state & 0x03) == WIFI_FW_AP_STATE) {
 		pwps_ie =
 		    rtw_get_wps_ie(cur_network->IEs + _FIXED_IE_LENGTH_,
@@ -7041,7 +7036,7 @@ void issue_auth(struct rtw_adapter *adap
 void issue_asocrsp(struct rtw_adapter *adapt, unsigned short status,
 		   struct sta_info *pstat, int pkt_type)
 {
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	struct xmit_frame *pmgntframe;
 	struct rtw_ieee80211_hdr *pwlanhdr;
 	struct pkt_attrib *pattrib;
@@ -10591,7 +10586,7 @@ u8 createbss_hdl(struct rtw_adapter *ada
 	u32 initialgain;
 
 	if (pparm->network.InfrastructureMode == NDIS802_11APMODE) {
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 
 		if (pmlmeinfo->state == WIFI_FW_AP_STATE) {
 			/* todo: */
@@ -11358,7 +11353,7 @@ u8 tx_beacon_hdl(struct rtw_adapter *ada
 		DBG_8192D("issue_beacon, fail!\n");
 		return H2C_PARAMETERS_ERROR;
 	}
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	else {			/* tx bc/mc frames after update TIM */
 
 		struct sta_info *psta_bmc;
--- a/drivers/staging/rtl8192du/core/rtw_recv.c
+++ b/drivers/staging/rtl8192du/core/rtw_recv.c
@@ -754,7 +754,7 @@ static int recv_decache(struct recv_fram
 static void process_pwrbit_data(struct rtw_adapter *padapter,
 			        struct recv_frame_hdr *precv_frame)
 {
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	unsigned char pwrbit;
 	u8 *ptr = precv_frame->rx_data;
 	struct rx_pkt_attrib *pattrib = &precv_frame->attrib;
@@ -780,7 +780,7 @@ static void process_pwrbit_data(struct r
 void process_wmmps_data(struct rtw_adapter *padapter,
 			struct recv_frame_hdr *precv_frame)
 {
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	struct rx_pkt_attrib *pattrib = &precv_frame->attrib;
 	struct sta_priv *pstapriv = &padapter->stapriv;
 	struct sta_info *psta = NULL;
@@ -1374,7 +1374,7 @@ exit:
 static int validate_recv_ctrl_frame(struct rtw_adapter *padapter,
 			     struct recv_frame_hdr *precv_frame)
 {
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	struct rx_pkt_attrib *pattrib = &precv_frame->attrib;
 	struct sta_priv *pstapriv = &padapter->stapriv;
 	u8 *pframe = precv_frame->rx_data;
@@ -2116,15 +2116,12 @@ static int amsdu_to_msdu(struct rtw_adap
 		a_len -= ETH_HLEN;
 
 		/* Allocate new skb for releasing to upper layer */
-#ifdef CONFIG_SKB_COPY
 		sub_skb = dev_alloc_skb(nSubframe_Length + 12);
 		if (sub_skb) {
 			skb_reserve(sub_skb, 12);
 			data_ptr = (u8 *)skb_put(sub_skb, nSubframe_Length);
 			memcpy(data_ptr, pdata, nSubframe_Length);
-		} else
-#endif /*  CONFIG_SKB_COPY */
-		{
+		} else {
 			sub_skb = skb_clone(prframe->pkt, GFP_ATOMIC);
 			if (sub_skb) {
 				sub_skb->data = pdata;
--- a/drivers/staging/rtl8192du/core/rtw_security.c
+++ b/drivers/staging/rtl8192du/core/rtw_security.c
@@ -164,12 +164,9 @@ void rtw_wep_encrypt(struct rtw_adapter
 	if (((struct xmit_frame *)pxmitframe)->buf_addr == NULL)
 		return;
 
-#ifdef CONFIG_USB_TX_AGGREGATION
 	pframe = ((struct xmit_frame *)pxmitframe)->buf_addr + TXDESC_SIZE +
-	    (((struct xmit_frame *)pxmitframe)->pkt_offset * PACKET_OFFSET_SZ);
-#else
-	pframe = ((struct xmit_frame *)pxmitframe)->buf_addr + TXDESC_OFFSET;
-#endif
+		 (((struct xmit_frame *)pxmitframe)->pkt_offset *
+		  PACKET_OFFSET_SZ);
 
 	/* start to encrypt each fragment */
 	if ((pattrib->encrypt == _WEP40_) || (pattrib->encrypt == _WEP104_)) {
@@ -634,12 +631,8 @@ u32 rtw_tkip_encrypt(struct rtw_adapter
 	if (((struct xmit_frame *)pxmitframe)->buf_addr == NULL)
 		return _FAIL;
 
-#ifdef CONFIG_USB_TX_AGGREGATION
 	pframe = ((struct xmit_frame *)pxmitframe)->buf_addr + TXDESC_SIZE +
 	    (((struct xmit_frame *)pxmitframe)->pkt_offset * PACKET_OFFSET_SZ);
-#else
-	pframe = ((struct xmit_frame *)pxmitframe)->buf_addr + TXDESC_OFFSET;
-#endif
 
 	/* 4 start to encrypt each fragment */
 	if (pattrib->encrypt == _TKIP_) {
@@ -1375,12 +1368,9 @@ u32 rtw_aes_encrypt(struct rtw_adapter *
 	if (((struct xmit_frame *)pxmitframe)->buf_addr == NULL)
 		return _FAIL;
 
-#ifdef CONFIG_USB_TX_AGGREGATION
 	pframe = ((struct xmit_frame *)pxmitframe)->buf_addr + TXDESC_SIZE +
-	    (((struct xmit_frame *)pxmitframe)->pkt_offset * PACKET_OFFSET_SZ);
-#else
-	pframe = ((struct xmit_frame *)pxmitframe)->buf_addr + TXDESC_OFFSET;
-#endif
+		 (((struct xmit_frame *)pxmitframe)->pkt_offset *
+		  PACKET_OFFSET_SZ);
 
 	/* 4 start to encrypt each fragment */
 	if ((pattrib->encrypt == _AES_)) {
--- a/drivers/staging/rtl8192du/core/rtw_sta_mgt.c
+++ b/drivers/staging/rtl8192du/core/rtw_sta_mgt.c
@@ -39,7 +39,7 @@ static void _rtw_init_stainfo(struct sta
 	_rtw_init_sta_xmit_priv(&psta->sta_xmitpriv);
 	_rtw_init_sta_recv_priv(&psta->sta_recvpriv);
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 
 	INIT_LIST_HEAD(&psta->asoc_list);
 
@@ -64,7 +64,7 @@ static void _rtw_init_stainfo(struct sta
 
 	psta->under_exist_checking = 0;
 	psta->keep_alive_trycnt = 0;
-#endif	/*  CONFIG_AP_MODE */
+#endif	/*  CONFIG_92D_AP_MODE */
 
 }
 
@@ -102,7 +102,7 @@ u32	_rtw_init_sta_priv(struct	sta_priv *
 		psta++;
 	}
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 
 	pstapriv->sta_dz_bitmap = 0;
 	pstapriv->tim_bitmap = 0;
@@ -205,7 +205,7 @@ static void rtw_mfree_all_stainfo(struct
 
 static void rtw_mfree_sta_priv_lock(struct	sta_priv *pstapriv)
 {
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	struct wlan_acl_pool *pacl_list = &pstapriv->acl_list;
 #endif
 
@@ -217,7 +217,7 @@ static void rtw_mfree_sta_priv_lock(stru
 	_rtw_spinlock_free(&pstapriv->wakeup_q.lock);
 	_rtw_spinlock_free(&pstapriv->sleep_q.lock);
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	_rtw_spinlock_free(&pstapriv->asoc_list_lock);
 	_rtw_spinlock_free(&pstapriv->auth_list_lock);
 	_rtw_spinlock_free(&pacl_list->acl_node_q.lock);
@@ -463,7 +463,7 @@ u32	rtw_free_stainfo(struct rtw_adapter
 		spin_unlock_bh(&ppending_recvframe_queue->lock);
 	}
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 
 	spin_lock_bh(&pstapriv->auth_list_lock);
 	if (!rtw_is_list_empty(&psta->auth_list)) {
@@ -499,7 +499,7 @@ u32	rtw_free_stainfo(struct rtw_adapter
 
 	psta->under_exist_checking = 0;
 
-#endif	/*  CONFIG_AP_MODE */
+#endif	/*  CONFIG_92D_AP_MODE */
 
 	spin_lock_bh(&(pfree_sta_queue->lock));
 	rtw_list_insert_tail(&psta->list, get_list_head(pfree_sta_queue));
@@ -621,7 +621,7 @@ struct sta_info *rtw_get_bcmc_stainfo(st
 u8 rtw_access_ctrl(struct rtw_adapter *padapter, u8 *mac_addr)
 {
 	u8 res = true;
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	struct list_head *plist, *phead;
 	struct rtw_wlan_acl_node *paclnode;
 	u8 match = false;
--- a/drivers/staging/rtl8192du/core/rtw_xmit.c
+++ b/drivers/staging/rtl8192du/core/rtw_xmit.c
@@ -209,14 +209,11 @@ s32	_rtw_init_xmit_priv(struct xmit_priv
 	pxmitpriv->viq_cnt = 0;
 	pxmitpriv->voq_cnt = 0;
 
-#ifdef CONFIG_XMIT_ACK
 	pxmitpriv->ack_tx = false;
 	_rtw_mutex_init(&pxmitpriv->ack_tx_mutex);
 	rtw_sctx_init(&pxmitpriv->ack_tx_ops, 0);
-#endif
 	rtw_hal_init_xmit_priv(padapter);
 exit:
-
 	return res;
 }
 
@@ -277,9 +274,7 @@ void _rtw_free_xmit_priv(struct xmit_pri
 
 	rtw_free_hwxmits(padapter);
 
-#ifdef CONFIG_XMIT_ACK
 	_rtw_mutex_free(&pxmitpriv->ack_tx_mutex);
-#endif
 }
 
 static void update_attrib_vcs_info(struct rtw_adapter *padapter, struct xmit_frame *pxmitframe)
@@ -644,16 +639,17 @@ exit:
 	return res;
 }
 
-static s32 xmitframe_addmic(struct rtw_adapter *padapter, struct xmit_frame *pxmitframe)
+static s32 xmitframe_addmic(struct rtw_adapter *padapter,
+			    struct xmit_frame *pxmitframe)
 {
-	int			curfragnum, length;
-	u8	*pframe, *payload, mic[8];
-	struct	mic_data		micdata;
-	struct	sta_info		*stainfo;
-	struct	qos_priv   *pqospriv = &(padapter->mlmepriv.qospriv);
-	struct	pkt_attrib	 *pattrib = &pxmitframe->attrib;
-	struct	security_priv	*psecuritypriv = &padapter->securitypriv;
-	struct	xmit_priv		*pxmitpriv = &padapter->xmitpriv;
+	int curfragnum, length;
+	u8 *pframe, *payload, mic[8];
+	struct	mic_data micdata;
+	struct	sta_info *stainfo;
+	struct	qos_priv *pqospriv = &(padapter->mlmepriv.qospriv);
+	struct	pkt_attrib *pattrib = &pxmitframe->attrib;
+	struct	security_priv *psecuritypriv = &padapter->securitypriv;
+	struct	xmit_priv *pxmitpriv = &padapter->xmitpriv;
 	u8 priority[4] = {0x0, 0x0, 0x0, 0x0};
 	int bmcst = IS_MCAST(pattrib->ra);
 
@@ -667,16 +663,11 @@ static s32 xmitframe_addmic(struct rtw_a
 		if (stainfo != NULL) {
 			u8 null_key[16] = {0};
 
-#ifdef CONFIG_USB_TX_AGGREGATION
-			pframe = pxmitframe->buf_addr + TXDESC_SIZE + (pxmitframe->pkt_offset * PACKET_OFFSET_SZ);
-#else
-			pframe = pxmitframe->buf_addr + TXDESC_OFFSET;
-#endif
+			pframe = pxmitframe->buf_addr + TXDESC_SIZE +
+				 (pxmitframe->pkt_offset * PACKET_OFFSET_SZ);
 
 			if (bmcst) {
 				if (_rtw_memcmp(psecuritypriv->dot118021XGrptxmickey[psecuritypriv->dot118021XGrpKeyid].skey, null_key, 16) == true) {
-					/* DbgPrint("\nxmitframe_addmic:stainfo->dot11tkiptxmickey == 0\n"); */
-					/* rtw_msleep_os(10); */
 					return _FAIL;
 				}
 				/* start to calculate the mic code */
@@ -1327,11 +1318,7 @@ s32 rtw_xmitframe_coalesce(struct rtw_ad
 
 	pbuf_start = pxmitframe->buf_addr;
 
-#ifdef CONFIG_USB_TX_AGGREGATION
 	mem_start = pbuf_start + TXDESC_SIZE + (pxmitframe->pkt_offset * PACKET_OFFSET_SZ);
-#else
-	mem_start = pbuf_start + TXDESC_OFFSET;
-#endif
 
 	if (rtw_make_wlanhdr(padapter, mem_start, pattrib) == _FAIL) {
 		RT_TRACE(_module_rtl871x_xmit_c_, _drv_err_, ("rtw_xmitframe_coalesce: rtw_make_wlanhdr fail; drop pkt\n"));
@@ -1528,21 +1515,13 @@ void rtw_count_tx_stats(struct rtw_adapt
 
 	if ((pxmitframe->frame_tag&0x0f) == DATA_FRAMETAG) {
 		pxmitpriv->tx_bytes += sz;
-#ifdef CONFIG_USB_TX_AGGREGATION
 		pmlmepriv->LinkDetectInfo.NumTxOkInPeriod += pxmitframe->agg_num;
-#else
-		pmlmepriv->LinkDetectInfo.NumTxOkInPeriod++;
-#endif
 
 		psta = pxmitframe->attrib.psta;
 
 		if (psta) {
 			pstats = &psta->sta_stats;
-#ifdef CONFIG_USB_TX_AGGREGATION
 			pstats->tx_pkts += pxmitframe->agg_num;
-#else
-			pstats->tx_pkts++;
-#endif
 			pstats->tx_bytes += sz;
 		}
 	}
@@ -1743,9 +1722,7 @@ struct xmit_frame *rtw_alloc_xmitframe(s
 		pxframe->pkt = NULL;
 		pxframe->pkt_offset = 1;/* default use pkt_offset to fill tx desc */
 
-#ifdef CONFIG_USB_TX_AGGREGATION
 		pxframe->agg_num = 1;
-#endif
 
 #if (LINUX_VERSION_CODE < KERNEL_VERSION(2, 6, 35))
 		if (pxmitpriv->free_xmitframe_cnt == 1) {
@@ -1753,10 +1730,7 @@ struct xmit_frame *rtw_alloc_xmitframe(s
 				rtw_netif_stop_queue(padapter->pnetdev);
 		}
 #endif
-
-#ifdef CONFIG_XMIT_ACK
 		pxframe->ack_report = 0;
-#endif
 	}
 	spin_unlock_bh(&pfree_xmit_queue->lock);
 
@@ -2244,7 +2218,7 @@ s32 rtw_xmit(struct rtw_adapter *padapte
 
 	do_queue_select(padapter, &pxmitframe->attrib);
 
-#if defined(CONFIG_AP_MODE) || defined(CONFIG_TDLS)
+#if defined(CONFIG_92D_AP_MODE) || defined(CONFIG_TDLS)
 	spin_lock_bh(&pxmitpriv->lock);
 	if (xmitframe_enqueue_for_sleeping_sta(padapter, pxmitframe) == true) {
 		spin_unlock_bh(&pxmitpriv->lock);
@@ -2320,7 +2294,7 @@ int xmitframe_enqueue_for_tdls_sleeping_
 }
 #endif /* CONFIG_TDLS */
 
-#if defined(CONFIG_AP_MODE) || defined(CONFIG_TDLS)
+#if defined(CONFIG_92D_AP_MODE) || defined(CONFIG_TDLS)
 
 int xmitframe_enqueue_for_sleeping_sta(struct rtw_adapter *padapter, struct xmit_frame *pxmitframe)
 {
@@ -2754,10 +2728,6 @@ void rtw_sctx_done(struct submit_ctx **s
 	rtw_sctx_done_err(sctx, RTW_SCTX_DONE_SUCCESS);
 }
 
-#ifdef CONFIG_XMIT_ACK
-
-#ifdef CONFIG_XMIT_ACK_POLLING
-
 /**
  * rtw_ack_tx_polling -
  * @pxmitpriv: xmit_priv to address ack_tx_ops
@@ -2803,21 +2773,10 @@ static int rtw_ack_tx_polling(struct xmi
 
 	return ret;
 }
-#endif
 
 int rtw_ack_tx_wait(struct xmit_priv *pxmitpriv, u32 timeout_ms)
 {
-#ifdef CONFIG_XMIT_ACK_POLLING
 	return rtw_ack_tx_polling(pxmitpriv, timeout_ms);
-#else
-	struct submit_ctx *pack_tx_ops = &pxmitpriv->ack_tx_ops;
-
-	pack_tx_ops->submit_time = rtw_get_current_time();
-	pack_tx_ops->timeout_ms = timeout_ms;
-	pack_tx_ops->status = RTW_SCTX_SUBMITTED;
-
-	return rtw_sctx_wait(pack_tx_ops);
-#endif
 }
 
 void rtw_ack_tx_done(struct xmit_priv *pxmitpriv, int status)
@@ -2829,4 +2788,3 @@ void rtw_ack_tx_done(struct xmit_priv *p
 	else
 		DBG_8192D("%s ack_tx not set\n", __func__);
 }
-#endif /* CONFIG_XMIT_ACK */
--- a/drivers/staging/rtl8192du/hal/rtl8192d_hal_init.c
+++ b/drivers/staging/rtl8192du/hal/rtl8192d_hal_init.c
@@ -294,9 +294,10 @@ static int get_fw_from_file(struct rtw_a
 		pr_err("Firmware %s not available\n", fw_name);
 		return _FAIL;
 	}
-	if (fw->size > 0x8000) {
+	if (fw->size > FW_8192D_SIZE) {
 		rtstatus = _FAIL;
-		pr_err("Firmware size exceeds 0x8000. Check it.\n");
+		pr_err("Firmware size exceeds 0x%x. Check it.\n",
+		       FW_8192D_SIZE);
 		goto exit;
 	}
 
--- a/drivers/staging/rtl8192du/hal/rtl8192d_xmit.c
+++ b/drivers/staging/rtl8192du/hal/rtl8192d_xmit.c
@@ -20,7 +20,6 @@
 #include <drv_types.h>
 #include <rtl8192d_hal.h>
 
-#ifdef CONFIG_XMIT_ACK
 void dump_txrpt_ccx_8192d(void *buf)
 {
 	struct txrpt_ccx_8192d *txrpt_ccx = buf;
@@ -55,4 +54,3 @@ void handle_txrpt_ccx_8192d(struct rtw_a
 			rtw_ack_tx_done(&adapter->xmitpriv, RTW_SCTX_DONE_CCX_PKT_FAIL);
 	}
 }
-#endif /* CONFIG_XMIT_ACK */
--- a/drivers/staging/rtl8192du/hal/rtl8192du_xmit.c
+++ b/drivers/staging/rtl8192du/hal/rtl8192du_xmit.c
@@ -224,9 +224,9 @@ static s32 update_txdesc(struct xmit_fra
 	struct rtw_adapter				*padapter = pxmitframe->padapter;
 	struct hal_data_8192du		*pHalData = GET_HAL_DATA(padapter);
 	struct dm_priv		*pdmpriv = &pHalData->dmpriv;
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	struct mlme_priv		*pmlmepriv = &padapter->mlmepriv;
-#endif /* CONFIG_AP_MODE */
+#endif /* CONFIG_92D_AP_MODE */
 	struct mlme_ext_priv	*pmlmeext = &padapter->mlmeextpriv;
 	struct mlme_ext_info	*pmlmeinfo = &(pmlmeext->mlmext_info);
 	struct pkt_attrib		*pattrib = &pxmitframe->attrib;
@@ -353,7 +353,7 @@ if (padapter->registrypriv.mp_mode == 0)
 		ptxdesc->txdw1 |= cpu_to_le32((pattrib->raid<< 16) & 0x000f0000);
 
 		/* offset 8 */
-#ifdef CONFIG_XMIT_ACK
+
 		/* CCX-TXRPT ack for xmit mgmt frames. */
 		if (pxmitframe->ack_report) {
 			ptxdesc->txdw2 |= cpu_to_le32(BIT(19));
@@ -361,7 +361,6 @@ if (padapter->registrypriv.mp_mode == 0)
 			DBG_8192D("%s set ccx\n", __func__);
 			#endif
 		}
-#endif /* CONFIG_XMIT_ACK */
 
 		/* offset 12 */
 		ptxdesc->txdw3 |= cpu_to_le32((pattrib->seqnum<<16)&0xffff0000);
@@ -370,7 +369,7 @@ if (padapter->registrypriv.mp_mode == 0)
 		ptxdesc->txdw4 |= cpu_to_le32(BIT(8));/* driver uses rate */
 
 		/* offset 20 */
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 		if (check_fwstate(pmlmepriv, WIFI_AP_STATE) == true) {
 			ptxdesc->txdw5 |= cpu_to_le32(BIT(17));/* retry limit enable */
 #ifdef CONFIG_P2P
@@ -434,12 +433,12 @@ if (padapter->registrypriv.mp_mode == 0)
 	/* offset 4 */
 	/*  pkt_offset, unit:8 bytes padding */
 	if (pxmitframe->pkt_offset > 0)
-		ptxdesc->txdw1 |= cpu_to_le32((pxmitframe->pkt_offset << 26) & 0x7c000000);
+		ptxdesc->txdw1 |= cpu_to_le32((pxmitframe->pkt_offset << 26) &
+					      0x7c000000);
 
-#ifdef CONFIG_USB_TX_AGGREGATION
 	if (pxmitframe->agg_num > 1)
-		ptxdesc->txdw5 |= cpu_to_le32((pxmitframe->agg_num << 24) & 0xff000000);
-#endif
+		ptxdesc->txdw5 |= cpu_to_le32((pxmitframe->agg_num << 24) &
+					      0xff000000);
 
 	rtl8192du_cal_txdesc_chksum(ptxdesc);
 
@@ -542,7 +541,6 @@ s32 rtw_dump_xframe(struct rtw_adapter *
 	return ret;
 }
 
-#ifdef CONFIG_USB_TX_AGGREGATION
 static u32 xmitframe_need_length(struct xmit_frame *pxmitframe)
 {
 	struct pkt_attrib *pattrib = &pxmitframe->attrib;
@@ -796,81 +794,6 @@ s32 rtl8192du_xmitframe_complete(struct
 	return true;
 }
 
-#else
-
-s32 rtl8192du_xmitframe_complete(struct rtw_adapter *padapter, struct xmit_priv *pxmitpriv, struct xmit_buf *pxmitbuf)
-{
-
-	struct hw_xmit *phwxmits;
-	int hwentry;
-	struct xmit_frame *pxmitframe=NULL;
-	int res=_SUCCESS, xcnt = 0;
-
-	phwxmits = pxmitpriv->hwxmits;
-	hwentry = pxmitpriv->hwxmit_entry;
-
-	RT_TRACE(_module_rtl871x_xmit_c_,_drv_info_,("xmitframe_complete()\n"));
-
-	if (pxmitbuf==NULL)
-	{
-		pxmitbuf = rtw_alloc_xmitbuf(pxmitpriv);
-		if (!pxmitbuf)
-		{
-			return false;
-		}
-	}
-
-	do
-	{
-		pxmitframe =  rtw_dequeue_xframe(pxmitpriv, phwxmits, hwentry);
-
-		if (pxmitframe)
-		{
-			pxmitframe->pxmitbuf = pxmitbuf;
-
-			pxmitframe->buf_addr = pxmitbuf->pbuf;
-
-			pxmitbuf->priv_data = pxmitframe;
-
-			if ((pxmitframe->frame_tag&0x0f) == DATA_FRAMETAG)
-			{
-				if (pxmitframe->attrib.priority<=15)/* TID0~15 */
-				{
-					res = rtw_xmitframe_coalesce(padapter, pxmitframe->pkt, pxmitframe);
-				}
-
-				rtw_os_xmit_complete(padapter, pxmitframe);/* always return ndis_packet after rtw_xmitframe_coalesce */
-			}
-
-			RT_TRACE(_module_rtl871x_xmit_c_,_drv_info_,("xmitframe_complete(): rtw_dump_xframe\n"));
-
-			if (res == _SUCCESS)
-			{
-				rtw_dump_xframe(padapter, pxmitframe);
-			}
-			else
-			{
-				rtw_free_xmitbuf(pxmitpriv, pxmitbuf);
-				rtw_free_xmitframe(pxmitpriv, pxmitframe);
-			}
-
-			xcnt++;
-
-		}
-		else
-		{
-			rtw_free_xmitbuf(pxmitpriv, pxmitbuf);
-			return false;
-		}
-
-		break;
-
-	}while (0/*xcnt < (NR_XMITFRAME >> 3)*/);
-
-	return true;
-}
-#endif
-
 static s32 xmitframe_direct(struct rtw_adapter *padapter, struct xmit_frame *pxmitframe)
 {
 	s32 res = _SUCCESS;
@@ -883,8 +806,7 @@ static s32 xmitframe_direct(struct rtw_a
 	return res;
 }
 
-/*
- * Return
+/*	Return
  *	true	dump packet directly
  *	false	enqueue packet
  */
--- a/drivers/staging/rtl8192du/hal/usb_halinit.c
+++ b/drivers/staging/rtl8192du/hal/usb_halinit.c
@@ -281,19 +281,14 @@ static void rtl8192du_interface_configur
 	pHalData->RtBulkOutPipe[1] = pdvobjpriv->ep_num[2];
 	pHalData->RtIntInPipe = pdvobjpriv->ep_num[3];
 	pHalData->RtBulkOutPipe[2] = pdvobjpriv->ep_num[4];
-	/* DBG_8192D("Bulk In = %x, Bulk Out = %x %x %x\n",pHalData->RtBulkInPipe, pHalData->RtBulkOutPipe[0],pHalData->RtBulkOutPipe[1],pHalData->RtBulkOutPipe[2]); */
-#ifdef CONFIG_USB_TX_AGGREGATION
-	pHalData->UsbTxAggMode		= 1;
-	pHalData->UsbTxAggDescNum	= 0x4;	/*  only 4 bits */
-#endif
+	pHalData->UsbTxAggMode = 1;
+	pHalData->UsbTxAggDescNum = 0x4;	/*  only 4 bits */
 
-#ifdef CONFIG_USB_RX_AGGREGATION
 	pHalData->UsbRxAggMode = USB_RX_AGG_DMA;/*  USB_RX_AGG_DMA; */
 	pHalData->UsbRxAggBlockCount	= 8; /* unit : 512b */
 	pHalData->UsbRxAggBlockTimeout = 0x6;
 	pHalData->UsbRxAggPageCount	= 48; /* uint :128 b 0x0A;	10 = MAX_RX_DMA_BUFFER_SIZE/2/pHalData->UsbBulkOutSize */
 	pHalData->UsbRxAggPageTimeout = 0x6; /* 6, absolute time = 34ms/(2^6) */
-#endif
 
 	HalUsbSetQueuePipeMapping8192DUsb(padapter,
 				pdvobjpriv->RtNumInPipes, pdvobjpriv->RtNumOutPipes);
@@ -304,7 +299,6 @@ static u8 _InitPowerOn(struct rtw_adapte
 	u8	ret = _SUCCESS;
 	u16	value16=0;
 	u8	value8 = 0;
-/*	struct hal_data_8192du *pHalData = GET_HAL_DATA(padapter); */
 
 	/*  polling autoload done. */
 	u32	pollingCount = 0;
@@ -1305,15 +1299,12 @@ _InitRetryFunction(
 	rtw_write8(adapter, REG_ACKTO, 0x40);
 }
 
-static void
-_InitUsbAggregationSetting(
-	struct rtw_adapter * adapter
-	)
-{
-#ifdef CONFIG_USB_TX_AGGREGATION
+static void _InitUsbAggregationSetting(struct rtw_adapter * adapter)
 {
 	struct hal_data_8192du *pHalData = GET_HAL_DATA(adapter);
-	u32			value32;
+	u8 valuedma;
+	u8 valueusb;
+	u32 value32;
 
 	if (adapter->registrypriv.wifi_spec)
 		pHalData->UsbTxAggMode = false;
@@ -1328,46 +1319,37 @@ _InitUsbAggregationSetting(
 
 		rtw_write32(adapter, REG_TDECTRL, value32);
 	}
-}
-#endif
 
 	/*  Rx aggregation setting */
-#ifdef CONFIG_USB_RX_AGGREGATION
-{
-	struct hal_data_8192du *pHalData = GET_HAL_DATA(adapter);
-	u8		valueDMA;
-	u8		valueUSB;
-
 	if (pHalData->MacPhyMode92D!=SINGLEMAC_SINGLEPHY) {
 		pHalData->UsbRxAggPageCount	= 24;
 		pHalData->UsbRxAggPageTimeout = 0x6;
 	}
-
-	valueDMA = rtw_read8(adapter, REG_TRXDMA_CTRL);
-	valueUSB = rtw_read8(adapter, REG_USB_SPECIAL_OPTION);
+	valuedma = rtw_read8(adapter, REG_TRXDMA_CTRL);
+	valueusb = rtw_read8(adapter, REG_USB_SPECIAL_OPTION);
 
 	switch (pHalData->UsbRxAggMode) {
 	case USB_RX_AGG_DMA:
-		valueDMA |= RXDMA_AGG_EN;
-		valueUSB &= ~USB_AGG_EN;
+		valuedma |= RXDMA_AGG_EN;
+		valueusb &= ~USB_AGG_EN;
 		break;
 	case USB_RX_AGG_USB:
-		valueDMA &= ~RXDMA_AGG_EN;
-		valueUSB |= USB_AGG_EN;
+		valuedma &= ~RXDMA_AGG_EN;
+		valueusb |= USB_AGG_EN;
 		break;
 	case USB_RX_AGG_DMA_USB:
-		valueDMA |= RXDMA_AGG_EN;
-		valueUSB |= USB_AGG_EN;
+		valuedma |= RXDMA_AGG_EN;
+		valueusb |= USB_AGG_EN;
 		break;
 	case USB_RX_AGG_DISABLE:
 	default:
-		valueDMA &= ~RXDMA_AGG_EN;
-		valueUSB &= ~USB_AGG_EN;
+		valuedma &= ~RXDMA_AGG_EN;
+		valueusb &= ~USB_AGG_EN;
 		break;
 	}
 
-	rtw_write8(adapter, REG_TRXDMA_CTRL, valueDMA);
-	rtw_write8(adapter, REG_USB_SPECIAL_OPTION, valueUSB);
+	rtw_write8(adapter, REG_TRXDMA_CTRL, valuedma);
+	rtw_write8(adapter, REG_USB_SPECIAL_OPTION, valueusb);
 	switch (pHalData->UsbRxAggMode) {
 		case USB_RX_AGG_DMA:
 			rtw_write8(adapter, REG_RXDMA_AGG_PG_TH, pHalData->UsbRxAggPageCount);
@@ -1388,35 +1370,28 @@ _InitUsbAggregationSetting(
 			/*  TODO: */
 			break;
 	}
-	switch (PBP_128)
-	{
-		case PBP_128:
-			pHalData->HwRxPageSize = 128;
-			break;
-		case PBP_64:
-			pHalData->HwRxPageSize = 64;
-			break;
-		case PBP_256:
-			pHalData->HwRxPageSize = 256;
-			break;
-		case PBP_512:
-			pHalData->HwRxPageSize = 512;
-			break;
-		case PBP_1024:
-			pHalData->HwRxPageSize = 1024;
-			break;
-		default:
-			/* RT_ASSERT(FALSE, ("RX_PAGE_SIZE_REG_VALUE definition is incorrect!\n")); */
-			break;
+	switch (PBP_128) {
+	case PBP_128:
+		pHalData->HwRxPageSize = 128;
+		break;
+	case PBP_64:
+		pHalData->HwRxPageSize = 64;
+		break;
+	case PBP_256:
+		pHalData->HwRxPageSize = 256;
+		break;
+	case PBP_512:
+		pHalData->HwRxPageSize = 512;
+		break;
+	case PBP_1024:
+		pHalData->HwRxPageSize = 1024;
+		break;
+	default:
+		break;
 	}
 }
-#endif
-}
 
-static void
-_InitOperationMode(
-	struct rtw_adapter *			adapter
-	)
+static void _InitOperationMode(struct rtw_adapter *adapter)
 {
 	struct hal_data_8192du *pHalData = GET_HAL_DATA(adapter);
 	u8 regBwOpMode = 0, MinSpaceCfg = 0;
@@ -1599,19 +1574,13 @@ static void _RfPowerSave(
 	}
 }
 
-#ifdef CONFIG_LED
-static void _InitHWLed(struct rtw_adapter * adapter)
+static void init_hwled(struct rtw_adapter * adapter)
 {
 	struct led_priv *pledpriv = &(adapter->ledpriv);
 
 	if (pledpriv->LedStrategy != HW_LED)
 			return;
-
-/*  HW led control */
-/*  to do .... */
-/* must consider the cases of antenna diversity/ commbo card/solo card/mini card */
 }
-#endif /* CONFIG_LED */
 
 #ifdef CONFIG_WOWLAN
 static void dump_wakup_reason(struct rtw_adapter *padapter)
@@ -1925,9 +1894,7 @@ HAL_INIT_PROFILE_TAG(HAL_INIT_STAGES_MIS
 	rtw_write16(padapter, REG_PKT_BE_BK_LIFE_TIME, 0x0400);	/*  unit: 256us. 256ms */
 #endif	/*  CONFIG_CONCURRENT_MODE */
 
-	#ifdef CONFIG_LED
-	_InitHWLed(padapter);
-	#endif
+	init_hwled(padapter);
 
 #if ENABLE_USB_DROP_INCORRECT_OUT
 	_InitHardwareDropIncorrectBulkOut(padapter);
@@ -2200,11 +2167,8 @@ HAL_INIT_PROFILE_TAG(HAL_INIT_STAGES_MIS
 		rtw_write32(padapter, 0xC8C, 0xa0e40000);
 	}
 
-#ifdef CONFIG_XMIT_ACK
 	/* ack for xmit mgmt frames. */
 	rtw_write32(padapter, REG_FWHW_TXQ_CTRL, rtw_read32(padapter, REG_FWHW_TXQ_CTRL)|BIT(12));
-#endif /* CONFIG_XMIT_ACK */
-
 exit:
 	padapter->init_adpt_in_progress = false;
 
@@ -4629,7 +4593,6 @@ static void SetHwReg8192DU(struct rtw_ad
 			}
 			break;
 		case HW_VAR_RXDMA_AGG_PG_TH:
-			#ifdef CONFIG_USB_RX_AGGREGATION
 			{
 				u8	threshold = *((u8 *)val);
 				if (threshold == 0)
@@ -4638,7 +4601,6 @@ static void SetHwReg8192DU(struct rtw_ad
 				}
 				rtw_write8(adapter, REG_RXDMA_AGG_PG_TH, threshold);
 			}
-			#endif
 			break;
 		case HW_VAR_SET_RPWM:
 			{
@@ -5319,13 +5281,8 @@ void rtl8192du_set_hal_ops(struct rtw_ad
 
 	pHalFunc->init_recv_priv = &rtl8192du_init_recv_priv;
 	pHalFunc->free_recv_priv = &rtl8192du_free_recv_priv;
-#ifdef CONFIG_SW_LED
 	pHalFunc->InitSwLeds = &rtl8192du_InitSwLeds;
 	pHalFunc->DeInitSwLeds = &rtl8192du_DeInitSwLeds;
-#else /*  case of hw led or no led */
-	pHalFunc->InitSwLeds = NULL;
-	pHalFunc->DeInitSwLeds = NULL;
-#endif /* CONFIG_SW_LED */
 
 	pHalFunc->init_default_value = &rtl8192du_init_default_value;
 	pHalFunc->intf_chip_configure = &rtl8192du_interface_configure;
--- a/drivers/staging/rtl8192du/hal/usb_ops_linux.c
+++ b/drivers/staging/rtl8192du/hal/usb_ops_linux.c
@@ -599,43 +599,31 @@ static int recvbuf2recvframe(struct rtw_
 
 		recvframe_put(precvframe, skb_len);
 
-#ifdef CONFIG_USB_RX_AGGREGATION
-		switch (pHalData->UsbRxAggMode)
-		{
-			case USB_RX_AGG_DMA:
-			case USB_RX_AGG_DMA_USB:
-				pkt_offset = (u16)_RND128(pkt_offset);
-				break;
-				case USB_RX_AGG_USB:
-				pkt_offset = (u16)_RND4(pkt_offset);
-				break;
-			case USB_RX_AGG_DISABLE:
-			default:
-				break;
+		switch (pHalData->UsbRxAggMode) {
+		case USB_RX_AGG_DMA:
+		case USB_RX_AGG_DMA_USB:
+			pkt_offset = (u16)_RND128(pkt_offset);
+			break;
+			case USB_RX_AGG_USB:
+			pkt_offset = (u16)_RND4(pkt_offset);
+			break;
+		case USB_RX_AGG_DISABLE:
+		default:
+			break;
 		}
-#endif
 #ifdef CONFIG_CONCURRENT_MODE
-		if (rtw_buddy_adapter_up(padapter))
-		{
+		if (rtw_buddy_adapter_up(padapter)) {
 			if (pre_recv_entry(precvframe, prxstat, pphy_info) != _SUCCESS)
-			{
 				RT_TRACE(_module_rtl871x_recv_c_,_drv_err_,("recvbuf2recvframe: recv_entry(precvframe) != _SUCCESS\n"));
-			}
-		}
-		else
-		{
+		} else {
 			rtl8192d_translate_rx_signal_stuff(precvframe, pphy_info);
 			if (rtw_recv_entry(precvframe) != _SUCCESS)
-			{
 				RT_TRACE(_module_rtl871x_recv_c_,_drv_err_,("recvbuf2recvframe: rtw_recv_entry(precvframe) != _SUCCESS\n"));
-			}
 		}
 #else
 		rtl8192d_translate_rx_signal_stuff(precvframe, pphy_info);
 		if (rtw_recv_entry(precvframe) != _SUCCESS)
-		{
 			RT_TRACE(_module_rtl871x_recv_c_,_drv_err_,("recvbuf2recvframe: rtw_recv_entry(precvframe) != _SUCCESS\n"));
-		}
 #endif /* CONFIG_CONCURRENT_MODE */
 		pkt_cnt--;
 
@@ -644,7 +632,7 @@ static int recvbuf2recvframe(struct rtw_
 		precvframe = NULL;
 		pkt_copy = NULL;
 
-		if (transfer_len>0 && pkt_cnt==0)
+		if (transfer_len > 0 && pkt_cnt == 0)
 			pkt_cnt = (le32_to_cpu(prxstat->rxdw2)>>16) & 0xff;
 
 	}while ((transfer_len>0) && (pkt_cnt>0));
--- a/drivers/staging/rtl8192du/include/autoconf.h
+++ b/drivers/staging/rtl8192du/include/autoconf.h
@@ -42,12 +42,7 @@
 #endif /* CONFIG_WAKE_ON_WLAN */
 #define CONFIG_R871X_TEST	1
 
-#define CONFIG_XMIT_ACK
-#ifdef CONFIG_XMIT_ACK
-	#define CONFIG_XMIT_ACK_POLLING
-	#define CONFIG_ACTIVE_KEEP_ALIVE_CHECK
-#endif
-
+#define CONFIG_ACTIVE_KEEP_ALIVE_CHECK
 
 #define CONFIG_80211N_HT	1
 
@@ -56,14 +51,12 @@
 #define CONFIG_IPS	1
 #define CONFIG_LPS	1
 
-#define CONFIG_AP_MODE 1
-#ifdef CONFIG_AP_MODE
-	#define CONFIG_NATIVEAP_MLME 1
-	#ifndef CONFIG_NATIVEAP_MLME
-		#define CONFIG_HOSTAPD_MLME	1
-	#endif
-	#define CONFIG_FIND_BEST_CHANNEL	1
+#define CONFIG_92D_AP_MODE 1
+#define CONFIG_NATIVEAP_MLME 1
+#ifndef CONFIG_NATIVEAP_MLME
+	#define CONFIG_HOSTAPD_MLME	1
 #endif
+#define CONFIG_FIND_BEST_CHANNEL	1
 
 /* 	Added by Albert 20110314 */
 #define CONFIG_P2P	1
@@ -77,16 +70,8 @@
 	#endif
 #endif
 
-#define CONFIG_SKB_COPY	1/* for amsdu */
-
 #define CONFIG_DFS	1
 
-#define CONFIG_LED
-#ifdef CONFIG_LED
-	#define CONFIG_SW_LED
-#endif /* CONFIG_LED */
-
-
 #define CONFIG_LAYER2_ROAMING
 #define CONFIG_LAYER2_ROAMING_RESUME
 /* define CONFIG_SET_SCAN_DENY_TIMER */
@@ -107,11 +92,6 @@
 
 /* Interface  Related Config */
 
-#ifndef CONFIG_MINIMAL_MEMORY_USAGE
-	#define CONFIG_USB_TX_AGGREGATION	1
-	#define CONFIG_USB_RX_AGGREGATION	1
-#endif
-
 #define CONFIG_PREALLOC_RECV_SKB	1
 
 /*
--- a/drivers/staging/rtl8192du/include/drv_types.h
+++ b/drivers/staging/rtl8192du/include/drv_types.h
@@ -317,7 +317,7 @@ struct rtw_adapter {
 	struct	drvext_priv	drvextpriv;
 #endif
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	struct	hostapd_priv	*phostapdpriv;
 #endif
 
--- a/drivers/staging/rtl8192du/include/ieee80211.h
+++ b/drivers/staging/rtl8192du/include/ieee80211.h
@@ -28,7 +28,7 @@
 #define ETH_TYPE_LEN		2
 #define PAYLOAD_TYPE_LEN	1
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 
 #define RTL_IOCTL_HOSTAPD (SIOCIWFIRSTPRIV + 28)
 
@@ -221,7 +221,7 @@ struct ieee_param {
 			u16 key_len;
 			u8 key[0];
 		} crypt;
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 		struct {
 			u16 aid;
 			u16 capability;
@@ -238,7 +238,7 @@ struct ieee_param {
 	} u;
 };
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 struct ieee_param_ex {
 	u32 cmd;
 	u8 sta_addr[ETH_ALEN];
--- a/drivers/staging/rtl8192du/include/ioctl_cfg80211.h
+++ b/drivers/staging/rtl8192du/include/ioctl_cfg80211.h
@@ -92,10 +92,10 @@ void rtw_cfg80211_indicate_connect(struc
 void rtw_cfg80211_indicate_disconnect(struct rtw_adapter *padapter);
 void rtw_cfg80211_indicate_scan_done(struct rtw_wdev_priv *pwdev_priv, bool aborted);
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 void rtw_cfg80211_indicate_sta_assoc(struct rtw_adapter *padapter, u8 *pmgmt_frame, uint frame_len);
 void rtw_cfg80211_indicate_sta_disassoc(struct rtw_adapter *padapter, unsigned char *da, unsigned short reason);
-#endif /* CONFIG_AP_MODE */
+#endif /* CONFIG_92D_AP_MODE */
 
 void rtw_cfg80211_issue_p2p_provision_request(struct rtw_adapter *padapter, const u8 *buf, size_t len);
 void rtw_cfg80211_rx_p2p_action_public(struct rtw_adapter *padapter, u8 *pmgmt_frame, uint frame_len);
--- a/drivers/staging/rtl8192du/include/rtl8192d_hal.h
+++ b/drivers/staging/rtl8192du/include/rtl8192d_hal.h
@@ -238,22 +238,21 @@ static u32 TargetChnl_2G[TARGET_CHNL_NUM
 #define DRVINFO_SZ	4 /*  unit is 8bytes */
 #define PageNum_128(_Len)		(u32)(((_Len)>>7) + ((_Len)&0x7F ? 1:0))
 
-/*  */
-/*  Check if FW header exists. We do not consider the lower 4 bits in this case. */
-/*  By tynli. 2009.12.04. */
-/*  */
-#define IS_FW_HEADER_EXIST(_pFwHdr)	((le16_to_cpu(_pFwHdr->Signature)&0xFFF0) == 0x92C0 ||\
-					(le16_to_cpu(_pFwHdr->Signature)&0xFFF0) == 0x88C0 ||\
-					(le16_to_cpu(_pFwHdr->Signature)&0xFFFF) == 0x92D0 ||\
-					(le16_to_cpu(_pFwHdr->Signature)&0xFFFF) == 0x92D1 ||\
-					(le16_to_cpu(_pFwHdr->Signature)&0xFFFF) == 0x92D2 ||\
-					(le16_to_cpu(_pFwHdr->Signature)&0xFFFF) == 0x92D3)
+/*  Check if FW header exists. Ignore the lower 4 bits in this case. */
+#define IS_FW_HEADER_EXIST(_fwhdr)				\
+	((le16_to_cpu(_fwhdr->Signature)&0xFFF0) == 0x92C0 ||	\
+	(le16_to_cpu(_fwhdr->Signature)&0xFFF0) == 0x88C0 ||	\
+	(le16_to_cpu(_fwhdr->Signature)&0xFFFF) == 0x92D0 ||	\
+	(le16_to_cpu(_fwhdr->Signature)&0xFFFF) == 0x92D1 ||	\
+	(le16_to_cpu(_fwhdr->Signature)&0xFFFF) == 0x92D2 ||	\
+	(le16_to_cpu(_fwhdr->Signature)&0xFFFF) == 0x92D3)
 
-#define FW_8192D_SIZE				0x8020 /*  Max FW len = 32k + 32(FW header length). */
+/* Max FW len = 32k + 32(FW header length). */
+#define FW_8192D_SIZE		0x8020
 #define FW_8192D_START_ADDRESS	0x1000
-#define FW_8192D_END_ADDRESS		0x1FFF
+#define FW_8192D_END_ADDRESS	0x1FFF
 
-#define MAX_PAGE_SIZE				4096	/*  @ page : 4k bytes */
+#define MAX_PAGE_SIZE		4096	/*  @ page : 4k bytes */
 
 struct rt_firmware_92d {
 	u8 *buffer;
@@ -264,16 +263,19 @@ struct rt_firmware_92d {
 #endif /* CONFIG_WOWLAN */
 };
 
-/*  */
-/*  This structure must be cared byte-ordering */
-/*  */
-/*  Added by tynli. 2009.12.04. */
+/*  This structure must be careful with le byte-ordering */
 struct rt_8192d_firmware_hdr { /* 8-byte alinment required */
-
 	/*  LONG WORD 0 ---- */
-	__le16		Signature;	/*  92C0: test chip; 92C, 88C0: test chip; 88C1: MP A-cut; 92C1: MP A-cut */
+
+	/*  92C0: test chip; 92C, 88C0: test chip; 88C1: MP A-cut;
+	 * 92C1: MP A-cut
+	 */
+	__le16		Signature;
 	u8		Category;	/*  AP/NIC and USB/PCI */
-	u8		Function;	/*  Reserved for different FW function indcation, for further use when driver needs to download different FW in different conditions */
+	/* Reserved for different FW function indication, for further use when
+	 * driver needs to download different FW in different conditions
+	 */
+	u8		Function;
 	__le16		Version;		/*  FW Version */
 	u8		Subversion;	/*  FW Subversion, default 0x00 */
 	u8		Rsvd1;
@@ -305,8 +307,6 @@ struct iqk_matrix_regs_setting {
 	int		Value[1][IQK_Matrix_REG_NUM];
 };
 
-#ifdef CONFIG_USB_RX_AGGREGATION
-
 enum USB_RX_AGG_MODE {
 	USB_RX_AGG_DISABLE,
 	USB_RX_AGG_DMA,
@@ -314,20 +314,19 @@ enum USB_RX_AGG_MODE {
 	USB_RX_AGG_DMA_USB
 };
 
-#define MAX_RX_DMA_BUFFER_SIZE	10240		/*  10K for 8192C RX DMA buffer */
-
-#endif
-
+#define MAX_RX_DMA_BUFFER_SIZE	10240		/*  10K for 8192C RX DMA buf */
 
-#define TX_SELE_HQ			BIT(0)		/*  High Queue */
-#define TX_SELE_LQ			BIT(1)		/*  Low Queue */
-#define TX_SELE_NQ			BIT(2)		/*  Normal Queue */
+#define TX_SELE_HQ		BIT(0)		/*  High Queue */
+#define TX_SELE_LQ		BIT(1)		/*  Low Queue */
+#define TX_SELE_NQ		BIT(2)		/*  Normal Queue */
 
 
-/*  Note: We will divide number of page equally for each queue other than public queue! */
+/* Note: We will divide number of page equally for each queue
+ * other than public queue!
+ */
 
 #define TX_TOTAL_PAGE_NUMBER		0xF8
-#define TX_PAGE_BOUNDARY			(TX_TOTAL_PAGE_NUMBER + 1)
+#define TX_PAGE_BOUNDARY		(TX_TOTAL_PAGE_NUMBER + 1)
 
 /*  For Normal Chip Setting */
 /*  (HPQ + LPQ + NPQ + PUBQ) shall be TX_TOTAL_PAGE_NUMBER */
@@ -685,11 +684,8 @@ struct hal_data_8192du {
 
 	u8	Queue2EPNum[8];/* for out endpoint number mapping */
 
-#ifdef CONFIG_USB_TX_AGGREGATION
 	u8	UsbTxAggMode;
 	u8	UsbTxAggDescNum;
-#endif
-#ifdef CONFIG_USB_RX_AGGREGATION
 	u16	HwRxPageSize;				/*  Hardware setting */
 	u32	MaxUsbRxAggBlock;
 
@@ -698,7 +694,6 @@ struct hal_data_8192du {
 	u8	UsbRxAggBlockTimeout;
 	u8	UsbRxAggPageCount;			/*  8192C DMA page count */
 	u8	UsbRxAggPageTimeout;
-#endif
 
 	u16	RegRRSR;
 
--- a/drivers/staging/rtl8192du/include/rtl8192d_xmit.h
+++ b/drivers/staging/rtl8192du/include/rtl8192d_xmit.h
@@ -80,17 +80,10 @@ struct txrpt_ccx_8192d {
 
 #define txrpt_ccx_qtime_8192d(txrpt_ccx) ((txrpt_ccx)->ccx_qtime0+((txrpt_ccx)->ccx_qtime1<<8))
 
-#ifdef CONFIG_XMIT_ACK
 void dump_txrpt_ccx_8192d(void *buf);
 void handle_txrpt_ccx_8192d(struct rtw_adapter *adapter, void *buf);
-#else
-#define dump_txrpt_ccx_8192d(buf) do {} while (0)
-#define handle_txrpt_ccx_8192d(adapter, buf) do {} while (0)
-#endif
 
-#ifdef CONFIG_USB_TX_AGGREGATION
 #define MAX_TX_AGG_PACKET_NUMBER 0xFF
-#endif
 
 s32	rtl8192du_init_xmit_priv(struct rtw_adapter * padapter);
 
@@ -98,11 +91,15 @@ void	rtl8192du_free_xmit_priv(struct rtw
 
 void rtl8192du_cal_txdesc_chksum(struct tx_desc	*ptxdesc);
 
-s32 rtl8192du_xmitframe_complete(struct rtw_adapter *padapter, struct xmit_priv *pxmitpriv, struct xmit_buf *pxmitbuf);
+s32 rtl8192du_xmitframe_complete(struct rtw_adapter *padapter,
+				 struct xmit_priv *pxmitpriv,
+				 struct xmit_buf *pxmitbuf);
 
-s32 rtl8192du_mgnt_xmit(struct rtw_adapter *padapter, struct xmit_frame *pmgntframe);
+s32 rtl8192du_mgnt_xmit(struct rtw_adapter *padapter,
+			struct xmit_frame *pmgntframe);
 
-s32 rtl8192du_hal_xmit(struct rtw_adapter *padapter, struct xmit_frame *pxmitframe);
+s32 rtl8192du_hal_xmit(struct rtw_adapter *padapter,
+		       struct xmit_frame *pxmitframe);
 
 #ifdef CONFIG_HOSTAPD_MLME
 s32	rtl8192du_hostap_mgnt_xmit_entry(struct rtw_adapter *padapter, _pkt *pkt);
--- a/drivers/staging/rtl8192du/include/rtw_ap.h
+++ b/drivers/staging/rtl8192du/include/rtw_ap.h
@@ -21,7 +21,7 @@
 #include <drv_types.h>
 
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 
 /* external function */
 extern void rtw_indicate_sta_assoc_event(struct rtw_adapter *padapter, struct sta_info *psta);
@@ -52,6 +52,6 @@ int rtw_ap_inform_ch_switch (struct rtw_
 void start_ap_mode(struct rtw_adapter *padapter);
 void stop_ap_mode(struct rtw_adapter *padapter);
 #endif
-#endif /* end of CONFIG_AP_MODE */
+#endif /* end of CONFIG_92D_AP_MODE */
 
 #endif
--- a/drivers/staging/rtl8192du/include/rtw_cmd.h
+++ b/drivers/staging/rtl8192du/include/rtw_cmd.h
@@ -925,7 +925,7 @@ extern  u8 rtw_antenna_select_cmd(struct
 extern u8 rtw_ps_cmd(struct rtw_adapter*padapter);
 
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 u8 rtw_chk_hi_queue_cmd(struct rtw_adapter*padapter);
 #endif
 
--- a/drivers/staging/rtl8192du/include/rtw_debug.h
+++ b/drivers/staging/rtl8192du/include/rtw_debug.h
@@ -313,7 +313,7 @@ extern u32 GlobalDebugLevel;
 			  off_t offset, int count,
 			  int *eof, void *data);
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 
 	int proc_get_all_sta_info(char *page, char **start,
 			  off_t offset, int count,
--- a/drivers/staging/rtl8192du/include/rtw_led.h
+++ b/drivers/staging/rtl8192du/include/rtw_led.h
@@ -118,20 +118,17 @@ struct led_priv{
 	struct LED_871X			SwLed0;
 	struct LED_871X			SwLed1;
 	enum LED_STRATEGY_871X	LedStrategy;
-	u8					bRegUseLed;
-	void (*LedControlHandler)(struct rtw_adapter *padapter, enum LED_CTL_MODE LedAction);
+	u8	bRegUseLed;
+	void (*LedControlHandler)(struct rtw_adapter *padapter, enum LED_CTL_MODE _ledaction);
 	/* add for led controll */
 };
 
-#ifdef CONFIG_SW_LED
-#define rtw_led_control(adapter, LedAction) \
+#define rtw_led_control(adapter, _ledaction) \
 	do { \
 		if ((adapter)->ledpriv.LedControlHandler) \
-			(adapter)->ledpriv.LedControlHandler((adapter), (LedAction)); \
+			(adapter)->ledpriv.LedControlHandler((adapter),	\
+							     (_ledaction)); \
 	} while (0)
-#else /* CONFIG_SW_LED */
-#define rtw_led_control(adapter, LedAction)
-#endif /* CONFIG_SW_LED */
 
 extern void BlinkHandler(struct LED_871X *pLed);
 
--- a/drivers/staging/rtl8192du/include/rtw_mlme.h
+++ b/drivers/staging/rtl8192du/include/rtw_mlme.h
@@ -426,7 +426,7 @@ struct mlme_priv {
 	u8 *wps_probe_req_ie;
 	u32 wps_probe_req_ie_len;
 
-#if defined (CONFIG_AP_MODE) && defined (CONFIG_NATIVEAP_MLME)
+#if defined (CONFIG_92D_AP_MODE) && defined (CONFIG_NATIVEAP_MLME)
 	/* Number of associated Non-ERP stations (i.e., stations using 802.11b
 	 * in 802.11g BSS) */
 	int num_sta_non_erp;
@@ -483,7 +483,7 @@ struct mlme_priv {
 	u8		update_bcn;
 
 
-#endif /* if defined (CONFIG_AP_MODE) && defined (CONFIG_NATIVEAP_MLME) */
+#endif /* if defined (CONFIG_92D_AP_MODE) && defined (CONFIG_NATIVEAP_MLME) */
 
 #if defined(CONFIG_WFD) && defined(CONFIG_IOCTL_CFG80211)
 
@@ -517,7 +517,7 @@ struct mlme_priv {
 #endif
 };
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 
 struct hostapd_priv
 {
--- a/drivers/staging/rtl8192du/include/rtw_mlme_ext.h
+++ b/drivers/staging/rtl8192du/include/rtw_mlme_ext.h
@@ -454,7 +454,7 @@ struct mlme_ext_priv
 
 	u64 TSFValue;
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	unsigned char bstart_bss;
 #endif
 
--- a/drivers/staging/rtl8192du/include/rtw_security.h
+++ b/drivers/staging/rtl8192du/include/rtw_security.h
@@ -109,7 +109,7 @@ struct security_priv
 	union pn48		dot11Grptxpn;			/*  PN48 used for Grp Key xmit. */
 	union pn48		dot11Grprxpn;			/*  PN48 used for Grp Key recv. */
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	/* extend security capabilities for AP_MODE */
 	unsigned int dot8021xalg;/* 0:disable, 1:psk, 2:802.1x */
 	unsigned int wpa_psk;/* 0:disable, bit(0): WPA, bit(1):WPA2 */
--- a/drivers/staging/rtl8192du/include/rtw_xmit.h
+++ b/drivers/staging/rtl8192du/include/rtw_xmit.h
@@ -19,25 +19,21 @@
 #include <drv_conf.h>
 #include <osdep_service.h>
 #include <drv_types.h>
-#ifdef CONFIG_USB_TX_AGGREGATION
-	#define MAX_XMITBUF_SZ	(20480)	/*  20k */
-#else
-#define MAX_XMITBUF_SZ	(2048)
-#endif /* CONFIG_USB_TX_AGGREGATION */
+#define MAX_XMITBUF_SZ		(20480)	/*  20k */
 #ifdef CONFIG_SINGLE_XMIT_BUF
-#define NR_XMITBUFF	(1)
+#define NR_XMITBUFF		(1)
 #else
-#define NR_XMITBUFF	(4)
+#define NR_XMITBUFF		(4)
 #endif /* CONFIG_SINGLE_XMIT_BUF */
 
-#define XMITBUF_ALIGN_SZ 512
+#define XMITBUF_ALIGN_SZ	512
 
 /*  xmit extension buff defination */
 #define MAX_XMIT_EXTBUF_SZ	(1536)
 #ifdef CONFIG_SINGLE_XMIT_BUF
-#define NR_XMIT_EXTBUFF	(1)
+#define NR_XMIT_EXTBUFF		(1)
 #else
-#define NR_XMIT_EXTBUFF	(32)
+#define NR_XMIT_EXTBUFF		(32)
 #endif /* CONFIG_SINGLE_XMIT_BUF */
 
 #define MAX_NUMBLKS		(1)
@@ -292,15 +288,11 @@ struct xmit_frame {
 	struct rtw_adapter *padapter;
 	u8	*buf_addr;
 	struct xmit_buf *pxmitbuf;
-#ifdef CONFIG_USB_TX_AGGREGATION
 	u8	agg_num;
-#endif
 	u8	pkt_offset;
 	u8	EMPktNum;
 	u16	EMPktLen[5];/* The max value by HW */
-#ifdef CONFIG_XMIT_ACK
 	u8 ack_report;
-#endif
 };
 
 struct tx_servq {
@@ -394,60 +386,53 @@ struct	xmit_priv	{
 
 	u16	nqos_ssn;
 
-#ifdef CONFIG_XMIT_ACK
 	int	ack_tx;
 	_mutex ack_tx_mutex;
 	struct submit_ctx ack_tx_ops;
-#endif
-
 };
 
-extern struct xmit_buf *rtw_alloc_xmitbuf_ext(struct xmit_priv *pxmitpriv);
-extern s32 rtw_free_xmitbuf_ext(struct xmit_priv *pxmitpriv, struct xmit_buf *pxmitbuf);
+struct xmit_buf *rtw_alloc_xmitbuf_ext(struct xmit_priv *pxmitpriv);
+s32 rtw_free_xmitbuf_ext(struct xmit_priv *pxmitpriv, struct xmit_buf *pxmitbuf);
 
-extern struct xmit_buf *rtw_alloc_xmitbuf(struct xmit_priv *pxmitpriv);
-extern s32 rtw_free_xmitbuf(struct xmit_priv *pxmitpriv, struct xmit_buf *pxmitbuf);
+struct xmit_buf *rtw_alloc_xmitbuf(struct xmit_priv *pxmitpriv);
+s32 rtw_free_xmitbuf(struct xmit_priv *pxmitpriv, struct xmit_buf *pxmitbuf);
 
 void rtw_count_tx_stats(struct rtw_adapter *padapter, struct xmit_frame *pxmitframe, int sz);
-extern void rtw_update_protection(struct rtw_adapter *padapter, u8 *ie, uint ie_len);
-extern s32 rtw_make_wlanhdr(struct rtw_adapter *padapter, u8 *hdr, struct pkt_attrib *pattrib);
-extern s32 rtw_put_snap(u8 *data, u16 h_proto);
-
-extern struct xmit_frame *rtw_alloc_xmitframe(struct xmit_priv *pxmitpriv);
-extern s32 rtw_free_xmitframe(struct xmit_priv *pxmitpriv, struct xmit_frame *pxmitframe);
-extern void rtw_free_xmitframe_queue(struct xmit_priv *pxmitpriv, struct __queue *pframequeue);
+void rtw_update_protection(struct rtw_adapter *padapter, u8 *ie, uint ie_len);
+s32 rtw_make_wlanhdr(struct rtw_adapter *padapter, u8 *hdr, struct pkt_attrib *pattrib);
+s32 rtw_put_snap(u8 *data, u16 h_proto);
+
+struct xmit_frame *rtw_alloc_xmitframe(struct xmit_priv *pxmitpriv);
+s32 rtw_free_xmitframe(struct xmit_priv *pxmitpriv, struct xmit_frame *pxmitframe);
+void rtw_free_xmitframe_queue(struct xmit_priv *pxmitpriv, struct __queue *pframequeue);
 struct tx_servq *rtw_get_sta_pending(struct rtw_adapter *padapter, struct sta_info *psta, int up, u8 *ac);
-extern s32 rtw_xmitframe_enqueue(struct rtw_adapter *padapter, struct xmit_frame *pxmitframe);
-extern struct xmit_frame* rtw_dequeue_xframe(struct xmit_priv *pxmitpriv, struct hw_xmit *phwxmit_i, int entry);
+s32 rtw_xmitframe_enqueue(struct rtw_adapter *padapter, struct xmit_frame *pxmitframe);
+struct xmit_frame* rtw_dequeue_xframe(struct xmit_priv *pxmitpriv, struct hw_xmit *phwxmit_i, int entry);
 
-extern s32 rtw_xmit_classifier(struct rtw_adapter *padapter, struct xmit_frame *pxmitframe);
-extern int rtw_xmit_thread(void *context);
-extern u32 rtw_calculate_wlan_pkt_size_by_attribue(struct pkt_attrib *pattrib);
+s32 rtw_xmit_classifier(struct rtw_adapter *padapter, struct xmit_frame *pxmitframe);
+int rtw_xmit_thread(void *context);
+u32 rtw_calculate_wlan_pkt_size_by_attribue(struct pkt_attrib *pattrib);
 #define rtw_wlan_pkt_size(f) rtw_calculate_wlan_pkt_size_by_attribue(&f->attrib)
-extern s32 rtw_xmitframe_coalesce(struct rtw_adapter *padapter, struct sk_buff *pkt, struct xmit_frame *pxmitframe);
+s32 rtw_xmitframe_coalesce(struct rtw_adapter *padapter, struct sk_buff *pkt, struct xmit_frame *pxmitframe);
 #ifdef CONFIG_TDLS
 s32 rtw_xmit_tdls_coalesce(struct rtw_adapter *padapter, struct xmit_frame *pxmitframe, u8 action);
 #endif /* CONFIG_TDLS */
 s32 _rtw_init_hw_txqueue(struct hw_txqueue* phw_txqueue, u8 ac_tag);
 void _rtw_init_sta_xmit_priv(struct sta_xmit_priv *psta_xmitpriv);
 
-
 s32 rtw_txframes_pending(struct rtw_adapter *padapter);
 s32 rtw_txframes_sta_ac_pending(struct rtw_adapter *padapter, struct pkt_attrib *pattrib);
 void rtw_init_hwxmits(struct hw_xmit *phwxmit, int entry);
 
-
 s32 _rtw_init_xmit_priv(struct xmit_priv *pxmitpriv, struct rtw_adapter *padapter);
 void _rtw_free_xmit_priv (struct xmit_priv *pxmitpriv);
 
-
 void rtw_alloc_hwxmits(struct rtw_adapter *padapter);
 void rtw_free_hwxmits(struct rtw_adapter *padapter);
 
-
 s32 rtw_xmit(struct rtw_adapter *padapter, struct sk_buff **pkt);
 
-#if defined(CONFIG_AP_MODE) || defined(CONFIG_TDLS)
+#if defined(CONFIG_92D_AP_MODE) || defined(CONFIG_TDLS)
 int xmitframe_enqueue_for_sleeping_sta(struct rtw_adapter *padapter, struct xmit_frame *pxmitframe);
 void stop_sta_xmit(struct rtw_adapter *padapter, struct sta_info *psta);
 void wakeup_sta_to_xmit(struct rtw_adapter *padapter, struct sta_info *psta);
@@ -456,11 +441,8 @@ void xmit_delivery_enabled_frames(struct
 
 u8	qos_acm(u8 acm_mask, u8 priority);
 
-#ifdef CONFIG_XMIT_ACK
 int rtw_ack_tx_wait(struct xmit_priv *pxmitpriv, u32 timeout_ms);
 void rtw_ack_tx_done(struct xmit_priv *pxmitpriv, int status);
-#endif /* CONFIG_XMIT_ACK */
-
 
 /* include after declaring struct xmit_buf, in order to avoid warning */
 #include <xmit_osdep.h>
--- a/drivers/staging/rtl8192du/include/sta_info.h
+++ b/drivers/staging/rtl8192du/include/sta_info.h
@@ -175,7 +175,7 @@ struct sta_info {
 	/* curr_network(mlme_priv/security_priv/qos/ht) : AP CAP/INFO */
 	/* sta_info: (AP & STA) CAP/INFO */
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 
 	struct list_head asoc_list;
 	struct list_head auth_list;
@@ -240,7 +240,7 @@ struct sta_info {
 
 	u8 keep_alive_trycnt;
 
-#endif	/*  CONFIG_AP_MODE */
+#endif	/*  CONFIG_92D_AP_MODE */
 
 #ifdef CONFIG_IOCTL_CFG80211
 	u8 *passoc_req;
@@ -350,7 +350,7 @@ struct	sta_priv {
 	struct rtw_adapter *padapter;
 
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	struct list_head asoc_list;
 	struct list_head auth_list;
 	spinlock_t asoc_list_lock;
--- a/drivers/staging/rtl8192du/include/usb_osintf.h
+++ b/drivers/staging/rtl8192du/include/usb_osintf.h
@@ -42,16 +42,16 @@ int pm_netdev_open(struct net_device *pn
 int nat25_db_handle(struct rtw_adapter *priv, struct sk_buff *skb, int method);
 int nat25_handle_frame(struct rtw_adapter *priv, struct sk_buff *skb);
 void dhcp_flag_bcast(struct rtw_adapter *priv, struct sk_buff *skb);
-void *scdb_findentry(struct rtw_adapter *priv, unsigned char *macaddr, unsigned char *ipaddr);
+void *scdb_findentry(struct rtw_adapter *priv, unsigned char *macaddr,
+		     unsigned char *ipaddr);
 void nat25_db_expire(struct rtw_adapter *priv);
 u8 str_2char2num(u8 hch, u8 lch);
 u8 str_2char2num(u8 hch, u8 lch);
 u8 key_2char2num(u8 hch, u8 lch);
 u8 convert_ip_addr(u8 hch, u8 mch, u8 lch);
-void process_wmmps_data(struct rtw_adapter *padapter, struct recv_frame_hdr *precv_frame);
-
-#ifdef CONFIG_XMIT_ACK_POLLING
-s32 c2h_evt_hdl(struct rtw_adapter *adapter, struct c2h_evt_hdr *c2h_evt, c2h_id_filter filter);
-#endif
+void process_wmmps_data(struct rtw_adapter *padapter,
+			struct recv_frame_hdr *precv_frame);
+s32 c2h_evt_hdl(struct rtw_adapter *adapter, struct c2h_evt_hdr *c2h_evt,
+		c2h_id_filter filter);
 
 #endif
--- a/drivers/staging/rtl8192du/os_dep/ioctl_cfg80211.c
+++ b/drivers/staging/rtl8192du/os_dep/ioctl_cfg80211.c
@@ -566,7 +566,7 @@ void rtw_cfg80211_indicate_disconnect(_a
 	}
 }
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 static u8 set_pairwise_key(_adapter *padapter, struct sta_info *psta)
 {
 	struct cmd_obj*			ph2c;
@@ -1219,7 +1219,7 @@ static int cfg80211_rtw_add_key(struct w
 	}
 	else if (check_fwstate(pmlmepriv, WIFI_AP_STATE) == true)
 	{
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 		if (mac_addr)
 			memcpy(param->sta_addr, (void*)mac_addr, ETH_ALEN);
 
@@ -2688,7 +2688,7 @@ static int cfg80211_rtw_flush_pmksa(stru
 	return 0;
 }
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 void rtw_cfg80211_indicate_sta_assoc(_adapter *padapter, u8 *pmgmt_frame, uint frame_len)
 {
 	s32 freq;
@@ -3485,7 +3485,7 @@ static int	cfg80211_rtw_assoc(struct wip
 
 	return 0;
 }
-#endif /* CONFIG_AP_MODE */
+#endif /* CONFIG_92D_AP_MODE */
 
 void rtw_cfg80211_rx_action_p2p(_adapter *padapter, u8 *pmgmt_frame, uint frame_len)
 {
@@ -4606,7 +4606,7 @@ static struct cfg80211_ops rtw_cfg80211_
 	.del_pmksa = cfg80211_rtw_del_pmksa,
 	.flush_pmksa = cfg80211_rtw_flush_pmksa,
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	.add_virtual_intf = cfg80211_rtw_add_virtual_intf,
 	.del_virtual_intf = cfg80211_rtw_del_virtual_intf,
 
@@ -4628,7 +4628,7 @@ static struct cfg80211_ops rtw_cfg80211_
 	#if (LINUX_VERSION_CODE < KERNEL_VERSION(3, 6, 0))
 	.set_channel = cfg80211_rtw_set_channel,
 	#endif
-#endif /* CONFIG_AP_MODE */
+#endif /* CONFIG_92D_AP_MODE */
 
 #ifdef CONFIG_P2P
 	.remain_on_channel = cfg80211_rtw_remain_on_channel,
@@ -4728,7 +4728,7 @@ void rtw_cfg80211_init_wiphy(_adapter *p
 struct ieee80211_iface_limit rtw_limits[] = {
 	{ .max = 1, .types = BIT(NL80211_IFTYPE_STATION)
 					| BIT(NL80211_IFTYPE_ADHOC)
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 					| BIT(NL80211_IFTYPE_AP)
 #endif
 #if defined(CONFIG_P2P) && ((LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,37)) || defined(COMPAT_KERNEL_RELEASE))
@@ -4762,7 +4762,7 @@ static void rtw_cfg80211_preinit_wiphy(_
 
 	wiphy->interface_modes =	BIT(NL80211_IFTYPE_STATION)
 								| BIT(NL80211_IFTYPE_ADHOC)
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 								| BIT(NL80211_IFTYPE_AP)
 								| BIT(NL80211_IFTYPE_MONITOR)
 #endif
@@ -4773,9 +4773,9 @@ static void rtw_cfg80211_preinit_wiphy(_
 								;
 
 #if (LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,37)) || defined(COMPAT_KERNEL_RELEASE)
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	wiphy->mgmt_stypes = rtw_cfg80211_default_mgmt_stypes;
-#endif /* CONFIG_AP_MODE */
+#endif /* CONFIG_92D_AP_MODE */
 #endif
 
 	wiphy->software_iftypes |= BIT(NL80211_IFTYPE_MONITOR);
--- a/drivers/staging/rtl8192du/os_dep/ioctl_linux.c
+++ b/drivers/staging/rtl8192du/os_dep/ioctl_linux.c
@@ -5521,7 +5521,7 @@ static int rtw_dbg_port(struct net_devic
 						struct list_head *plist, *phead;
 						struct recv_reorder_ctrl *preorder_ctrl;
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 						DBG_8192D("sta_dz_bitmap = 0x%x, tim_bitmap = 0x%x\n", pstapriv->sta_dz_bitmap, pstapriv->tim_bitmap);
 #endif
 						spin_lock_bh(&pstapriv->sta_hash_lock);
@@ -5546,7 +5546,7 @@ static int rtw_dbg_port(struct net_devic
 									DBG_8192D("bwmode =%d, ch_offset =%d, sgi =%d\n", psta->htpriv.bwmode, psta->htpriv.ch_offset, psta->htpriv.sgi);
 									DBG_8192D("ampdu_enable = %d\n", psta->htpriv.ampdu_enable);
 									DBG_8192D("agg_enable_bitmap =%x, candidate_tid_bitmap =%x\n", psta->htpriv.agg_enable_bitmap, psta->htpriv.candidate_tid_bitmap);
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 									DBG_8192D("capability = 0x%x\n", psta->capability);
 									DBG_8192D("flags = 0x%x\n", psta->flags);
 									DBG_8192D("wpa_psk = 0x%x\n", psta->wpa_psk);
@@ -5937,7 +5937,7 @@ out:
 	return ret;
 }
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 static u8 set_pairwise_key(struct rtw_adapter *padapter, struct sta_info *psta)
 {
 	struct cmd_obj*			ph2c;
@@ -8138,7 +8138,7 @@ int rtw_ioctl(struct net_device *dev, st
 	case RTL_IOCTL_WPA_SUPPLICANT:
 		ret = wpa_supplicant_ioctl(dev, &wrq->u.data);
 		break;
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	case RTL_IOCTL_HOSTAPD:
 		ret = rtw_hostapd_ioctl(dev, &wrq->u.data);
 		break;
--- a/drivers/staging/rtl8192du/os_dep/mlme_linux.c
+++ b/drivers/staging/rtl8192du/os_dep/mlme_linux.c
@@ -244,7 +244,7 @@ void init_mlme_ext_timer(struct rtw_adap
 	_init_timer(&pmlmeext->link_timer, padapter->pnetdev, _link_timer_hdl, padapter);
 }
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 
 void rtw_indicate_sta_assoc_event(struct rtw_adapter *padapter, struct sta_info *psta)
 {
--- a/drivers/staging/rtl8192du/os_dep/os_intfs.c
+++ b/drivers/staging/rtl8192du/os_dep/os_intfs.c
@@ -475,7 +475,7 @@ void rtw_proc_init_one(struct net_device
 		}
 	}
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 
 	entry = create_proc_read_entry("all_sta_info", S_IFREG | S_IRUGO,
 				   dir_dev, proc_get_all_sta_info, dev);
@@ -596,7 +596,7 @@ void rtw_proc_remove_one(struct net_devi
 			remove_proc_entry("rf_reg_dump3", dir_dev);
 			remove_proc_entry("rf_reg_dump4", dir_dev);
 		}
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 		remove_proc_entry("all_sta_info", dir_dev);
 #endif
 
@@ -1662,27 +1662,21 @@ void rtw_drv_stop_vir_if (struct rtw_ada
 
 	pnetdev = padapter->pnetdev;
 
-	if (pnetdev)
-	{
+	if (pnetdev) {
 		unregister_netdev(pnetdev); /* will call netdev_close() */
 		rtw_proc_remove_one(pnetdev);
 	}
 
 	rtw_cancel_all_timer(padapter);
 
-	if (padapter->bup == true)
-	{
+	if (padapter->bup == true) {
 		padapter->bDriverStopped = true;
 
-		#ifdef CONFIG_XMIT_ACK
 		if (padapter->xmitpriv.ack_tx)
 			rtw_ack_tx_done(&padapter->xmitpriv, RTW_SCTX_DONE_DRV_STOP);
-		#endif
 
 		if (padapter->intf_stop)
-		{
 			padapter->intf_stop(padapter);
-		}
 
 		rtw_stop_drv_threads(padapter);
 
@@ -2053,15 +2047,11 @@ void rtw_drv_if2_stop(struct rtw_adapter
 
 	if (padapter->bup == true) {
 		padapter->bDriverStopped = true;
-		#ifdef CONFIG_XMIT_ACK
 		if (padapter->xmitpriv.ack_tx)
 			rtw_ack_tx_done(&padapter->xmitpriv, RTW_SCTX_DONE_DRV_STOP);
-		#endif
 
 		if (padapter->intf_stop)
-		{
 			padapter->intf_stop(padapter);
-		}
 
 		rtw_stop_drv_threads(padapter);
 
--- a/drivers/staging/rtl8192du/os_dep/usb_intf.c
+++ b/drivers/staging/rtl8192du/os_dep/usb_intf.c
@@ -455,24 +455,19 @@ static void rtw_dev_unload(struct rtw_ad
 		DBG_8192D("===> rtw_dev_unload\n");
 
 		padapter->bDriverStopped = true;
-		#ifdef CONFIG_XMIT_ACK
 		if (padapter->xmitpriv.ack_tx)
 			rtw_ack_tx_done(&padapter->xmitpriv, RTW_SCTX_DONE_DRV_STOP);
-		#endif
 
 		/* s3. */
 		if (padapter->intf_stop)
-		{
 			padapter->intf_stop(padapter);
-		}
 
 		/* s4. */
 		if (!padapter->pwrctrlpriv.bInternalAutoSuspend)
 		rtw_stop_drv_threads(padapter);
 
 		/* s5. */
-		if (padapter->bSurpriseRemoved == false)
-		{
+		if (padapter->bSurpriseRemoved == false) {
 #ifdef CONFIG_WOWLAN
 			if ((padapter->pwrctrlpriv.bSupportRemoteWakeup==true)&&(padapter->pwrctrlpriv.wowlan_mode==true)) {
 				DBG_8192D("%s bSupportWakeOnWlan==true  do not run rtw_hal_deinit()\n",__func__);
@@ -1122,7 +1117,7 @@ static void rtw_usb_if1_deinit(struct rt
 	if (check_fwstate(pmlmepriv, _FW_LINKED))
 		rtw_disassoc_cmd(if1, 0, false);
 
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 	free_mlme_ap_info(if1);
 	#ifdef CONFIG_HOSTAPD_MLME
 	hostapd_mode_unload(if1);
--- a/drivers/staging/rtl8192du/os_dep/usb_ops_linux.c
+++ b/drivers/staging/rtl8192du/os_dep/usb_ops_linux.c
@@ -292,7 +292,7 @@ static void usb_write_port_complete(stru
 			pxmitpriv->bkq_cnt--;
 			break;
 		case HIGH_QUEUE_INX:
-#ifdef CONFIG_AP_MODE
+#ifdef CONFIG_92D_AP_MODE
 			rtw_chk_hi_queue_cmd(padapter);
 #endif
 			break;
