From 09dd4db32413c9514719664e74310df0bb2d82b3 Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Thu, 20 Feb 2014 13:32:25 -0600
Subject: [PATCH 229/390] rtl8192du: Remove CONFIG_EVENT_THREAD_MODE

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 core/rtw_cmd.c    | 83 -------------------------------------------------------
 include/rtw_cmd.h | 21 --------------
 os_dep/os_intfs.c | 13 ---------
 3 files changed, 117 deletions(-)

--- a/drivers/staging/rtl8192du/core/rtw_cmd.c
+++ b/drivers/staging/rtl8192du/core/rtw_cmd.c
@@ -87,24 +87,6 @@ int _rtw_init_evt_priv(struct evt_priv *
 	atomic_set(&pevtpriv->event_seq, 0);
 	pevtpriv->evt_done_cnt = 0;
 
-#ifdef CONFIG_EVENT_THREAD_MODE
-
-	_rtw_init_sema(&(pevtpriv->evt_notify), 0);
-	_rtw_init_sema(&(pevtpriv->terminate_evtthread_sema), 0);
-
-	pevtpriv->evt_allocated_buf = kzalloc(MAX_EVTSZ + 4, GFP_ATOMIC);
-	if (pevtpriv->evt_allocated_buf == NULL) {
-		res = _FAIL;
-		goto exit;
-		}
-	pevtpriv->evt_buf = pevtpriv->evt_allocated_buf  +  4 - ((unsigned int)(pevtpriv->evt_allocated_buf) & 3);
-
-	_rtw_init_queue(&(pevtpriv->evt_queue));
-
-exit:
-
-#endif /* end of CONFIG_EVENT_THREAD_MODE */
-
 #ifdef CONFIG_C2H_WK
 	_init_workitem(&pevtpriv->c2h_wk, c2h_wk_callback, NULL);
 	pevtpriv->c2h_wk_alive = false;
@@ -118,13 +100,6 @@ void _rtw_free_evt_priv(struct evt_priv
 
 	RT_TRACE(_module_rtl871x_cmd_c_, _drv_info_, ("+_rtw_free_evt_priv\n"));
 
-#ifdef CONFIG_EVENT_THREAD_MODE
-	_rtw_free_sema(&(pevtpriv->evt_notify));
-	_rtw_free_sema(&(pevtpriv->terminate_evtthread_sema));
-
-	kfree(pevtpriv->evt_allocated_buf);
-#endif
-
 #ifdef CONFIG_C2H_WK
 	_cancel_workitem_sync(&pevtpriv->c2h_wk);
 	while (pevtpriv->c2h_wk_alive)
@@ -425,64 +400,6 @@ post_process:
 	thread_exit();
 }
 
-#ifdef CONFIG_EVENT_THREAD_MODE
-u32 rtw_enqueue_evt(struct evt_priv *pevtpriv, struct evt_obj *obj)
-{
-	int	res;
-	struct __queue *queue = &pevtpriv->evt_queue;
-
-	res = _SUCCESS;
-
-	if (obj == NULL) {
-		res = _FAIL;
-		goto exit;
-	}
-
-	spin_lock_bh(&queue->lock);
-
-	rtw_list_insert_tail(&obj->list, &queue->queue);
-
-	spin_unlock_bh(&queue->lock);
-
-exit:
-	return res;
-}
-
-struct evt_obj *rtw_dequeue_evt(_queue *queue)
-{
-	struct evt_obj *pevtobj;
-
-	spin_lock_bh(&queue->lock);
-
-	if (rtw_is_list_empty(&(queue->queue))) {
-		pevtobj = NULL;
-	} else {
-		pevtobj = container_of(&(queue->queue->next; struct evt_obj, list);
-		list_del_init(&pevtobj->list);
-	}
-
-	spin_unlock_bh(&queue->lock);
-
-	return pevtobj;
-}
-
-void rtw_free_evt_obj(struct evt_obj *pevtobj)
-{
-
-	kfree(pevtobj->parmbuf);
-	kfree(pevtobj);
-
-}
-
-void rtw_evt_notify_isr(struct evt_priv *pevtpriv)
-{
-
-	pevtpriv->evt_done_cnt++;
-	_rtw_up_sema(&(pevtpriv->evt_notify));
-
-}
-#endif
-
 u8 rtw_setstandby_cmd(struct rtw_adapter *padapter, uint action)
 {
 	struct cmd_obj *ph2c;
--- a/drivers/staging/rtl8192du/include/rtw_cmd.h
+++ b/drivers/staging/rtl8192du/include/rtw_cmd.h
@@ -62,22 +62,7 @@
 		struct rtw_adapter *padapter;
 	};
 
-#ifdef CONFIG_EVENT_THREAD_MODE
-	struct evt_obj {
-		u16	evtcode;
-		u8	res;
-		u8	*parmbuf;
-		u32	evtsz;
-		struct list_head list;
-	};
-#endif
-
 	struct	evt_priv {
-#ifdef CONFIG_EVENT_THREAD_MODE
-		struct  semaphore evt_notify;
-		struct  semaphore terminate_evtthread_sema;
-		struct __queue evt_queue;
-#endif
 
 /* define CONFIG_C2H_WK */
 #ifdef CONFIG_C2H_WK
@@ -122,12 +107,6 @@ extern u32 rtw_enqueue_cmd(struct cmd_pr
 extern struct cmd_obj *rtw_dequeue_cmd(struct cmd_priv *pcmdpriv);
 extern void rtw_free_cmd_obj(struct cmd_obj *pcmd);
 
-#ifdef CONFIG_EVENT_THREAD_MODE
-extern u32 rtw_enqueue_evt(struct evt_priv *pevtpriv, struct evt_obj *obj);
-extern struct evt_obj *rtw_dequeue_evt(struct __queue *queue);
-extern void rtw_free_evt_obj(struct evt_obj *pcmd);
-#endif
-
 int rtw_cmd_thread(void *context);
 
 extern u32 rtw_init_cmd_priv (struct cmd_priv *pcmdpriv);
--- a/drivers/staging/rtl8192du/os_dep/os_intfs.c
+++ b/drivers/staging/rtl8192du/os_dep/os_intfs.c
@@ -941,12 +941,6 @@ u32 rtw_start_drv_threads(struct rtw_ada
 			_rtw_down_sema(&padapter->cmdpriv.terminate_cmdthread_sema); /* wait for cmd_thread to run */
 	}
 
-#ifdef CONFIG_EVENT_THREAD_MODE
-	padapter->evtThread = kthread_run(event_thread, padapter, "RTW_EVENT_THREAD");
-	if (IS_ERR(padapter->evtThread))
-		_status = _FAIL;
-#endif
-
 	return _status;
 }
 
@@ -965,13 +959,6 @@ void rtw_stop_drv_threads (struct rtw_ad
 		}
 	}
 
-#ifdef CONFIG_EVENT_THREAD_MODE
-        _rtw_up_sema(&padapter->evtpriv.evt_notify);
-	if (padapter->evtThread) {
-		_rtw_down_sema(&padapter->evtpriv.terminate_evtthread_sema);
-	}
-#endif
-
 #ifdef CONFIG_XMIT_THREAD_MODE
 	/*  Below is to termindate tx_thread... */
 	_rtw_up_sema(&padapter->xmitpriv.xmit_sema);
