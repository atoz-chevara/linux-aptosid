From 0fb0fe2fe4234440b65c1813f9b815da4fd1fe20 Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Sun, 28 Apr 2013 12:27:05 -0500
Subject: [PATCH 076/390] Convert typedef for _lock

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 include/drv_types.h      |  2 +-
 include/ioctl_cfg80211.h |  2 +-
 include/osdep_service.h  | 16 ++++++++--------
 include/rtw_io.h         |  3 +--
 include/rtw_mlme.h       |  8 ++++----
 include/rtw_recv.h       | 21 +++++----------------
 include/rtw_xmit.h       |  8 ++------
 include/sta_info.h       |  8 ++++----
 os_dep/osdep_service.c   | 12 ++++++------
 9 files changed, 32 insertions(+), 48 deletions(-)

--- a/drivers/staging/rtl8192du/include/drv_types.h
+++ b/drivers/staging/rtl8192du/include/drv_types.h
@@ -446,7 +446,7 @@ struct _ADAPTER {
 #endif
 
 #ifdef CONFIG_BR_EXT
-	_lock					br_ext_lock;
+	spinlock_t			br_ext_lock;
 	struct nat25_network_db_entry	*nethash[NAT25_HASH_SIZE];
 	int				pppoe_connection_in_progress;
 	unsigned char			pppoe_addr[MACADDRLEN];
--- a/drivers/staging/rtl8192du/include/ioctl_cfg80211.h
+++ b/drivers/staging/rtl8192du/include/ioctl_cfg80211.h
@@ -56,7 +56,7 @@ struct rtw_wdev_priv
 	_adapter *padapter;
 
 	struct cfg80211_scan_request *scan_request;
-	_lock scan_req_lock;
+	spinlock_t scan_req_lock;
 
 	struct net_device *pmon_ndev;//for monitor interface
 	char ifname_mon[IFNAMSIZ + 1]; //interface name for monitor interface
--- a/drivers/staging/rtl8192du/include/osdep_service.h
+++ b/drivers/staging/rtl8192du/include/osdep_service.h
@@ -90,7 +90,7 @@
 #endif
 #endif
 
-	typedef	spinlock_t	_lock;
+//	typedef	spinlock_t	_lock;
 #if (LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,37))
 	typedef struct mutex		_mutex;
 #else
@@ -100,7 +100,7 @@
 
 	struct	__queue	{
 		struct	list_head	queue;
-		_lock	lock;
+		spinlock_t	lock;
 	};
 
 	typedef	struct sk_buff	_pkt;
@@ -378,12 +378,12 @@ extern void	_rtw_up_sema(struct  semapho
 extern u32	_rtw_down_sema(struct  semaphore *sema);
 extern void	_rtw_mutex_init(_mutex *pmutex);
 extern void	_rtw_mutex_free(_mutex *pmutex);
-extern void	_rtw_spinlock_init(_lock *plock);
-extern void	_rtw_spinlock_free(_lock *plock);
-extern void	_rtw_spinlock(_lock	*plock);
-extern void	_rtw_spinunlock(_lock	*plock);
-extern void	_rtw_spinlock_ex(_lock	*plock);
-extern void	_rtw_spinunlock_ex(_lock	*plock);
+extern void	_rtw_spinlock_init(spinlock_t *plock);
+extern void	_rtw_spinlock_free(spinlock_t *plock);
+extern void	_rtw_spinlock(spinlock_t	*plock);
+extern void	_rtw_spinunlock(spinlock_t	*plock);
+extern void	_rtw_spinlock_ex(spinlock_t	*plock);
+extern void	_rtw_spinunlock_ex(spinlock_t	*plock);
 
 extern void	_rtw_init_queue(_queue	*pqueue);
 extern u32	_rtw_queue_empty(_queue	*pqueue);
--- a/drivers/staging/rtl8192du/include/rtw_io.h
+++ b/drivers/staging/rtl8192du/include/rtw_io.h
@@ -32,7 +32,6 @@
 #include <linux/semaphore.h>
 #endif
 #include <linux/list.h>
-//#include <linux/smp_lock.h>
 #include <linux/spinlock.h>
 #include <asm/atomic.h>
 
@@ -290,7 +289,7 @@ Below is the data structure used by _io_
 */
 
 struct io_queue {
-	_lock	lock;
+	spinlock_t lock;
 	_list	free_ioreqs;
 	_list		pending;		//The io_req list that will be served in the single protocol read/write.
 	_list		processing;
--- a/drivers/staging/rtl8192du/include/rtw_mlme.h
+++ b/drivers/staging/rtl8192du/include/rtw_mlme.h
@@ -366,8 +366,8 @@ struct tdls_info{
 	u8					cur_channel;
 	u8					candidate_ch;
 	u8					collect_pkt_num[MAX_CHANNEL_NUM];
-	_lock				cmd_lock;
-	_lock				hdl_lock;
+	spinlock_t				cmd_lock;
+	spinlock_t				hdl_lock;
 	u8					watchdog_count;
 	u8					dev_discovered;		//WFD_TDLS: for sigma test
 	u8					enable;
@@ -378,7 +378,7 @@ struct tdls_info{
 
 struct mlme_priv {
 
-	_lock	lock;
+	spinlock_t	lock;
 	int	fw_state;	//shall we protect this variable? maybe not necessarily...
 
 	u8	to_join; //flag
@@ -515,7 +515,7 @@ struct mlme_priv {
 #endif
 */
 
-	_lock	bcn_update_lock;
+	spinlock_t	bcn_update_lock;
 	u8		update_bcn;
 
 
--- a/drivers/staging/rtl8192du/include/rtw_recv.h
+++ b/drivers/staging/rtl8192du/include/rtw_recv.h
@@ -187,9 +187,8 @@ accesser of recv_priv: rtw_recv_entry(di
 
 using enter_critical section to protect
 */
-struct recv_priv
-{
-	  _lock	lock;
+struct recv_priv {
+	  spinlock_t	lock;
 
 #ifdef CONFIG_RECV_THREAD_MODE
 	struct  semaphore recv_sema;
@@ -282,27 +281,17 @@ struct recv_priv
 #endif //CONFIG_NEW_SIGNAL_STAT_PROCESS
 
 struct sta_recv_priv {
-
-	_lock	lock;
+	spinlock_t lock;
 	int	option;
-
-	//_queue	blk_strms[MAX_RX_NUMBLKS];
 	_queue defrag_q;	 //keeping the fragment frame until defrag
-
 	struct	stainfo_rxcache rxcache;
-
-	//uint	sta_rx_bytes;
-	//uint	sta_rx_pkts;
-	//uint	sta_rx_fail;
-
 };
 
 
-struct recv_buf
-{
+struct recv_buf {
 	_list list;
 
-	_lock recvbuf_lock;
+	spinlock_t recvbuf_lock;
 
 	u32	ref_cnt;
 
--- a/drivers/staging/rtl8192du/include/rtw_xmit.h
+++ b/drivers/staging/rtl8192du/include/rtw_xmit.h
@@ -165,11 +165,7 @@ union txdesc {
 };
 
 struct	hw_xmit	{
-	//_lock xmit_lock;
-	//_list	pending;
 	_queue *sta_queue;
-	//struct hw_txqueue *phwtxqueue;
-	//int	txcmdcnt;
 	int	accnt;
 };
 
@@ -330,7 +326,7 @@ struct tx_servq {
 
 struct sta_xmit_priv
 {
-	_lock	lock;
+	spinlock_t lock;
 	int	option;
 	int	apsd_setting;	//When bit mask is on, the associated edca queue supports APSD.
 
@@ -366,7 +362,7 @@ struct	hw_txqueue	{
 
 struct	xmit_priv	{
 
-	_lock	lock;
+	spinlock_t lock;
 
 	struct  semaphore xmit_sema;
 	struct  semaphore terminate_xmitthread_sema;
--- a/drivers/staging/rtl8192du/include/sta_info.h
+++ b/drivers/staging/rtl8192du/include/sta_info.h
@@ -94,7 +94,7 @@ struct TDLS_PeerKey {
 
 struct sta_info {
 
-	_lock	lock;
+	spinlock_t lock;
 	_list	list; //free_sta_queue
 	_list	hash_list; //sta_hash
 	//_list asoc_list; //20061114
@@ -352,7 +352,7 @@ struct	sta_priv {
 	u8 *pstainfo_buf;
 	_queue	free_sta_queue;
 
-	_lock sta_hash_lock;
+	spinlock_t sta_hash_lock;
 	_list   sta_hash[NUM_STA];
 	int asoc_sta_count;
 	_queue sleep_q;
@@ -364,8 +364,8 @@ struct	sta_priv {
 #ifdef CONFIG_AP_MODE
 	_list asoc_list;
 	_list auth_list;
-	_lock asoc_list_lock;
-	_lock auth_list_lock;
+	spinlock_t asoc_list_lock;
+	spinlock_t auth_list_lock;
 	u8 asoc_list_cnt;
 	u8 auth_list_cnt;
 
--- a/drivers/staging/rtl8192du/os_dep/osdep_service.c
+++ b/drivers/staging/rtl8192du/os_dep/osdep_service.c
@@ -465,31 +465,31 @@ void	_rtw_mutex_free(_mutex *pmutex)
 #endif
 }
 
-void	_rtw_spinlock_init(_lock *plock)
+void	_rtw_spinlock_init(spinlock_t *plock)
 {
 	spin_lock_init(plock);
 }
 
-void	_rtw_spinlock_free(_lock *plock)
+void	_rtw_spinlock_free(spinlock_t *plock)
 {
 }
 
-void	_rtw_spinlock(_lock	*plock)
+void	_rtw_spinlock(spinlock_t *plock)
 {
 	spin_lock(plock);
 }
 
-void	_rtw_spinunlock(_lock *plock)
+void	_rtw_spinunlock(spinlock_t *plock)
 {
 	spin_unlock(plock);
 }
 
-void	_rtw_spinlock_ex(_lock	*plock)
+void	_rtw_spinlock_ex(spinlock_t *plock)
 {
 	spin_lock(plock);
 }
 
-void	_rtw_spinunlock_ex(_lock *plock)
+void	_rtw_spinunlock_ex(spinlock_t *plock)
 {
 	spin_unlock(plock);
 }
