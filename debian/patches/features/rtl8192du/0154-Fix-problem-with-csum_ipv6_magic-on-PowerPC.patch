From 9e4a4e02863d29cfc97f5b58a569475c24615399 Mon Sep 17 00:00:00 2001
From: finger <Larry.Finger@lwfinger.net>
Date: Tue, 14 May 2013 13:01:36 -0500
Subject: [PATCH 154/390] Fix problem with csum_ipv6_magic on PowerPC

On ppc, an addition header is needed.

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 core/rtw_br_ext.c | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

--- a/drivers/staging/rtl8192du/core/rtw_br_ext.c
+++ b/drivers/staging/rtl8192du/core/rtw_br_ext.c
@@ -41,6 +41,11 @@
 #endif
 #endif
 
+/* some architectures need an extra header */
+#ifndef csum_ipv6_magic
+#include <net/ip6_checksum.h>
+#endif
+
 #ifdef CONFIG_BR_EXT
 
 #define NAT25_IPV4		01
@@ -1266,12 +1271,10 @@ int nat25_db_handle(struct rtw_adapter *
 								      GET_MY_HWADDR(priv))) {
 						struct icmp6hdr  *hdr = (struct icmp6hdr *)(skb->data + ETH_HLEN + sizeof(*iph));
 						hdr->icmp6_cksum = 0;
-#ifdef csum_ipv6_magic
 						hdr->icmp6_cksum = csum_ipv6_magic(&iph->saddr, &iph->daddr,
 										iph->payload_len,
 										IPPROTO_ICMPV6,
 										csum_partial((__u8 *)hdr, iph->payload_len, 0));
-#endif
 					}
 				}
 			}
