From dc660436c430081b16dd4ab3d244bfc1673eadbd Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Thu, 20 Feb 2014 17:02:12 -0600
Subject: [PATCH 241/390] rtl8192du: Cleanup some routine associated with lock
 suspend

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 include/osdep_service.h |  7 -------
 os_dep/osdep_service.c  | 32 ++++++++------------------------
 os_dep/rtw_android.c    | 13 +++----------
 os_dep/usb_intf.c       |  3 ---
 4 files changed, 11 insertions(+), 44 deletions(-)

--- a/drivers/staging/rtl8192du/include/osdep_service.h
+++ b/drivers/staging/rtl8192du/include/osdep_service.h
@@ -322,13 +322,6 @@ static inline u32 bitshift(u32 bitmask)
 /*  limitation of path length */
 	#define PATH_LENGTH_MAX PATH_MAX
 
-/*  Suspend lock prevent system from going suspend */
-
-void rtw_suspend_lock_init(void);
-void rtw_suspend_lock_uninit(void);
-void rtw_lock_suspend(void);
-void rtw_unlock_suspend(void);
-
 struct rtw_netdev_priv_indicator {
 	void *priv;
 	u32 sizeof_priv;
--- a/drivers/staging/rtl8192du/os_dep/osdep_service.c
+++ b/drivers/staging/rtl8192du/os_dep/osdep_service.c
@@ -237,22 +237,6 @@ void rtw_yield_os(void)
 
 #define RTW_SUSPEND_LOCK_NAME "rtw_wifi"
 
-inline void rtw_suspend_lock_init(void)
-{
-}
-
-inline void rtw_suspend_lock_uninit(void)
-{
-}
-
-inline void rtw_lock_suspend(void)
-{
-}
-
-inline void rtw_unlock_suspend(void)
-{
-}
-
 struct net_device *rtw_alloc_etherdev_with_old_priv(int sizeof_priv, void *old_priv)
 {
 	struct net_device *pnetdev;
@@ -260,13 +244,13 @@ struct net_device *rtw_alloc_etherdev_wi
 
 	pnetdev = alloc_etherdev_mq(sizeof(struct rtw_netdev_priv_indicator), 4);
 	if (!pnetdev)
-		goto RETURN;
+		goto exit;
 
 	pnpi = netdev_priv(pnetdev);
 	pnpi->priv=old_priv;
 	pnpi->sizeof_priv=sizeof_priv;
 
-RETURN:
+exit:
 	return pnetdev;
 }
 
@@ -277,7 +261,7 @@ struct net_device *rtw_alloc_etherdev(in
 
 	pnetdev = alloc_etherdev_mq(sizeof(struct rtw_netdev_priv_indicator), 4);
 	if (!pnetdev)
-		goto RETURN;
+		goto exit;
 
 	pnpi = netdev_priv(pnetdev);
 
@@ -285,11 +269,11 @@ struct net_device *rtw_alloc_etherdev(in
 	if (!pnpi->priv) {
 		free_netdev(pnetdev);
 		pnetdev = NULL;
-		goto RETURN;
+		goto exit;
 	}
 
 	pnpi->sizeof_priv=sizeof_priv;
-RETURN:
+exit:
 	return pnetdev;
 }
 
@@ -298,17 +282,17 @@ void rtw_free_netdev(struct net_device *
 	struct rtw_netdev_priv_indicator *pnpi;
 
 	if (!netdev)
-		goto RETURN;
+		goto exit;
 
 	pnpi = netdev_priv(netdev);
 
 	if (!pnpi->priv)
-		goto RETURN;
+		goto exit;
 
 	vfree(pnpi->priv);
 	free_netdev(netdev);
 
-RETURN:
+exit:
 	return;
 }
 
--- a/drivers/staging/rtl8192du/os_dep/rtw_android.c
+++ b/drivers/staging/rtl8192du/os_dep/rtw_android.c
@@ -319,8 +319,6 @@ int rtw_android_priv_cmd(struct net_devi
 	int bytes_written = 0;
 	struct android_wifi_priv_cmd priv_cmd;
 
-	rtw_lock_suspend();
-
 	if (!ifr->ifr_data) {
 		ret = -EINVAL;
 		goto exit;
@@ -331,8 +329,7 @@ int rtw_android_priv_cmd(struct net_devi
 	}
 
 	command = kzalloc(priv_cmd.total_len, GFP_KERNEL);
-	if (!command)
-	{
+	if (!command) {
 		DBG_8192D("%s: failed to allocate memory\n", __func__);
 		ret = -ENOMEM;
 		goto exit;
@@ -464,16 +461,12 @@ response:
 			DBG_8192D("%s: failed to copy data to user buffer\n", __func__);
 			ret = -EFAULT;
 		}
-	}
-	else {
+	} else {
 		ret = bytes_written;
 	}
 
 exit:
-	rtw_unlock_suspend();
-	if (command) {
-		kfree(command);
-	}
+	kfree(command);
 
 	return ret;
 }
--- a/drivers/staging/rtl8192du/os_dep/usb_intf.c
+++ b/drivers/staging/rtl8192du/os_dep/usb_intf.c
@@ -938,7 +938,6 @@ extern int console_suspend_enabled;
 
 static int __init rtw_drv_entry(void)
 {
-	rtw_suspend_lock_init();
 	usb_drv->drv_registered = true;
 	return usb_register(&usb_drv->usbdrv);
 }
@@ -948,8 +947,6 @@ static void __exit rtw_drv_halt(void)
 	RT_TRACE(_module_hci_intfs_c_,_drv_err_,("+rtw_drv_halt\n"));
 	DBG_8192D("+rtw_drv_halt\n");
 
-	rtw_suspend_lock_uninit();
-
 	usb_drv->drv_registered = false;
 	usb_deregister(&usb_drv->usbdrv);
 
