From 75f65b1b00c889dbf5b9f5eee8f6fbb0bddca020 Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Thu, 20 Feb 2014 13:24:59 -0600
Subject: [PATCH 227/390] rtl8192du: Remove CONFIG_INTEL_WIDI

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 Makefile             |  7 ----
 core/rtw_cmd.c       |  5 ---
 core/rtw_mlme.c      | 51 ++-------------------------
 core/rtw_mlme_ext.c  | 99 ----------------------------------------------------
 core/rtw_p2p.c       | 23 ------------
 core/rtw_wlan_util.c |  5 ---
 include/rtw_mlme.h   | 15 --------
 os_dep/ioctl_linux.c | 54 ----------------------------
 os_dep/os_intfs.c    | 16 ---------
 9 files changed, 3 insertions(+), 272 deletions(-)

--- a/drivers/staging/rtl8192du/Makefile
+++ b/drivers/staging/rtl8192du/Makefile
@@ -25,7 +25,6 @@ CONFIG_USB_AUTOSUSPEND = n
 CONFIG_HW_PWRP_DETECTION = n
 CONFIG_WIFI_TEST = n
 CONFIG_BT_COEXISTENCE = n
-CONFIG_INTEL_WIDI = n
 CONFIG_WAKE_ON_WLAN = n
 
 CONFIG_DRVEXT_MODULE = n
@@ -103,10 +102,6 @@ ifeq ($(CONFIG_WAKE_ON_WLAN), y)
 EXTRA_CFLAGS += -DCONFIG_WAKE_ON_WLAN
 endif
 
-ifeq ($(CONFIG_INTEL_WIDI), y)
-EXTRA_CFLAGS += -DCONFIG_INTEL_WIDI
-endif
-
 SUBARCH := $(shell uname -m | sed -e s/i.86/i386/ | sed -e s/ppc/powerpc/)
 ARCH ?= $(SUBARCH)
 CROSS_COMPILE ?=
@@ -143,8 +138,6 @@ rtk_core :=	core/rtw_cmd.o \
 
 $(MODULE_NAME)-y += $(rtk_core)
 
-$(MODULE_NAME)-$(CONFIG_INTEL_WIDI) += core/rtw_intel_widi.o
-
 $(MODULE_NAME)-y += core/rtw_efuse.o
 
 $(MODULE_NAME)-y += $(_HAL_INTFS_FILES)
--- a/drivers/staging/rtl8192du/core/rtw_cmd.c
+++ b/drivers/staging/rtl8192du/core/rtw_cmd.c
@@ -2090,11 +2090,6 @@ u8 rtw_drvextra_cmd_hdl(struct rtw_adapt
 		rtw_chk_hi_queue_hdl(padapter);
 		break;
 #endif /* CONFIG_92D_AP_MODE */
-#ifdef CONFIG_INTEL_WIDI
-	case INTEl_WIDI_WK_CID:
-		intel_widi_wk_hdl(padapter, pdrvextra_cmd->type_size, pdrvextra_cmd->pbuf);
-		break;
-#endif /* CONFIG_INTEL_WIDI */
 	case C2H_WK_CID:
 		c2h_evt_hdl(padapter, (struct c2h_evt_hdr *)pdrvextra_cmd->pbuf, NULL);
 		break;
--- a/drivers/staging/rtl8192du/core/rtw_mlme.c
+++ b/drivers/staging/rtl8192du/core/rtw_mlme.c
@@ -1022,21 +1022,6 @@ void rtw_surveydone_event_callback(struc
 							       NULL, 0)
 					    ) {
 						rtw_set_roaming(adapter, 0);
-#ifdef CONFIG_INTEL_WIDI
-						if (adapter->mlmepriv.
-						    widi_state ==
-						    INTEL_WIDI_STATE_ROAMING) {
-							memset(pmlmepriv->
-							       sa_ext, 0x00,
-							       L2SDTA_SERVICE_VE_LEN);
-							intel_widi_wk_cmd
-							    (adapter,
-							     INTEL_WIDI_LISTEN_WK,
-							     NULL);
-							DBG_8192D
-							    ("change to widi listen\n");
-						}
-#endif /*  CONFIG_INTEL_WIDI */
 						rtw_free_assoc_resources
 						    (adapter, 1);
 						rtw_indicate_disconnect
@@ -1075,9 +1060,6 @@ void rtw_surveydone_event_callback(struc
 #endif
 
 #ifdef DBG_CONFIG_ERROR_DETECT
-#ifdef CONFIG_INTEL_WIDI
-	if (adapter->mlmepriv.widi_state == INTEL_WIDI_STATE_NONE)
-#endif
 	{
 		struct mlme_ext_priv *pmlmeext = &adapter->mlmeextpriv;
 		if (pmlmeext->sitesurvey_res.bss_cnt == 0) {
@@ -1224,14 +1206,6 @@ void rtw_indicate_connect(struct rtw_ada
 
 	rtw_set_roaming(padapter, 0);
 
-#ifdef CONFIG_INTEL_WIDI
-	if (padapter->mlmepriv.widi_state == INTEL_WIDI_STATE_ROAMING) {
-		memset(pmlmepriv->sa_ext, 0x00, L2SDTA_SERVICE_VE_LEN);
-		intel_widi_wk_cmd(padapter, INTEL_WIDI_LISTEN_WK, NULL);
-		DBG_8192D("change to widi listen\n");
-	}
-#endif /*  CONFIG_INTEL_WIDI */
-
 	rtw_set_scan_deny(padapter, 3000);
 
 	RT_TRACE(_module_rtl871x_mlme_c_, _drv_err_,
@@ -1863,12 +1837,9 @@ void rtw_stadel_event_callback(struct rt
 			rtw_set_roaming(adapter,
 					adapter->registrypriv.
 					max_roaming_times);
-#ifdef CONFIG_INTEL_WIDI
-		if (adapter->mlmepriv.widi_state != INTEL_WIDI_STATE_CONNECTED)
-#endif /*  CONFIG_INTEL_WIDI */
-			if (*((unsigned short *)(pstadel->rsvd)) !=
-			    WLAN_REASON_EXPIRATION_CHK)
-				rtw_set_roaming(adapter, 0);	/* don't roam */
+		if (*((unsigned short *)(pstadel->rsvd)) !=
+		    WLAN_REASON_EXPIRATION_CHK)
+			rtw_set_roaming(adapter, 0);	/* don't roam */
 #endif
 
 		rtw_free_uc_swdec_pending_queue(adapter);
@@ -1887,11 +1858,6 @@ void rtw_stadel_event_callback(struct rt
 		spin_unlock_bh(&(pmlmepriv->scanned_queue.lock));
 
 		_rtw_roaming(adapter, tgt_network);
-
-#ifdef CONFIG_INTEL_WIDI
-		if (!rtw_to_roaming(adapter))
-			process_intel_widi_disconnect(adapter, 1);
-#endif /*  CONFIG_INTEL_WIDI */
 	}
 
 	if (check_fwstate(pmlmepriv, WIFI_ADHOC_MASTER_STATE) ||
@@ -1985,17 +1951,6 @@ void _rtw_join_timeout_handler(struct rt
 				}
 				break;
 			} else {
-#ifdef CONFIG_INTEL_WIDI
-				if (adapter->mlmepriv.widi_state ==
-				    INTEL_WIDI_STATE_ROAMING) {
-					memset(pmlmepriv->sa_ext, 0x00,
-					       L2SDTA_SERVICE_VE_LEN);
-					intel_widi_wk_cmd(adapter,
-							  INTEL_WIDI_LISTEN_WK,
-							  NULL);
-					DBG_8192D("change to widi listen\n");
-				}
-#endif /*  CONFIG_INTEL_WIDI */
 				DBG_8192D("%s We've try roaming but fail\n",
 					  __func__);
 				rtw_indicate_disconnect(adapter);
--- a/drivers/staging/rtl8192du/core/rtw_mlme_ext.c
+++ b/drivers/staging/rtl8192du/core/rtw_mlme_ext.c
@@ -4230,11 +4230,6 @@ void issue_probersp_p2p(struct rtw_adapt
 	u8 listen_channel =
 	    (u8) ieee80211_frequency_to_channel(ieee_ch->center_freq);
 #endif /* CONFIG_IOCTL_CFG80211 */
-#ifdef CONFIG_INTEL_WIDI
-	u8 zero_array_check[L2SDTA_SERVICE_VE_LEN] = { 0x00 };
-#endif /* CONFIG_INTEL_WIDI */
-
-	/* DBG_8192D("%s\n", __func__); */
 
 	pmgntframe = alloc_mgtxmitframe(pxmitpriv);
 	if (pmgntframe == NULL)
@@ -4353,43 +4348,6 @@ void issue_probersp_p2p(struct rtw_adapt
 		/*      Value: */
 		wpsie[wpsielen++] = WPS_VERSION_1;	/*      Version 1.0 */
 
-#ifdef CONFIG_INTEL_WIDI
-		/*      Commented by Kurt */
-		/*      Appended WiDi info. only if we did issued_probereq_widi(), and then we saved ven. ext. in pmlmepriv->sa_ext. */
-		if (_rtw_memcmp
-		    (pmlmepriv->sa_ext, zero_array_check,
-		     L2SDTA_SERVICE_VE_LEN) == false) {
-			/* Sec dev type */
-			*(u16 *)(wpsie + wpsielen) =
-			    cpu_to_be16(WPS_ATTR_SEC_DEV_TYPE_LIST);
-			wpsielen += 2;
-
-			/*      Length: */
-			*(u16 *)(wpsie + wpsielen) = cpu_to_be16(0x0008);
-			wpsielen += 2;
-
-			/*      Value: */
-			/*      Category ID */
-			*(u16 *)(wpsie + wpsielen) =
-			    cpu_to_be16(WPS_PDT_CID_DISPLAYS);
-			wpsielen += 2;
-
-			/*      OUI */
-			*(u32 *)(wpsie + wpsielen) =
-			    cpu_to_be32(INTEL_DEV_TYPE_OUI);
-			wpsielen += 4;
-
-			*(u16 *)(wpsie + wpsielen) =
-			    cpu_to_be16(WPS_PDT_SCID_WIDI_CONSUMER_SINK);
-			wpsielen += 2;
-
-			/*      Vendor Extension */
-			memcpy(wpsie + wpsielen, pmlmepriv->sa_ext,
-			       L2SDTA_SERVICE_VE_LEN);
-			wpsielen += L2SDTA_SERVICE_VE_LEN;
-		}
-#endif /* CONFIG_INTEL_WIDI */
-
 		/*      WiFi Simple Config State */
 		/*      Type: */
 		*(__be16 *)(wpsie + wpsielen) =
@@ -5074,18 +5032,6 @@ static unsigned int on_action_public_p2p
 			issue_p2p_GO_response(adapt,
 					      GetAddr2Ptr(pframe),
 					      frame_body, len, result);
-#ifdef CONFIG_INTEL_WIDI
-			if ((adapt->mlmepriv.widi_state == INTEL_WIDI_STATE_LISTEN) &&
-			    (adapt->mlmepriv.widi_state != INTEL_WIDI_STATE_WFD_CONNECTION)) {
-				adapt->mlmepriv.widi_state =
-				    INTEL_WIDI_STATE_WFD_CONNECTION;
-				intel_widi_wk_cmd(adapt,
-						  INTEL_WIDI_LISTEN_STOP_WK,
-						  NULL);
-			}
-#endif /* CONFIG_INTEL_WIDI */
-
-			/*      Commented by Albert 20110718 */
 			/*      No matter negotiating or negotiation failure, the driver should set up the restore P2P state timer. */
 #ifdef CONFIG_CONCURRENT_MODE
 			/*      Commented by Albert 20120107 */
@@ -5316,18 +5262,6 @@ static unsigned int on_action_public_p2p
 									rtw_p2p_set_state
 									    (pwdinfo,
 									     P2P_STATE_RECV_INVITE_REQ_DISMATCH);
-#ifdef CONFIG_INTEL_WIDI
-									memcpy
-									    (pwdinfo->
-									     p2p_peer_device_addr,
-									     group_id.
-									     go_device_addr,
-									     ETH_ALEN);
-									rtw_p2p_set_role
-									    (pwdinfo,
-									     P2P_ROLE_CLIENT);
-#endif /* CONFIG_INTEL_WIDI */
-
 									status_code
 									    =
 									    P2P_STATUS_FAIL_UNKNOWN_P2PGROUP;
@@ -5413,16 +5347,6 @@ static unsigned int on_action_public_p2p
 							      token,
 							      status_code);
 			}
-#ifdef CONFIG_INTEL_WIDI
-			if ((adapt->mlmepriv.widi_state == INTEL_WIDI_STATE_LISTEN) &&
-			    (adapt->mlmepriv.widi_state != INTEL_WIDI_STATE_WFD_CONNECTION)) {
-				adapt->mlmepriv.widi_state =
-				    INTEL_WIDI_STATE_WFD_CONNECTION;
-				intel_widi_wk_cmd(adapt,
-						  INTEL_WIDI_LISTEN_STOP_WK,
-						  NULL);
-			}
-#endif /* CONFIG_INTEL_WIDI */
 			break;
 		case P2P_INVIT_RESP:
 			{
@@ -5530,20 +5454,8 @@ static unsigned int on_action_public_p2p
 					  P2P_STATE_RX_PROVISION_DIS_REQ);
 			_set_timer(&pwdinfo->restore_p2p_state_timer,
 				   P2P_PROVISION_TIMEOUT);
-#ifdef CONFIG_INTEL_WIDI
-			if ((adapt->mlmepriv.widi_state == INTEL_WIDI_STATE_LISTEN) &&
-			    (adapt->mlmepriv.widi_state != INTEL_WIDI_STATE_WFD_CONNECTION)) {
-				adapt->mlmepriv.widi_state =
-				    INTEL_WIDI_STATE_WFD_CONNECTION;
-				intel_widi_wk_cmd(adapt,
-						  INTEL_WIDI_LISTEN_STOP_WK,
-						  NULL);
-			}
-#endif /* CONFIG_INTEL_WIDI */
 			break;
-
 		case P2P_PROVISION_DISC_RESP:
-			/*      Commented by Albert 20110707 */
 			/*      Should we check the pwdinfo->tx_prov_disc_info.bsent flag here?? */
 			DBG_8192D
 			    ("[%s] Got Provisioning Discovery Response Frame\n",
@@ -8881,12 +8793,6 @@ u8 collect_bss_info(struct rtw_adapter *
 			pmlmepriv->num_sta_no_ht++;
 		}
 	}
-#ifdef CONFIG_INTEL_WIDI
-	/*process_intel_widi_query_or_tigger(adapt, bssid); */
-	if (process_intel_widi_query_or_tigger(adapt, bssid)) {
-		return _FAIL;
-	}
-#endif /*  CONFIG_INTEL_WIDI */
 
 #if defined(DBG_RX_SIGNAL_DISPLAY_PROCESSING) & 1
 	if (strcmp(bssid->Ssid.Ssid, DBG_RX_SIGNAL_DISPLAY_SSID_MONITORED) == 0) {
@@ -9999,11 +9905,6 @@ void linked_status_chk(struct rtw_adapte
 
 		rx_chk_limit = 4;
 
-#ifdef CONFIG_INTEL_WIDI
-		if (adapt->mlmepriv.widi_state != INTEL_WIDI_STATE_NONE)
-			rx_chk_limit = 1;
-#endif
-
 		psta = rtw_get_stainfo(pstapriv, pmlmeinfo->network.MacAddress);
 		if (psta != NULL) {
 			bool is_p2p_enable = false;
--- a/drivers/staging/rtl8192du/core/rtw_p2p.c
+++ b/drivers/staging/rtl8192du/core/rtw_p2p.c
@@ -486,9 +486,6 @@ u32 build_probe_resp_p2p_ie(struct wifid
 {
 	u8 p2pie[MAX_P2P_IE_LEN] = { 0x00 };
 	u32 len = 0, p2pielen = 0;
-#ifdef CONFIG_INTEL_WIDI
-	u8 zero_array_check[L2SDTA_SERVICE_VE_LEN] = { 0x00 };
-#endif /* CONFIG_INTEL_WIDI */
 
 	/*	P2P OUI */
 	p2pielen = 0;
@@ -561,11 +558,6 @@ u32 build_probe_resp_p2p_ie(struct wifid
 	/*	Length: */
 	/*	21 -> P2P Device Address (6bytes) + Config Methods (2bytes) + Primary Device Type (8bytes) */
 	/*	+ NumofSecondDevType (1byte) + WPS Device Name ID field (2bytes) + WPS Device Name Len field (2bytes) */
-#ifdef CONFIG_INTEL_WIDI
-	if (_rtw_memcmp(pwdinfo->padapter->mlmepriv.sa_ext, zero_array_check, L2SDTA_SERVICE_VE_LEN) == false)
-		RTW_PUT_LE16(p2pie + p2pielen, 21 + 8 + pwdinfo->device_name_len);
-	else
-#endif /* CONFIG_INTEL_WIDI */
 	RTW_PUT_LE16(p2pie + p2pielen, 21 + pwdinfo->device_name_len);
 	p2pielen += 2;
 
@@ -592,21 +584,6 @@ u32 build_probe_resp_p2p_ie(struct wifid
 	RTW_PUT_BE16(p2pie + p2pielen, WPS_PDT_SCID_MEDIA_SERVER);
 	p2pielen += 2;
 
-	/*	Number of Secondary Device Types */
-#ifdef CONFIG_INTEL_WIDI
-	if (_rtw_memcmp(pwdinfo->padapter->mlmepriv.sa_ext, zero_array_check, L2SDTA_SERVICE_VE_LEN) == false) {
-		p2pie[p2pielen++] = 0x01;
-
-		RTW_PUT_BE16(p2pie + p2pielen, WPS_PDT_CID_DISPLAYS);
-		p2pielen += 2;
-
-		RTW_PUT_BE32(p2pie + p2pielen, INTEL_DEV_TYPE_OUI);
-		p2pielen += 4;
-
-		RTW_PUT_BE16(p2pie + p2pielen, P2P_SCID_WIDI_CONSUMER_SINK);
-		p2pielen += 2;
-	} else
-#endif /* CONFIG_INTEL_WIDI */
 	p2pie[p2pielen++] = 0x00;	/*	No Secondary Device Type List */
 
 	/*	Device Name */
--- a/drivers/staging/rtl8192du/core/rtw_wlan_util.c
+++ b/drivers/staging/rtl8192du/core/rtw_wlan_util.c
@@ -1240,11 +1240,6 @@ void update_tx_basic_rate(struct rtw_ada
 	if (!rtw_p2p_chk_state(pwdinfo, P2P_STATE_NONE))
 		return;
 #endif /* CONFIG_P2P */
-#ifdef CONFIG_INTEL_WIDI
-	if (padapter->mlmepriv.widi_state != INTEL_WIDI_STATE_NONE)
-		return;
-#endif /* CONFIG_INTEL_WIDI */
-
 	memset(supported_rates, 0, NDIS_802_11_LENGTH_RATES_EX);
 
 	/* clear B mod if current channel is in 5G band, avoid tx cck rate in 5G band. */
--- a/drivers/staging/rtl8192du/include/rtw_mlme.h
+++ b/drivers/staging/rtl8192du/include/rtw_mlme.h
@@ -22,10 +22,6 @@
 #include <drv_types.h>
 #include <wlan_bssdef.h>
 
-#ifdef CONFIG_INTEL_WIDI
-#include <rtw_intel_widi.h>
-#endif
-
 #define	MAX_BSS_CNT	128
 #define   MAX_JOIN_TIMEOUT	6500
 
@@ -446,17 +442,6 @@ struct mlme_priv {
 
 #endif /* if defined (CONFIG_92D_AP_MODE) && defined (CONFIG_NATIVEAP_MLME) */
 
-#ifdef CONFIG_INTEL_WIDI
-	int	widi_state;
-	int	listen_state;
-	struct timer_list listen_timer;
-	atomic_t	rx_probe_rsp; /*  1:receive probe respone from RDS source. */
-	u8	*l2sdTaBuffer;
-	u8	channel_idx;
-	s8	group_cnt;	/* For WiDi 3.5, they specified another scan algo. for WFD/RDS co-existed */
-	u8	sa_ext[L2SDTA_SERVICE_VE_LEN];
-#endif /*  CONFIG_INTEL_WIDI */
-
 #ifdef CONFIG_CONCURRENT_MODE
 	u8	scanning_via_buddy_intf;
 #endif
--- a/drivers/staging/rtl8192du/os_dep/ioctl_linux.c
+++ b/drivers/staging/rtl8192du/os_dep/ioctl_linux.c
@@ -3066,24 +3066,13 @@ static int rtw_wps_start(struct net_devi
 	DBG_8192D("[%s] wps_start = %d\n", __func__, u32wps_start);
 
 	if (u32wps_start == 1) /*  WPS Start */
-	{
 		rtw_led_control(padapter, LED_CTL_START_WPS);
-	}
 	else if (u32wps_start == 2) /*  WPS Stop because of wps success */
-	{
 		rtw_led_control(padapter, LED_CTL_STOP_WPS);
-	}
 	else if (u32wps_start == 3) /*  WPS Stop because of wps fail */
-	{
 		rtw_led_control(padapter, LED_CTL_STOP_WPS_FAIL);
-	}
-
-#ifdef CONFIG_INTEL_WIDI
-	process_intel_widi_wps_status(padapter, u32wps_start);
-#endif /* CONFIG_INTEL_WIDI */
 
 exit:
-
 	return ret;
 }
 
@@ -7198,35 +7187,6 @@ _rtw_wowlan_ctrl_exit:
 }
 #endif /* CONFIG_WOWLAN */
 
-#ifdef CONFIG_INTEL_WIDI
-static int rtw_widi_set(struct net_device *dev,
-			struct iw_request_info *info,
-			union iwreq_data *wrqu, char *extra)
-{
-	struct rtw_adapter *padapter = (struct rtw_adapter *)rtw_netdev_priv(dev);
-
-	process_intel_widi_cmd(padapter, extra);
-
-	return 0;
-}
-
-static int rtw_widi_set_probe_request(struct net_device *dev,
-				      struct iw_request_info *info,
-				      union iwreq_data *wrqu, char *extra)
-{
-	struct rtw_adapter *padapter = (struct rtw_adapter *)rtw_netdev_priv(dev);
-	u8	*pbuf = NULL;
-
-	pbuf = kmalloc(sizeof(l2_msg_t, GFP_KERNEL));
-	if (pbuf) {
-		memcpy(pbuf, wrqu->data.pointer, wrqu->data.length);
-		intel_widi_wk_cmd(padapter, INTEL_WIDI_ISSUE_PROB_WK, pbuf);
-	}
-	return 0;
-}
-
-#endif /*  CONFIG_INTEL_WIDI */
-
 static int rtw_test(struct net_device *dev, struct iw_request_info *info,
 		    union iwreq_data *wrqu, char *extra)
 {
@@ -7430,16 +7390,6 @@ static const struct iw_priv_args rtw_pri
 		SIOCIWFIRSTPRIV + 0x1D,
 		IW_PRIV_TYPE_CHAR | 40, IW_PRIV_TYPE_CHAR | 0x7FF, "test"
 	},
-#ifdef CONFIG_INTEL_WIDI
-	{
-		SIOCIWFIRSTPRIV + 0x1E,
-		IW_PRIV_TYPE_CHAR | 64, 0, "widi_set"
-	},
-	{
-		SIOCIWFIRSTPRIV + 0x1F,
-		IW_PRIV_TYPE_CHAR | 128, 0, "widi_prob_req"
-	},
-#endif /*  CONFIG_INTEL_WIDI */
 };
 
 static iw_handler rtw_private_handler[] = {
@@ -7489,10 +7439,6 @@ static iw_handler rtw_private_handler[]
 	rtw_mp_efuse_get,		/* 0x1B */
 	NULL,				/*  0x1C is reserved for hostapd */
 	rtw_test	,		/*  0x1D */
-#ifdef CONFIG_INTEL_WIDI
-	rtw_widi_set,			/* 0x1E */
-	rtw_widi_set_probe_request,	/* 0x1F */
-#endif /*  CONFIG_INTEL_WIDI */
 };
 
 #if WIRELESS_EXT >= 17
--- a/drivers/staging/rtl8192du/os_dep/os_intfs.c
+++ b/drivers/staging/rtl8192du/os_dep/os_intfs.c
@@ -700,9 +700,6 @@ static uint loadparam(struct rtw_adapter
 
 #ifdef CONFIG_LAYER2_ROAMING
 	registry_par->max_roaming_times = (u8)rtw_max_roaming_times;
-#ifdef CONFIG_INTEL_WIDI
-	registry_par->max_roaming_times = (u8)rtw_max_roaming_times + 2;
-#endif /*  CONFIG_INTEL_WIDI */
 #endif
 
 	registry_par->mac_phy_mode = rtw_mac_phy_mode;
@@ -1162,15 +1159,6 @@ u8 rtw_init_drv_sw(struct rtw_adapter *p
 	rtw_hal_sreset_init(padapter);
 #endif
 
-#ifdef CONFIG_INTEL_WIDI
-	if (rtw_init_intel_widi(padapter) == _FAIL)
-	{
-		DBG_8192D("Can't rtw_init_intel_widi\n");
-		ret8 = _FAIL;
-		goto exit;
-	}
-#endif /* CONFIG_INTEL_WIDI */
-
 #ifdef CONFIG_BR_EXT
 	spin_lock_init(&padapter->br_ext_lock);
 #endif	/*  CONFIG_BR_EXT */
@@ -1242,10 +1230,6 @@ u8 rtw_free_drv_sw(struct rtw_adapter *p
 	}
 	#endif
 
-#ifdef CONFIG_INTEL_WIDI
-	rtw_free_intel_widi(padapter);
-#endif /* CONFIG_INTEL_WIDI */
-
 	free_mlme_ext_priv(&padapter->mlmeextpriv);
 
 	rtw_free_cmd_priv(&padapter->cmdpriv);
