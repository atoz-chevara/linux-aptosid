From 34a251c9bde16a6f772a7426c6cca5436fa620be Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Fri, 19 Apr 2013 16:00:39 -0500
Subject: [PATCH 040/390] Remove more unused code including dependency on
 CONFIG_INTEL_PROXIM

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 core/rtw_pwrctrl.c   | 25 ++++++--------------
 core/rtw_recv.c      | 51 ----------------------------------------
 hal/rtl8192du_xmit.c | 30 ++++++------------------
 include/drv_types.h  | 66 +++++-----------------------------------------------
 include/rtw_mlme.h   |  6 -----
 include/usb_hal.h    |  4 +---
 os_dep/usb_intf.c    |  8 -------
 7 files changed, 21 insertions(+), 169 deletions(-)

--- a/drivers/staging/rtl8192du/core/rtw_pwrctrl.c
+++ b/drivers/staging/rtl8192du/core/rtw_pwrctrl.c
@@ -31,11 +31,6 @@ void ips_enter(_adapter * padapter)
 	struct pwrctrl_priv *pwrpriv = &padapter->pwrctrlpriv;
 	struct mlme_priv *pmlmepriv = &(padapter->mlmepriv);
 
-#ifdef CONFIG_INTEL_PROXIM
-	if(padapter->proximity.proxim_on==true){
-		return;
-	}
-#endif
 	_enter_pwrlock(&pwrpriv->lock);
 
 	pwrpriv->bips_processing = true;
@@ -576,23 +571,17 @@ _func_enter_;
 	}
 #endif
 
-#ifdef CONFIG_INTEL_PROXIM
-	if(padapter->proximity.proxim_on==true){
-		return;
-	}
-#endif
-	if (	(check_fwstate(pmlmepriv, _FW_LINKED) == false) ||
-		(check_fwstate(pmlmepriv, _FW_UNDER_SURVEY) == true) ||
-		(check_fwstate(pmlmepriv, WIFI_AP_STATE) == true) ||
-		(check_fwstate(pmlmepriv, WIFI_ADHOC_MASTER_STATE) == true) ||
-		(check_fwstate(pmlmepriv, WIFI_ADHOC_STATE) == true) )
+	if ((check_fwstate(pmlmepriv, _FW_LINKED) == false) ||
+	    (check_fwstate(pmlmepriv, _FW_UNDER_SURVEY) == true) ||
+	    (check_fwstate(pmlmepriv, WIFI_AP_STATE) == true) ||
+	    (check_fwstate(pmlmepriv, WIFI_ADHOC_MASTER_STATE) == true) ||
+	    (check_fwstate(pmlmepriv, WIFI_ADHOC_STATE) == true) )
 		return;
 
-	if(true == pwrpriv->bInSuspend )
+	if (true == pwrpriv->bInSuspend)
 		return ;
 
-	if (pwrpriv->bLeisurePs)
-	{
+	if (pwrpriv->bLeisurePs) {
 		// Idle for a while if we connect to AP a while ago.
 		if(pwrpriv->LpsIdleCount >= 2) //  4 Sec
 		{
--- a/drivers/staging/rtl8192du/core/rtw_recv.c
+++ b/drivers/staging/rtl8192du/core/rtw_recv.c
@@ -1677,63 +1677,12 @@ sint validate_recv_mgnt_frame(PADAPTER p
 		}
 	}
 
-#ifdef CONFIG_INTEL_PROXIM
-	if(padapter->proximity.proxim_on==true)
-	{
-		struct rx_pkt_attrib * pattrib=&precv_frame->u.hdr.attrib;
-		 struct recv_stat* prxstat=( struct recv_stat * )  precv_frame->u.hdr.rx_head ;
-		 u8 * pda,*psa,*pbssid,*ptr;
-		 ptr=precv_frame->u.hdr.rx_data;
-		pda = get_da(ptr);
-		psa = get_sa(ptr);
-		pbssid = get_hdr_bssid(ptr);
-
-
-		_rtw_memcpy(pattrib->dst, pda, ETH_ALEN);
-		_rtw_memcpy(pattrib->src, psa, ETH_ALEN);
-
-		_rtw_memcpy(pattrib->bssid, pbssid, ETH_ALEN);
-
-	switch(pattrib->to_fr_ds)
-	{
-		case 0:
-			_rtw_memcpy(pattrib->ra, pda, ETH_ALEN);
-			_rtw_memcpy(pattrib->ta, psa, ETH_ALEN);
-			break;
-
-		case 1:
-			_rtw_memcpy(pattrib->ra, pda, ETH_ALEN);
-			_rtw_memcpy(pattrib->ta, pbssid, ETH_ALEN);
-			break;
-
-		case 2:
-			_rtw_memcpy(pattrib->ra, pbssid, ETH_ALEN);
-			_rtw_memcpy(pattrib->ta, psa, ETH_ALEN);
-			break;
-
-		case 3:
-			_rtw_memcpy(pattrib->ra, GetAddr1Ptr(ptr), ETH_ALEN);
-			_rtw_memcpy(pattrib->ta, GetAddr2Ptr(ptr), ETH_ALEN);
-			RT_TRACE(_module_rtl871x_recv_c_,_drv_err_,(" case 3\n"));
-			break;
-
-		default:
-			break;
-
-		}
-			pattrib->priority=0;
-			pattrib->hdrlen = pattrib->to_fr_ds==3 ? 30 : 24;
-
-		 padapter->proximity.proxim_rx(padapter,precv_frame);
-	}
-#endif
 	mgt_dispatcher(padapter, precv_frame);
 
 	return _SUCCESS;
 
 }
 
-sint validate_recv_data_frame(_adapter *adapter, union recv_frame *precv_frame);
 sint validate_recv_data_frame(_adapter *adapter, union recv_frame *precv_frame)
 {
 	u8 bretry;
--- a/drivers/staging/rtl8192du/hal/rtl8192du_xmit.c
+++ b/drivers/staging/rtl8192du/hal/rtl8192du_xmit.c
@@ -411,43 +411,27 @@ if (padapter->registrypriv.mp_mode == 0)
 
 		//offset 20
 #ifdef CONFIG_AP_MODE
-		if(check_fwstate(pmlmepriv, WIFI_AP_STATE) == true)
-		{
+		if(check_fwstate(pmlmepriv, WIFI_AP_STATE) == true) {
 			ptxdesc->txdw5 |= cpu_to_le32(BIT(17));//retry limit enable
 #ifdef CONFIG_P2P
-			if(!rtw_p2p_chk_state(pwdinfo, P2P_STATE_NONE))
-			{
+			if(!rtw_p2p_chk_state(pwdinfo, P2P_STATE_NONE)) {
 				ptxdesc->txdw5 |= cpu_to_le32(0x00080000);//retry limit = 2
-			}
-			else
+			} else
 #endif //CONFIG_P2P
 				ptxdesc->txdw5 |= cpu_to_le32(0x00180000);//retry limit = 6
 		}
 #endif
 
-#ifdef CONFIG_INTEL_PROXIM
-		if((padapter->proximity.proxim_on==true)&&(pattrib->intel_proxim==true)){
-			printk("\n %s pattrib->rate=%d\n",__FUNCTION__,pattrib->rate);
-			ptxdesc->txdw5 |= cpu_to_le32( pattrib->rate);
-		}
-		else
-#endif
-		{
-			ptxdesc->txdw5 |= cpu_to_le32(ratetohwrate(pmlmeext->tx_rate));
-		}
-	}
-	else if((pxmitframe->frame_tag&0x0f) == TXAGG_FRAMETAG)
-	{
+		ptxdesc->txdw5 |= cpu_to_le32(ratetohwrate(pmlmeext->tx_rate));
+	} else if((pxmitframe->frame_tag&0x0f) == TXAGG_FRAMETAG) {
 		DBG_8192C("pxmitframe->frame_tag == TXAGG_FRAMETAG\n");
 	}
 #ifdef CONFIG_MP_INCLUDED
-	else if((pxmitframe->frame_tag&0x0f) == MP_FRAMETAG)
-	{
+	else if((pxmitframe->frame_tag&0x0f) == MP_FRAMETAG) {
 		fill_txdesc_for_mp(padapter, ptxdesc);
 	}
 #endif
-	else
-	{
+	else {
 		DBG_8192C("pxmitframe->frame_tag = %d\n", pxmitframe->frame_tag);
 
 		//offset 4
--- a/drivers/staging/rtl8192du/include/drv_types.h
+++ b/drivers/staging/rtl8192du/include/drv_types.h
@@ -36,6 +36,7 @@ enum {
 	UP_LINK,
 	DOWN_LINK,
 };
+
 typedef struct _ADAPTER _adapter, ADAPTER,*PADAPTER;
 
 #ifdef CONFIG_80211N_HT
@@ -90,14 +91,11 @@ typedef struct _ADAPTER _adapter, ADAPTE
 struct specific_device_id{
 
 	u32		flags;
-
 	u16		idVendor;
 	u16		idProduct;
-
 };
 
-struct registry_priv
-{
+struct registry_priv {
 	u8	chip_version;
 	u8	rfintfs;
 	u8	lbkmode;
@@ -112,7 +110,7 @@ struct registry_priv
 	u8	vrtl_carrier_sense;//Enable, Disable, Auto
 	u8	vcs_type;//RTS/CTS, CTS-to-self
 	u16	rts_thresh;
-	u16  frag_thresh;
+	u16	frag_thresh;
 	u8	adhoc_tx_pwr;
 	u8	soft_ap;
 	u8	power_mgnt;
@@ -220,8 +218,7 @@ enum _IFACE_ID {
 	IFACE_ID_MAX,
 };
 
-struct dvobj_priv
-{
+struct dvobj_priv {
 	_adapter *if1; //PRIMARY_ADAPTER
 	_adapter *if2; //SECONDARY_ADAPTER
 
@@ -237,8 +234,6 @@ struct dvobj_priv
 
 #ifdef CONFIG_CONCURRENT_MODE
 	//extend to support mulitu interface
-	//padapters[IFACE_ID0] == if1
-	//padapters[IFACE_ID1] == if2
 	_adapter *padapters[IFACE_ID_MAX];
 	u8 iface_nums; // total number of ifaces used runtime
 #endif //CONFIG_CONCURRENT_MODE
@@ -285,8 +280,6 @@ struct dvobj_priv
 static struct device *dvobj_to_dev(struct dvobj_priv *dvobj)
 {
 	/* todo: get interface type from dvobj and the return the dev accordingly */
-#ifdef RTW_DVOBJ_CHIP_HW_TYPE
-#endif
 	return &dvobj->pusbintf->dev;
 }
 
@@ -302,42 +295,13 @@ enum _ADAPTER_TYPE {
 	MAX_ADAPTER = 0xFF,
 };
 
-typedef enum _DRIVER_STATE{
+enum DRIVER_STATE {
 	DRIVER_NORMAL = 0,
 	DRIVER_DISAPPEAR = 1,
 	DRIVER_REPLACE_DONGLE = 2,
-}DRIVER_STATE;
-
-#ifdef CONFIG_INTEL_PROXIM
-struct proxim {
-	bool proxim_support;
-	bool proxim_on;
-
-	void *proximity_priv;
-	int (*proxim_rx)(_adapter *padapter,
-		union recv_frame *precv_frame);
-	u8	(*proxim_get_var)(_adapter* padapter, u8 type);
 };
-#endif	//CONFIG_INTEL_PROXIM
-
-#ifdef RTL8723A_SDIO_LOOPBACK
-typedef struct loopbackdata
-{
-	_sema	sema;
-	_thread_hdl_ lbkthread;
-	u8 bstop;
-	u32 cnt;
-	u16 size;
-	u16 txsize;
-	u8 txbuf[0x8000];
-	u16 rxsize;
-	u8 rxbuf[0x8000];
-	u8 msg[100];
 
-}LOOPBACKDATA, *PLOOPBACKDATA;
-#endif
-
-struct _ADAPTER{
+struct _ADAPTER {
 	int	DriverState;// for disable driver using module, use dongle to replace module.
 	int	pid[3];//process id from UI, 0:wps, 1:hostapd, 2:dhcpcd
 	int	bDongle;//build-in module or external dongle
@@ -350,7 +314,6 @@ struct _ADAPTER{
 	struct	mlme_ext_priv mlmeextpriv;
 	struct	cmd_priv	cmdpriv;
 	struct	evt_priv	evtpriv;
-	//struct	io_queue	*pio_queue;
 	struct	io_priv	iopriv;
 	struct	xmit_priv	xmitpriv;
 	struct	recv_priv	recvpriv;
@@ -395,9 +358,6 @@ struct _ADAPTER{
 	u32 hal_data_sz;
 	struct hal_ops	HalFunc;
 
-#ifdef CONFIG_BT_COEXIST
-	//struct	btcoexist_priv	bt_coexist;
-#endif
 	s32	bDriverStopped;
 	s32	bSurpriseRemoved;
 	s32  bCardDisableWOHSM;
@@ -488,7 +448,6 @@ struct _ADAPTER{
 
 #ifdef CONFIG_BR_EXT
 	_lock					br_ext_lock;
-	//unsigned int			macclone_completed;
 	struct nat25_network_db_entry	*nethash[NAT25_HASH_SIZE];
 	int				pppoe_connection_in_progress;
 	unsigned char			pppoe_addr[MACADDRLEN];
@@ -500,18 +459,6 @@ struct _ADAPTER{
 
 	struct br_ext_info		ethBrExtInfo;
 #endif	// CONFIG_BR_EXT
-
-#ifdef CONFIG_INTEL_PROXIM
-	/* intel Proximity, should be alloc mem
-	 * in intel Proximity module and can only
-	 * be used in intel Proximity mode */
-	struct proxim proximity;
-#endif	//CONFIG_INTEL_PROXIM
-
-#ifdef RTL8723A_SDIO_LOOPBACK
-	PLOOPBACKDATA ploopback;
-#endif
-
 };
 
 #define adapter_to_dvobj(adapter) (adapter->dvobj)
@@ -523,5 +470,4 @@ __inline static u8 *myid(struct eeprom_p
 	return (peepriv->mac_addr);
 }
 
-
 #endif //__DRV_TYPES_H__
--- a/drivers/staging/rtl8192du/include/rtw_mlme.h
+++ b/drivers/staging/rtl8192du/include/rtw_mlme.h
@@ -772,10 +772,4 @@ u8 rtw_to_roaming(_adapter *adapter);
 #define rtw_to_roaming(adapter) 0
 #endif
 
-
-#ifdef CONFIG_INTEL_PROXIM
-void rtw_proxim_enable(_adapter *padapter);
-void rtw_proxim_disable(_adapter *padapter);
-void rtw_proxim_send_packet(_adapter *padapter,u8 *pbuf,u16 len,u8 hw_rate);
-#endif //CONFIG_INTEL_PROXIM
 #endif //__RTL871X_MLME_H_
--- a/drivers/staging/rtl8192du/include/usb_hal.h
+++ b/drivers/staging/rtl8192du/include/usb_hal.h
@@ -24,13 +24,11 @@
 void rtl8192cu_set_hal_ops(_adapter * padapter);
 
 void rtl8192du_set_hal_ops(_adapter * padapter);
-#ifdef CONFIG_INTEL_PROXIM
-extern _adapter  *rtw_usb_get_sw_pointer(void);
-#endif	//CONFIG_INTEL_PROXIM
 #ifdef CONFIG_WOWLAN
 #ifdef CONFIG_WOWLAN_MANUAL
 extern int rtw_suspend_toshiba(PADAPTER Adapter);
 extern int rtw_resume_toshiba(PADAPTER Adapter);
 #endif // CONFIG_WOWLAN_MANUAL
 #endif //CONFIG_WOWLAN
+
 #endif //__USB_HAL_H__
--- a/drivers/staging/rtl8192du/os_dep/usb_intf.c
+++ b/drivers/staging/rtl8192du/os_dep/usb_intf.c
@@ -1470,11 +1470,3 @@ EXPORT_SYMBOL(rtw_suspend_toshiba);
 EXPORT_SYMBOL(rtw_resume_toshiba);
 #endif //CONFIG_WOWLAN_MANUAL
 #endif //CONFIG_WOWLAN
-
-#ifdef CONFIG_INTEL_PROXIM
-_adapter  *rtw_usb_get_sw_pointer(void)
-{
-	return rtw_sw_export;
-}
-EXPORT_SYMBOL(rtw_usb_get_sw_pointer);
-#endif	//CONFIG_INTEL_PROXIM
