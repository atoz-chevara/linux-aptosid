From 512d1e01a9a490086e55eebfa386cf116d337ff1 Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Sat, 15 Mar 2014 14:45:27 -0500
Subject: [PATCH 283/390] Remove CONFIG_DRVEXT_MODULE

This one is not used.

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 Makefile             |  2 --
 core/rtw_mlme.c      | 13 +-------
 include/drv_types.h  |  8 -----
 os_dep/ioctl_linux.c | 90 +---------------------------------------------------
 os_dep/os_intfs.c    |  9 ------
 os_dep/recv_linux.c  |  5 ---
 6 files changed, 2 insertions(+), 125 deletions(-)

--- a/drivers/staging/rtl8192du/Makefile
+++ b/drivers/staging/rtl8192du/Makefile
@@ -26,8 +26,6 @@ CONFIG_HW_PWRP_DETECTION = n
 CONFIG_BT_COEXISTENCE = n
 CONFIG_WAKE_ON_WLAN = n
 
-CONFIG_DRVEXT_MODULE = n
-
 export TopDIR ?= $(shell pwd)
 
 ccflags-y += -D__CHECK_ENDIAN__
--- a/drivers/staging/rtl8192du/core/rtw_mlme.c
+++ b/drivers/staging/rtl8192du/core/rtw_mlme.c
@@ -1149,14 +1149,7 @@ void rtw_indicate_connect(struct rtw_ada
 
 		rtw_led_control(padapter, LED_CTL_LINK);
 
-#ifdef CONFIG_DRVEXT_MODULE
-		if (padapter->drvextpriv.enable_wpa) {
-			indicate_l2_connect(padapter);
-		} else
-#endif
-		{
-			rtw_os_indicate_connect(padapter);
-		}
+		rtw_os_indicate_connect(padapter);
 	}
 
 	rtw_set_roaming(padapter, 0);
@@ -2409,10 +2402,6 @@ int rtw_restruct_sec_ie(struct rtw_adapt
 		ielength += psecuritypriv->supplicant_ie[1] + 2;
 		rtw_report_sec_ie(adapter, authmode,
 				  psecuritypriv->supplicant_ie);
-
-#ifdef CONFIG_DRVEXT_MODULE
-		drvext_report_sec_ie(&adapter->drvextpriv, authmode, sec_ie);
-#endif
 	}
 
 	iEntry = SecIsInPMKIDList(adapter, pmlmepriv->assoc_bssid);
--- a/drivers/staging/rtl8192du/include/drv_types.h
+++ b/drivers/staging/rtl8192du/include/drv_types.h
@@ -49,10 +49,6 @@
 #include <rtw_tdls.h>
 #include <rtw_ap.h>
 
-#ifdef CONFIG_DRVEXT_MODULE
-#include <drvext_api.h>
-#endif
-
 #ifdef CONFIG_IOCTL_CFG80211
 	#include "ioctl_cfg80211.h"
 #endif /* CONFIG_IOCTL_CFG80211 */
@@ -282,10 +278,6 @@ struct rtw_adapter {
 	struct	eeprom_priv eeprompriv;
 	struct	led_priv	ledpriv;
 
-#ifdef CONFIG_DRVEXT_MODULE
-	struct	drvext_priv	drvextpriv;
-#endif
-
 #ifdef CONFIG_92D_AP_MODE
 	struct	hostapd_priv	*phostapdpriv;
 #endif
--- a/drivers/staging/rtl8192du/os_dep/ioctl_linux.c
+++ b/drivers/staging/rtl8192du/os_dep/ioctl_linux.c
@@ -2669,96 +2669,8 @@ static int rtw_wx_set_mtk_wps_ie(struct
  *	pointer to memory allocated in user space.
  */
 static  int rtw_drvext_hdl(struct net_device *dev, struct iw_request_info *info,
-						union iwreq_data *wrqu, char *extra)
+			   union iwreq_data *wrqu, char *extra)
 {
-
-#ifdef CONFIG_DRVEXT_MODULE
-	u8 res;
-	struct drvext_handler *phandler;
-	struct drvext_oidparam *poidparam;
-	int ret;
-	u16 len;
-	u8 *pparmbuf, bset;
-	struct rtw_adapter *padapter = (struct rtw_adapter *)rtw_netdev_priv(dev);
-	struct iw_point *p = &wrqu->data;
-
-	if ((!p->length) || (!p->pointer)) {
-		ret = -EINVAL;
-		goto _rtw_drvext_hdl_exit;
-	}
-
-	bset = (u8)(p->flags&0xFFFF);
-	len = p->length;
-	pparmbuf = (u8 *)kmalloc(len, GFP_KERNEL);
-	if (pparmbuf == NULL) {
-		ret = -ENOMEM;
-		goto _rtw_drvext_hdl_exit;
-	}
-
-	if (bset)/* set info */
-	{
-		if (copy_from_user(pparmbuf, p->pointer, len)) {
-			kfree(pparmbuf);
-			ret = -EFAULT;
-			goto _rtw_drvext_hdl_exit;
-		}
-	}
-	else/* query info */
-	{
-
-	}
-
-	/*  */
-	poidparam = (struct drvext_oidparam *)pparmbuf;
-
-	RT_TRACE(_module_rtl871x_ioctl_os_c, _drv_info_, ("drvext set oid subcode [%d], len[%d], InformationBufferLength[%d]\r\n",
-						 poidparam->subcode, poidparam->len, len));
-
-	/* check subcode */
-	if (poidparam->subcode >= MAX_DRVEXT_HANDLERS)
-	{
-		RT_TRACE(_module_rtl871x_ioctl_os_c, _drv_err_, ("no matching drvext handlers\r\n"));
-		ret = -EINVAL;
-		goto _rtw_drvext_hdl_exit;
-	}
-
-	if (poidparam->subcode >= MAX_DRVEXT_OID_SUBCODES)
-	{
-		RT_TRACE(_module_rtl871x_ioctl_os_c, _drv_err_, ("no matching drvext subcodes\r\n"));
-		ret = -EINVAL;
-		goto _rtw_drvext_hdl_exit;
-	}
-
-	phandler = drvextoidhandlers + poidparam->subcode;
-
-	if (poidparam->len != phandler->parmsize)
-	{
-		RT_TRACE(_module_rtl871x_ioctl_os_c, _drv_err_, ("no matching drvext param size %d vs %d\r\n",
-						poidparam->len , phandler->parmsize));
-		ret = -EINVAL;
-		goto _rtw_drvext_hdl_exit;
-	}
-
-	res = phandler->handler(&padapter->drvextpriv, bset, poidparam->data);
-
-	if (res == 0)
-	{
-		ret = 0;
-
-		if (bset == 0x00) {/* query info */
-			if (copy_to_user(p->pointer, pparmbuf, len))
-				ret = -EFAULT;
-		}
-	}
-	else
-		ret = -EFAULT;
-
-_rtw_drvext_hdl_exit:
-
-	return ret;
-
-#endif
-
 	return 0;
 }
 
--- a/drivers/staging/rtl8192du/os_dep/os_intfs.c
+++ b/drivers/staging/rtl8192du/os_dep/os_intfs.c
@@ -782,10 +782,6 @@ u8 rtw_free_drv_sw(struct rtw_adapter *p
 
 	rtw_free_pwrctrl_priv(padapter);
 
-#ifdef CONFIG_DRVEXT_MODULE
-	free_drvext(&padapter->drvextpriv);
-#endif
-
 	rtw_hal_free_data(padapter);
 
 	RT_TRACE(_module_os_intfs_c_, _drv_info_, ("<== rtw_free_drv_sw\n"));
@@ -1494,11 +1490,6 @@ int _netdev_open(struct net_device *pnet
 			RT_TRACE(_module_os_intfs_c_, _drv_err_, ("can't init mlme_ext_priv\n"));
 			goto netdev_open_error;
 		}
-
-#ifdef CONFIG_DRVEXT_MODULE
-		init_drvext(padapter);
-#endif
-
 		if (padapter->intf_start)
 			padapter->intf_start(padapter);
 
--- a/drivers/staging/rtl8192du/os_dep/recv_linux.c
+++ b/drivers/staging/rtl8192du/os_dep/recv_linux.c
@@ -171,11 +171,6 @@ int rtw_recv_indicatepkt(struct rtw_adap
 	precvpriv = &(padapter->recvpriv);
 	pfree_recv_queue = &(precvpriv->free_recv_queue);
 
-#ifdef CONFIG_DRVEXT_MODULE
-	if (drvext_rx_handler(padapter, precv_frame->rx_data, precv_frame->len) == _SUCCESS)
-		goto _recv_indicatepkt_drop;
-#endif
-
 	skb = precv_frame->pkt;
 	if (skb == NULL) {
 		RT_TRACE(_module_recv_osdep_c_,_drv_err_,("rtw_recv_indicatepkt():skb==NULL something wrong!!!!\n"));
