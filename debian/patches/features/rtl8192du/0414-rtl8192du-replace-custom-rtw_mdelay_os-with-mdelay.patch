From 3e5b1385b1828516016e698a1b83fa255af82843 Mon Sep 17 00:00:00 2001
From: Stefan Lippers-Hollmann <s.l-h@gmx.de>
Date: Sat, 22 Mar 2014 03:03:12 +0100
Subject: [PATCH 414/456] rtl8192du: replace custom rtw_mdelay_os() with
 mdelay()

Signed-off-by: Stefan Lippers-Hollmann <s.l-h@gmx.de>
---
 hal/rtl8192d_phycfg.c   | 30 +++++++++++++++---------------
 hal/usb_halinit.c       |  4 ++--
 include/osdep_service.h |  2 --
 os_dep/osdep_service.c  |  5 -----
 4 files changed, 17 insertions(+), 24 deletions(-)

--- a/drivers/staging/rtl8192du/hal/rtl8192d_phycfg.c
+++ b/drivers/staging/rtl8192du/hal/rtl8192d_phycfg.c
@@ -795,11 +795,11 @@ phy_ConfigBBWithHeaderFile(
 	if (ConfigType == BaseBand_Config_PHY_REG) {
 		for (i = 0; i < PHY_REGArrayLen; i = i+2) {
 			if (Rtl819XPHY_REGArray_Table[i] == 0xfe || Rtl819XPHY_REGArray_Table[i] == 0xffe)
-				rtw_mdelay_os(50);
+				mdelay(50);
 			else if (Rtl819XPHY_REGArray_Table[i] == 0xfd)
-				rtw_mdelay_os(5);
+				mdelay(5);
 			else if (Rtl819XPHY_REGArray_Table[i] == 0xfc)
-				rtw_mdelay_os(1);
+				mdelay(1);
 			else if (Rtl819XPHY_REGArray_Table[i] == 0xfb)
 				udelay(50);
 			else if (Rtl819XPHY_REGArray_Table[i] == 0xfa)
@@ -1151,7 +1151,7 @@ rtl8192d_PHY_ConfigRFWithHeaderFile(
 			for (i = 0;i<RadioA_ArrayLen; i = i+2)
 			{
 				if (Rtl819XRadioA_Array_Table[i] == 0xfe) {
-					rtw_mdelay_os(50);
+					mdelay(50);
 				} else if (Rtl819XRadioA_Array_Table[i] == 0xfd) {
 					for (j = 0;j<100;j++)
 						udelay(MAX_STALL_TIME);
@@ -1176,13 +1176,13 @@ rtl8192d_PHY_ConfigRFWithHeaderFile(
 			{
 				if (Rtl819XRadioB_Array_Table[i] == 0xfe)
 				{ /*  Deay specific ms. Only RF configuration require delay. */
-					rtw_mdelay_os(50);
+					mdelay(50);
 				} else if (Rtl819XRadioB_Array_Table[i] == 0xfd) {
-					/* rtw_mdelay_os(5); */
+					/* mdelay(5); */
 					for (j = 0;j<100;j++)
 						udelay(MAX_STALL_TIME);
 				} else if (Rtl819XRadioB_Array_Table[i] == 0xfc) {
-					/* rtw_mdelay_os(1); */
+					/* mdelay(1); */
 					for (j = 0;j<20;j++)
 						udelay(MAX_STALL_TIME);
 				} else if (Rtl819XRadioB_Array_Table[i] == 0xfb) {
@@ -1269,9 +1269,9 @@ rtl8192d_PHY_CheckBBAndRFOK(
 			WriteData[i] &= 0xfff;
 			PHY_SetRFReg(adapter, eRFPath, WriteAddr[HW90_BLOCK_RF], bRFRegOffsetMask, WriteData[i]);
 			/*  TODO: we should not delay for such a long time. Ask SD3 */
-			rtw_mdelay_os(10);
+			mdelay(10);
 			ulRegRead = PHY_QueryRFReg(adapter, eRFPath, WriteAddr[HW90_BLOCK_RF], bRFRegOffsetMask);
-			rtw_mdelay_os(10);
+			mdelay(10);
 			/* cosa PlatformReleaseSpinLock(adapter, RT_INITIAL_SPINLOCK); */
 			break;
 
@@ -2552,7 +2552,7 @@ PHY_SwChnl8192D(	/*  Call after initiali
 		pHalDataBuddyadapter = GET_HAL_DATA(Buddyadapter);
 		while (pHalDataBuddyadapter->bLCKInProgress && timecount < timeout)
 		{
-			rtw_mdelay_os(50);
+			mdelay(50);
 			timecount += 50;
 		}
 	}
@@ -2560,7 +2560,7 @@ PHY_SwChnl8192D(	/*  Call after initiali
 
 	while (pHalData->bLCKInProgress && timecount < timeout)
 	{
-		rtw_mdelay_os(50);
+		mdelay(50);
 		timecount += 50;
 	}
 
@@ -2805,7 +2805,7 @@ phy_PathA_IQK_5G_Normal(
 		PHY_SetBBReg(adapter, rIQK_AGC_Pts, bMaskDWord, 0xf8000000);
 
 		/*  delay x ms */
-		rtw_mdelay_os(IQK_DELAY_TIME*10);
+		mdelay(IQK_DELAY_TIME*10);
 
 		while (timecount < timeout && PHY_QueryBBReg(adapter, rRx_Power_After_IQK_A_2, BIT26) == 0x00)
 		{
@@ -2945,7 +2945,7 @@ phy_PathB_IQK_5G_Normal(
 		PHY_SetBBReg(adapter, rIQK_AGC_Pts, bMaskDWord, 0xf8000000);
 
 		/*  delay x ms */
-		rtw_mdelay_os(IQK_DELAY_TIME*10);
+		mdelay(IQK_DELAY_TIME*10);
 
 		while (timecount < timeout && PHY_QueryBBReg(adapter, rRx_Power_After_IQK_A_2, BIT29) == 0x00) {
 			udelay(IQK_DELAY_TIME*1000*2);
@@ -4077,7 +4077,7 @@ phy_IQCalibrate_5G_Normal(
 
 	bool		is2T =  IS_92D_SINGLEPHY(pHalData->VersionID);
 
-	rtw_mdelay_os(IQK_DELAY_TIME*20);
+	mdelay(IQK_DELAY_TIME*20);
 
 	if (t == 0) {
 		/*  Save ADDA parameters, turn Path A ADDA on */
@@ -4358,7 +4358,7 @@ phy_LCCalibrate92DSW(
 		while ((!(u4tmp & BIT11)) &&
 			timecount <= timeout)
 		{
-			rtw_mdelay_os(50);
+			mdelay(50);
 			timecount += 50;
 			u4tmp = PHY_QueryRFReg(adapter, (enum RF_RADIO_PATH_E)index, RF_SYN_G6, bRFRegOffsetMask);
 		}
--- a/drivers/staging/rtl8192du/hal/usb_halinit.c
+++ b/drivers/staging/rtl8192du/hal/usb_halinit.c
@@ -2087,7 +2087,7 @@ _ResetDigitalProcedure1(
 				rtw_write8(adapter, REG_FWIMR, 0x00);
 				/*  2010/08/31 MH According to Filen's info, if 8051 reset fail, reset MAC directly. */
 				rtw_write8(adapter, REG_SYS_FUNC_EN+1, 0x50);	/* Reset MAC and Enable 8051 */
-				rtw_mdelay_os(10);
+				mdelay(10);
 			} else {
 				DBG_8192D("=====> 8051 reset success (%d) .\n", retry_cnts);
 			}
@@ -4221,7 +4221,7 @@ static void SetHwReg8192DU(struct rtw_ad
 					/* RQPN Load 0 */
 					rtw_write16(adapter, REG_RQPN_NPQ, 0x0);
 					rtw_write32(adapter, REG_RQPN, 0x80000000);
-					rtw_mdelay_os(10);
+					mdelay(10);
 				}
 
 			}
--- a/drivers/staging/rtl8192du/include/osdep_service.h
+++ b/drivers/staging/rtl8192du/include/osdep_service.h
@@ -209,8 +209,6 @@ void	rtw_usleep_os(int us);
 
 u32	rtw_atoi(u8* s);
 
-void	rtw_mdelay_os(int ms);
-
 static inline unsigned char _cancel_timer_ex(struct timer_list *timer)
 {
 	return del_timer_sync(timer);
--- a/drivers/staging/rtl8192du/os_dep/osdep_service.c
+++ b/drivers/staging/rtl8192du/os_dep/osdep_service.c
@@ -206,11 +206,6 @@ void rtw_usleep_os(int us)
 		msleep((us/1000) + 1);
 }
 
-void rtw_mdelay_os(int ms)
-{
-	mdelay((unsigned long)ms);
-}
-
 #define RTW_SUSPEND_LOCK_NAME "rtw_wifi"
 
 struct net_device *rtw_alloc_etherdev_with_old_priv(int sizeof_priv, void *old_priv)
