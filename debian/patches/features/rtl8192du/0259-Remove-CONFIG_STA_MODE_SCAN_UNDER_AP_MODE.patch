From 277a876d1728f1d6fcace7e55cc159d9915fc71b Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Sat, 15 Mar 2014 11:54:50 -0500
Subject: [PATCH 259/390] Remove CONFIG_STA_MODE_SCAN_UNDER_AP_MODE

This configuration variable is never selected.

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 core/rtw_cmd.c         |  9 +--------
 core/rtw_mlme_ext.c    | 25 ++++---------------------
 include/rtw_mlme_ext.h |  9 ---------
 3 files changed, 5 insertions(+), 38 deletions(-)

--- a/drivers/staging/rtl8192du/core/rtw_cmd.c
+++ b/drivers/staging/rtl8192du/core/rtw_cmd.c
@@ -460,14 +460,7 @@ u8 rtw_sitesurvey_cmd(struct rtw_adapter
 	if (res == _SUCCESS) {
 		pmlmepriv->scan_start_time = rtw_get_current_time();
 
-#ifdef CONFIG_STA_MODE_SCAN_UNDER_AP_MODE
-		if ((padapter->pbuddy_adapter->mlmeextpriv.mlmext_info.state&0x03) == WIFI_FW_AP_STATE)
-			_set_timer(&pmlmepriv->scan_to_timer, SURVEY_TO *
-				   (38 + (38 / RTW_SCAN_NUM_OF_CH) *
-				    RTW_STAY_AP_CH_MILLISECOND) + 1000);
-		else
-#endif /* CONFIG_STA_MODE_SCAN_UNDER_AP_MODE */
-			_set_timer(&pmlmepriv->scan_to_timer, SCANNING_TIMEOUT);
+		_set_timer(&pmlmepriv->scan_to_timer, SCANNING_TIMEOUT);
 
 		rtw_led_control(padapter, LED_CTL_SITE_SURVEY);
 
--- a/drivers/staging/rtl8192du/core/rtw_mlme_ext.c
+++ b/drivers/staging/rtl8192du/core/rtw_mlme_ext.c
@@ -8275,7 +8275,7 @@ void site_survey(struct rtw_adapter *ada
 				pmlmeinfo->scan_cnt++;
 			}
 		}
-#endif /* CONFIG_STA_MODE_SCAN_UNDER_AP_MODE */
+#endif
 #endif /* CONFIG_CONCURRENT_MODE */
 		if (pmlmeext->sitesurvey_res.channel_idx == 0) {
 			set_channel_bwmode(adapt, survey_channel,
@@ -8345,15 +8345,7 @@ void site_survey(struct rtw_adapter *ada
 				}
 			}
 		}
-#ifdef CONFIG_STA_MODE_SCAN_UNDER_AP_MODE
-		if (stay_buddy_ch == 1)
-			set_survey_timer(pmlmeext,
-					 pmlmeext->chan_scan_time *
-					 RTW_STAY_AP_CH_MILLISECOND);
-		else
-#endif /* CONFIG_STA_MODE_SCAN_UNDER_AP_MODE */
-			set_survey_timer(pmlmeext, pmlmeext->chan_scan_time);
-
+		set_survey_timer(pmlmeext, pmlmeext->chan_scan_time);
 	} else {
 		/*      channel number is 0 or this channel is not valid. */
 
@@ -8417,10 +8409,6 @@ void site_survey(struct rtw_adapter *ada
 		} else
 #endif /* CONFIG_P2P */
 		{
-#ifdef CONFIG_STA_MODE_SCAN_UNDER_AP_MODE
-			pmlmeinfo->scan_cnt = 0;
-#endif /* CONFIG_DMP_STA_NODE_SCAN_UNDER_AP_MODE */
-
 #ifdef CONFIG_P2P
 			if (rtw_p2p_chk_state(pwdinfo, P2P_STATE_SCAN) || rtw_p2p_chk_state(pwdinfo,
 			    P2P_STATE_FIND_PHASE_SEARCH)) {
@@ -9958,13 +9946,8 @@ void survey_timer_hdl(struct rtw_adapter
 
 	/* issue rtw_sitesurvey_cmd */
 	if (pmlmeext->sitesurvey_res.state > SCAN_START) {
-		if (pmlmeext->sitesurvey_res.state == SCAN_PROCESS) {
-#ifdef CONFIG_STA_MODE_SCAN_UNDER_AP_MODE
-			if (adapt->mlmeextpriv.mlmext_info.scan_cnt !=
-			    RTW_SCAN_NUM_OF_CH)
-#endif /* CONFIG_STA_MODE_SCAN_UNDER_AP_MODE */
-				pmlmeext->sitesurvey_res.channel_idx++;
-		}
+		if (pmlmeext->sitesurvey_res.state == SCAN_PROCESS)
+			pmlmeext->sitesurvey_res.channel_idx++;
 
 		if (pmlmeext->scan_abort == true) {
 #ifdef CONFIG_P2P
--- a/drivers/staging/rtl8192du/include/rtw_mlme_ext.h
+++ b/drivers/staging/rtl8192du/include/rtw_mlme_ext.h
@@ -288,11 +288,6 @@ struct FW_Sta_Info
  * 4. Back to channel 1 for 300 milliseconds
  * 5. ... and so on, till survey done.
  */
-#if defined CONFIG_STA_MODE_SCAN_UNDER_AP_MODE && defined CONFIG_CONCURRENT_MODE
-#define RTW_SCAN_NUM_OF_CH			8
-#define RTW_STAY_AP_CH_MILLISECOND	3	/*  this value is a multiplier,for example, when this value is 3, it would stay AP's op ch for */
-											/*  3 * SURVEY_TO millisecond. */
-#endif /* defined CONFIG_STA_MODE_SCAN_UNDER_AP_MODE && defined CONFIG_CONCURRENT_MODE */
 
 struct mlme_ext_info
 {
@@ -338,10 +333,6 @@ struct mlme_ext_info
 	struct HT_info_element		HT_info;
 	struct wlan_bssid_ex network;/* join network or bss_network, if in ap mode, it is the same to cur_network.network */
 	struct FW_Sta_Info		FW_sta_info[NUM_STA];
-
-#ifdef CONFIG_STA_MODE_SCAN_UNDER_AP_MODE
-	u8 scan_cnt;
-#endif /* CONFIG_STA_MODE_SCAN_UNDER_AP_MODE */
 };
 
 /*  The channel information about this channel including joining, scanning, and power constraints. */
