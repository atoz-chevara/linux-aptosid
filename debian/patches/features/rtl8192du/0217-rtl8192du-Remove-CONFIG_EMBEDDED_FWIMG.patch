From 530b04759d205235dcb32329c918519a378660cb Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Wed, 19 Feb 2014 21:52:39 -0600
Subject: [PATCH 217/390] rtl8192du: Remove CONFIG_EMBEDDED_FWIMG

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 hal/rtl8192d_phycfg.c | 176 +-------------------------------------------------
 hal/rtl8192d_rf6052.c |  76 ++++++----------------
 include/autoconf.h    |   2 -
 3 files changed, 19 insertions(+), 235 deletions(-)

--- a/drivers/staging/rtl8192du/hal/rtl8192d_phycfg.c
+++ b/drivers/staging/rtl8192du/hal/rtl8192d_phycfg.c
@@ -630,20 +630,7 @@ rtl8192d_PHY_SetRFReg(
  * Note:		The format of MACPHY_REG.txt is different from PHY and RF.
  *			[Register][Mask][Value]
  *---------------------------------------------------------------------------*/
-#ifndef CONFIG_EMBEDDED_FWIMG
-static	int
-phy_ConfigMACWithParaFile(
-	struct rtw_adapter *		adapter,
-	u8*			pFileName
-)
-{
-	struct hal_data_8192du *pHalData = GET_HAL_DATA(adapter);
-
-	int		rtStatus = _SUCCESS;
 
-	return rtStatus;
-}
-#endif /* CONFIG_EMBEDDED_FWIMG */
 /*-----------------------------------------------------------------------------
  * Function:    phy_ConfigMACWithHeaderFile()
  *
@@ -701,9 +688,6 @@ phy_ConfigMACWithHeaderFile(
 int PHY_MACConfig8192D(struct rtw_adapter *adapter)
 {
 	struct hal_data_8192du *pHalData = GET_HAL_DATA(adapter);
-#ifndef CONFIG_EMBEDDED_FWIMG
-	char		*pszMACRegFile;
-#endif
 	char		sz92DMACRegFile[] = RTL8192D_PHY_MACREG;
 	int		rtStatus = _SUCCESS;
 
@@ -712,20 +696,8 @@ int PHY_MACConfig8192D(struct rtw_adapte
 		return rtStatus;
 	}
 
-#ifndef CONFIG_EMBEDDED_FWIMG
-	pszMACRegFile = sz92DMACRegFile;
-#endif
-
-	/*  */
 	/*  Config MAC */
-	/*  */
-#ifdef CONFIG_EMBEDDED_FWIMG
 	rtStatus = phy_ConfigMACWithHeaderFile(adapter);
-#else
-
-	/*  Not make sure EEPROM, add later */
-	rtStatus = phy_ConfigMACWithParaFile(adapter, pszMACRegFile);
-#endif
 
 	if (pHalData->MacPhyMode92D == SINGLEMAC_SINGLEPHY)
 	{
@@ -963,36 +935,6 @@ phy_ConfigBBWithHeaderFile(
 	return _SUCCESS;
 }
 
-/*-----------------------------------------------------------------------------
- * Function:    phy_ConfigBBWithParaFile()
- *
- * Overview:    This function read BB parameters from general file format, and do register
- *			  Read/Write
- *
- * Input:	struct rtw_adapter *		adapter
- *			ps1Byte				pFileName
- *
- * Output:      NONE
- *
- * Return:      RT_STATUS_SUCCESS: configuration file exist
- *	2008/11/06	MH	For 92S we do not support silent reset now. Disable
- *					parameter file compare!!!!!!??
- *
- *---------------------------------------------------------------------------*/
-#ifndef CONFIG_EMBEDDED_FWIMG
-static	int
-phy_ConfigBBWithParaFile(
-	struct rtw_adapter *		adapter,
-	u8*			pFileName
-)
-{
-	struct hal_data_8192du *pHalData = GET_HAL_DATA(adapter);
-
-	int		rtStatus = _SUCCESS;
-
-	return rtStatus;
-}
-#endif /* CONFIG_EMBEDDED_FWIMG */
 #if MP_DRIVER != 1
 static void
 storePwrIndexDiffRateOffset(
@@ -1081,65 +1023,7 @@ phy_ConfigBBWithPgHeaderFile(
 }	/* phy_ConfigBBWithPgHeaderFile */
 #endif
 
-/*-----------------------------------------------------------------------------
- * Function:	phy_ConfigBBWithPgParaFile
- *
- * Overview:
- *
- * Input:       NONE
- *
- * Output:      NONE
- *
- * Return:      NONE
- *
- * Revised History:
- * When			Who		Remark
- * 11/06/2008	MHC		Create Version 0.
- * 2009/07/29	tynli		(porting from 92SE branch)2009/03/11 Add copy parameter file to buffer for silent reset
- *---------------------------------------------------------------------------*/
-#ifndef CONFIG_EMBEDDED_FWIMG
-static	int
-phy_ConfigBBWithPgParaFile(
-	struct rtw_adapter *		adapter,
-	u8*			pFileName)
-{
-	struct hal_data_8192du *pHalData = GET_HAL_DATA(adapter);
-
-	int		rtStatus = _SUCCESS;
-
-	return rtStatus;
-}	/* phy_ConfigBBWithPgParaFile */
-#endif /* CONFIG_EMBEDDED_FWIMG */
 #if MP_DRIVER == 1
-#ifndef CONFIG_EMBEDDED_FWIMG
-/*-----------------------------------------------------------------------------
- * Function:    phy_ConfigBBWithMpParaFile()
- *
- * Overview:    This function read BB parameters from general file format, and do register
- *			  Read/Write
- *
- * Input:	struct rtw_adapter *		adapter
- *			ps1Byte				pFileName
- *
- * Output:      NONE
- *
- * Return:      RT_STATUS_SUCCESS: configuration file exist
- *	2008/11/06	MH	For 92S we do not support silent reset now. Disable
- *					parameter file compare!!!!!!??
- *
- *---------------------------------------------------------------------------*/
-static	int
-phy_ConfigBBWithMpParaFile(
-	struct rtw_adapter *	adapter,
-	s8			*pFileName
-)
-{
-	struct hal_data_8192du *pHalData = GET_HAL_DATA(adapter);
-	int	rtStatus = _SUCCESS;
-
-	return rtStatus;
-}
-#else
 /*-----------------------------------------------------------------------------
  * Function:	phy_ConfigBBWithMpHeaderFile
  *
@@ -1197,8 +1081,6 @@ phy_ConfigBBWithMpHeaderFile(
 	}
 	return _SUCCESS;
 }	/* phy_ConfigBBWithPgHeaderFile */
-
-#endif
 #endif
 
 static	int
@@ -1217,40 +1099,11 @@ phy_BB8192D_Config_ParaFile(
 	s8		sz92DAGCTableFile[] = RTL8192D_AGC_TAB;
 	s8		sz92D2GAGCTableFile[] = RTL8192D_AGC_TAB_2G;
 	s8		sz92D5GAGCTableFile[] = RTL8192D_AGC_TAB_5G;
-#ifndef CONFIG_EMBEDDED_FWIMG
-	char		*pszBBRegFile;
-	char *pszAGCTableFile;
-	char *pszBBRegPgFile;
-	char *pszBBRegMpFile;
-#endif
-
-#ifndef CONFIG_EMBEDDED_FWIMG
-	pszBBRegFile = sz92DBBRegFile;
-	pszBBRegPgFile = sz92DBBRegPgFile;
-
-	/* Normal chip,Mac0 use AGC_TAB.txt for 2G and 5G band. */
-	if (pHalData->interfaceIndex == 0) {
-		pszAGCTableFile = sz92DAGCTableFile;
-	} else {
-		if (pHalData->CurrentBandType92D == BAND_ON_2_4G)
-			pszAGCTableFile = sz92D2GAGCTableFile;
-		else
-			pszAGCTableFile = sz92D5GAGCTableFile;
-	}
-	pszBBRegMpFile = sz92DBBRegMpFile;
-#endif
 
 	/*  1. Read PHY_REG.TXT BB INIT!! */
 	/*  We will seperate as 88C / 92C according to chip version */
 	/*  */
-#ifdef CONFIG_EMBEDDED_FWIMG
 	rtStatus = phy_ConfigBBWithHeaderFile(adapter, BaseBand_Config_PHY_REG);
-#else
-	/*  No matter what kind of CHIP we always read PHY_REG.txt. We must copy different */
-	/*  type of parameter files to phy_reg.txt at first. */
-	rtStatus = phy_ConfigBBWithParaFile(adapter,pszBBRegFile);
-#endif
-
 	if (rtStatus != _SUCCESS)
 		goto phy_BB8190_Config_ParaFile_Fail;
 
@@ -1259,13 +1112,7 @@ phy_BB8192D_Config_ParaFile(
 	/*  1.1 Read PHY_REG_MP.TXT BB INIT!! */
 	/*  We will seperate as 88C / 92C according to chip version */
 	/*  */
-#ifdef CONFIG_EMBEDDED_FWIMG
 	rtStatus = phy_ConfigBBWithMpHeaderFile(adapter, BaseBand_Config_PHY_REG);
-#else
-	/*  No matter what kind of CHIP we always read PHY_REG.txt. We must copy different */
-	/*  type of parameter files to phy_reg.txt at first. */
-	rtStatus = phy_ConfigBBWithMpParaFile(adapter,pszBBRegMpFile);
-#endif
 
 	if (rtStatus != _SUCCESS)
 		goto phy_BB8190_Config_ParaFile_Fail;
@@ -1275,15 +1122,10 @@ phy_BB8192D_Config_ParaFile(
 	/*  */
 	/*  2. If EEPROM or EFUSE autoload OK, We must config by PHY_REG_PG.txt */
 	/*  */
-	if (pEEPROM->bautoload_fail_flag == false)
-	{
+	if (pEEPROM->bautoload_fail_flag == false) {
 		pHalData->pwrGroupCnt = 0;
 
-#ifdef CONFIG_EMBEDDED_FWIMG
 		rtStatus = phy_ConfigBBWithPgHeaderFile(adapter, BaseBand_Config_PHY_REG);
-#else
-		rtStatus = phy_ConfigBBWithPgParaFile(adapter, pszBBRegPgFile);
-#endif
 	}
 
 	if (rtStatus != _SUCCESS)
@@ -1293,7 +1135,6 @@ phy_BB8192D_Config_ParaFile(
 	/*  */
 	/*  3. BB AGC table Initialization */
 	/*  */
-#ifdef CONFIG_EMBEDDED_FWIMG
 #ifdef CONFIG_DUALMAC_CONCURRENT
 	if (pHalData->bSlaveOfDMSP)
 	{
@@ -1304,9 +1145,6 @@ phy_BB8192D_Config_ParaFile(
 	{
 		rtStatus = phy_ConfigBBWithHeaderFile(adapter, BaseBand_Config_AGC_TAB);
 	}
-#else
-	rtStatus = phy_ConfigBBWithParaFile(adapter, pszAGCTableFile);
-#endif
 
 	if (rtStatus != _SUCCESS)
 		goto phy_BB8190_Config_ParaFile_Fail;
@@ -2306,24 +2144,12 @@ static void PHY_SwitchWirelessBand(struc
 	{
 		/* BB & RF Config */
 		if (pHalData->interfaceIndex == 1)
-		{
-#ifdef CONFIG_EMBEDDED_FWIMG
 			phy_ConfigBBWithHeaderFile(adapter, BaseBand_Config_AGC_TAB);
-#else
-			PHY_SetAGCTab8192D(adapter);
-#endif
-		}
 	}
 	else	/* 5G band */
 	{
 		if (pHalData->interfaceIndex == 1)
-		{
-#ifdef CONFIG_EMBEDDED_FWIMG
 			phy_ConfigBBWithHeaderFile(adapter, BaseBand_Config_AGC_TAB);
-#else
-			PHY_SetAGCTab8192D(adapter);
-#endif
-		}
 	}
 
 	PHY_UpdateBBRFConfiguration8192D(adapter, true);
--- a/drivers/staging/rtl8192du/hal/rtl8192d_rf6052.c
+++ b/drivers/staging/rtl8192du/hal/rtl8192d_rf6052.c
@@ -574,10 +574,6 @@ phy_RF6052_Config_ParaFile(
 	int	rtStatus = _SUCCESS;
 	struct hal_data_8192du	*pHalData = GET_HAL_DATA(adapter);
 	struct dm_priv	*pdmpriv = &pHalData->dmpriv;
-#ifndef CONFIG_EMBEDDED_FWIMG
-	u8	*pszRadioAFile = NULL;
-	u8	*pszRadioBFile = NULL;
-#endif
 	static s8		sz92DRadioAFile[] = RTL8192D_PHY_RADIO_A;
 	static s8		sz92DRadioBFile[] = RTL8192D_PHY_RADIO_B;
 	static s8		sz92DRadioAintPAFile[] = RTL8192D_PHY_RADIO_A_intPA;
@@ -587,18 +583,6 @@ phy_RF6052_Config_ParaFile(
 	bool		bTrueBPath = false;/* vivi added this for read parameter from header, 20100908 */
 	u32	MaskforPhySet = 0; /* For 92d PHY cross access, 88c must set value 0. */
 
-#ifndef CONFIG_EMBEDDED_FWIMG
-	pszRadioAFile = sz92DRadioAFile;
-	pszRadioBFile = sz92DRadioBFile;
-#endif
-
-#ifndef CONFIG_EMBEDDED_FWIMG
-	if (pHalData->InternalPA5G[0])
-		pszRadioAFile = sz92DRadioAintPAFile;
-	if (pHalData->InternalPA5G[1])
-		pszRadioBFile = sz92DRadioBintPAFile;
-#endif
-
 	/* DMDP,MAC0 on G band,MAC1 on A band. */
 	if (pHalData->MacPhyMode92D==DUALMAC_DUALPHY)
 	{
@@ -633,9 +617,6 @@ phy_RF6052_Config_ParaFile(
 		else if (pHalData->interfaceIndex == 1)
 		{
 			/*  MAC0 enabled, only init radia B. */
-#ifndef CONFIG_EMBEDDED_FWIMG
-			pszRadioAFile = pszRadioBFile;
-#endif
 			bTrueBPath = true;  /* vivi added this for read parameter from header, 20100909 */
 		}
 	}
@@ -647,40 +628,28 @@ phy_RF6052_Config_ParaFile(
 	{
 		if (bMac1NeedInitRadioAFirst) /* Mac1 use PHY0 write */
 		{
-			if (eRFPath == RF_PATH_A)
-			{
+			if (eRFPath == RF_PATH_A) {
 				bNeedPowerDownRadioA = true;
 				MaskforPhySet = MAC1_ACCESS_PHY0;
-			}
-			else if (eRFPath == RF_PATH_B)
-			{
+			} else if (eRFPath == RF_PATH_B) {
 				MaskforPhySet = 0;
 				bMac1NeedInitRadioAFirst = false;
 				eRFPath = RF_PATH_A;
 				bTrueBPath = true;
-#ifndef CONFIG_EMBEDDED_FWIMG
-				pszRadioAFile = pszRadioBFile;
-#endif
 				pHalData->NumTotalRFPath = 1;
 			}
 		}
 		else  if (bMac0NeedInitRadioBFirst) /* Mac0 use PHY1 write */
 		{
 			if (eRFPath == RF_PATH_A)
-			{
 				MaskforPhySet = 0;
-			}
 
-			if (eRFPath == RF_PATH_B)
-			{
+			if (eRFPath == RF_PATH_B) {
 				MaskforPhySet = MAC0_ACCESS_PHY1;
 				bMac0NeedInitRadioBFirst = false;
 				bNeedPowerDownRadioB = true;
 				eRFPath = RF_PATH_A;
 				bTrueBPath = true;
-#ifndef CONFIG_EMBEDDED_FWIMG
-				pszRadioAFile = pszRadioBFile;
-#endif
 				pHalData->NumTotalRFPath = 1;
 			}
 		}
@@ -716,30 +685,21 @@ phy_RF6052_Config_ParaFile(
 		rtw_udelay_os(1);/* PlatformStallExecution(1); */
 
 		/*----Initialize RF fom connfiguration file----*/
-		switch (eRFPath)
-		{
-			case RF_PATH_A:
-#ifdef CONFIG_EMBEDDED_FWIMG
-				/* vivi added this for read parameter from header, 20100908 */
-				if (bTrueBPath == true)
-					rtStatus = rtl8192d_PHY_ConfigRFWithHeaderFile(adapter,radiob_txt|MaskforPhySet, (enum RF_RADIO_PATH_E)eRFPath);
-				else
-					rtStatus = rtl8192d_PHY_ConfigRFWithHeaderFile(adapter,radioa_txt|MaskforPhySet, (enum RF_RADIO_PATH_E)eRFPath);
-#else
-				rtStatus = rtl8192d_PHY_ConfigRFWithParaFile(adapter, pszRadioAFile, (enum RF_RADIO_PATH_E)eRFPath);
-#endif
-				break;
-			case RF_PATH_B:
-#ifdef CONFIG_EMBEDDED_FWIMG
-			rtStatus = rtl8192d_PHY_ConfigRFWithHeaderFile(adapter,radiob_txt, (enum RF_RADIO_PATH_E)eRFPath);
-#else
-			rtStatus = rtl8192d_PHY_ConfigRFWithParaFile(adapter, pszRadioBFile, (enum RF_RADIO_PATH_E)eRFPath);
-#endif
-				break;
-			case RF_PATH_C:
-				break;
-			case RF_PATH_D:
-				break;
+		switch (eRFPath) {
+		case RF_PATH_A:
+			/* vivi added this for read parameter from header, 20100908 */
+			if (bTrueBPath == true)
+				rtStatus = rtl8192d_PHY_ConfigRFWithHeaderFile(adapter,radiob_txt|MaskforPhySet, (enum RF_RADIO_PATH_E)eRFPath);
+			else
+				rtStatus = rtl8192d_PHY_ConfigRFWithHeaderFile(adapter,radioa_txt|MaskforPhySet, (enum RF_RADIO_PATH_E)eRFPath);
+			break;
+		case RF_PATH_B:
+		rtStatus = rtl8192d_PHY_ConfigRFWithHeaderFile(adapter,radiob_txt, (enum RF_RADIO_PATH_E)eRFPath);
+			break;
+		case RF_PATH_C:
+			break;
+		case RF_PATH_D:
+			break;
 		}
 
 		/*----Restore RFENV control type----*/;
--- a/drivers/staging/rtl8192du/include/autoconf.h
+++ b/drivers/staging/rtl8192du/include/autoconf.h
@@ -34,8 +34,6 @@
 /* define CONFIG_PWRCTRL	1 */
 /* define CONFIG_H2CLBK	1 */
 
-#define CONFIG_EMBEDDED_FWIMG	1
-
 #ifdef CONFIG_WAKE_ON_WLAN
 #define CONFIG_WOWLAN 1
 #endif /* CONFIG_WAKE_ON_WLAN */
