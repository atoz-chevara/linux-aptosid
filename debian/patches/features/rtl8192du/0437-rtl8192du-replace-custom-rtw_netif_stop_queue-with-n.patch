From 714b6dde9bcebcb1e21ca1c378cfd1cbbf5ff94f Mon Sep 17 00:00:00 2001
From: Stefan Lippers-Hollmann <s.l-h@gmx.de>
Date: Sat, 22 Mar 2014 03:03:35 +0100
Subject: [PATCH 437/456] rtl8192du: replace custom rtw_netif_stop_queue() with
 netif_tx_stop_all_queues()

Signed-off-by: Stefan Lippers-Hollmann <s.l-h@gmx.de>
---
 include/osdep_service.h | 6 ------
 os_dep/os_intfs.c       | 8 ++++----
 os_dep/usb_intf.c       | 2 +-
 3 files changed, 5 insertions(+), 11 deletions(-)

--- a/drivers/staging/rtl8192du/include/osdep_service.h
+++ b/drivers/staging/rtl8192du/include/osdep_service.h
@@ -120,12 +120,6 @@ static inline int rtw_netif_queue_stoppe
 		netif_tx_queue_stopped(netdev_get_tx_queue(pnetdev, 3));
 }
 
-static inline void rtw_netif_stop_queue(struct net_device *pnetdev)
-{
-	netif_tx_stop_all_queues(pnetdev);
-}
-
-
 #ifndef BIT
 	#define BIT(x)	(1 << (x))
 #endif
--- a/drivers/staging/rtl8192du/os_dep/os_intfs.c
+++ b/drivers/staging/rtl8192du/os_dep/os_intfs.c
@@ -794,7 +794,7 @@ netdev_if2_open_error:
 	padapter->bup = false;
 
 	netif_carrier_off(pnetdev);
-	rtw_netif_stop_queue(pnetdev);
+	netif_tx_stop_all_queues(pnetdev);
 
 	return (-1);
 }
@@ -817,7 +817,7 @@ static int netdev_if2_close(struct net_d
 	padapter->net_closed = true;
 	if (pnetdev) {
 		if (!rtw_netif_queue_stopped(pnetdev))
-			rtw_netif_stop_queue(pnetdev);
+			netif_tx_stop_all_queues(pnetdev);
 	}
 	rtw_scan_abort(padapter);
 	return 0;
@@ -1096,7 +1096,7 @@ netdev_open_error:
 	padapter->bup = false;
 
 	netif_carrier_off(pnetdev);
-	rtw_netif_stop_queue(pnetdev);
+	netif_tx_stop_all_queues(pnetdev);
 
 	RT_TRACE(_module_os_intfs_c_, _drv_err_, ("-871x_drv - dev_open, fail!\n"));
 	DBG_8192D("-871x_drv - drv_open fail, bup =%d\n", padapter->bup);
@@ -1221,7 +1221,7 @@ static int netdev_close(struct net_devic
 		/* s1. */
 		if (pnetdev) {
 			if (!rtw_netif_queue_stopped(pnetdev))
-				rtw_netif_stop_queue(pnetdev);
+				netif_tx_stop_all_queues(pnetdev);
 		}
 
 		/* s2. */
--- a/drivers/staging/rtl8192du/os_dep/usb_intf.c
+++ b/drivers/staging/rtl8192du/os_dep/usb_intf.c
@@ -398,7 +398,7 @@ static int rtw_suspend(struct usb_interf
 	if (pnetdev)
 	{
 		netif_carrier_off(pnetdev);
-		rtw_netif_stop_queue(pnetdev);
+		netif_tx_stop_all_queues(pnetdev);
 	}
 #ifdef CONFIG_WAKE_ON_WLAN
 	if (padapter->pwrctrlpriv.bSupportRemoteWakeup==true&&padapter->pwrctrlpriv.wowlan_mode==true) {
