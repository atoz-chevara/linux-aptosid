From b8a587e47aebb5a585f97a2324a5f0c90e26dab6 Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Sun, 28 Apr 2013 12:41:02 -0500
Subject: [PATCH 077/210] Remove typedef for _timer

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 include/osdep_intf.h    |  2 +-
 include/osdep_service.h | 25 ++++++++++---------------
 include/rtw_led.h       |  2 +-
 include/rtw_mlme.h      | 30 +++++++++++++++---------------
 include/rtw_mlme_ext.h  |  7 ++-----
 include/rtw_pwrctrl.h   |  2 +-
 include/rtw_recv.h      |  4 ++--
 include/rtw_security.h  |  2 +-
 include/sta_info.h      | 16 ++++++++--------
 9 files changed, 41 insertions(+), 49 deletions(-)

--- a/drivers/staging/rtl8192du/include/osdep_intf.h
+++ b/drivers/staging/rtl8192du/include/osdep_intf.h
@@ -56,7 +56,7 @@ The protection mechanism is through the
 	u8 io_irp_cnt;
 	u8 bio_irp_pending;
 	struct  semaphore io_retevt;
-	_timer	io_timer;
+	struct timer_list io_timer;
 	u8 bio_irp_timeout;
 	u8 bio_timer_cancel;
 };
--- a/drivers/staging/rtl8192du/include/osdep_service.h
+++ b/drivers/staging/rtl8192du/include/osdep_service.h
@@ -40,7 +40,6 @@
 #if (LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,5))
 	#include <linux/kref.h>
 #endif
-	//#include <linux/smp_lock.h>
 	#include <linux/netdevice.h>
 	#include <linux/skbuff.h>
 	#include <linux/circ_buf.h>
@@ -90,14 +89,11 @@
 #endif
 #endif
 
-//	typedef	spinlock_t	_lock;
 #if (LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,37))
 	typedef struct mutex		_mutex;
 #else
 	typedef struct semaphore	_mutex;
 #endif
-	typedef struct timer_list _timer;
-
 	struct	__queue	{
 		struct	list_head	queue;
 		spinlock_t	lock;
@@ -186,22 +182,21 @@ static inline void rtw_list_delete(_list
 	list_del_init(plist);
 }
 
-static inline void _init_timer(_timer *ptimer,_nic_hdl nic_hdl,void *pfunc,void* cntx)
+static inline void _init_timer(struct timer_list *timer,_nic_hdl nic_hdl,void *pfunc,void* cntx)
 {
-	//setup_timer(ptimer, pfunc,(u32)cntx);
-	ptimer->function = pfunc;
-	ptimer->data = (unsigned long)cntx;
-	init_timer(ptimer);
+	timer->function = pfunc;
+	timer->data = (unsigned long)cntx;
+	init_timer(timer);
 }
 
-static inline void _set_timer(_timer *ptimer,u32 delay_time)
+static inline void _set_timer(struct timer_list *timer,u32 delay_time)
 {
-	mod_timer(ptimer , (jiffies+(delay_time*HZ/1000)));
+	mod_timer(timer , (jiffies+(delay_time*HZ/1000)));
 }
 
-static inline void _cancel_timer(_timer *ptimer,u8 *bcancelled)
+static inline void _cancel_timer(struct timer_list *timer,u8 *bcancelled)
 {
-	del_timer_sync(ptimer);
+	del_timer_sync(timer);
 	*bcancelled=  true;
 }
 
@@ -415,9 +410,9 @@ extern void	rtw_udelay_os(int us);
 extern void rtw_yield_os(void);
 
 
-static inline unsigned char _cancel_timer_ex(_timer *ptimer)
+static inline unsigned char _cancel_timer_ex(struct timer_list *timer)
 {
-	return del_timer_sync(ptimer);
+	return del_timer_sync(timer);
 }
 
 static __inline void thread_enter(char *name)
--- a/drivers/staging/rtl8192du/include/rtw_led.h
+++ b/drivers/staging/rtl8192du/include/rtw_led.h
@@ -95,7 +95,7 @@ struct LED_871X {
 	u32					BlinkTimes; // Number of times to toggle led state for blinking.
 	enum LED_STATE_871X		BlinkingLedState; // Next state for blinking, either RTW_LED_ON or RTW_LED_OFF are.
 
-	_timer				BlinkTimer; // Timer object for led blinking.
+	struct timer_list		BlinkTimer; // Timer object for led blinking.
 #if LINUX_VERSION_CODE > KERNEL_VERSION(2,5,0)
 	_workitem			BlinkWorkItem; // Workitem used by BlinkTimer to manipulate H/W to blink LED.
 #endif
--- a/drivers/staging/rtl8192du/include/rtw_mlme.h
+++ b/drivers/staging/rtl8192du/include/rtw_mlme.h
@@ -151,7 +151,7 @@ struct sitesurvey_ctrl {
 	u64	last_tx_pkts;
 	uint	last_rx_pkts;
 	int	traffic_busy;
-	_timer	sitesurvey_ctrl_timer;
+	struct timer_list sitesurvey_ctrl_timer;
 };
 
 typedef struct _RT_LINK_DETECT_T{
@@ -246,27 +246,27 @@ struct scan_limit_info{
 
 #ifdef CONFIG_IOCTL_CFG80211
 struct cfg80211_wifidirect_info{
-	_timer					remain_on_ch_timer;
-	u8						restore_channel;
+	struct timer_list		remain_on_ch_timer;
+	u8				restore_channel;
 	struct ieee80211_channel	remain_on_ch_channel;
 	enum nl80211_channel_type	remain_on_ch_type;
-	u64						remain_on_ch_cookie;
+	u64				remain_on_ch_cookie;
 	bool is_ro_ch;
 };
 #endif //CONFIG_IOCTL_CFG80211
 
 struct wifidirect_info{
 	_adapter*				padapter;
-	_timer					find_phase_timer;
-	_timer					restore_p2p_state_timer;
+	struct timer_list			find_phase_timer;
+	struct timer_list			restore_p2p_state_timer;
 
 	//	Used to do the scanning. After confirming the peer is availalble, the driver transmits the P2P frame to peer.
-	_timer					pre_tx_scan_timer;
-	_timer					reset_ch_sitesurvey;
-	_timer					reset_ch_sitesurvey2;	//	Just for resetting the scan limit function by using p2p nego
+	struct timer_list			pre_tx_scan_timer;
+	struct timer_list			reset_ch_sitesurvey;
+	struct timer_list			reset_ch_sitesurvey2;	//	Just for resetting the scan limit function by using p2p nego
 #ifdef CONFIG_CONCURRENT_MODE
 	//	Used to switch the channel between legacy AP and listen state.
-	_timer					ap_p2p_switch_timer;
+	struct timer_list			ap_p2p_switch_timer;
 #endif
 	struct tx_provdisc_req_info	tx_prov_disc_info;
 	struct rx_provdisc_req_info rx_prov_disc_info;
@@ -404,16 +404,16 @@ struct mlme_priv {
 
 	u32	scan_interval;
 
-	_timer assoc_timer;
+	struct timer_list assoc_timer;
 
 	uint assoc_by_bssid;
 	uint assoc_by_rssi;
 
-	_timer scan_to_timer; // driver itself handles scan_timeout status.
+	struct timer_list scan_to_timer; // driver itself handles scan_timeout status.
 	u32 scan_start_time; // used to evaluate the time spent in scanning
 
 	#ifdef CONFIG_SET_SCAN_DENY_TIMER
-	_timer set_scan_deny_timer;
+	struct timer_list set_scan_deny_timer;
 	ATOMIC_T set_scan_deny; //0: allowed, 1: deny
 	#endif
 
@@ -435,7 +435,7 @@ struct mlme_priv {
 #endif
 
 	RT_LINK_DETECT_T	LinkDetectInfo;
-	_timer	dynamic_chk_timer; //dynamic/periodic check timer
+	struct timer_list dynamic_chk_timer; //dynamic/periodic check timer
 
 	u8	key_mask; //use for ips to set wep key after ips_leave
 	u8	acm_mask; // for wmm acm mask
@@ -540,7 +540,7 @@ struct mlme_priv {
 #ifdef CONFIG_INTEL_WIDI
 	int	widi_state;
 	int	listen_state;
-	_timer	listen_timer;
+	struct timer_list listen_timer;
 	ATOMIC_T	rx_probe_rsp; // 1:receive probe respone from RDS source.
 	u8	*l2sdTaBuffer;
 	u8	channel_idx;
--- a/drivers/staging/rtl8192du/include/rtw_mlme_ext.h
+++ b/drivers/staging/rtl8192du/include/rtw_mlme_ext.h
@@ -468,9 +468,8 @@ struct mlme_ext_priv
 	struct ss_res		sitesurvey_res;
 	struct mlme_ext_info	mlmext_info;//for sta/adhoc mode, including current scanning/connecting/connected related info.
                                                      //for ap mode, network includes ap's cap_info
-	_timer		survey_timer;
-	_timer		link_timer;
-	//_timer		ADDBA_timer;
+	struct timer_list survey_timer;
+	struct timer_list link_timer;
 	u16			chan_scan_time;
 
 	u8	scan_abort;
@@ -676,8 +675,6 @@ void linked_status_chk(_adapter *padapte
 void survey_timer_hdl (_adapter *padapter);
 void link_timer_hdl (_adapter *padapter);
 void addba_timer_hdl(struct sta_info *psta);
-//void reauth_timer_hdl(_adapter *padapter);
-//void reassoc_timer_hdl(_adapter *padapter);
 
 #define set_survey_timer(mlmeext, ms) \
 	do { \
--- a/drivers/staging/rtl8192du/include/rtw_pwrctrl.h
+++ b/drivers/staging/rtl8192du/include/rtw_pwrctrl.h
@@ -226,7 +226,7 @@ struct pwrctrl_priv
 	u8		wowlan_pattern_idx;
 	u32		wowlan_pattern_context[8][5];
 #endif // CONFIG_WOWLAN
-	_timer	pwr_state_check_timer;
+	struct timer_list pwr_state_check_timer;
 	int		pwr_state_check_interval;
 	u8		pwr_state_check_cnts;
 
--- a/drivers/staging/rtl8192du/include/rtw_recv.h
+++ b/drivers/staging/rtl8192du/include/rtw_recv.h
@@ -62,7 +62,7 @@ struct recv_reorder_ctrl
 	u16 wend_b;
 	u8 wsize_b;
 	_queue pending_recvframe_queue;
-	_timer reordering_ctrl_timer;
+	struct timer_list reordering_ctrl_timer;
 };
 
 struct	stainfo_rxcache	{
@@ -258,7 +258,7 @@ struct recv_priv {
 	int falsealmcnt_all;
 
 #ifdef CONFIG_NEW_SIGNAL_STAT_PROCESS
-	_timer signal_stat_timer;
+	struct timer_list signal_stat_timer;
 	u32 signal_stat_sampling_interval;
 	//u32 signal_stat_converging_constant;
 	struct signal_stat signal_qual_data;
--- a/drivers/staging/rtl8192du/include/rtw_security.h
+++ b/drivers/staging/rtl8192du/include/rtw_security.h
@@ -131,7 +131,7 @@ struct security_priv
 
 	u8	binstallGrpkey;
 	u8	busetkipkey;
-	//_timer tkip_timer;
+	//struct timer_list tkip_timer;
 	u8	bcheck_grpkey;
 	u8	bgrpkey_handshake;
 
--- a/drivers/staging/rtl8192du/include/sta_info.h
+++ b/drivers/staging/rtl8192du/include/sta_info.h
@@ -142,7 +142,7 @@ struct sta_info {
 	u8	ANonce[32];
 	u32	TDLS_PeerKey_Lifetime;
 	u16	TPK_count;
-	_timer	TPK_timer;
+	struct timer_list TPK_timer;
 	struct TDLS_PeerKey	tpk;
 	_adapter *padapter;
 	u16	stat_code;
@@ -150,19 +150,19 @@ struct sta_info {
 	u16	ch_switch_time;
 	u16	ch_switch_timeout;
 	u8	option;
-	_timer	option_timer;
-	_timer	base_ch_timer;
-	_timer	off_ch_timer;
+	struct timer_list option_timer;
+	struct timer_list base_ch_timer;
+	struct timer_list off_ch_timer;
 
-	_timer handshake_timer;
-	_timer alive_timer1;
-	_timer alive_timer2;
+	struct timer_list handshake_timer;
+	struct timer_list alive_timer1;
+	struct timer_list alive_timer2;
 	u8 timer_flag;
 	u8 alive_count;
 #endif //CONFIG_TDLS
 
 	//for A-MPDU TX, ADDBA timeout check
-	_timer addba_retry_timer;
+	struct timer_list addba_retry_timer;
 
 	//for A-MPDU Rx reordering buffer control
 	struct recv_reorder_ctrl recvreorder_ctrl[16];
