From 217b61ad7f71b2cab3c5b585d31f83001ad5dd75 Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Wed, 17 Apr 2013 14:48:46 -0500
Subject: [PATCH 016/210] Remove dead code due to PLATFORM cinfiguration and
 delete 2 unused files

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 Makefile                  |   1 -
 core/rtw_ioctl_query.c    | 195 ----------------------------------------------
 include/ip.h              |   3 -
 include/osdep_intf.h      |  33 --------
 include/rtl8192d_recv.h   |  55 +------------
 include/rtw_byteorder.h   |   3 -
 include/rtw_ioctl_query.h |  35 ---------
 include/swab.h            |  29 +++----
 os_dep/ioctl_cfg80211.c   |   1 -
 os_dep/ioctl_linux.c      |   1 -
 10 files changed, 10 insertions(+), 346 deletions(-)
 delete mode 100644 core/rtw_ioctl_query.c
 delete mode 100644 include/rtw_ioctl_query.h

--- a/drivers/staging/rtl8192du/Makefile
+++ b/drivers/staging/rtl8192du/Makefile
@@ -171,7 +171,6 @@ rtk_core :=	core/rtw_cmd.o \
 		core/rtw_security.o \
 		core/rtw_debug.o \
 		core/rtw_io.o \
-		core/rtw_ioctl_query.o \
 		core/rtw_ioctl_set.o \
 		core/rtw_ieee80211.o \
 		core/rtw_mlme.o \
--- a/drivers/staging/rtl8192du/core/rtw_ioctl_query.c
+++ /dev/null
@@ -1,195 +0,0 @@
-/******************************************************************************
- *
- * Copyright(c) 2007 - 2011 Realtek Corporation. All rights reserved.
- *
- * This program is free software; you can redistribute it and/or modify it
- * under the terms of version 2 of the GNU General Public License as
- * published by the Free Software Foundation.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT
- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
- * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
- * more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, write to the Free Software Foundation, Inc.,
- * 51 Franklin Street, Fifth Floor, Boston, MA 02110, USA
- *
- *
- ******************************************************************************/
-#define _RTW_IOCTL_QUERY_C_
-
-#include <drv_conf.h>
-#include <osdep_service.h>
-#include <drv_types.h>
-#include <rtw_ioctl_query.h>
-#include <wifi.h>
-
-
-#ifdef PLATFORM_WINDOWS
-//
-// Added for WPA2-PSK, by Annie, 2005-09-20.
-//
-u8
-query_802_11_capability(
-	_adapter*		Adapter,
-	u8*			pucBuf,
-	u32 *		pulOutLen
-)
-{
-	static NDIS_802_11_AUTHENTICATION_ENCRYPTION szAuthEnc[] =
-	{
-		{Ndis802_11AuthModeOpen, Ndis802_11EncryptionDisabled},
-		{Ndis802_11AuthModeOpen, Ndis802_11Encryption1Enabled},
-		{Ndis802_11AuthModeShared, Ndis802_11EncryptionDisabled},
-		{Ndis802_11AuthModeShared, Ndis802_11Encryption1Enabled},
-		{Ndis802_11AuthModeWPA, Ndis802_11Encryption2Enabled},
-		{Ndis802_11AuthModeWPA, Ndis802_11Encryption3Enabled},
-		{Ndis802_11AuthModeWPAPSK, Ndis802_11Encryption2Enabled},
-		{Ndis802_11AuthModeWPAPSK, Ndis802_11Encryption3Enabled},
-		{Ndis802_11AuthModeWPANone, Ndis802_11Encryption2Enabled},
-		{Ndis802_11AuthModeWPANone, Ndis802_11Encryption3Enabled},
-		{Ndis802_11AuthModeWPA2, Ndis802_11Encryption2Enabled},
-		{Ndis802_11AuthModeWPA2, Ndis802_11Encryption3Enabled},
-		{Ndis802_11AuthModeWPA2PSK, Ndis802_11Encryption2Enabled},
-		{Ndis802_11AuthModeWPA2PSK, Ndis802_11Encryption3Enabled}
-	};
-	static ULONG	ulNumOfPairSupported = sizeof(szAuthEnc)/sizeof(NDIS_802_11_AUTHENTICATION_ENCRYPTION);
-	NDIS_802_11_CAPABILITY * pCap = (NDIS_802_11_CAPABILITY *)pucBuf;
-	u8*	pucAuthEncryptionSupported = (u8*) pCap->AuthenticationEncryptionSupported;
-
-
-	pCap->Length = sizeof(NDIS_802_11_CAPABILITY);
-	if(ulNumOfPairSupported > 1 )
-		pCap->Length +=		(ulNumOfPairSupported-1) * sizeof(NDIS_802_11_AUTHENTICATION_ENCRYPTION);
-
-	pCap->Version = 2;
-	pCap->NoOfPMKIDs = NUM_PMKID_CACHE;
-	pCap->NoOfAuthEncryptPairsSupported = ulNumOfPairSupported;
-
-	if( sizeof (szAuthEnc) <= 240 )		// 240 = 256 - 4*4	// SecurityInfo.szCapability: only 256 bytes in size.
-	{
-		_rtw_memcpy( pucAuthEncryptionSupported, (u8*)szAuthEnc,  sizeof (szAuthEnc) );
-		*pulOutLen = pCap->Length;
-		return _TRUE;
-	}
-	else
-	{
-		*pulOutLen = 0;
-		RT_TRACE(_module_rtl871x_ioctl_query_c_,_drv_info_,("_query_802_11_capability(): szAuthEnc size is too large.\n"));
-		return _FALSE;
-	}
-}
-
-u8 query_802_11_association_information(	_adapter *padapter,PNDIS_802_11_ASSOCIATION_INFORMATION	pAssocInfo)
-{
-	struct wlan_network *tgt_network;
-	struct	mlme_priv	*pmlmepriv = &(padapter->mlmepriv);
-	struct	security_priv  *psecuritypriv=&(padapter->securitypriv);
-	WLAN_BSSID_EX	*psecnetwork=(WLAN_BSSID_EX*)&(psecuritypriv->sec_bss);
-	u8 *	pDest = (u8 *)pAssocInfo + sizeof(NDIS_802_11_ASSOCIATION_INFORMATION);
-	unsigned char i,*auth_ie,*supp_ie;
-
-	//NdisZeroMemory(pAssocInfo, sizeof(NDIS_802_11_ASSOCIATION_INFORMATION));
-	_rtw_memset(pAssocInfo, 0, sizeof(NDIS_802_11_ASSOCIATION_INFORMATION));
-	//pAssocInfo->Length = sizeof(NDIS_802_11_ASSOCIATION_INFORMATION);
-
-	//------------------------------------------------------
-	// Association Request related information
-	//------------------------------------------------------
-	// Req_1. AvailableRequestFixedIEs
-	if(psecnetwork!=NULL){
-
-	pAssocInfo->AvailableRequestFixedIEs |= NDIS_802_11_AI_REQFI_CAPABILITIES|NDIS_802_11_AI_REQFI_CURRENTAPADDRESS;
-	pAssocInfo->RequestFixedIEs.Capabilities = (unsigned short)* & psecnetwork->IEs[10];
-	_rtw_memcpy(pAssocInfo->RequestFixedIEs.CurrentAPAddress,
-		& psecnetwork->MacAddress, 6);
-
-	pAssocInfo->OffsetRequestIEs = sizeof(NDIS_802_11_ASSOCIATION_INFORMATION);
-
-	if(check_fwstate( pmlmepriv, _FW_UNDER_LINKING|_FW_LINKED)==_TRUE)
-	{
-
-		if(psecuritypriv->ndisauthtype>=Ndis802_11AuthModeWPA2)
-			pDest[0] =48;		//RSN Information Element
-		else
-			pDest[0] =221;	//WPA(SSN) Information Element
-
-		RT_TRACE(_module_rtl871x_ioctl_query_c_,_drv_info_,("\n Adapter->ndisauthtype==Ndis802_11AuthModeWPA)?0xdd:0x30 [%d]",pDest[0]));
-		supp_ie=&psecuritypriv->supplicant_ie[0];
-		for(i=0;i<supp_ie[0];i++)
-		{
-			RT_TRACE(_module_rtl871x_ioctl_query_c_,_drv_info_,("IEs [%d] = 0x%x \n\n", i,supp_ie[i]));
-		}
-
-		i=13;	//0~11 is fixed information element
-		RT_TRACE(_module_rtl871x_ioctl_query_c_,_drv_info_,("i= %d tgt_network->network.IELength=%d\n\n", i,(int)psecnetwork->IELength));
-		while((i<supp_ie[0]) && (i<256)){
-			if((unsigned char)supp_ie[i]==pDest[0]){
-						_rtw_memcpy((u8 *)(pDest),
-							&supp_ie[i],
-							supp_ie[1+i]+2);
-
-				break;
-			}
-
-			i=i+supp_ie[i+1]+2;
-			if(supp_ie[1+i]==0)
-				i=i+1;
-			RT_TRACE(_module_rtl871x_ioctl_query_c_,_drv_info_,("iteration i=%d IEs [%d] = 0x%x \n\n", i,i,supp_ie[i+1]));
-
-		}
-
-
-		pAssocInfo->RequestIELength += (2 + supp_ie[1+i]);// (2 + psecnetwork->IEs[1+i]+4);
-
-	}
-
-
-		RT_TRACE(_module_rtl871x_ioctl_query_c_,_drv_info_,("\n psecnetwork != NULL,fwstate==_FW_UNDER_LINKING \n"));
-
-	}
-
-
-	//------------------------------------------------------
-	// Association Response related information
-	//------------------------------------------------------
-
-	if(check_fwstate( pmlmepriv, _FW_LINKED)==_TRUE)
-	{
-		tgt_network =&(pmlmepriv->cur_network);
-		if(tgt_network!=NULL){
-		pAssocInfo->AvailableResponseFixedIEs =
-				NDIS_802_11_AI_RESFI_CAPABILITIES
-				|NDIS_802_11_AI_RESFI_ASSOCIATIONID
-				;
-
-		pAssocInfo->ResponseFixedIEs.Capabilities =(unsigned short)* & tgt_network->network.IEs[10];
-		pAssocInfo->ResponseFixedIEs.StatusCode = 0;
-		pAssocInfo->ResponseFixedIEs.AssociationId =(unsigned short) tgt_network->aid;
-
-		pDest = (u8 *)pAssocInfo + sizeof(NDIS_802_11_ASSOCIATION_INFORMATION)+pAssocInfo->RequestIELength;
-		auth_ie=&psecuritypriv->authenticator_ie[0];
-
-		for(i=0;i<auth_ie[0];i++)
-			RT_TRACE(_module_rtl871x_ioctl_query_c_,_drv_info_,("IEs [%d] = 0x%x \n\n", i,auth_ie[i]));
-
-		i=auth_ie[0]-12;
-		if(i>0){
-			_rtw_memcpy((u8 *)&pDest[0],&auth_ie[1],i);
-			pAssocInfo->ResponseIELength =i;
-		}
-
-
-		pAssocInfo->OffsetResponseIEs = sizeof(NDIS_802_11_ASSOCIATION_INFORMATION) + pAssocInfo->RequestIELength;
-
-
-		RT_TRACE(_module_rtl871x_ioctl_query_c_,_drv_info_,("\n tgt_network != NULL,fwstate==_FW_LINKED \n"));
-		}
-	}
-	RT_TRACE(_module_rtl871x_ioctl_query_c_,_drv_info_,("\n exit query_802_11_association_information \n"));
-_func_exit_;
-
-	return _TRUE;
-}
-#endif
--- a/drivers/staging/rtl8192du/include/ip.h
+++ b/drivers/staging/rtl8192du/include/ip.h
@@ -91,8 +91,6 @@
 #define	IPOPT_TS_TSANDADDR	1		/* timestamps and addresses */
 #define	IPOPT_TS_PRESPEC	3		/* specified modules only */
 
-#ifdef PLATFORM_LINUX
-
 struct ip_options {
   __u32		faddr;				/* Saved first hop address */
   unsigned char	optlen;
@@ -114,7 +112,6 @@ struct ip_options {
 };
 
 #define optlength(opt) (sizeof(struct ip_options) + opt->optlen)
-#endif
 
 struct iphdr {
 #if defined(__LITTLE_ENDIAN_BITFIELD)
--- a/drivers/staging/rtl8192du/include/osdep_intf.h
+++ b/drivers/staging/rtl8192du/include/osdep_intf.h
@@ -50,9 +50,6 @@ The protection mechanism is through the
 
 	_mutex ioctl_mutex;
 
-
-#ifdef PLATFORM_LINUX
-	#ifdef CONFIG_USB_HCI
 	// when in USB, IO is through interrupt in/out endpoints
 	struct usb_device	*udev;
 	PURB	piorw_urb;
@@ -62,29 +59,6 @@ The protection mechanism is through the
 	_timer	io_timer;
 	u8 bio_irp_timeout;
 	u8 bio_timer_cancel;
-	#endif
-#endif
-
-#ifdef PLATFORM_OS_XP
-	#ifdef CONFIG_SDIO_HCI
-		// below is for io_rwmem...
-		PMDL pmdl;
-		PSDBUS_REQUEST_PACKET  sdrp;
-		PSDBUS_REQUEST_PACKET  recv_sdrp;
-		PSDBUS_REQUEST_PACKET  xmit_sdrp;
-
-			PIRP		piorw_irp;
-
-	#endif
-	#ifdef CONFIG_USB_HCI
-		PURB	piorw_urb;
-		PIRP		piorw_irp;
-		u8 io_irp_cnt;
-		u8 bio_irp_pending;
-		_sema io_retevt;
-	#endif
-#endif
-
 };
 
 
@@ -101,7 +75,6 @@ u32 rtw_start_drv_threads(_adapter *pada
 void rtw_stop_drv_threads (_adapter *padapter);
 void rtw_cancel_all_timer(_adapter *padapter);
 
-#ifdef PLATFORM_LINUX
 int rtw_ioctl(struct net_device *dev, struct ifreq *rq, int cmd);
 
 int rtw_init_netdev_name(struct net_device *pnetdev, const char *ifname);
@@ -118,12 +91,6 @@ void rtw_proc_remove_one(struct net_devi
 static void rtw_proc_init_one(struct net_device *dev){}
 static void rtw_proc_remove_one(struct net_device *dev){}
 #endif //!CONFIG_PROC_DEBUG
-#endif //PLATFORM_LINUX
-
-
-#ifdef PLATFORM_FREEBSD
-extern int rtw_ioctl(struct ifnet * ifp, u_long cmd, caddr_t data);
-#endif
 
 void rtw_ips_dev_unload(_adapter *padapter);
 #ifdef CONFIG_IPS
--- a/drivers/staging/rtl8192du/include/rtl8192d_recv.h
+++ b/drivers/staging/rtl8192du/include/rtl8192d_recv.h
@@ -25,63 +25,18 @@
 #include <drv_types.h>
 
 
-#ifdef PLATFORM_OS_XP
-	#ifdef CONFIG_SDIO_HCI
-		#define NR_RECVBUFF 1024//512//128
-	#else
-		#define NR_RECVBUFF (16)
-	#endif
-#elif defined(PLATFORM_OS_CE)
-	#ifdef CONFIG_SDIO_HCI
-		#define NR_RECVBUFF (128)
-	#else
-		#define NR_RECVBUFF (4)
-	#endif
-#else
 #ifdef CONFIG_SINGLE_RECV_BUF
 	#define NR_RECVBUFF (1)
 #else
 	#define NR_RECVBUFF (4)
 #endif //CONFIG_SINGLE_RECV_BUF
 	#define NR_PREALLOC_RECV_SKB (8)
-#endif
-
-
 
 #define RECV_BLK_SZ 512
 #define RECV_BLK_CNT 16
 #define RECV_BLK_TH RECV_BLK_CNT
 
-#if defined(CONFIG_USB_HCI)
-
-#ifdef PLATFORM_OS_CE
 #define MAX_RECVBUF_SZ (8192+1024) // 8K+1k
-#else
-	#ifndef CONFIG_MINIMAL_MEMORY_USAGE
-		//#define MAX_RECVBUF_SZ (32768) // 32k
-		//#define MAX_RECVBUF_SZ (16384) //16K
-		//#define MAX_RECVBUF_SZ (10240) //10K
-		#ifdef CONFIG_PLATFORM_MSTAR_TITANIA12
-			#define MAX_RECVBUF_SZ (8192) // 8K
-		#else
-			#define MAX_RECVBUF_SZ (15360) // 15k < 16k
-		#endif
-	#else
-		#define MAX_RECVBUF_SZ (4000) // about 4K
-	#endif
-#endif
-
-#elif defined(CONFIG_PCI_HCI)
-//#ifndef CONFIG_MINIMAL_MEMORY_USAGE
-//	#define MAX_RECVBUF_SZ (9100)
-//#else
-	#define MAX_RECVBUF_SZ (4000) // about 4K
-//#endif
-
-#define RX_MPDU_QUEUE				0
-#define RX_CMD_QUEUE				1
-#define RX_MAX_QUEUE				2
-#endif
 
 #define RECV_BULK_IN_ADDR		0x80
 #define RECV_INT_IN_ADDR		0x81
@@ -89,22 +44,14 @@
 #define PHY_RSSI_SLID_WIN_MAX				100
 #define PHY_LINKQUALITY_SLID_WIN_MAX		20
 
-struct phy_stat
-{
+struct phy_stat {
 	unsigned int phydw0;
-
 	unsigned int phydw1;
-
 	unsigned int phydw2;
-
 	unsigned int phydw3;
-
 	unsigned int phydw4;
-
 	unsigned int phydw5;
-
 	unsigned int phydw6;
-
 	unsigned int phydw7;
 };
 
--- a/drivers/staging/rtl8192du/include/rtw_byteorder.h
+++ b/drivers/staging/rtl8192du/include/rtw_byteorder.h
@@ -27,9 +27,6 @@
 #endif
 
 #if defined (CONFIG_LITTLE_ENDIAN)
-#ifndef CONFIG_PLATFORM_MSTAR389
-#  include <little_endian.h>
-#endif
 #elif defined (CONFIG_BIG_ENDIAN)
 #  include <big_endian.h>
 #else
--- a/drivers/staging/rtl8192du/include/rtw_ioctl_query.h
+++ /dev/null
@@ -1,35 +0,0 @@
-/******************************************************************************
- *
- * Copyright(c) 2007 - 2011 Realtek Corporation. All rights reserved.
- *
- * This program is free software; you can redistribute it and/or modify it
- * under the terms of version 2 of the GNU General Public License as
- * published by the Free Software Foundation.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT
- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
- * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
- * more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, write to the Free Software Foundation, Inc.,
- * 51 Franklin Street, Fifth Floor, Boston, MA 02110, USA
- *
- *
- ******************************************************************************/
-#ifndef _RTW_IOCTL_QUERY_H_
-#define _RTW_IOCTL_QUERY_H_
-
-#include <drv_conf.h>
-#include <drv_types.h>
-
-
-#ifdef PLATFORM_WINDOWS
-
-u8 query_802_11_capability(_adapter*	padapter,u8*	pucBuf,u32 *	pulOutLen);
-u8 query_802_11_association_information (_adapter * padapter, PNDIS_802_11_ASSOCIATION_INFORMATION pAssocInfo);
-
-#endif
-
-
-#endif
--- a/drivers/staging/rtl8192du/include/swab.h
+++ b/drivers/staging/rtl8192du/include/swab.h
@@ -20,7 +20,6 @@
 #ifndef _LINUX_BYTEORDER_SWAB_H
 #define _LINUX_BYTEORDER_SWAB_H
 
-#if !defined(CONFIG_PLATFORM_MSTAR_TITANIA12)
 #ifndef __u16
 typedef unsigned short __u16;
 #endif
@@ -38,7 +37,7 @@ typedef unsigned long long	__u64;
 #endif
 
 
-__inline static __u16  ___swab16(__u16 x)
+static inline __u16  ___swab16(__u16 x)
 {
 	__u16 __x = x;
 	return
@@ -48,7 +47,7 @@ __inline static __u16  ___swab16(__u16 x
 
 }
 
-__inline static __u32  ___swab32(__u32 x)
+static inline __u32  ___swab32(__u32 x)
 {
 	__u32 __x = (x);
 	return ((__u32)(
@@ -58,7 +57,7 @@ __inline static __u32  ___swab32(__u32 x
 		(((__u32)(__x) & (__u32)0xff000000UL) >> 24) ));
 }
 
-__inline static __u64  ___swab64(__u64 x)
+static inline __u64  ___swab64(__u64 x)
 {
 	__u64 __x = (x);
 
@@ -73,10 +72,9 @@ __inline static __u64  ___swab64(__u64 x
 		(__u64)(((__u64)(__x) & (__u64)0x00ff000000000000ULL) >> 40) | \
 		(__u64)(((__u64)(__x) & (__u64)0xff00000000000000ULL) >> 56) )); \
 }
-#endif // CONFIG_PLATFORM_MSTAR_TITANIA12
 
 #ifndef __arch__swab16
-__inline static __u16 __arch__swab16(__u16 x)
+static inline __u16 __arch__swab16(__u16 x)
 {
 	return ___swab16(x);
 }
@@ -84,7 +82,7 @@ __inline static __u16 __arch__swab16(__u
 #endif
 
 #ifndef __arch__swab32
-__inline static __u32 __arch__swab32(__u32 x)
+static inline __u32 __arch__swab32(__u32 x)
 {
 	__u32 __tmp = (x) ;
 	return ___swab32(__tmp);
@@ -93,7 +91,7 @@ __inline static __u32 __arch__swab32(__u
 
 #ifndef __arch__swab64
 
-__inline static __u64 __arch__swab64(__u64 x)
+static inline __u64 __arch__swab64(__u64 x)
 {
 	__u64 __tmp = (x) ;
 	return ___swab64(__tmp);
@@ -108,24 +106,16 @@ __inline static __u64 __arch__swab64(__u
 #define __swab64(x) __fswab64(x)
 #endif	// __swab16
 
-#ifdef PLATFORM_FREEBSD
-__inline static __u16 __fswab16(__u16 x)
-#else
-__inline static const __u16 __fswab16(__u16 x)
-#endif //PLATFORM_FREEBSD
+static inline const __u16 __fswab16(__u16 x)
 {
 	return __arch__swab16(x);
 }
-#ifdef PLATFORM_FREEBSD
-__inline static __u32 __fswab32(__u32 x)
-#else
-__inline static const __u32 __fswab32(__u32 x)
-#endif //PLATFORM_FREEBSD
+
+static inline const __u32 __fswab32(__u32 x)
 {
 	return __arch__swab32(x);
 }
 
-#if defined(PLATFORM_LINUX) || defined(PLATFORM_WINDOWS)
 #define swab16 __swab16
 #define swab32 __swab32
 #define swab64 __swab64
@@ -135,6 +125,5 @@ __inline static const __u32 __fswab32(__
 #define swab16s __swab16s
 #define swab32s __swab32s
 #define swab64s __swab64s
-#endif
 
 #endif /* _LINUX_BYTEORDER_SWAB_H */
--- a/drivers/staging/rtl8192du/os_dep/ioctl_cfg80211.c
+++ b/drivers/staging/rtl8192du/os_dep/ioctl_cfg80211.c
@@ -24,7 +24,6 @@
 #include <drv_types.h>
 #include <rtw_ioctl.h>
 #include <rtw_ioctl_set.h>
-#include <rtw_ioctl_query.h>
 #include <xmit_osdep.h>
 
 #ifdef CONFIG_IOCTL_CFG80211
--- a/drivers/staging/rtl8192du/os_dep/ioctl_linux.c
+++ b/drivers/staging/rtl8192du/os_dep/ioctl_linux.c
@@ -29,7 +29,6 @@
 #include <rtw_mlme_ext.h>
 #include <rtw_ioctl.h>
 #include <rtw_ioctl_set.h>
-#include <rtw_ioctl_query.h>
 
 //#ifdef CONFIG_MP_INCLUDED
 #include <rtw_mp_ioctl.h>
