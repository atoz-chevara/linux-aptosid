From 2a39c8b578b0d1a28188316db3b08423f904b2ce Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Thu, 20 Feb 2014 16:13:05 -0600
Subject: [PATCH 234/390] rtl8192du: Remove CONFIG_DFS

This variable is always selected.

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 core/rtw_mlme_ext.c    | 41 ++---------------------------------------
 core/rtw_wlan_util.c   |  2 --
 include/autoconf.h     |  2 --
 include/rtw_mlme_ext.h |  2 --
 4 files changed, 2 insertions(+), 45 deletions(-)

--- a/drivers/staging/rtl8192du/core/rtw_mlme_ext.c
+++ b/drivers/staging/rtl8192du/core/rtw_mlme_ext.c
@@ -464,7 +464,6 @@ static u8 init_channel_set(struct rtw_ad
 
 	if (b5GBand) {
 		for (index = 0; index < RTW_ChannelPlan5G[Index5G].Len; index++) {
-#ifdef CONFIG_DFS
 			channel_set[chanset_size].ChannelNum =
 			    RTW_ChannelPlan5G[Index5G].Channel[index];
 			if (channel_set[chanset_size].ChannelNum <= 48 ||
@@ -480,27 +479,8 @@ static u8 init_channel_set(struct rtw_ad
 				    SCAN_PASSIVE;
 			}
 			chanset_size++;
-#else /* CONFIG_DFS */
-			if (RTW_ChannelPlan5G[Index5G].Channel[index] <= 48 ||
-			    RTW_ChannelPlan5G[Index5G].Channel[index] >= 149) {
-				channel_set[chanset_size].ChannelNum =
-				    RTW_ChannelPlan5G[Index5G].Channel[index];
-				if (RT_CHANNEL_DOMAIN_WORLD_WIDE_5G == ChannelPlan)	/*passive scan for all 5G channels */
-					channel_set[chanset_size].ScanType =
-					    SCAN_PASSIVE;
-				else
-					channel_set[chanset_size].ScanType =
-					    SCAN_ACTIVE;
-				DBG_8192D
-				    ("%s(): channel_set[%d].ChannelNum = %d\n",
-				     __func__, chanset_size,
-				     channel_set[chanset_size].ChannelNum);
-				chanset_size++;
-			}
-#endif /* CONFIG_DFS */
 		}
 	}
-
 	return chanset_size;
 }
 
@@ -996,10 +976,6 @@ unsigned int OnBeacon(struct rtw_adapter
 					update_beacon_info(adapt, pframe,
 							   len, psta);
 				}
-#ifdef CONFIG_DFS
-				process_csa_ie(adapt, pframe, len);	/* channel switch announcement */
-#endif /* CONFIG_DFS */
-
 #ifdef CONFIG_P2P_PS
 				process_p2p_ps_ie(adapt,
 						  (pframe + WLAN_HDR_A3_LEN),
@@ -6922,11 +6898,9 @@ void issue_assocreq(struct rtw_adapter *
 	u16 p2pielen = 0;
 #endif /* CONFIG_P2P */
 
-#ifdef CONFIG_DFS
 	u16 cap;
-	u8 pow_cap_ele[2] = { 0x00 };
-	u8 sup_ch[30 * 2] = { 0x00 }, sup_ch_idx = 0, idx_5g = 2;	/* For supported channel */
-#endif /* CONFIG_DFS */
+	u8 pow_cap_ele[2] = {0x00};
+	u8 sup_ch[30 * 2] = {0x00}, sup_ch_idx = 0, idx_5g = 2;	/* For supported channel */
 
 	pmgntframe = alloc_mgtxmitframe(pxmitpriv);
 	if (pmgntframe == NULL)
@@ -6956,14 +6930,10 @@ void issue_assocreq(struct rtw_adapter *
 
 	/* caps */
 
-#ifdef CONFIG_DFS
 	memcpy(&cap, rtw_get_capability_from_ie(pmlmeinfo->network.IEs), 2);
 	if (pmlmeext->cur_channel > 14)
 		cap |= BIT(8);	/* Spectrum Mgmt. Enabled */
 	memcpy(pframe, &cap, 2);
-#else
-	memcpy(pframe, rtw_get_capability_from_ie(pmlmeinfo->network.IEs), 2);
-#endif /* CONFIG_DFS */
 
 	pframe += 2;
 	pattrib->pktlen += 2;
@@ -7050,7 +7020,6 @@ void issue_assocreq(struct rtw_adapter *
 			       bssrate, &(pattrib->pktlen));
 	}
 
-#ifdef CONFIG_DFS
 	if (pmlmeext->cur_channel > 14) {
 		pow_cap_ele[0] = 13;	/*  Minimum transmit power capability */
 		pow_cap_ele[1] = 21;	/*  Maximum transmit power capability */
@@ -7073,7 +7042,6 @@ void issue_assocreq(struct rtw_adapter *
 		} while (pmlmeext->channel_set[sup_ch_idx].ChannelNum != 0);
 		pframe = rtw_set_ie(pframe, _SUPPORTED_CH_IE_, idx_5g, sup_ch, &(pattrib->pktlen));
 	}
-#endif /* CONFIG_DFS */
 
 	/* RSN */
 	p = rtw_get_ie((pmlmeinfo->network.IEs +
@@ -12020,7 +11988,6 @@ u8 led_blink_hdl(struct rtw_adapter *ada
 
 u8 set_csa_hdl(struct rtw_adapter *adapt, unsigned char *pbuf)
 {
-#ifdef CONFIG_DFS
 	struct setchannelswitch_param *setchannelswitch_param;
 	struct setchannelplan_param *setchannelplan_param;
 	struct mlme_priv *pmlmepriv = &adapt->mlmepriv;
@@ -12052,11 +12019,7 @@ u8 set_csa_hdl(struct rtw_adapter *adapt
 		DBG_8192D("Switched to DFS band (ch %02x) again!!\n",
 			  new_ch_no);
 	}
-
 	return H2C_SUCCESS;
-#else
-	return H2C_REJECTED;
-#endif /* CONFIG_DFS */
 }
 
 u8 tdls_hdl(struct rtw_adapter *adapt, unsigned char *pbuf)
--- a/drivers/staging/rtl8192du/core/rtw_wlan_util.c
+++ b/drivers/staging/rtl8192du/core/rtw_wlan_util.c
@@ -1021,7 +1021,6 @@ void update_beacon_info(struct rtw_adapt
 	}
 }
 
-#ifdef CONFIG_DFS
 void process_csa_ie(struct rtw_adapter *padapter, u8 *pframe, uint pkt_len)
 {
 	unsigned int i;
@@ -1045,7 +1044,6 @@ void process_csa_ie(struct rtw_adapter *
 		i += (pIE->Length + 2);
 	}
 }
-#endif /* CONFIG_DFS */
 
 unsigned int is_ap_in_tkip(struct rtw_adapter *padapter)
 {
--- a/drivers/staging/rtl8192du/include/autoconf.h
+++ b/drivers/staging/rtl8192du/include/autoconf.h
@@ -53,8 +53,6 @@
 	#endif
 #endif
 
-#define CONFIG_DFS	1
-
 #define CONFIG_LAYER2_ROAMING
 #define CONFIG_LAYER2_ROAMING_RESUME
 /* define CONFIG_IOCTL_CFG80211 */
--- a/drivers/staging/rtl8192du/include/rtw_mlme_ext.h
+++ b/drivers/staging/rtl8192du/include/rtw_mlme_ext.h
@@ -503,9 +503,7 @@ void ERP_IE_handler(struct rtw_adapter *
 void VCS_update(struct rtw_adapter *padapter, struct sta_info *psta);
 
 void update_beacon_info(struct rtw_adapter *padapter, u8 *pframe, uint len, struct sta_info *psta);
-#ifdef CONFIG_DFS
 void process_csa_ie(struct rtw_adapter *padapter, u8 *pframe, uint len);
-#endif /* CONFIG_DFS */
 void update_IOT_info(struct rtw_adapter *padapter);
 void update_capinfo(struct rtw_adapter *adapter, u16 updateCap);
 void update_wireless_mode(struct rtw_adapter *padapter);
