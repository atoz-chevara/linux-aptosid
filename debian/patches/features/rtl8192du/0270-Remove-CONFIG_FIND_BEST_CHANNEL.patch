From edd9c253ff97830a160361227ec3680cfceb3575 Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Sat, 15 Mar 2014 13:42:21 -0500
Subject: [PATCH 270/390] Remove CONFIG_FIND_BEST_CHANNEL

This one is always selected.

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 core/rtw_debug.c       |   2 -
 core/rtw_mlme_ext.c    |   3 -
 core/rtw_recv.c        |  12 +--
 hal/usb_halinit.c      |  10 --
 include/autoconf.h     |   1 -
 include/rtw_debug.h    | 243 ++++++++++++++++++++++++-------------------------
 include/rtw_mlme_ext.h |   6 +-
 os_dep/os_intfs.c      |   4 -
 8 files changed, 127 insertions(+), 154 deletions(-)

--- a/drivers/staging/rtl8192du/core/rtw_debug.c
+++ b/drivers/staging/rtl8192du/core/rtw_debug.c
@@ -1018,7 +1018,6 @@ int proc_get_all_sta_info(char *page, ch
 
 #endif
 
-#ifdef CONFIG_FIND_BEST_CHANNEL
 int proc_get_best_channel(char *page, char **start,
 			  off_t offset, int count,
 			  int *eof, void *data)
@@ -1075,6 +1074,5 @@ int proc_get_best_channel(char *page, ch
 	*eof = 1;
 	return len;
 }
-#endif /* CONFIG_FIND_BEST_CHANNEL */
 
 #endif
--- a/drivers/staging/rtl8192du/core/rtw_mlme_ext.c
+++ b/drivers/staging/rtl8192du/core/rtw_mlme_ext.c
@@ -10456,9 +10456,6 @@ u8 sitesurvey_cmd_hdl(struct rtw_adapter
 
 	if ((pmlmeext->sitesurvey_res.state == SCAN_START) ||
 	    (pmlmeext->sitesurvey_res.state == SCAN_TXNULL)) {
-#ifdef CONFIG_FIND_BEST_CHANNEL
-#endif /* CONFIG_FIND_BEST_CHANNEL */
-
 		/* disable dynamic functions, such as high power, DIG */
 		Save_DM_Func_Flag(adapt);
 		Switch_DM_Func(adapt, DYNAMIC_FUNC_DISABLE, false);
--- a/drivers/staging/rtl8192du/core/rtw_recv.c
+++ b/drivers/staging/rtl8192du/core/rtw_recv.c
@@ -1422,17 +1422,16 @@ exit:
 static int validate_recv_frame(struct rtw_adapter *adapter,
 			struct recv_frame_hdr *precv_frame)
 {
-	/* shall check frame subtype, to / from ds, da, bssid */
-
-	/* then call check if rx seq/frag. duplicated. */
+	/* shall check frame subtype, to / from ds, da, bssid
+	 * then call check if rx seq/frag. duplicated.
+	 */
+	struct rx_pkt_attrib *pattrib = &precv_frame->attrib;
+	struct mlme_ext_priv *pmlmeext = &adapter->mlmeextpriv;
 	u8 type;
 	u8 subtype;
 	int retval = _SUCCESS;
-	struct rx_pkt_attrib *pattrib = &precv_frame->attrib;
 	u8 *ptr = precv_frame->rx_data;
 	u8 ver = (unsigned char)(*ptr) & 0x3;
-#ifdef CONFIG_FIND_BEST_CHANNEL
-	struct mlme_ext_priv *pmlmeext = &adapter->mlmeextpriv;
 
 	if (pmlmeext->sitesurvey_res.state == SCAN_PROCESS) {
 		int ch_set_idx =
@@ -1441,7 +1440,6 @@ static int validate_recv_frame(struct rt
 		if (ch_set_idx >= 0)
 			pmlmeext->channel_set[ch_set_idx].rx_count++;
 	}
-#endif
 
 	/* add version chk */
 	if (ver != 0) {
--- a/drivers/staging/rtl8192du/hal/usb_halinit.c
+++ b/drivers/staging/rtl8192du/hal/usb_halinit.c
@@ -3589,7 +3589,6 @@ static void hw_var_set_mlme_sitesurvey(s
 #endif
 		reg_bcn_ctl = REG_BCN_CTRL;
 
-#ifdef CONFIG_FIND_BEST_CHANNEL
 
 	if ((check_fwstate(pmlmepriv, WIFI_AP_STATE) == true)
 #ifdef CONFIG_CONCURRENT_MODE
@@ -3603,15 +3602,6 @@ static void hw_var_set_mlme_sitesurvey(s
 	/*  Recieve all data frames */
 	value_rxfltmap2 = 0xFFFF;
 
-#else /* CONFIG_FIND_BEST_CHANNEL */
-
-	rcr_clear_bit = RCR_CBSSID_BCN;
-
-	/* config RCR to receive different BSSID & not to receive data frame */
-	value_rxfltmap2 = 0;
-
-#endif /* CONFIG_FIND_BEST_CHANNEL */
-
 	value_rcr = rtw_read32(adapter, REG_RCR);
 
 	if (*((u8 *)val))/* under sitesurvey */
--- a/drivers/staging/rtl8192du/include/autoconf.h
+++ b/drivers/staging/rtl8192du/include/autoconf.h
@@ -38,7 +38,6 @@
 #define CONFIG_RECV_REORDERING_CTRL	1
 
 #define CONFIG_92D_AP_MODE 1
-#define CONFIG_FIND_BEST_CHANNEL	1
 
 #define CONFIG_P2P	1
 
--- a/drivers/staging/rtl8192du/include/rtw_debug.h
+++ b/drivers/staging/rtl8192du/include/rtw_debug.h
@@ -211,177 +211,174 @@ extern u32 GlobalDebugLevel;
 
 #ifdef CONFIG_PROC_DEBUG
 
-	int proc_get_drv_version(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_log_level(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_set_log_level(struct file *file, const char __user *buffer,
-			unsigned long count, void *data);
-
-	int proc_get_write_reg(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
+int proc_get_drv_version(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
 
-	int proc_set_write_reg(struct file *file, const char __user *buffer,
+int proc_get_log_level(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_set_log_level(struct file *file, const char __user *buffer,
 		unsigned long count, void *data);
 
-	int proc_get_read_reg(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
+int proc_get_write_reg(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
 
-	int proc_set_read_reg(struct file *file, const char __user *buffer,
-		unsigned long count, void *data);
+int proc_set_write_reg(struct file *file, const char __user *buffer,
+	unsigned long count, void *data);
+
+int proc_get_read_reg(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_set_read_reg(struct file *file, const char __user *buffer,
+	unsigned long count, void *data);
+
+
+int proc_get_fwstate(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_sec_info(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_mlmext_state(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_qos_option(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_ht_option(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_rf_info(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_ap_info(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_adapter_state(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_trx_info(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_mac_reg_dump1(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_mac_reg_dump2(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
 
+int proc_get_mac_reg_dump3(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
 
-	int proc_get_fwstate(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_sec_info(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_mlmext_state(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_qos_option(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_ht_option(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_rf_info(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_ap_info(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_adapter_state(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_trx_info(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_mac_reg_dump1(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_mac_reg_dump2(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_mac_reg_dump3(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_bb_reg_dump1(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_bb_reg_dump2(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_bb_reg_dump3(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_rf_reg_dump1(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_rf_reg_dump2(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_rf_reg_dump3(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_rf_reg_dump4(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
+int proc_get_bb_reg_dump1(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_bb_reg_dump2(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_bb_reg_dump3(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_rf_reg_dump1(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_rf_reg_dump2(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_rf_reg_dump3(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_rf_reg_dump4(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
 
 #ifdef CONFIG_92D_AP_MODE
 
-	int proc_get_all_sta_info(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
+int proc_get_all_sta_info(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
 
 #endif
 
-#ifdef CONFIG_FIND_BEST_CHANNEL
-	int proc_get_best_channel(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-#endif
+int proc_get_best_channel(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
 
-	int proc_get_rx_signal(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
+int proc_get_rx_signal(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
 
-	int proc_set_rx_signal(struct file *file, const char __user *buffer,
-		unsigned long count, void *data);
+int proc_set_rx_signal(struct file *file, const char __user *buffer,
+	unsigned long count, void *data);
 
-	int proc_get_ht_enable(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
+int proc_get_ht_enable(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
 
-	int proc_set_ht_enable(struct file *file, const char __user *buffer,
-		unsigned long count, void *data);
+int proc_set_ht_enable(struct file *file, const char __user *buffer,
+	unsigned long count, void *data);
 
-	int proc_get_cbw40_enable(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
+int proc_get_cbw40_enable(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
 
-	int proc_set_cbw40_enable(struct file *file, const char __user *buffer,
-		unsigned long count, void *data);
+int proc_set_cbw40_enable(struct file *file, const char __user *buffer,
+	unsigned long count, void *data);
 
-	int proc_get_ampdu_enable(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
+int proc_get_ampdu_enable(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
 
-	int proc_set_ampdu_enable(struct file *file, const char __user *buffer,
-		unsigned long count, void *data);
+int proc_set_ampdu_enable(struct file *file, const char __user *buffer,
+	unsigned long count, void *data);
 
-	int proc_get_two_path_rssi(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_rx_stbc(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
+int proc_get_two_path_rssi(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
 
-	int proc_set_rx_stbc(struct file *file, const char __user *buffer,
-		unsigned long count, void *data);
+int proc_get_rx_stbc(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
 
+int proc_set_rx_stbc(struct file *file, const char __user *buffer,
+	unsigned long count, void *data);
 
-	int proc_get_vid(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_pid(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
-
-	int proc_get_rssi_disp(char *page, char **start,
-			  off_t offset, int count,
-			  int *eof, void *data);
 
-	int proc_set_rssi_disp(struct file *file, const char __user *buffer,
-		unsigned long count, void *data);
+int proc_get_vid(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_pid(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
+
+int proc_get_rssi_disp(char *page, char **start,
+		  off_t offset, int count,
+		  int *eof, void *data);
 
+int proc_set_rssi_disp(struct file *file, const char __user *buffer,
+	unsigned long count, void *data);
 
 #endif /* CONFIG_PROC_DEBUG */
 
--- a/drivers/staging/rtl8192du/include/rtw_mlme_ext.h
+++ b/drivers/staging/rtl8192du/include/rtw_mlme_ext.h
@@ -337,11 +337,9 @@ struct mlme_ext_info
 
 /*  The channel information about this channel including joining, scanning, and power constraints. */
 struct rt_channel_info {
-	u8				ChannelNum;		/*  The channel number. */
+	u8 ChannelNum;		/*  The channel number. */
 	enum RT_SCAN_TYPE	ScanType;		/*  Scan type such as passive or active scan. */
-#ifdef CONFIG_FIND_BEST_CHANNEL
-	u32				rx_count;
-#endif
+	u32 rx_count;
 };
 
 int rtw_ch_set_search_ch(struct rt_channel_info *ch_set, const u32 ch);
--- a/drivers/staging/rtl8192du/os_dep/os_intfs.c
+++ b/drivers/staging/rtl8192du/os_dep/os_intfs.c
@@ -451,14 +451,12 @@ void rtw_proc_init_one(struct net_device
 	}
 #endif
 
-#ifdef CONFIG_FIND_BEST_CHANNEL
 	entry = create_proc_read_entry("best_channel", S_IFREG | S_IRUGO,
 				   dir_dev, proc_get_best_channel, dev);
 	if (!entry) {
 		DBG_8192D("Unable to create_proc_read_entry!\n");
 		return;
 	}
-#endif
 
 	entry = create_proc_read_entry("rx_signal", S_IFREG | S_IRUGO,
 				   dir_dev, proc_get_rx_signal, dev);
@@ -566,9 +564,7 @@ void rtw_proc_remove_one(struct net_devi
 		remove_proc_entry("all_sta_info", dir_dev);
 #endif
 
-#ifdef CONFIG_FIND_BEST_CHANNEL
 		remove_proc_entry("best_channel", dir_dev);
-#endif
 		remove_proc_entry("rx_signal", dir_dev);
 
 		remove_proc_entry("cbw40_enable", dir_dev);
