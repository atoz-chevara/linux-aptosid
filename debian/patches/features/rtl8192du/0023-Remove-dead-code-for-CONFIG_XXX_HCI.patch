From 7d53930c21e1c4c33dceae573093d5ce290245f3 Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Wed, 17 Apr 2013 16:38:48 -0500
Subject: [PATCH 023/390] Remove dead code for CONFIG_XXX_HCI

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 os_dep/ioctl_linux.c | 14 --------------
 os_dep/os_intfs.c    | 32 +++++---------------------------
 os_dep/recv_linux.c  | 20 +-------------------
 os_dep/usb_intf.c    |  7 -------
 os_dep/xmit_linux.c  | 27 ---------------------------
 5 files changed, 6 insertions(+), 94 deletions(-)

--- a/drivers/staging/rtl8192du/os_dep/ioctl_linux.c
+++ b/drivers/staging/rtl8192du/os_dep/ioctl_linux.c
@@ -34,9 +34,7 @@
 #include <rtw_mp_ioctl.h>
 //#endif
 
-#ifdef CONFIG_USB_HCI
 #include <usb_ops.h>
-#endif //CONFIG_USB_HCI
 #include <rtw_version.h>
 
 #ifdef CONFIG_MP_INCLUDED
@@ -6352,9 +6350,7 @@ static int rtw_dbg_port(struct net_devic
 
 						DBG_871X("free_xmitbuf_cnt=%d, free_xmitframe_cnt=%d, free_xmit_extbuf_cnt=%d\n",
 							pxmitpriv->free_xmitbuf_cnt, pxmitpriv->free_xmitframe_cnt, pxmitpriv->free_xmit_extbuf_cnt);
-						#ifdef CONFIG_USB_HCI
 						DBG_871X("rx_urb_pending_cn=%d\n", precvpriv->rx_pending_cnt);
-						#endif
 					}
 					break;
 				case 0x09:
@@ -10651,16 +10647,6 @@ static struct xmit_frame* createloopback
 	desc->txdw5 = cpu_to_le32(desc->txdw5);
 	desc->txdw6 = cpu_to_le32(desc->txdw6);
 	desc->txdw7 = cpu_to_le32(desc->txdw7);
-#ifdef CONFIG_PCI_HCI
-	desc->txdw8 = cpu_to_le32(desc->txdw8);
-	desc->txdw9 = cpu_to_le32(desc->txdw9);
-	desc->txdw10 = cpu_to_le32(desc->txdw10);
-	desc->txdw11 = cpu_to_le32(desc->txdw11);
-	desc->txdw12 = cpu_to_le32(desc->txdw12);
-	desc->txdw13 = cpu_to_le32(desc->txdw13);
-	desc->txdw14 = cpu_to_le32(desc->txdw14);
-	desc->txdw15 = cpu_to_le32(desc->txdw15);
-#endif
 
 	rtl8723a_cal_txdesc_chksum(desc);
 
--- a/drivers/staging/rtl8192du/os_dep/os_intfs.c
+++ b/drivers/staging/rtl8192du/os_dep/os_intfs.c
@@ -143,11 +143,7 @@ int rtw_hwpwrp_detect = 1;
 int rtw_hwpwrp_detect = 0; //HW power  ping detect 0:disable , 1:enable
 #endif
 
-#ifdef CONFIG_USB_HCI
 int rtw_hw_wps_pbc = 1;
-#else
-int rtw_hw_wps_pbc = 0;
-#endif
 
 #ifdef CONFIG_TX_MCAST2UNI
 int rtw_mc2u_disable = 0;
@@ -1521,9 +1517,7 @@ u8 rtw_free_drv_sw(_adapter *padapter)
 
 #ifdef CONFIG_CONCURRENT_MODE
 
-#ifdef CONFIG_USB_HCI
-	#include <usb_hal.h>
-#endif
+#include <usb_hal.h>
 
 #ifdef CONFIG_MULTI_VIR_IFACES
 int _netdev_vir_if_open(struct net_device *pnetdev)
@@ -1722,17 +1716,9 @@ _adapter *rtw_drv_add_vir_if(_adapter *p
 
 	//set hal data & hal ops
 #if defined(CONFIG_RTL8192C)
-	#if defined(CONFIG_PCI_HCI)
-		rtl8192ce_set_hal_ops(padapter);
-	#elif defined(CONFIG_USB_HCI)
-		rtl8192cu_set_hal_ops(padapter);
-	#endif
+	rtl8192cu_set_hal_ops(padapter);
 #elif defined(CONFIG_RTL8192D)
-	#if defined(CONFIG_PCI_HCI)
-		rtl8192de_set_hal_ops(padapter);
-	#elif defined(CONFIG_USB_HCI)
-		rtl8192du_set_hal_ops(padapter);
-	#endif
+	rtl8192du_set_hal_ops(padapter);
 #endif
 
 	padapter->HalFunc.inirp_init = NULL;
@@ -2114,17 +2100,9 @@ _adapter *rtw_drv_if2_init(_adapter *pri
 
 	//set hal data & hal ops
 #if defined(CONFIG_RTL8192C)
-	#if defined(CONFIG_PCI_HCI)
-		rtl8192ce_set_hal_ops(padapter);
-	#elif defined(CONFIG_USB_HCI)
-		rtl8192cu_set_hal_ops(padapter);
-	#endif
+	rtl8192cu_set_hal_ops(padapter);
 #elif defined(CONFIG_RTL8192D)
-	#if defined(CONFIG_PCI_HCI)
-		rtl8192de_set_hal_ops(padapter);
-	#elif defined(CONFIG_USB_HCI)
-		rtl8192du_set_hal_ops(padapter);
-	#endif
+	rtl8192du_set_hal_ops(padapter);
 #endif
 
 	padapter->HalFunc.inirp_init = NULL;
--- a/drivers/staging/rtl8192du/os_dep/recv_linux.c
+++ b/drivers/staging/rtl8192du/os_dep/recv_linux.c
@@ -29,9 +29,7 @@
 #include <osdep_intf.h>
 #include <ethernet.h>
 
-#ifdef CONFIG_USB_HCI
 #include <usb_ops.h>
-#endif
 
 //init os related resource in struct recv_priv
 int rtw_os_recv_resource_init(struct recv_priv *precvpriv, _adapter *padapter)
@@ -64,7 +62,6 @@ int rtw_os_recvbuf_resource_alloc(_adapt
 {
 	int res=_SUCCESS;
 
-#ifdef CONFIG_USB_HCI
 	struct dvobj_priv	*pdvobjpriv = adapter_to_dvobj(padapter);
 	struct usb_device	*pusbd = pdvobjpriv->pusbdev;
 
@@ -92,9 +89,6 @@ int rtw_os_recvbuf_resource_alloc(_adapt
 	if(precvbuf->pallocated_buf == NULL)
 		return _FAIL;
 	#endif //CONFIG_USE_USB_BUFFER_ALLOC_RX
-
-#endif //CONFIG_USB_HCI
-
 	return res;
 }
 
@@ -103,8 +97,6 @@ int rtw_os_recvbuf_resource_free(_adapte
 {
 	int ret = _SUCCESS;
 
-#ifdef CONFIG_USB_HCI
-
 #ifdef CONFIG_USE_USB_BUFFER_ALLOC_RX
 
 	struct dvobj_priv	*pdvobjpriv = adapter_to_dvobj(padapter);
@@ -122,9 +114,6 @@ int rtw_os_recvbuf_resource_free(_adapte
 		usb_free_urb(precvbuf->purb);
 	}
 
-#endif //CONFIG_USB_HCI
-
-
 	if(precvbuf->pskb)
 		dev_kfree_skb_any(precvbuf->pskb);
 
@@ -409,8 +398,6 @@ void rtw_os_read_port(_adapter *padapter
 {
 	struct recv_priv *precvpriv = &padapter->recvpriv;
 
-#ifdef CONFIG_USB_HCI
-
 	precvbuf->ref_cnt--;
 
 	//free skb in recv_buf
@@ -425,13 +412,8 @@ void rtw_os_read_port(_adapter *padapter
 	}
 
 
-#endif
-#ifdef CONFIG_SDIO_HCI
-		precvbuf->pskb = NULL;
-#endif
-
 }
-void _rtw_reordering_ctrl_timeout_handler (void *FunctionContext);
+
 void _rtw_reordering_ctrl_timeout_handler (void *FunctionContext)
 {
 	struct recv_reorder_ctrl *preorder_ctrl = (struct recv_reorder_ctrl *)FunctionContext;
--- a/drivers/staging/rtl8192du/os_dep/usb_intf.c
+++ b/drivers/staging/rtl8192du/os_dep/usb_intf.c
@@ -26,13 +26,6 @@
 #include <xmit_osdep.h>
 #include <hal_intf.h>
 #include <rtw_version.h>
-
-#ifndef CONFIG_USB_HCI
-
-#error "CONFIG_USB_HCI shall be on!\n"
-
-#endif
-
 #include <usb_vendor_req.h>
 #include <usb_ops.h>
 #include <usb_osintf.h>
--- a/drivers/staging/rtl8192du/os_dep/xmit_linux.c
+++ b/drivers/staging/rtl8192du/os_dep/xmit_linux.c
@@ -126,7 +126,6 @@ void rtw_set_tx_chksum_offload(_pkt *pkt
 
 int rtw_os_xmit_resource_alloc(_adapter *padapter, struct xmit_buf *pxmitbuf,u32 alloc_sz)
 {
-#ifdef CONFIG_USB_HCI
 	int i;
 	struct dvobj_priv	*pdvobjpriv = adapter_to_dvobj(padapter);
 	struct usb_device	*pusbd = pdvobjpriv->pusbdev;
@@ -159,23 +158,11 @@ int rtw_os_xmit_resource_alloc(_adapter
 		}
 
 	}
-#endif
-#if defined(CONFIG_PCI_HCI) || defined(CONFIG_SDIO_HCI)
-	pxmitbuf->pallocated_buf = rtw_zmalloc(alloc_sz);
-	if (pxmitbuf->pallocated_buf == NULL)
-	{
-		return _FAIL;
-	}
-
-	pxmitbuf->pbuf = (u8 *)N_BYTE_ALIGMENT((SIZE_PTR)(pxmitbuf->pallocated_buf), XMITBUF_ALIGN_SZ);
-#endif
-
 	return _SUCCESS;
 }
 
 void rtw_os_xmit_resource_free(_adapter *padapter, struct xmit_buf *pxmitbuf,u32 free_sz)
 {
-#ifdef CONFIG_USB_HCI
 	int i;
 	struct dvobj_priv	*pdvobjpriv = adapter_to_dvobj(padapter);
 	struct usb_device	*pusbd = pdvobjpriv->pusbdev;
@@ -198,12 +185,6 @@ void rtw_os_xmit_resource_free(_adapter
 	if(pxmitbuf->pallocated_buf)
 		rtw_mfree(pxmitbuf->pallocated_buf, free_sz);
 #endif	// CONFIG_USE_USB_BUFFER_ALLOC_TX
-
-#endif
-#if defined(CONFIG_PCI_HCI) || defined(CONFIG_SDIO_HCI)
-	if(pxmitbuf->pallocated_buf)
-		rtw_mfree(pxmitbuf->pallocated_buf, free_sz);
-#endif
 }
 
 void rtw_os_pkt_complete(_adapter *padapter, _pkt *pkt)
@@ -242,13 +223,6 @@ void rtw_os_xmit_complete(_adapter *pada
 
 void rtw_os_xmit_schedule(_adapter *padapter)
 {
-#ifdef CONFIG_SDIO_HCI
-	if(!padapter)
-		return;
-
-	if (rtw_txframes_pending(padapter))
-		_rtw_up_sema(&padapter->xmitpriv.xmit_sema);
-#else
 	_irqL  irqL;
 	struct xmit_priv *pxmitpriv;
 
@@ -265,7 +239,6 @@ void rtw_os_xmit_schedule(_adapter *pada
 	}
 
 	_exit_critical_bh(&pxmitpriv->lock, &irqL);
-#endif
 }
 
 
