From ed7e54992bc0510b5004de4c2b4af0403d1c7370 Mon Sep 17 00:00:00 2001
From: Stefan Lippers-Hollmann <s.l-h@gmx.de>
Date: Sat, 22 Mar 2014 03:03:24 +0100
Subject: [PATCH 426/456] rtl8192du: replace custom _rtw_init_sema() with
 sema_init()

Signed-off-by: Stefan Lippers-Hollmann <s.l-h@gmx.de>
---
 core/rtw_cmd.c          | 4 ++--
 core/rtw_recv.c         | 2 +-
 core/rtw_xmit.c         | 6 +++---
 include/osdep_service.h | 1 -
 include/rtw_pwrctrl.h   | 2 +-
 os_dep/osdep_service.c  | 5 -----
 os_dep/usb_intf.c       | 2 +-
 7 files changed, 8 insertions(+), 14 deletions(-)

--- a/drivers/staging/rtl8192du/core/rtw_cmd.c
+++ b/drivers/staging/rtl8192du/core/rtw_cmd.c
@@ -31,8 +31,8 @@ int _rtw_init_cmd_priv(struct cmd_priv *
 {
 	int res = _SUCCESS;
 
-	_rtw_init_sema(&(pcmdpriv->cmd_queue_sema), 0);
-	_rtw_init_sema(&(pcmdpriv->terminate_cmdthread_sema), 0);
+	sema_init(&(pcmdpriv->cmd_queue_sema), 0);
+	sema_init(&(pcmdpriv->terminate_cmdthread_sema), 0);
 
 	_rtw_init_queue(&(pcmdpriv->cmd_queue));
 
--- a/drivers/staging/rtl8192du/core/rtw_recv.c
+++ b/drivers/staging/rtl8192du/core/rtw_recv.c
@@ -86,7 +86,7 @@ int _rtw_init_recv_priv(struct recv_priv
 	}
 	precvpriv->rx_pending_cnt = 1;
 
-	_rtw_init_sema(&precvpriv->allrxreturnevt, 0);
+	sema_init(&precvpriv->allrxreturnevt, 0);
 	res = rtw_hal_init_recv_priv(padapter);
 
 	precvpriv->recvbuf_skb_alloc_fail_cnt = 0;
--- a/drivers/staging/rtl8192du/core/rtw_xmit.c
+++ b/drivers/staging/rtl8192du/core/rtw_xmit.c
@@ -67,8 +67,8 @@ s32	_rtw_init_xmit_priv(struct xmit_priv
 	/* memset((unsigned char *)pxmitpriv, 0, sizeof(struct xmit_priv)); */
 
 	spin_lock_init(&pxmitpriv->lock);
-	_rtw_init_sema(&pxmitpriv->xmit_sema, 0);
-	_rtw_init_sema(&pxmitpriv->terminate_xmitthread_sema, 0);
+	sema_init(&pxmitpriv->xmit_sema, 0);
+	sema_init(&pxmitpriv->terminate_xmitthread_sema, 0);
 
 	/*
 	Please insert all the queue initializaiton using _rtw_init_queue below
@@ -194,7 +194,7 @@ s32	_rtw_init_xmit_priv(struct xmit_priv
 
 	pxmitpriv->txirp_cnt = 1;
 
-	_rtw_init_sema(&(pxmitpriv->tx_retevt), 0);
+	sema_init(&(pxmitpriv->tx_retevt), 0);
 
 	/* per AC pending irp */
 	pxmitpriv->beq_cnt = 0;
--- a/drivers/staging/rtl8192du/include/osdep_service.h
+++ b/drivers/staging/rtl8192du/include/osdep_service.h
@@ -178,7 +178,6 @@ enum {
 
 #define rtw_update_mem_stat(flag, sz) do {} while (0)
 
-void	_rtw_init_sema(struct  semaphore *sema, int init_val);
 void	_rtw_free_sema(struct  semaphore *sema);
 void	_rtw_up_sema(struct  semaphore *sema);
 u32	_rtw_down_sema(struct  semaphore *sema);
--- a/drivers/staging/rtl8192du/include/rtw_pwrctrl.h
+++ b/drivers/staging/rtl8192du/include/rtw_pwrctrl.h
@@ -103,7 +103,7 @@ struct reportpwrstate_parm {
 
 static inline void _init_pwrlock(struct  semaphore *plock)
 {
-	_rtw_init_sema(plock, 1);
+	sema_init(plock, 1);
 }
 
 static inline void _free_pwrlock(struct  semaphore *plock)
--- a/drivers/staging/rtl8192du/os_dep/osdep_service.c
+++ b/drivers/staging/rtl8192du/os_dep/osdep_service.c
@@ -36,11 +36,6 @@ inline int RTW_STATUS_CODE(int error_cod
 	}
 }
 
-void _rtw_init_sema(struct  semaphore *sema, int init_val)
-{
-	sema_init(sema, init_val);
-}
-
 void _rtw_free_sema(struct  semaphore *sema)
 {
 }
--- a/drivers/staging/rtl8192du/os_dep/usb_intf.c
+++ b/drivers/staging/rtl8192du/os_dep/usb_intf.c
@@ -212,7 +212,7 @@ static struct dvobj_priv *usb_dvobj_init
 	}
 
 	/* 3 misc */
-	_rtw_init_sema(&(pdvobjpriv->usb_suspend_sema), 0);
+	sema_init(&(pdvobjpriv->usb_suspend_sema), 0);
 
 	rtw_reset_continual_urb_error(pdvobjpriv);
 
