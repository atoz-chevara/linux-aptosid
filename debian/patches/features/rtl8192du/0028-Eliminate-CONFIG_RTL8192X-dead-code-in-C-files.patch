From 55625c94fd13323690284fdf67505fe2e3edb3d4 Mon Sep 17 00:00:00 2001
From: Larry Finger <Larry.Finger@lwfinger.net>
Date: Wed, 17 Apr 2013 18:10:29 -0500
Subject: [PATCH 028/210] Eliminate CONFIG_RTL8192X dead code in C files

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
---
 hal/hal_com.c        |   7 ---
 hal/rtl8192d_mp.c    |  53 +++++++-------------
 os_dep/ioctl_linux.c | 137 ++++++++++++++++++---------------------------------
 os_dep/os_intfs.c    |   8 ---
 os_dep/usb_intf.c    |  49 +-----------------
 5 files changed, 65 insertions(+), 189 deletions(-)

--- a/drivers/staging/rtl8192du/hal/hal_com.c
+++ b/drivers/staging/rtl8192du/hal/hal_com.c
@@ -21,16 +21,9 @@
 #include <osdep_service.h>
 #include <drv_types.h>
 #include <rtw_byteorder.h>
-
 #include <hal_intf.h>
 #include <hal_com.h>
-
-#ifdef CONFIG_RTL8192C
-#include <rtl8192c_hal.h>
-#endif
-#ifdef CONFIG_RTL8192D
 #include <rtl8192d_hal.h>
-#endif
 
 #define _HAL_COM_C_
 
--- a/drivers/staging/rtl8192du/hal/rtl8192d_mp.c
+++ b/drivers/staging/rtl8192du/hal/rtl8192d_mp.c
@@ -22,10 +22,7 @@
 
 #include <drv_types.h>
 #include <rtw_mp.h>
-
-#ifdef CONFIG_RTL8192D
 #include <rtl8192d_hal.h>
-#endif
 
 #define IQK_DELAY_TIME		1	//ms
 
@@ -249,34 +246,27 @@ void Hal_SetAntenna(PADAPTER pAdapter)
 			break;
 	}
 
-	if (chgTx && chgRx)
-	{
-		switch(pHalData->rf_chip)
-		{
-			case RF_8225:
-			case RF_8256:
-			case RF_6052:
-				//r_ant_sel_cck_val = r_ant_select_cck_val;
-				PHY_SetBBReg(pAdapter, rFPGA1_TxInfo, 0x7fffffff, r_ant_select_ofdm_val);	//OFDM Tx
-				PHY_SetBBReg(pAdapter, rFPGA0_TxInfo, 0x0000000f, r_ofdm_tx_en_val);		//OFDM Tx
-				PHY_SetBBReg(pAdapter, rOFDM0_TRxPathEnable, 0x0000000f, r_rx_antenna_ofdm);	//OFDM Rx
-				PHY_SetBBReg(pAdapter, rOFDM1_TRxPathEnable, 0x0000000f, r_rx_antenna_ofdm);	//OFDM Rx
-				PHY_SetBBReg(pAdapter, rCCK0_AFESetting, bMaskByte3, r_ant_select_cck_val);//r_ant_sel_cck_val);		//CCK TxRx
-#ifdef CONFIG_RTL8192D
-				if(pHalData->CurrentBandType92D == BAND_ON_2_4G || IS_92D_SINGLEPHY(pHalData->VersionID))
-						rtw_write8(pAdapter, rCCK0_AFESetting+3, r_ant_select_cck_val);
-#endif
-				break;
-
-			default:
-				break;
+	if (chgTx && chgRx) {
+		switch(pHalData->rf_chip) {
+		case RF_8225:
+		case RF_8256:
+		case RF_6052:
+			//r_ant_sel_cck_val = r_ant_select_cck_val;
+			PHY_SetBBReg(pAdapter, rFPGA1_TxInfo, 0x7fffffff, r_ant_select_ofdm_val);	//OFDM Tx
+			PHY_SetBBReg(pAdapter, rFPGA0_TxInfo, 0x0000000f, r_ofdm_tx_en_val);		//OFDM Tx
+			PHY_SetBBReg(pAdapter, rOFDM0_TRxPathEnable, 0x0000000f, r_rx_antenna_ofdm);	//OFDM Rx
+			PHY_SetBBReg(pAdapter, rOFDM1_TRxPathEnable, 0x0000000f, r_rx_antenna_ofdm);	//OFDM Rx
+			PHY_SetBBReg(pAdapter, rCCK0_AFESetting, bMaskByte3, r_ant_select_cck_val);//r_ant_sel_cck_val);		//CCK TxRx
+			if(pHalData->CurrentBandType92D == BAND_ON_2_4G || IS_92D_SINGLEPHY(pHalData->VersionID))
+					rtw_write8(pAdapter, rCCK0_AFESetting+3, r_ant_select_cck_val);
+			break;
+		default:
+			break;
 		}
 	}
-
 	RT_TRACE(_module_mp_, _drv_notice_, ("-SwitchAntenna: finished\n"));
 }
 
-
 s32 Hal_SetPowerTracking(PADAPTER padapter, u8 enable)
 {
 	HAL_DATA_TYPE	*pHalData = GET_HAL_DATA(padapter);
@@ -1610,16 +1600,7 @@ void Hal_SetCCKContinuousTx(PADAPTER pAd
 		write_bbreg(pAdapter, rCCK0_System, bCCKBBMode, 0x2);	//transmit mode
 		write_bbreg(pAdapter, rCCK0_System, bCCKScramble, bEnable); //turn on scramble setting
 
-#ifdef CONFIG_RTL8192C
-		// Patch for CCK 11M waveform
-		if (cckrate == MPT_RATE_1M)
-			write_bbreg(pAdapter, 0xA71, BIT(6), bDisable);
-		else
-			write_bbreg(pAdapter, 0xA71, BIT(6), bEnable);
-#endif
-
-	}
-	else {
+	} else {
 		RT_TRACE(_module_mp_, _drv_info_,
 			 ("SetCCKContinuousTx: test stop\n"));
 
--- a/drivers/staging/rtl8192du/os_dep/ioctl_linux.c
+++ b/drivers/staging/rtl8192du/os_dep/ioctl_linux.c
@@ -8272,14 +8272,8 @@ static int rtw_mp_efuse_get(struct net_d
 	}
 	else if ( strcmp(tmp[0],"mac") == 0 ) {
 		if ( tmp[1]==NULL || tmp[2]==NULL ) return	-EINVAL;
-		#ifdef CONFIG_RTL8192C
-		addr = 0x16;
-		cnts = 6;
-		#endif
-		#ifdef CONFIG_RTL8192D
 		addr = 0x19;
 		cnts = 6;
-		#endif
 		EFUSE_GetEfuseDefinition(padapter, EFUSE_WIFI, TYPE_AVAILABLE_EFUSE_BYTES_TOTAL, (PVOID)&max_available_size, _FALSE);
 		if ((addr + mapLen) > max_available_size) {
 			DBG_871X("(addr + cnts parameter error \n");
@@ -8304,12 +8298,7 @@ static int rtw_mp_efuse_get(struct net_d
 	}
 	else if ( strcmp(tmp[0],"vidpid") == 0 ) {
 		if ( tmp[1]==NULL || tmp[2]==NULL ) return	-EINVAL;
-		#ifdef CONFIG_RTL8192C
-		addr=0x0a;
-		#endif
-		#ifdef CONFIG_RTL8192D
 		addr = 0x0c;
-		#endif
 		cnts = 4;
 		EFUSE_GetEfuseDefinition(padapter, EFUSE_WIFI, TYPE_AVAILABLE_EFUSE_BYTES_TOTAL, (PVOID)&max_available_size, _FALSE);
 		if ((addr + mapLen) > max_available_size) {
@@ -8441,12 +8430,7 @@ static int rtw_mp_efuse_set(struct net_d
 	else if ( strcmp(tmp[0],"mac") == 0 ) {
 			 if ( tmp[1]==NULL || tmp[2]==NULL ) return	-EINVAL;
 			//mac,00e04c871200
-			#ifdef CONFIG_RTL8192C
-				addr = 0x16;
-			#endif
-			#ifdef CONFIG_RTL8192D
 				addr = 0x19;
-			#endif
 				cnts = strlen( tmp[1] )/2;
 				if ( cnts == 0) return -EFAULT;
 				if ( cnts > 6 ){
@@ -8476,42 +8460,38 @@ static int rtw_mp_efuse_set(struct net_d
 			return 0;
 		}
 		else if ( strcmp(tmp[0],"vidpid") == 0 ) {
-			 if ( tmp[1]==NULL || tmp[2]==NULL ) return	-EINVAL;
+			if ( tmp[1]==NULL || tmp[2]==NULL )
+				return	-EINVAL;
 				// pidvid,da0b7881
-				#ifdef CONFIG_RTL8192C
-					   addr=0x0a;
-				#endif
-				#ifdef CONFIG_RTL8192D
-					addr = 0x0c;
-				#endif
+			addr = 0x0c;
 
-				cnts=strlen( tmp[1] )/2;
-				if ( cnts == 0) return -EFAULT;
-				DBG_871X("target data = %s \n" ,tmp[1]);
+			cnts=strlen( tmp[1] )/2;
+			if ( cnts == 0)
+				return -EFAULT;
+			DBG_871X("target data = %s \n" ,tmp[1]);
 
-				for( jj = 0, kk = 0; jj < cnts; jj++, kk += 2 )
+			for( jj = 0, kk = 0; jj < cnts; jj++, kk += 2 )
 				{
-					setdata[jj] = key_2char2num(tmp[1][kk], tmp[1][kk+ 1]);
-				}
+				setdata[jj] = key_2char2num(tmp[1][kk], tmp[1][kk+ 1]);
+			}
 
-				EFUSE_GetEfuseDefinition(padapter, EFUSE_WIFI, TYPE_AVAILABLE_EFUSE_BYTES_TOTAL, (PVOID)&max_available_size, _FALSE);
+			EFUSE_GetEfuseDefinition(padapter, EFUSE_WIFI, TYPE_AVAILABLE_EFUSE_BYTES_TOTAL, (PVOID)&max_available_size, _FALSE);
 
-				if ((addr + cnts) > max_available_size) {
-						DBG_871X("parameter error \n");
-						return -EFAULT;
-					}
+			if ((addr + cnts) > max_available_size) {
+				DBG_871X("parameter error \n");
+				return -EFAULT;
+			}
 
-				if ( rtw_efuse_map_write(padapter, addr, cnts, setdata) == _FAIL ) {
-					DBG_871X("rtw_efuse_map_write error \n");
-					return -EFAULT;
-				} else
-					DBG_871X("rtw_efuse_map_write ok \n");
+			if ( rtw_efuse_map_write(padapter, addr, cnts, setdata) == _FAIL ) {
+				DBG_871X("rtw_efuse_map_write error \n");
+				return -EFAULT;
+			} else
+				DBG_871X("rtw_efuse_map_write ok \n");
 
-				return 0;
-		}
-		else{
-				 DBG_871X("Command not found\n");
-			   return 0;
+			return 0;
+		} else{
+			DBG_871X("Command not found\n");
+			return 0;
 		}
 
 	  return 0;
@@ -9313,12 +9293,7 @@ static int rtw_mp_thermal(struct net_dev
 {
 	u8 val;
 	u16 bwrite=1;
-	#ifdef CONFIG_RTL8192C
-		u16 addr=0x78;
-	#endif
-	#ifdef CONFIG_RTL8192D
-		u16 addr=0xc3;
-	#endif
+	u16 addr=0xc3;
 	u16 cnt=1;
 	u16 max_available_size=0;
 	PADAPTER padapter = rtw_netdev_priv(dev);
@@ -9326,37 +9301,26 @@ static int rtw_mp_thermal(struct net_dev
 	if (copy_from_user(extra, wrqu->pointer, wrqu->length))
 		return -EFAULT;
 
-	//DBG_871X("print extra %s \n",extra);
-
 	 bwrite = strncmp(extra, "write", 6); // strncmp TRUE is 0
 
 	 Hal_GetThermalMeter(padapter, &val);
 
-	 if( bwrite == 0 )
-	 {
-		 //DBG_871X("to write val:%d",val);
-			EFUSE_GetEfuseDefinition(padapter, EFUSE_WIFI, TYPE_AVAILABLE_EFUSE_BYTES_TOTAL, (PVOID)&max_available_size, _FALSE);
-			if( 2 > max_available_size )
-			{
-				DBG_871X("no available efuse!\n");
-				return -EFAULT;
-			}
-			if ( rtw_efuse_map_write(padapter, addr, cnt, &val) == _FAIL )
-			{
-				DBG_871X("rtw_efuse_map_write error \n");
-				return -EFAULT;
-			}
-			else
-			{
-				 sprintf(extra, " efuse write ok :%d", val);
-			}
-	  }
-	  else
-	  {
-			 sprintf(extra, "%d", val);
-	  }
+	 if( bwrite == 0 ) {
+		EFUSE_GetEfuseDefinition(padapter, EFUSE_WIFI, TYPE_AVAILABLE_EFUSE_BYTES_TOTAL, (PVOID)&max_available_size, _FALSE);
+		if( 2 > max_available_size ) {
+			DBG_871X("no available efuse!\n");
+			return -EFAULT;
+		}
+		if ( rtw_efuse_map_write(padapter, addr, cnt, &val) == _FAIL ) {
+			DBG_871X("rtw_efuse_map_write error \n");
+			return -EFAULT;
+		} else {
+			sprintf(extra, " efuse write ok :%d", val);
+		}
+	} else {
+		sprintf(extra, "%d", val);
+	}
 	wrqu->length = strlen(extra);
-
 	return 0;
 }
 
@@ -9419,19 +9383,14 @@ static int rtw_mp_dump(struct net_device
 			else
 				path_nums = 2;
 
-			for(path=0;path<path_nums;path++)
-			{
-#ifdef CONFIG_RTL8192D
-			  for (i = 0; i < 0x50; i++)
-#else
-			 for (i = 0; i < 0x34; i++)
-#endif
-				{
-					//value = PHY_QueryRFReg(padapter, (RF90_RADIO_PATH_E)path,i, bMaskDWord);
+			for(path=0;path<path_nums;path++) {
+				for (i = 0; i < 0x50; i++) {
 					value =rtw_hal_read_rfreg(padapter, path, i, 0xffffffff);
-					if(j%4==1)	DBG_871X("0x%02x ",i);
+					if (j%4==1)
+						DBG_871X("0x%02x ",i);
 					DBG_871X(" 0x%08x ",value);
-					if((j++)%4==0)	DBG_871X("\n");
+					if ((j++)%4==0)
+						DBG_871X("\n");
 				}
 			}
 	}
@@ -9456,9 +9415,7 @@ static int rtw_mp_phypara(struct net_dev
 
 	if (!IS_HARDWARE_TYPE_8192D(padapter))
 			return 0;
-#ifdef CONFIG_RTL8192D
 	Hal_ProSetCrystalCap( padapter , valxcap );
-#endif
 
 	sprintf( extra, "Set xcap=%d",valxcap );
 	wrqu->length = strlen(extra) + 1;
--- a/drivers/staging/rtl8192du/os_dep/os_intfs.c
+++ b/drivers/staging/rtl8192du/os_dep/os_intfs.c
@@ -1715,11 +1715,7 @@ _adapter *rtw_drv_add_vir_if(_adapter *p
 	padapter->HardwareType = primary_padapter->HardwareType;
 
 	//set hal data & hal ops
-#if defined(CONFIG_RTL8192C)
-	rtl8192cu_set_hal_ops(padapter);
-#elif defined(CONFIG_RTL8192D)
 	rtl8192du_set_hal_ops(padapter);
-#endif
 
 	padapter->HalFunc.inirp_init = NULL;
 	padapter->HalFunc.inirp_deinit = NULL;
@@ -2099,11 +2095,7 @@ _adapter *rtw_drv_if2_init(_adapter *pri
 	padapter->HardwareType = primary_padapter->HardwareType;
 
 	//set hal data & hal ops
-#if defined(CONFIG_RTL8192C)
-	rtl8192cu_set_hal_ops(padapter);
-#elif defined(CONFIG_RTL8192D)
 	rtl8192du_set_hal_ops(padapter);
-#endif
 
 	padapter->HalFunc.inirp_init = NULL;
 	padapter->HalFunc.inirp_deinit = NULL;
--- a/drivers/staging/rtl8192du/os_dep/usb_intf.c
+++ b/drivers/staging/rtl8192du/os_dep/usb_intf.c
@@ -173,15 +173,8 @@ static void rtw_dev_remove(struct usb_in
 	/****** 8192DU-WiFi Display Dongle ********/ \
 	{USB_DEVICE(0x2019, 0xAB2D)},/* Planex - Abocom ,5G dongle for WiFi Display */
 
-#ifndef CONFIG_RTL8192C
 	#undef RTL8192C_USB_IDS
 	#define RTL8192C_USB_IDS
-#endif
-#ifndef CONFIG_RTL8192D
-	#undef RTL8192D_USB_IDS
-	#define RTL8192D_USB_IDS
-#endif
-
 
 static struct usb_device_id rtw_usb_id_tbl[] ={
 	RTL8192C_USB_IDS
@@ -206,31 +199,6 @@ struct rtw_usb_drv {
 	int drv_registered;
 };
 
-#ifdef CONFIG_RTL8192C
-static struct usb_device_id rtl8192c_usb_id_tbl[] ={
-	RTL8192C_USB_IDS
-	{}	/* Terminating entry */
-};
-
-struct rtw_usb_drv rtl8192c_usb_drv = {
-	.usbdrv.name = (char*)"rtl8192cu",
-	.usbdrv.probe = rtw_drv_init,
-	.usbdrv.disconnect = rtw_dev_remove,
-	.usbdrv.id_table = rtl8192c_usb_id_tbl,
-	.usbdrv.suspend =  rtw_suspend,
-	.usbdrv.resume = rtw_resume,
-	#if (LINUX_VERSION_CODE > KERNEL_VERSION(2, 6, 22))
-	.usbdrv.reset_resume   = rtw_resume,
-	#endif
-	#ifdef CONFIG_AUTOSUSPEND
-	.usbdrv.supports_autosuspend = 1,
-	#endif
-};
-
-static struct rtw_usb_drv *usb_drv = &rtl8192c_usb_drv;
-#endif /* CONFIG_RTL8192C */
-
-#ifdef CONFIG_RTL8192D
 static struct usb_device_id rtl8192d_usb_id_tbl[] ={
 	RTL8192D_USB_IDS
 	{}	/* Terminating entry */
@@ -251,7 +219,6 @@ struct rtw_usb_drv rtl8192d_usb_drv = {
 	#endif
 };
 static struct rtw_usb_drv *usb_drv = &rtl8192d_usb_drv;
-#endif /* CONFIG_RTL8192D */
 
 static inline int RT_usb_endpoint_dir_in(const struct usb_endpoint_descriptor *epd)
 {
@@ -540,17 +507,9 @@ _func_exit_;
 static void decide_chip_type_by_usb_device_id(_adapter *padapter, const struct usb_device_id *pdid)
 {
 	padapter->chip_type = NULL_CHIP_TYPE;
-#ifdef CONFIG_RTL8192C
-	padapter->chip_type = RTL8188C_8192C;
-	padapter->HardwareType = HARDWARE_TYPE_RTL8192CU;
-	DBG_871X("CHIP TYPE: RTL8188C_8192C\n");
-#endif
-
-#ifdef CONFIG_RTL8192D
 	padapter->chip_type = RTL8192D;
 	padapter->HardwareType = HARDWARE_TYPE_RTL8192DU;
 	DBG_871X("CHIP TYPE: RTL8192D\n");
-#endif
 }
 
 static void usb_intf_start(_adapter *padapter)
@@ -1155,14 +1114,8 @@ _adapter *rtw_usb_if1_init(struct dvobj_
 #endif
 
 	//step 2. hook HalFunc, allocate HalData
-	if(padapter->chip_type == RTL8188C_8192C) {
-		#ifdef CONFIG_RTL8192C
-		rtl8192cu_set_hal_ops(padapter);
-		#endif
-	} else if(padapter->chip_type == RTL8192D) {
-		#ifdef CONFIG_RTL8192D
+	if(padapter->chip_type == RTL8192D) {
 		rtl8192du_set_hal_ops(padapter);
-		#endif
 	} else {
 		DBG_871X("Detect NULL_CHIP_TYPE\n");
 		goto free_wdev;
